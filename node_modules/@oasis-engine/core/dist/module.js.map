{"version":3,"file":"module.js","sources":["../src/asset/AssetPromise.ts","../src/base/Util.ts","../src/asset/ResourceManager.ts","../src/base/Event.ts","../src/clone/enums/CloneMode.ts","../src/clone/CloneManager.ts","../src/base/EngineObject.ts","../src/base/EventDispatcher.ts","../src/base/Logger.ts","../src/base/Time.ts","../src/base/Constant.ts","../src/DisorderedArray.ts","../src/shader/ShaderMacroCollection.ts","../src/ComponentsManager.ts","../src/clone/ComponentCloner.ts","../src/ComponentsDependencies.ts","../src/Layer.ts","../src/Component.ts","../src/UpdateFlag.ts","../src/Transform.ts","../src/Entity.ts","../src/FeatureManager.ts","../src/RenderPipeline/RenderElement.ts","../src/SceneFeature.ts","../src/shader/enums/BlendFactor.ts","../src/shader/enums/BlendOperation.ts","../src/shader/enums/ColorWriteMask.ts","../src/shader/enums/CompareFunction.ts","../src/shader/enums/CullMode.ts","../src/shader/enums/StencilOperation.ts","../src/material/enums/RenderQueueType.ts","../src/RenderPipeline/RenderQueue.ts","../src/shaderlib/pbr/index.ts","../src/shaderlib/ShaderLib.ts","../src/shaderlib/ShaderFactory.ts","../src/shader/ShaderMacro.ts","../src/shader/enums/ShaderDataGroup.ts","../src/shader/ShaderUniform.ts","../src/shader/ShaderUniformBlock.ts","../src/shader/ShaderProgram.ts","../src/shader/ShaderProperty.ts","../src/shader/Shader.ts","../src/lighting/Light.ts","../src/lighting/AmbientLight.ts","../src/lighting/DirectLight.ts","../src/lighting/EnvironmentMapLight.ts","../src/lighting/PointLight.ts","../src/lighting/SpotLight.ts","../src/lighting/LightFeature.ts","../src/asset/RefObject.ts","../src/material/type.ts","../src/texture/enums/RenderBufferColorFormat.ts","../src/texture/enums/RenderBufferDepthFormat.ts","../src/texture/enums/TextureFilterMode.ts","../src/texture/enums/TextureFormat.ts","../src/texture/enums/TextureWrapMode.ts","../src/texture/Texture.ts","../src/shader/ShaderData.ts","../src/Scene.ts","../src/SceneManager.ts","../src/shader/ShaderPool.ts","../src/shader/ShaderProgramPool.ts","../src/shader/state/RenderTargetBlendState.ts","../src/shader/state/BlendState.ts","../src/shader/state/DepthState.ts","../src/shader/state/RasterState.ts","../src/shader/state/StencilState.ts","../src/shader/state/RenderState.ts","../src/Engine.ts","../src/SystemInfo.ts","../src/EngineFeature.ts","../src/Script.ts","../src/Renderer.ts","../src/material/enums/AlphaMode.ts","../src/material/Material.ts","../src/material/BlinnPhongMaterial.ts","../src/material/PBRBaseMaterial.ts","../src/material/PBRMaterial.ts","../src/material/PBRSpecularMaterial.ts","../src/material/UnlitMaterial.ts","../src/RenderPipeline/RenderPass.ts","../src/RenderPipeline/SeparateSpritePass.ts","../src/RenderPipeline/BasicRenderPipeline.ts","../src/RenderPipeline/RenderContext.ts","../src/Camera.ts","../src/asset/request.ts","../src/asset/Loader.ts","../src/asset/AssetType.ts","../src/collider/ColliderFeature.ts","../src/collider/Collider.ts","../src/collider/ABoxCollider.ts","../src/collider/ASphereCollider.ts","../src/collider/PlaneCollider.ts","../src/raycast/RaycastHit.ts","../src/raycast/index.ts","../src/mesh/Mesh.ts","../src/mesh/Skin.ts","../src/mesh/MeshRenderer.ts","../src/texture/Texture2D.ts","../src/mesh/SkinnedMeshRenderer.ts","../src/mesh/LODGroup.ts","../src/texture/enums/TextureCubeFace.ts","../src/texture/TextureCubeMap.ts","../src/texture/RenderDepthTexture.ts","../src/texture/RenderTarget.ts","../src/texture/RenderColorTexture.ts","../src/graphic/enums/BufferUsage.ts","../src/graphic/enums/VertexElementFormat.ts","../src/graphic/enums/IndexFormat.ts","../src/graphic/BufferUtil.ts","../src/graphic/enums/BufferBindFlag.ts","../src/graphic/enums/SetDataOptions.ts","../src/graphic/Buffer.ts","../src/graphic/enums/PrimitiveTopology.ts","../src/graphic/IndexBufferBinding.ts","../src/graphic/VertexBufferBinding.ts","../src/graphic/Primitive.ts","../src/graphic/VertexElement.ts","../src/graphic/SubPrimitive.ts","../src/2d/SpriteRenderer.ts","../src/animation/AnimationConst.ts","../src/animation/AnimationClip.ts","../src/animation/AnimationLayer.ts","../src/animation/Animation.ts","../src/geometry/BufferGeometry.ts","../src/geometry/GeometryRenderer.ts","../src/geometry-shape/ShapeGeometry.ts","../src/geometry-shape/CuboidGeometry.ts","../src/geometry-shape/SphereGeometry.ts","../src/geometry-shape/PlaneGeometry.ts","../src/geometry-shape/CylinderGeometry.ts","../src/geometry-shape/CircleGeometry.ts","../src/geometry-shape/ScreenQuadGeometry.ts","../src/geometry-shape/TorusGeometry.ts","../src/geometry-shape/Model.ts","../src/skybox/SkyBoxMaterial.ts","../src/skybox/SkyBox.ts","../src/particle/ParticleRenderer.ts","../src/trail/TrailMaterial.ts","../src/trail/TrailRenderer.ts","../src/collider/BoxCollider.ts","../src/collider/SphereCollider.ts","../src/collider/index.ts","../src/collision/intersect.ts","../src/collision/CollisionDetection.ts","../src/fog/Fog.ts","../src/fog/EXP2Fog.ts","../src/fog/LinearFog.ts","../src/env-probe/Probe.ts","../src/env-probe/CubeProbe.ts","../src/shadow/LightShadow.ts","../src/shadow/Extension.ts","../src/shadow/ShadowMapMaterial.ts","../src/shadow/ShadowMapPass.ts","../src/shadow/ShadowMaterial.ts","../src/shadow/ShadowPass.ts","../src/shadow/ShadowFeature.ts","../src/shadow/index.ts","../src/index.ts"],"sourcesContent":["type PromiseNotifier = (progress: number) => void;\n\n/**\n * Asset Promise Status\n */\nexport enum AssetPromiseStatus {\n  /** Success. */\n  Success,\n  /** Pending. */\n  Pending,\n  /** Failed. */\n  Failed\n}\n/**\n * Asset Loading Promise.\n */\nexport class AssetPromise<T> extends Promise<T> {\n  static all<T1, T2, T3, T4, T5, T6, T7, T8, T9, T10>(\n    values: readonly [\n      T1 | PromiseLike<T1>,\n      T2 | PromiseLike<T2>,\n      T3 | PromiseLike<T3>,\n      T4 | PromiseLike<T4>,\n      T5 | PromiseLike<T5>,\n      T6 | PromiseLike<T6>,\n      T7 | PromiseLike<T7>,\n      T8 | PromiseLike<T8>,\n      T9 | PromiseLike<T9>,\n      T10 | PromiseLike<T10>\n    ]\n  ): AssetPromise<[T1, T2, T3, T4, T5, T6, T7, T8, T9, T10]>;\n\n  static all<T1, T2, T3, T4, T5, T6, T7, T8, T9>(\n    values: readonly [\n      T1 | PromiseLike<T1>,\n      T2 | PromiseLike<T2>,\n      T3 | PromiseLike<T3>,\n      T4 | PromiseLike<T4>,\n      T5 | PromiseLike<T5>,\n      T6 | PromiseLike<T6>,\n      T7 | PromiseLike<T7>,\n      T8 | PromiseLike<T8>,\n      T9 | PromiseLike<T9>\n    ]\n  ): AssetPromise<[T1, T2, T3, T4, T5, T6, T7, T8, T9]>;\n\n  static all<T1, T2, T3, T4, T5, T6, T7, T8>(\n    values: readonly [\n      T1 | PromiseLike<T1>,\n      T2 | PromiseLike<T2>,\n      T3 | PromiseLike<T3>,\n      T4 | PromiseLike<T4>,\n      T5 | PromiseLike<T5>,\n      T6 | PromiseLike<T6>,\n      T7 | PromiseLike<T7>,\n      T8 | PromiseLike<T8>\n    ]\n  ): AssetPromise<[T1, T2, T3, T4, T5, T6, T7, T8]>;\n\n  static all<T1, T2, T3, T4, T5, T6, T7>(\n    values: readonly [\n      T1 | PromiseLike<T1>,\n      T2 | PromiseLike<T2>,\n      T3 | PromiseLike<T3>,\n      T4 | PromiseLike<T4>,\n      T5 | PromiseLike<T5>,\n      T6 | PromiseLike<T6>,\n      T7 | PromiseLike<T7>\n    ]\n  ): AssetPromise<[T1, T2, T3, T4, T5, T6, T7]>;\n\n  static all<T1, T2, T3, T4, T5, T6>(\n    values: readonly [\n      T1 | PromiseLike<T1>,\n      T2 | PromiseLike<T2>,\n      T3 | PromiseLike<T3>,\n      T4 | PromiseLike<T4>,\n      T5 | PromiseLike<T5>,\n      T6 | PromiseLike<T6>\n    ]\n  ): AssetPromise<[T1, T2, T3, T4, T5, T6]>;\n\n  static all<T1, T2, T3, T4, T5>(\n    values: readonly [\n      T1 | PromiseLike<T1>,\n      T2 | PromiseLike<T2>,\n      T3 | PromiseLike<T3>,\n      T4 | PromiseLike<T4>,\n      T5 | PromiseLike<T5>\n    ]\n  ): AssetPromise<[T1, T2, T3, T4, T5]>;\n\n  static all<T1, T2, T3, T4>(\n    values: readonly [T1 | PromiseLike<T1>, T2 | PromiseLike<T2>, T3 | PromiseLike<T3>, T4 | PromiseLike<T4>]\n  ): AssetPromise<[T1, T2, T3, T4]>;\n\n  static all<T1, T2, T3>(\n    values: readonly [T1 | PromiseLike<T1>, T2 | PromiseLike<T2>, T3 | PromiseLike<T3>]\n  ): AssetPromise<[T1, T2, T3]>;\n\n  static all<T1, T2>(values: readonly [T1 | PromiseLike<T1>, T2 | PromiseLike<T2>]): AssetPromise<[T1, T2]>;\n\n  static all<T>(values: readonly (T | PromiseLike<T>)[]): AssetPromise<T[]>;\n\n  /**\n   * Return a new resource Promise through the provided asset promise collection.\n   * The resolved of the new AssetPromise will be triggered when all the Promises in the provided set are completed.\n   * @param - AssetPromise Collection\n   * @returns AssetPromise\n   */\n  static all<T>(promises: T | PromiseLike<T>[]): AssetPromise<T[]> {\n    return new AssetPromise((resolve, reject, setProgress) => {\n      if (!Array.isArray(promises)) {\n        return resolve([promises]);\n      }\n\n      let completed = 0;\n      let total = promises.length;\n      let results = new Array<T>(total);\n\n      promises.forEach((value, index) => {\n        Promise.resolve(value)\n          .then((result) => {\n            results[index] = result;\n\n            completed += 1;\n            setProgress(completed / total);\n\n            if (completed == total) {\n              resolve(results);\n            }\n          })\n          .catch((err) => reject(err));\n      });\n    });\n  }\n\n  private _status: AssetPromiseStatus;\n  private _progress: number;\n  private _reject: (reason?: any) => void;\n  private _listeners: Set<PromiseNotifier>;\n\n  /**\n   * Current promise state.\n   */\n  get status(): AssetPromiseStatus {\n    return this._status;\n  }\n\n  /**\n   * Loading progress.\n   */\n  get progress(): number {\n    return this._progress;\n  }\n\n  /**\n   * Progress callback.\n   * @param callback - Progress callback\n   * @returns Asset Promise\n   */\n  onProgress(callback: (progress?: number) => any): AssetPromise<T> {\n    this._listeners.add(callback);\n    return this;\n  }\n\n  /**\n   * Cancel promise request.\n   * @returns Asset promise\n   */\n  cancel(): AssetPromise<T> {\n    if (this._status !== AssetPromiseStatus.Pending) {\n      return this;\n    }\n    this._reject(\"Promise Canceled\");\n    return this;\n  }\n\n  /**\n   * Create an asset loading Promise.\n   * @param executor - A callback used to initialize the promise. This callback is passed two arguments:\n   * a resolve callback used to resolve the promise with a value or the result of another promise,\n   * and a reject callback used to reject the promise with a provided reason or error.\n   * and a setProgress callback used to set promise progress with a percent.\n   */\n  constructor(\n    executor: (\n      resolve: (value?: T | PromiseLike<T>) => void,\n      reject?: (reason?: any) => void,\n      setProgress?: PromiseNotifier\n    ) => void\n  ) {\n    let newReject: (reason?: any) => void;\n\n    const setProgress = (progress: number) => {\n      if (progress <= this._progress) {\n        return;\n      }\n      this._progress = progress;\n\n      for (const listener of this._listeners) {\n        listener(progress);\n      }\n    };\n\n    super((resolve, reject) => {\n      newReject = (reason?: any) => {\n        // Add it to the micro task to avoid reporting an error when calling this directly.\n        Promise.resolve().then(() => {\n          this._status = AssetPromiseStatus.Failed;\n          reject(reason);\n        });\n      };\n      executor(\n        (value: T) => {\n          // Add it to the micro task to avoid reporting an error when calling this directly.\n          Promise.resolve().then(() => {\n            setProgress(1);\n            this._status = AssetPromiseStatus.Success;\n            resolve(value);\n          });\n        },\n        newReject,\n        (progress: number) => {\n          // Add it to the micro task to avoid reporting an error when calling this directly\n          Promise.resolve().then(() => {\n            setProgress(progress);\n          });\n        }\n      );\n    });\n    this._reject = newReject;\n    this._listeners = new Set();\n    this._progress = 0;\n    this._status = AssetPromiseStatus.Pending;\n  }\n}\n","export const Util = {\n  isArray:\n    \"isArray\" in Array\n      ? Array.isArray\n      : (value: any): boolean => {\n          return toString.call(value) === \"[object Array]\";\n        },\n  isArrayLike(x: any): boolean {\n    return !!x && typeof x.length === \"number\" && typeof x !== \"function\";\n  },\n  clone<T>(obj: T): T {\n    if (typeof obj !== \"object\" || obj === null) {\n      return obj;\n    }\n    let rst;\n    if (Util.isArrayLike(obj)) {\n      rst = (obj as any).slice();\n      for (let i = 0, l = (obj as any).length; i < l; i++) {\n        rst[i] = Util.clone(obj[i]);\n      }\n    } else {\n      rst = {};\n      for (const k in obj) {\n        if (obj.hasOwnProperty(k)) {\n          rst[k] = Util.clone(obj[k]);\n        }\n      }\n    }\n\n    return rst;\n  },\n\n  downloadBlob(blob: Blob, fileName: string = \"\") {\n    if (navigator && navigator.msSaveBlob) {\n      navigator.msSaveBlob(blob, fileName);\n      return;\n    }\n\n    let url = window.URL.createObjectURL(blob);\n    let a = document.createElement(\"a\");\n    document.body.appendChild(a);\n    a.style.display = \"none\";\n    a.href = url;\n    a.download = fileName;\n    a.addEventListener(\"click\", () => {\n      if (a.parentElement) {\n        a.parentElement.removeChild(a);\n      }\n    });\n    a.click();\n    window.URL.revokeObjectURL(url);\n  }\n};\n\nexport const isArrayLike = <T>(x: any): x is ArrayLike<T> =>\n  x && typeof x.length === \"number\" && typeof x !== \"function\";\n\n/**\n * Fastly remove an element from array.\n * @param array - Array\n * @param item - Element\n */\nexport function removeFromArray(array: any[], item: any): boolean {\n  const index = array.indexOf(item);\n  if (index < 0) {\n    return false;\n  }\n  const last = array.length - 1;\n  if (index !== last) {\n    const end = array[last];\n    array[index] = end;\n  }\n  array.length--;\n  return true;\n}\n\nexport function ObjectValues(obj: any) {\n  return Object.keys(obj).map((key: any) => obj[key]);\n}\n","import { AssetPromise } from \"./AssetPromise\";\nimport { LoadItem } from \"./LoadItem\";\nimport { RefObject } from \"./RefObject\";\nimport { Engine } from \"..\";\nimport { Loader } from \"./Loader\";\nimport { AssetType } from \"./AssetType\";\nimport { ObjectValues } from \"../base/Util\";\n\n/**\n * ResourceManager\n */\nexport class ResourceManager {\n  /** Loader collection. */\n  private static _loaders: { [key: number]: Loader<any> } = {};\n  private static _extTypeMapping: { [key: string]: AssetType } = {};\n\n  /**\n   * @internal\n   */\n  static _addLoader(type: AssetType, loader: Loader<any>, extnames: string[]) {\n    this._loaders[type] = loader;\n    for (let i = 0, len = extnames.length; i < len; i++) {\n      this._extTypeMapping[extnames[i]] = type;\n    }\n  }\n\n  private static _getTypeByUrl(url: string): AssetType {\n    const path = url.split(\"?\")[0];\n    return this._extTypeMapping[path.substring(path.lastIndexOf(\".\") + 1)];\n  }\n\n  /** The number of retries after failing to load assets. */\n  retryCount: number = 1;\n  /** Retry delay time after failed to load assets, in milliseconds. */\n  retryInterval: number = 0;\n  /** The default timeout period for loading assets, in milliseconds. */\n  timeout: number = 20000;\n\n  /** Asset path pool, key is asset ID, value is asset path */\n  private _assetPool: { [key: number]: string } = Object.create(null);\n  /** Asset pool, the key is the asset path and the value is the asset. */\n  private _assetUrlPool: { [key: string]: Object } = Object.create(null);\n  /** Reference counted object pool, key is the object ID, and reference counted objects are put into this pool. */\n  private _refObjectPool: { [key: number]: RefObject } = Object.create(null);\n  /** Loading assets. */\n  private _loadingPromises: { [url: string]: AssetPromise<any> } = {};\n\n  /**\n   * Create a ResourceManager.\n   * @param engine - Engine to which the current ResourceManager belongs\n   */\n  constructor(public readonly engine: Engine) {}\n\n  /**\n   * Load asset asynchronously through the path.\n   * @param path - Path\n   * @returns Asset promise\n   */\n  load<T>(path: string): AssetPromise<T>;\n\n  /**\n   * Load asset collection asynchronously through urls.\n   * @param path - Path collections\n   * @returns Asset Promise\n   */\n  load(pathes: string[]): AssetPromise<Object[]>;\n\n  /**\n   * Load the asset asynchronously by asset item information.\n   * @param assetItem - AssetItem\n   * @returns AssetPromise\n   */\n  load<T>(assetItem: LoadItem): AssetPromise<T>;\n\n  /**\n   * Load the asset collection asynchronously by loading the information collection.\n   * @param assetItems - Asset collection\n   * @returns AssetPromise\n   */\n  load(assetItems: LoadItem[]): AssetPromise<Object[]>;\n\n  load<T>(assetInfo: string | LoadItem | (LoadItem | string)[]): AssetPromise<T | Object[]> {\n    // single item\n    if (!Array.isArray(assetInfo)) {\n      return this._loadSingleItem(assetInfo);\n    }\n    // multi items\n    const promises = assetInfo.map((item) => this._loadSingleItem<T>(item));\n    return AssetPromise.all(promises);\n  }\n\n  /**\n   * Cancel all assets that have not finished loading.\n   */\n  cancelNotLoaded(): void;\n\n  /**\n   * Cancel assets whose url has not finished loading.\n   * @param url - Resource url\n   */\n  cancelNotLoaded(url: string): void;\n\n  /**\n   * Cancel the incompletely loaded assets in urls.\n   * @param urls - Resource urls\n   */\n  cancelNotLoaded(urls: string[]): void;\n\n  cancelNotLoaded(url?: string | string[]): void {\n    if (!url) {\n      ObjectValues(this._loadingPromises).forEach((promise) => {\n        promise.cancel();\n      });\n    } else if (typeof url === \"string\") {\n      this._loadingPromises[url]?.cancel();\n    } else {\n      url.forEach((p) => {\n        this._loadingPromises[p]?.cancel();\n      });\n    }\n  }\n\n  /**\n   * Garbage collection will release resource objects managed by reference counting.\n   * @remarks The release principle is that it is not referenced by the components, including direct and indirect reference.\n   */\n  gc(): void {\n    const objects = ObjectValues(this._refObjectPool);\n    for (let i = 0, len = objects.length; i < len; i++) {\n      if (!objects[i].isGCIgnored) {\n        objects[i].destroy();\n      }\n    }\n  }\n\n  /**\n   * Get asset url from instanceId.\n   * @param instanceId - Engine instance id\n   * @returns Asset url\n   */\n  getAssetPath(instanceId: number): string {\n    return this._assetPool[instanceId];\n  }\n\n  /**\n   * @internal\n   */\n  _addAsset(path: string, asset: RefObject): void {\n    this._assetPool[asset.instanceId] = path;\n    this._assetUrlPool[path] = asset;\n  }\n\n  /**\n   * @internal\n   */\n  _deleteAsset(asset: RefObject): void {\n    const id = asset.instanceId;\n    const path = this._assetPool[id];\n    if (path) {\n      delete this._assetPool[id];\n      delete this._assetUrlPool[path];\n    }\n  }\n\n  /**\n   * @internal\n   */\n  _addRefObject(id: number, asset: RefObject): void {\n    this._refObjectPool[id] = asset;\n  }\n\n  /**\n   * @internal\n   */\n  _deleteRefObject(id: number): void {\n    delete this._refObjectPool[id];\n  }\n\n  private _assignDefaultOptions(assetInfo: LoadItem): LoadItem | never {\n    assetInfo.type = assetInfo.type ?? ResourceManager._getTypeByUrl(assetInfo.url);\n    if (assetInfo.type === undefined) {\n      throw `asset type should be specified: ${assetInfo.url}`;\n    }\n    assetInfo.retryCount = assetInfo.retryCount ?? this.retryCount;\n    assetInfo.timeout = assetInfo.timeout ?? this.timeout;\n    assetInfo.retryInterval = assetInfo.retryInterval ?? this.retryInterval;\n    assetInfo.url = assetInfo.url ?? assetInfo.urls.join(\",\");\n    return assetInfo;\n  }\n\n  private _loadSingleItem<T>(item: LoadItem | string): AssetPromise<T> {\n    const info = this._assignDefaultOptions(typeof item === \"string\" ? { url: item } : item);\n    const url = info.url;\n    // has cache\n    if (this._assetUrlPool[url]) {\n      return new AssetPromise((resolve) => {\n        resolve(this._assetUrlPool[url] as T);\n      });\n    }\n    // loading\n    if (this._loadingPromises[url]) {\n      return this._loadingPromises[info.url];\n    }\n    const loader = ResourceManager._loaders[info.type];\n    const promise = loader.load(info, this);\n    this._loadingPromises[url] = promise;\n    promise\n      .then((res) => {\n        if (loader.useCache) this._addAsset(url, res);\n        delete this._loadingPromises[url];\n      })\n      .catch(() => {});\n    return promise;\n  }\n}\n\n/**\n * Declare ResourceLoader's decorator.\n * @param assetType - Type of asset\n * @param extnames - Name of file extension\n */\nexport function resourceLoader(assetType: AssetType, extnames: string[], useCache: boolean = true) {\n  return <T extends Loader<any>>(Target: { new (useCache: boolean): T }) => {\n    const loader = new Target(useCache);\n    ResourceManager._addLoader(assetType, loader, extnames);\n  };\n}\n","import { EventDispatcher } from \"./EventDispatcher\";\n\nexport type Listener = ((e: Event) => any) & { once?: boolean };\n\n/** Event Object. * @class */\nexport class Event {\n  get propagationStopped(): boolean {\n    return this._propagationStopped;\n  }\n\n  get target(): EventDispatcher {\n    return this._target;\n  }\n\n  set target(t) {\n    this._target = t;\n  }\n\n  get timeStamp(): number {\n    return this._timeStamp;\n  }\n\n  get currentTarget(): EventDispatcher {\n    return this._currentTarget;\n  }\n\n  set currentTarget(t) {\n    this._currentTarget = t;\n  }\n\n  get bubbles(): boolean {\n    return this._bubbles;\n  }\n\n  get type(): string | number {\n    return this._type;\n  }\n\n  public data: any;\n\n  private _timeStamp: number;\n\n  private _target: EventDispatcher;\n\n  private _currentTarget: any;\n\n  private _bubbles: boolean;\n\n  private _propagationStopped: boolean;\n\n  private _type: string | number;\n\n  constructor(type: string | number, target: EventDispatcher = null, data: any = {}, bubbles: boolean = true) {\n    this._timeStamp = new Date().getTime();\n    this._target = target;\n    this.data = data;\n    this._currentTarget = null;\n    this._bubbles = bubbles;\n    this._propagationStopped = false;\n    this._type = type;\n  }\n\n  public stopPropagation(): void {\n    this._propagationStopped = true;\n  }\n}\n","/**\n * Clone mode.\n */\nexport enum CloneMode {\n  /** Ignore clone. */\n  Ignore,\n  /** Assignment clone. */\n  Assignment,\n  /** Shallow clone. */\n  Shallow,\n  /** Deep clone. */\n  Deep\n}\n","import { IClone } from \"@oasis-engine/design\";\nimport { CloneMode } from \"./enums/CloneMode\";\n\ntype TypeArray =\n  | Uint8Array\n  | Uint16Array\n  | Uint32Array\n  | Int8Array\n  | Int16Array\n  | Int32Array\n  | Float32Array\n  | Float64Array;\n\n/**\n * Property decorator, ignore the property when cloning.\n */\nexport function ignoreClone(target: Object, propertyKey: string): void {\n  CloneManager.registerCloneMode(target, propertyKey, CloneMode.Ignore);\n}\n\n/**\n * Property decorator, assign value to the property when cloning.\n *\n * @remarks\n * If it's a primitive type, the value will be copied.\n * If it's a class type, the reference will be copied.\n */\nexport function assignmentClone(target: Object, propertyKey: string): void {\n  CloneManager.registerCloneMode(target, propertyKey, CloneMode.Assignment);\n}\n\n/**\n * Property decorator, shallow clone the property when cloning.\n * After cloning, it will keep its own reference independent, and use the method of assignment to clone all its internal properties.\n * if the internal property is a primitive type, the value will be copied, if the internal property is a reference type, its reference address will be copied.ã€‚\n *\n * @remarks\n * Applicable to Object, Array, TypedArray and Class types.\n */\nexport function shallowClone(target: Object, propertyKey: string): void {\n  CloneManager.registerCloneMode(target, propertyKey, CloneMode.Shallow);\n}\n\n/**\n * Property decorator, deep clone the property when cloning.\n * After cloning, it will maintain its own reference independence, and all its internal deep properties will remain completely independent.\n *\n * @remarks\n * Applicable to Object, Array, TypedArray and Class types.\n * If Class is encountered during the deep cloning process, the custom cloning function of the object will be called first. Custom cloning requires the object to implement the IClone interface.\n */\nexport function deepClone(target: Object, propertyKey: string): void {\n  CloneManager.registerCloneMode(target, propertyKey, CloneMode.Deep);\n}\n\n/**\n * @internal\n * Clone manager.\n */\nexport class CloneManager {\n  /** @internal */\n  static _subCloneModeMap = new Map<Object, Object>();\n  /** @internal */\n  static _cloneModeMap = new Map<Object, Object>();\n\n  private static _obejctType = Object.getPrototypeOf(Object);\n\n  /**\n   * Register clone mode.\n   * @param target - Clone target\n   * @param propertyKey - Clone property name\n   * @param mode - Clone mode\n   */\n  static registerCloneMode(target: Object, propertyKey: string, mode: CloneMode): void {\n    let targetMap = CloneManager._subCloneModeMap.get(target.constructor);\n    if (!targetMap) {\n      targetMap = Object.create(null);\n      CloneManager._subCloneModeMap.set(target.constructor, targetMap);\n    }\n    targetMap[propertyKey] = mode;\n  }\n\n  /**\n   * Get the clone mode according to the prototype chain.\n   */\n  static getCloneMode(type: Function): Object {\n    let cloneModes = CloneManager._cloneModeMap.get(type);\n    if (!cloneModes) {\n      cloneModes = Object.create(null);\n      CloneManager._cloneModeMap.set(type, cloneModes);\n      const obejctType = CloneManager._obejctType;\n      const cloneModeMap = CloneManager._subCloneModeMap;\n      while (type !== obejctType) {\n        const subCloneModes = cloneModeMap.get(type);\n        if (subCloneModes) {\n          Object.assign(cloneModes, subCloneModes);\n        }\n        type = Object.getPrototypeOf(type);\n      }\n    }\n    return cloneModes;\n  }\n\n  /**\n   * Deep clone the object.\n   * @param source - Clone source\n   * @param target - Clone target\n   */\n  static deepCloneObject(source: Object, target: Object): void {\n    const type = source.constructor;\n    switch (type) {\n      case Uint8Array:\n      case Uint16Array:\n      case Uint32Array:\n      case Int8Array:\n      case Int16Array:\n      case Int32Array:\n      case Float32Array:\n      case Float64Array:\n        // Type array clone.\n        (<TypeArray>target).set(<TypeArray>source);\n        break;\n      case Array:\n        // Array clone.\n        for (let i = 0, n = (<[]>source).length; i < n; i++) {\n          CloneManager._deepCloneObjectItem(source, target, i);\n        }\n        break;\n      default:\n        const customSource = <IClone>source;\n        if (customSource.clone && customSource.cloneTo) {\n          // Custom clone.\n          customSource.cloneTo(target);\n        } else {\n          // Object or other class not implments custom clone.\n          const keys = Object.keys(source);\n          for (let i = 0, n = keys.length; i < n; i++) {\n            CloneManager._deepCloneObjectItem(source, target, keys[i]);\n          }\n        }\n    }\n  }\n\n  private static _deepCloneObjectItem(source: object, target: object, k: number | string): void {\n    const sourceItem = source[k];\n    if (sourceItem instanceof Object) {\n      const itemType = (<Object>sourceItem).constructor;\n      switch (itemType) {\n        case Uint8Array:\n        case Uint16Array:\n        case Uint32Array:\n        case Int8Array:\n        case Int16Array:\n        case Int32Array:\n        case Float32Array:\n        case Float64Array:\n          // Type array clone.\n          const sourceTypeArrayItem = <TypeArray>sourceItem;\n          let targetTypeArrayItem = <TypeArray>target[k];\n          if (targetTypeArrayItem == null) {\n            target[k] = sourceTypeArrayItem.slice();\n          } else {\n            targetTypeArrayItem.set(sourceTypeArrayItem);\n          }\n          break;\n        case Array:\n          // Array clone.\n          const sourceArryItem = <[]>sourceItem;\n          let targetArrayItem = <[]>target[k];\n          if (targetArrayItem == null) {\n            target[k] = new Array(sourceArryItem.length);\n          } else {\n            targetArrayItem.length = sourceArryItem.length;\n          }\n          CloneManager.deepCloneObject(sourceArryItem, targetArrayItem);\n          break;\n        default:\n          if (sourceItem.clone && sourceItem.cloneTo) {\n            // Custom clone.\n            let sourceCustomItem = <IClone>sourceItem;\n            let targetCustomItem = <IClone>target[k];\n            if (targetCustomItem) {\n              sourceCustomItem.cloneTo(targetCustomItem);\n            } else {\n              target[k] = sourceCustomItem.clone();\n            }\n          } else {\n            // Object or other class not implments custom clone.\n            let targetItem = <Object>target[k];\n            targetItem == null && (target[k] = targetItem = new sourceItem.constructor());\n            CloneManager.deepCloneObject(sourceItem, targetItem);\n            break;\n          }\n      }\n    } else {\n      // Null or undefine and primitive type.\n      target[k] = sourceItem;\n    }\n  }\n}\n","import { ignoreClone } from \"../clone/CloneManager\";\nimport { Engine } from \"../Engine\";\n\n/**\n * EngineObject.\n */\nexport abstract class EngineObject {\n  private static _instanceIdCounter: number = 0;\n\n  /** Engine unique id. */\n  @ignoreClone\n  readonly instanceId: number = ++EngineObject._instanceIdCounter;\n\n  /** Engine to which the object belongs. */\n  @ignoreClone\n  protected _engine: Engine;\n\n  constructor(engine: Engine) {\n    this._engine = engine;\n  }\n}\n","import { EngineObject } from \"./EngineObject\";\nimport { Event } from \"./Event\";\nimport { ignoreClone } from \"../clone/CloneManager\";\n\n/**\n * EventDispatcher, which can be inherited as a base class.\n */\nexport class EventDispatcher extends EngineObject {\n  @ignoreClone\n  private _evts = Object.create(null);\n  private _evtCount = 0;\n\n  /**\n   * Determine whether there is event listening.\n   * @param event - Event name\n   * @returns Returns whether there is a corresponding event\n   */\n  hasEvent(event: string): boolean {\n    return this._evts[event] != null;\n  }\n\n  /**\n   * Returns the names of all registered events.\n   * @returns All event names\n   */\n  eventNames(): string[] {\n    if (this._evtCount === 0) return [];\n    return Object.keys(this._evts);\n  }\n\n  /**\n   * Returns the number of listeners with the specified event name.\n   * @param event - Event name\n   * @returns The count of listeners\n   */\n  listenerCount(event: string): number {\n    const listeners = this._evts[event];\n\n    if (!listeners) return 0;\n    if (listeners.fn) return 1;\n    return listeners.length;\n  }\n\n  /**\n   * Dispatch the event with the specified event name.\n   * @param event - Event name\n   * @param data - Data\n   * @returns - Whether the dispatching is successful\n   */\n  dispatch(event: string, data?: any): boolean {\n    if (!this._evts[event]) {\n      return false;\n    }\n\n    const listeners = this._evts[event];\n\n    if (listeners.fn) {\n      if (listeners.once) this.removeEventListener(event, listeners.fn);\n      listeners.fn(data);\n    } else {\n      const l = listeners.length;\n      for (let i = 0; i < l; i++) {\n        if (listeners[i].once) this.removeEventListener(event, listeners[i].fn);\n        listeners[i].fn(data);\n      }\n    }\n    return true;\n  }\n\n  /**\n   * Add a listener/\n   * @param event - Event name\n   * @param fn - Function\n   * @returns This\n   */\n  on(event: string, fn: Function): EventDispatcher {\n    return this.addEventListener(event, fn);\n  }\n\n  /**\n   * Add a one-time listener.\n   * @param event - Event name\n   * @param fn - Function\n   * @returns This\n   */\n  once(event: string, fn: Function): EventDispatcher {\n    return this.addEventListener(event, fn, true);\n  }\n\n  /**\n   * @deprecated Use `on/once` instead.\n   * Add a listener function with the specified event name.\n   * @param event - Event name\n   * @param fn - Function\n   * @param once - Is it a one-time listener\n   * @returns this\n   */\n  addEventListener(event: string, fn: Function, once?: boolean): EventDispatcher {\n    const listener = { fn, once };\n    const events = this._evts;\n    if (!events[event]) {\n      events[event] = listener;\n      this._evtCount++;\n    } else if (!events[event].fn) {\n      events[event].push(listener);\n    } else {\n      events[event] = [events[event], listener];\n    }\n    return this;\n  }\n\n  /**\n   * Remove the event listener(s) of the specified event name.\n   * @param event - Event name\n   * @param fn - Function, If is undefined, delete all corresponding event listeners.\n   */\n  off(event: string, fn?: Function): EventDispatcher {\n    if (!this._evts[event]) return this;\n    if (!fn) {\n      this._clearEvent(event);\n      return this;\n    }\n\n    const listeners = this._evts[event];\n\n    if (listeners.fn && listeners.fn === fn) {\n      this._clearEvent(event);\n    } else {\n      const index = listeners.indexOf(fn);\n      if (index > -1) {\n        const temp = listeners[listeners.length - 1];\n        listeners[index] = temp;\n        listeners.length--;\n        if (listeners.length === 1) {\n          this._evts[event] = listeners[0];\n        }\n      }\n    }\n    return this;\n  }\n\n  /**\n   * @deprecated Use `off` instead.\n   * Remove the event listener(s) of the specified event name.\n   * @param event - Event name\n   * @param fn - Function, If is undefined, delete all corresponding event listeners.\n   */\n  removeEventListener(event: string, fn?: Function): EventDispatcher {\n    return this.off(event, fn);\n  }\n\n  /**\n   * Remove all event listeners.\n   * @param event - Event name, delete all events if not passed\n   */\n  removeAllEventListeners(event?: string): void {\n    if (event) {\n      if (this._evts[event]) this._clearEvent(event);\n    } else {\n      this._evts = Object.create(null);\n      this._evtCount = 0;\n    }\n  }\n\n  /**\n   * @deprecated Use `dispatch` instead.\n   */\n  trigger(e: Event) {\n    this.dispatch(e.type as string, e.data);\n  }\n\n  private _clearEvent(event: string) {\n    if (--this._evtCount === 0) {\n      this._evts = Object.create(null);\n    } else {\n      delete this._evts[event];\n    }\n  }\n}\n","/**\n * @class\n * @private\n */\n/* tslint:disable */\nconst noop = (message?: any, ...optionalParams: any[]) => {};\nconst debug = console.log.bind(console);\nconst info = console.info.bind(console);\nconst warn = console.warn.bind(console);\nconst error = console.error.bind(console);\n\nexport const Logger = {\n  debug: noop,\n  info: noop,\n  warn: noop,\n  error: noop,\n  isEnabled: false,\n\n  /** Turn on log */\n  enable() {\n    this.debug = debug;\n    this.info = info;\n    this.warn = warn;\n    this.error = error;\n    this.isEnabled = true;\n  },\n\n  /** Turn off log */\n  disable() {\n    this.debug = noop;\n    this.info = noop;\n    this.warn = noop;\n    this.error = noop;\n    this.isEnabled = false;\n  }\n};\n","/**\n * Tools for calculating the time per frame.\n */\nexport class Time {\n  private _clock: { now: () => number };\n\n  private _timeScale: number;\n\n  private _deltaTime: number;\n\n  private _startTime: number;\n\n  private _lastTickTime: number;\n  /**\n   * Constructor of the Time.\n   */\n  constructor() {\n    this._clock = performance ? performance : Date;\n\n    this._timeScale = 1.0;\n    this._deltaTime = 0.0001;\n\n    const now = this._clock.now();\n    this._startTime = now;\n    this._lastTickTime = now;\n  }\n\n  reset() {\n    this._lastTickTime = this._clock.now();\n  }\n\n  /**\n   * Current Time\n   * @readonly\n   */\n  get nowTime(): number {\n    return this._clock.now();\n  }\n\n  /**\n   * Time between two ticks\n   * @readonly\n   */\n  get deltaTime(): number {\n    return this._deltaTime;\n  }\n\n  /**\n   * Scaled delta time.\n   */\n  get timeScale(): number {\n    return this._timeScale;\n  }\n  set timeScale(s) {\n    this._timeScale = s;\n  }\n\n  /**\n   * Unscaled delta time.\n   * @readonly\n   */\n  get unscaledDeltaTime(): number {\n    return this._deltaTime / this._timeScale;\n  }\n\n  /**\n   * The elapsed time, after the clock is initialized.\n   */\n  get timeSinceStartup(): number {\n    return this.nowTime - this._startTime;\n  }\n\n  /**\n   * Call every frame, update delta time and other data.\n   */\n  public tick(): void {\n    const now = this.nowTime;\n    this._deltaTime = (now - this._lastTickTime) * this._timeScale;\n    this._lastTickTime = now;\n  }\n}\n","/**\n * The type of resource, mainly used to deal with the recovery of GL objects associated with the resource object.\n */\nexport enum InternalAssetType {\n  /** Belonging to the current scene, GL resources will be automatically released when the scene is switched. */\n  Scene = 1,\n  /** Cache automatically handles, if not used in a period of time, GL resources will be released. */\n  Cache = 2\n}\n\n/**\n * Camera's clear mode enumeration\n * @readonly\n */\nexport enum ClearMode {\n  /** Do not perform any operations to clear the background */\n  DONT_CLEAR = 0,\n  /** Clear the background color and depth buffer */\n  SOLID_COLOR = 1,\n  /** Only clear the depth buffer */\n  DEPTH_ONLY = 2,\n  /** Only clear colors */\n  COLOR_ONLY = 3,\n  /** Only clear the template buffer */\n  STENCIL_ONLY = 4,\n  /** Clear all buffers */\n  ALL_CLEAR = 5\n}\n\n/**\n * Material type enumeration\n * @readonly\n */\nexport enum MaterialType {\n  /** Opaque */\n  OPAQUE = 1000,\n  /** Transparent */\n  TRANSPARENT = 2000\n}\n\n/**\n * Rendering state that can be turned on or off.\n * @readonly\n */\nexport enum RenderState {\n  /** Color blend calculation of fragments */\n  BLEND = 3042,\n  /** Front and back culling */\n  CULL_FACE = 2884,\n  /** Depth test */\n  DEPTH_TEST = 2929,\n  /** Alpha test */\n  ALPHA_TEST = 3008,\n  /** Offset of the depth value of the polygon fragment. */\n  POLYGON_OFFSET_FILL = 32823,\n  /** Calculation of temporary coverage value determined by alpha value. */\n  SAMPLE_ALPHA_TO_COVERAGE = 32926,\n  /** Clipping test, discarding the fragments outside the clipping rectangle. */\n  SCISSOR_TEST = 3089\n}\n\n/**\n * Face enumeration\n * @readonly\n */\nexport enum FrontFace {\n  /** Clockwise */\n  CW = 0x0900,\n  /** Counterclockwise */\n  CCW = 0x0901\n}\n\n/**\n * Face culling enum\n * @readonly\n */\nexport enum CullFace {\n  /** Front */\n  FRONT = 1028,\n  /** Back */\n  BACK = 1029,\n  /** Front and back */\n  FRONT_AND_BACK = 1032\n}\n\n/**\n * Display surface enumeration\n * @readonly\n * */\nexport enum Side {\n  /** Cull the back, only show the front */\n  FRONT,\n  /** Cull the front, only show the back */\n  BACK,\n  /** Cull out before smoothing, without showing any surface */\n  NONE,\n  /** Turn off culling, display the front and back */\n  DOUBLE\n}\n\n/**\n * Comparison function enum\n * @readonly\n */\nexport enum CompFunc {\n  /** Never pass */\n  NEVER = 0x0200,\n  /** Pass when less than the reference value */\n  LESS = 0x0201,\n  /** Pass when equal to reference value */\n  EQUAL = 0x0202,\n  /** Pass when less than or equal to the reference value */\n  LEQUAL = 0x0203,\n  /** Pass when greater than the reference value */\n  GREATER = 0x0204,\n  /** Pass when not equal to reference value */\n  NOTEQUAL = 0x0205,\n  /** Pass when greater than or equal to the reference value */\n  GEQUAL = 0x0206,\n  /** Always pass */\n  ALWAYS = 0x0207\n}\n\n/**\n * Data type enumeration\n */\nexport enum DataType {\n  /** Float */\n  FLOAT = 5126, // gl.FLOAT\n  /** Floating-point two-dimensional vector */\n  FLOAT_VEC2 = 35664, // gl.FLOAT_VEC2\n  /** Floating-point three-dimensional vector */\n  FLOAT_VEC3 = 35665, // gl.FLOAT_VEC3\n  /** Floating-point four-dimensional vector */\n  FLOAT_VEC4 = 35666, // gl.FLOAT_VEC4\n\n  /** Integer */\n  INT = 5124, // gl.INT\n  /** Integer two-dimensional vector */\n  INT_VEC2 = 35667, // gl.INT_VEC2\n  /** Integer three-dimensional vector */\n  INT_VEC3 = 35668, // gl.INT_VEC3\n  /** Integer four-dimensional vector */\n  INT_VEC4 = 35669, // gl.INT_VEC4\n\n  /** Boolean */\n  BOOL = 35670, // gl.BOOL\n  /** Boolean two-dimensional vector */\n  BOOL_VEC2 = 35671, // gl.BOOL_VEC2\n  /** Boolean three-dimensional vector */\n  BOOL_VEC3 = 35672, // gl.BOOL_VEC3\n  /** Boolean four-dimensional vector */\n  BOOL_VEC4 = 35673, // gl.BOOL_VEC4\n\n  /** Second-order matrix */\n  FLOAT_MAT2 = 35674, // gl.FLOAT_MAT2\n  /** Third-order matrix */\n  FLOAT_MAT3 = 35675, // gl.FLOAT_MAT3\n  /** Fourth-order matrix */\n  FLOAT_MAT4 = 35676, // gl.FLOAT_MAT4\n\n  /** Float array */\n  FLOAT_ARRAY = 35677, // gl.FLOAT_ARRAY\n  /** Floating-point two-dimensional vector array */\n  FLOAT_VEC2_ARRAY = 100000,\n  /** Floating-point three-dimensional vector array */\n  FLOAT_VEC3_ARRAY,\n  /** Floating-point four-dimensional vector array */\n  FLOAT_VEC4_ARRAY,\n\n  /** Integer array */\n  INT_ARRAY,\n  /** Integer two-dimensional vector array */\n  INT_VEC2_ARRAY,\n  /** Integer three-dimensional vector array */\n  INT_VEC3_ARRAY,\n  /** Integer four-dimensional vector array */\n  INT_VEC4_ARRAY,\n\n  /** Second-order matrix array */\n  FLOAT_MAT2_ARRAY,\n  /** Third-order matrix array */\n  FLOAT_MAT3_ARRAY,\n  /** Fourth-order matrix array */\n  FLOAT_MAT4_ARRAY,\n\n  /** 2D texture sampler array */\n  SAMPLER_2D_ARRAY,\n  /** Cube map texture sampler array */\n  SAMPLER_CUBE_ARRAY,\n\n  /** 2D sampler */\n  SAMPLER_2D = 35678, // gl.SAMPLER_2D\n  /** Cube map Texture sampler */\n  SAMPLER_CUBE = 35680, // gl.SAMPLER_CUBE\n\n  /** Byte */\n  BYTE = 5120, // gl.BYTE\n  /** Unsigned byte */\n  UNSIGNED_BYTE = 5121, // gl.UNSIGNED_BYTE\n  /** Short */\n  SHORT = 5122, // gl.SHORT\n  /** Unsigned short */\n  UNSIGNED_SHORT = 5123, // gl.UNSIGNED_SHORT\n  /** Unsigned int */\n  UNSIGNED_INT = 5125 // gl.UNSIGNED_INT\n}\n\n/**\n * Uniform Semantic and Oasis3D extension supported by glTF 1.0\n * @readonly\n */\nexport enum UniformSemantic {\n  // -- GLTF\n  /** Local matrix */\n  LOCAL = 1,\n  /** Model matrix */\n  MODEL = 2,\n  /** View matrix */\n  VIEW = 3,\n  /** Project matrix */\n  PROJECTION = 4,\n  /** Model View matrix */\n  MODELVIEW = 5,\n  /** View Projection matrix */\n  VIEWPROJECTION = 21,\n  /** Model View Project matrix */\n  MODELVIEWPROJECTION = 6,\n  /** Model matrix's inverse matrix */\n  MODELINVERSE = 7,\n  /** View matrix's inverse matrix */\n  VIEWINVERSE = 8,\n  /** Projection matrix's inverse matrix */\n  PROJECTIONINVERSE = 9,\n  /** Model View matrix's inverse matrix */\n  MODELVIEWINVERSE = 10,\n  /** Model View Project matrix's inverse matrix */\n  MODELVIEWPROJECTIONINVERSE = 11,\n  /** The inverse transpose matrix of Model matrix, which can be used to transform Normal */\n  MODELINVERSETRANSPOSE = 12,\n  /** Model View matrix's inverse transpose matrix */\n  MODELVIEWINVERSETRANSPOSE = 13,\n  /** Viewport parameter */\n  VIEWPORT = 14,\n  /** Joint matrix array */\n  JOINTMATRIX = 15,\n  /** MorphTarget weights */\n  MORPHWEIGHTS = 16,\n\n  // --\n  /** Current camera position */\n  EYEPOS = 17,\n  /** How long the current program is running */\n  TIME = 18,\n  /** Joint matrix texture */\n  JOINTTEXTURE = 19,\n  /** Joint count */\n  JOINTCOUNT = 20\n}\n\n/**\n * Color blending method enumeration\n */\nexport enum BlendFunc {\n  /** Multiply all channels by 0 */\n  ZERO = 0,\n  /** Multiply all channels by 1 */\n  ONE = 1,\n  /** Multiply all channels by source color */\n  SRC_COLOR = 768,\n  /** Multiply all channels by 1 minus source color */\n  ONE_MINUS_SRC_COLOR = 769,\n  /** Multiply all channels by source alpha */\n  SRC_ALPHA = 770,\n  /** Multiply all channels by 1 minus source alpha */\n  ONE_MINUS_SRC_ALPHA = 771,\n  /** Multiply all channels by destination alpha */\n  DST_ALPHA = 772,\n  /** Multiply all channels by 1 minus destination alpha */\n  ONE_MINUS_DST_ALPHA = 773,\n  /** Multiply all channels by destination color */\n  DST_COLOR = 774,\n  /** Multiply all channels by 1 minus destination color */\n  ONE_MINUS_DST_COLOR = 775,\n  /**\n   * Multiplies the RGB colors by the smaller of either the source alpha value or the value of 1 minus the destination alpha value. The alpha value is multiplied by 1.\n   */\n  SRC_ALPHA_SATURATE = 776,\n  /**\n   * Multiply all channels by a color constant.\n   */\n  enumANT_COLOR = 32769,\n  /** Multiply all channels by 1 minus the color constant. */\n  ONE_MINUS_enumANT_COLOR = 32770,\n  /**\n   * Multiply all channels by an alpha constant.\n   */\n  enumANT_ALPHA = 32771,\n  /**\n   * Multiply all channels by one minus the Alpha constant.\n   */\n  ONE_MINUS_enumANT_ALPHA = 32772\n}\n\n/**\n * Probe rendering rate.\n * */\nexport enum RefreshRate {\n  /** Only render once */\n  ONCE = 1,\n  /** Render every frame. */\n  EVERYFRAME = 2\n}\n\n/**\n * GL Capabilities\n * Some capabilities can be smoothed out by extension, and some capabilities must use WebGL 2.0.\n * */\nexport enum GLCapabilityType {\n  standardDerivatives = \"OES_standard_derivatives\",\n  shaderTextureLod = \"EXT_shader_texture_lod\",\n  elementIndexUint = \"OES_element_index_uint\",\n  depthTexture = \"WEBGL_depth_texture\",\n  drawBuffers = \"WEBGL_draw_buffers\",\n  vertexArrayObject = \"OES_vertex_array_object\",\n  instancedArrays = \"ANGLE_instanced_arrays\",\n  multipleSample = \"multipleSampleOnlySupportedInWebGL2\",\n  textureFloat = \"OES_texture_float\",\n  textureFloatLinear = \"OES_texture_float_linear\",\n  textureHalfFloat = \"OES_texture_half_float\",\n  textureHalfFloatLinear = \"OES_texture_half_float_linear\",\n  WEBGL_colorBufferFloat = \"WEBGL_color_buffer_float\",\n  colorBufferFloat = \"EXT_color_buffer_float\",\n  colorBufferHalfFloat = \"EXT_color_buffer_half_float\",\n  textureFilterAnisotropic = \"EXT_texture_filter_anisotropic\",\n\n  astc = \"WEBGL_compressed_texture_astc\",\n  astc_webkit = \"WEBKIT_WEBGL_compressed_texture_astc\",\n  etc = \"WEBGL_compressed_texture_etc\",\n  etc_webkit = \"WEBKIT_WEBGL_compressed_texture_etc\",\n  etc1 = \"WEBGL_compressed_texture_etc1\",\n  etc1_webkit = \"WEBKIT_WEBGL_compressed_texture_etc1\",\n  pvrtc = \"WEBGL_compressed_texture_pvrtc\",\n  pvrtc_webkit = \"WEBKIT_WEBGL_compressed_texture_pvrtc\",\n  s3tc = \"WEBGL_compressed_texture_s3tc\",\n  s3tc_webkit = \"WEBKIT_WEBGL_compressed_texture_s3tc\"\n  // atc = \"WEBGL_compressed_texture_atc\",\n  // s3tc_srgb = \"WEBGL_compressed_texture_s3tc_srgb\"\n}\n\nexport type TypedArray =\n  | Int8Array\n  | Uint8Array\n  | Int16Array\n  | Uint16Array\n  | Int32Array\n  | Uint32Array\n  | Uint8ClampedArray\n  | Float32Array\n  | Float64Array;\n","/**\n * High-performance unordered array, delete uses exchange method to improve performance, internal capacity only increases.\n */\nexport class DisorderedArray<T> {\n  _elements: T[];\n\n  length: number = 0;\n\n  constructor(count: number = 0) {\n    this._elements = new Array<T>(count);\n  }\n\n  add(element: T): void {\n    if (this.length === this._elements.length) this._elements.push(element);\n    else this._elements[this.length] = element;\n    this.length++;\n  }\n\n  delete(element: T): void {\n    //TODO: It can be optimized for custom binary search and other algorithms, currently this._elements>=this.length wastes performance.\n    const index = this._elements.indexOf(element);\n    this.deleteByIndex(index);\n  }\n  /**\n   *\n   * @param index\n   * @returns The replaced item is used to reset its index.\n   */\n  deleteByIndex(index: number): T {\n    var elements: T[] = this._elements;\n    let end: T = null;\n    const lastIndex = this.length - 1;\n    if (index !== lastIndex) {\n      end = elements[lastIndex];\n      elements[index] = end;\n    }\n    this.length--;\n    return end;\n  }\n\n  garbageCollection(): void {\n    this._elements.length = this.length;\n  }\n}\n","import { ShaderMacro } from \"./ShaderMacro\";\n\n/**\n * Shader macro collection.\n * @internal\n */\nexport class ShaderMacroCollection {\n  /**\n   * Union of two macro collection.\n   * @param left - input macro collection\n   * @param right - input macro collection\n   * @param out - union output macro collection\n   */\n  static unionCollection(left: ShaderMacroCollection, right: ShaderMacroCollection, out: ShaderMacroCollection): void {\n    const outMask = out._mask;\n    let minSize: number, maxSize: number;\n    let minMask: number[], maxMask: number[];\n    if (left._length < right._length) {\n      minSize = left._length;\n      maxSize = right._length;\n      minMask = left._mask;\n      maxMask = right._mask;\n    } else {\n      minSize = right._length;\n      maxSize = left._length;\n      minMask = right._mask;\n      maxMask = left._mask;\n    }\n\n    let i = 0;\n    outMask.length < maxSize && (outMask.length = maxSize);\n    for (; i < minSize; i++) {\n      outMask[i] = minMask[i] | maxMask[i];\n    }\n    for (; i < maxSize; i++) {\n      outMask[i] = maxMask[i];\n    }\n    out._length = maxSize;\n  }\n\n  /** @internal */\n  _mask: number[] = [];\n  /** @internal */\n  _length: number = 0;\n\n  /**\n   * Enable one macro in this macro collection.\n   * @param macro - ShaderMacro\n   */\n  enable(macro: ShaderMacro): void {\n    const index = macro._index;\n    const size = index + 1;\n    const mask = this._mask;\n    let maskStart = this._length; // must from this._length because this._length maybe less than mask.length and have dirty data should clear.\n    if (maskStart < size) {\n      mask.length < size && (mask.length = size); // mask.length maybe small than size,maybe not.\n      for (; maskStart < index; maskStart++) {\n        mask[maskStart] = 0;\n      }\n      mask[index] = macro._value;\n      this._length = size;\n    } else {\n      mask[index] |= macro._value;\n    }\n  }\n\n  /**\n   * Disable one macro in this macro collection.\n   * @param macro - ShaderMacro\n   */\n  disable(macro: ShaderMacro): void {\n    const index = macro._index;\n    const mask = this._mask;\n    const endIndex = this._length - 1;\n    if (index > endIndex) {\n      return;\n    }\n    const newValue = mask[index] & ~macro._value;\n    if (index == endIndex && newValue === 0) {\n      this._length--;\n    } else {\n      mask[index] = newValue;\n    }\n  }\n\n  /**\n   * Union of this and other macro collection.\n   * @param macroCollection - macro collection\n   */\n  unionCollection(macroCollection: ShaderMacroCollection): void {\n    const addMask = macroCollection._mask;\n    const addSize = macroCollection._length;\n    const mask = this._mask;\n    const maskSize = this._length;\n    if (maskSize < addSize) {\n      mask.length < addSize && (mask.length = addSize);\n      let i = 0;\n      for (; i < maskSize; i++) {\n        mask[i] |= addMask[i];\n      }\n      for (; i < addSize; i++) {\n        mask[i] = addMask[i];\n      }\n      this._length = addSize;\n    } else {\n      for (let i = 0; i < addSize; i++) {\n        mask[i] |= addMask[i];\n      }\n    }\n  }\n\n  /**\n   * Complementarity of this and other macro collection.\n   * @param macroCollection - macro collection\n   */\n  complementaryCollection(macroCollection: ShaderMacroCollection): void {\n    const removeMask = macroCollection._mask;\n    const mask = this._mask;\n    let endIndex = this._length - 1;\n    let i = Math.min(macroCollection._length - 1, endIndex);\n    for (; i >= 0; i--) {\n      const newValue = mask[i] & ~removeMask[i];\n      if (i == endIndex && newValue === 0) {\n        endIndex--;\n        this._length--;\n      } else {\n        mask[i] = newValue;\n      }\n    }\n  }\n\n  /**\n   * Intersection of this and other macro collection.\n   * @param macroCollection - macro collection\n   */\n  intersectionCollection(macroCollection: ShaderMacroCollection): void {\n    const unionMask = macroCollection._mask;\n    const mask = this._mask;\n    for (let i = this._length - 1; i >= 0; i--) {\n      const value = mask[i] & unionMask[i];\n      if (value == 0 && i == this._length - 1) {\n        this._length--;\n      } else {\n        mask[i] = value;\n      }\n    }\n  }\n\n  /**\n   * Whether macro is enabled in this macro collection.\n   * @param macro - ShaderMacro\n   */\n  isEnable(macro: ShaderMacro): boolean {\n    const index = macro._index;\n    if (index >= this._length) {\n      return false;\n    }\n    return (this._mask[index] & macro._value) !== 0;\n  }\n\n  /**\n   * Clear this macro collection.\n   */\n  clear(): void {\n    this._length = 0;\n  }\n}\n","import { Camera } from \"./Camera\";\nimport { DisorderedArray } from \"./DisorderedArray\";\nimport { Component } from \"./Component\";\nimport { Renderer } from \"./Renderer\";\nimport { Script } from \"./Script\";\nimport { ShaderMacroCollection } from \"./shader/ShaderMacroCollection\";\nimport { RenderContext } from \"./RenderPipeline/RenderContext\";\n\n/**\n * The manager of the components.\n */\nexport class ComponentsManager {\n  // Script\n  private _onStartScripts: DisorderedArray<Script> = new DisorderedArray();\n  private _onUpdateScripts: DisorderedArray<Script> = new DisorderedArray();\n  private _onLateUpdateScripts: DisorderedArray<Script> = new DisorderedArray();\n  private _destoryComponents: Script[] = [];\n\n  // Animation\n  private _onUpdateAnimations: DisorderedArray<Component> = new DisorderedArray();\n\n  // Render\n  private _renderers: DisorderedArray<Renderer> = new DisorderedArray();\n  private _onUpdateRenderers: DisorderedArray<Renderer> = new DisorderedArray();\n\n  // Delay dispose active/inActive Pool\n  private _componentsContainerPool: Component[][] = [];\n\n  addRenderer(renderer: Renderer) {\n    renderer._rendererIndex = this._renderers.length;\n    this._renderers.add(renderer);\n  }\n\n  removeRenderer(renderer: Renderer) {\n    const replaced = this._renderers.deleteByIndex(renderer._rendererIndex);\n    replaced && (replaced._rendererIndex = renderer._rendererIndex);\n    renderer._rendererIndex = -1;\n  }\n\n  addOnStartScript(script: Script) {\n    script._onStartIndex = this._onStartScripts.length;\n    this._onStartScripts.add(script);\n  }\n\n  removeOnStartScript(script: Script): void {\n    const replaced = this._onStartScripts.deleteByIndex(script._onStartIndex);\n    replaced && (replaced._onStartIndex = script._onStartIndex);\n    script._onStartIndex = -1;\n  }\n\n  addOnUpdateScript(script: Script) {\n    script._onUpdateIndex = this._onUpdateScripts.length;\n    this._onUpdateScripts.add(script);\n  }\n\n  removeOnUpdateScript(script: Script): void {\n    const replaced = this._onUpdateScripts.deleteByIndex(script._onUpdateIndex);\n    replaced && (replaced._onUpdateIndex = script._onUpdateIndex);\n    script._onUpdateIndex = -1;\n  }\n\n  addOnLateUpdateScript(script: Script): void {\n    script._onLateUpdateIndex = this._onLateUpdateScripts.length;\n    this._onLateUpdateScripts.add(script);\n  }\n\n  removeOnLateUpdateScript(script: Script): void {\n    const replaced = this._onLateUpdateScripts.deleteByIndex(script._onLateUpdateIndex);\n    replaced && (replaced._onLateUpdateIndex = script._onLateUpdateIndex);\n    script._onLateUpdateIndex = -1;\n  }\n\n  addOnUpdateAnimations(animation: Component): void {\n    //@ts-ignore\n    animation._onUpdateIndex = this._onUpdateAnimations.length;\n    this._onUpdateAnimations.add(animation);\n  }\n\n  removeOnUpdateAnimations(animation: Component): void {\n    //@ts-ignore\n    const replaced = this._onUpdateAnimations.deleteByIndex(animation._onUpdateIndex);\n    //@ts-ignore\n    replaced && (replaced._onUpdateIndex = animation._onUpdateIndex);\n    //@ts-ignore\n    animation._onUpdateIndex = -1;\n  }\n\n  addOnUpdateRenderers(renderer: Renderer): void {\n    renderer._onUpdateIndex = this._onUpdateRenderers.length;\n    this._onUpdateRenderers.add(renderer);\n  }\n\n  removeOnUpdateRenderers(renderer: Renderer): void {\n    const replaced = this._onUpdateRenderers.deleteByIndex(renderer._onUpdateIndex);\n    replaced && (replaced._onUpdateIndex = renderer._onUpdateIndex);\n    renderer._onUpdateIndex = -1;\n  }\n\n  addDestoryComponent(component): void {\n    this._destoryComponents.push(component);\n  }\n\n  callScriptOnStart(): void {\n    const onStartScripts = this._onStartScripts;\n    if (onStartScripts.length > 0) {\n      const elements = onStartScripts._elements;\n      // The 'onStartScripts.length' maybe add if you add some Script with addComponent() in some Script's onStart()\n      for (let i = 0; i < onStartScripts.length; i++) {\n        const script = elements[i];\n        script._started = true;\n        script._onStartIndex = -1;\n        script.onStart();\n      }\n      onStartScripts.length = 0;\n    }\n  }\n\n  callScriptOnUpdate(deltaTime): void {\n    const elements = this._onUpdateScripts._elements;\n    for (let i = this._onUpdateScripts.length - 1; i >= 0; --i) {\n      const element = elements[i];\n      if (element._started) {\n        element.onUpdate(deltaTime);\n      }\n    }\n  }\n\n  callScriptOnLateUpdate(deltaTime): void {\n    const elements = this._onLateUpdateScripts._elements;\n    for (let i = this._onLateUpdateScripts.length - 1; i >= 0; --i) {\n      const element = elements[i];\n      if (element._started) {\n        element.onLateUpdate(deltaTime);\n      }\n    }\n  }\n\n  callAnimationUpdate(deltaTime): void {\n    const elements = this._onUpdateAnimations._elements;\n    for (let i = this._onUpdateAnimations.length - 1; i >= 0; --i) {\n      //@ts-ignore\n      elements[i].update(deltaTime);\n    }\n  }\n\n  callRendererOnUpdate(deltaTime: number): void {\n    const elements = this._onUpdateRenderers._elements;\n    for (let i = this._onUpdateRenderers.length - 1; i >= 0; --i) {\n      elements[i].update(deltaTime);\n    }\n  }\n\n  callRender(context: RenderContext): void {\n    const camera = context._camera;\n    const elements = this._renderers._elements;\n    for (let i = this._renderers.length - 1; i >= 0; --i) {\n      const element = elements[i];\n\n      // filter by camera culling mask.\n      if (!(camera.cullingMask & element._entity.layer)) {\n        continue;\n      }\n\n      // filter by camera frustm.\n      if (camera.enableFrustumCulling) {\n        element.isCulled = !camera._frustum.intersectsBox(element.bounds);\n        if (element.isCulled) {\n          continue;\n        }\n      }\n\n      element._updateShaderData(context);\n\n      // union camera global macro and renderer macro.\n      ShaderMacroCollection.unionCollection(\n        camera._globalShaderMacro,\n        element.shaderData._macroCollection,\n        element._globalShaderMacro\n      );\n\n      element._render(camera);\n    }\n  }\n\n  callComponentDestory(): void {\n    const destoryComponents = this._destoryComponents;\n    const length = destoryComponents.length;\n    if (length > 0) {\n      for (let i = length - 1; i >= 0; --i) {\n        destoryComponents[i].onDestroy();\n      }\n      destoryComponents.length = 0;\n    }\n  }\n\n  callCameraOnBeginRender(camera: Camera) {\n    const camComps = camera.entity._components;\n    for (let i = camComps.length - 1; i >= 0; --i) {\n      const camComp = camComps[i];\n      (camComp as any).onBeginRender && (camComp as any).onBeginRender(camera);\n    }\n  }\n\n  callCameraOnEndRender(camera: Camera) {\n    const camComps = camera.entity._components;\n    for (let i = camComps.length - 1; i >= 0; --i) {\n      const camComp = camComps[i];\n      (camComp as any).onBeginRender && (camComp as any).onEndRender(camera);\n    }\n  }\n\n  getActiveChangedTempList(): Component[] {\n    return this._componentsContainerPool.length ? this._componentsContainerPool.pop() : [];\n  }\n\n  putActiveChangedTempList(componentContainer: Component[]): void {\n    componentContainer.length = 0;\n    this._componentsContainerPool.push(componentContainer);\n  }\n}\n","import { Component } from \"../Component\";\nimport { CloneManager } from \"./CloneManager\";\nimport { CloneMode } from \"./enums/CloneMode\";\n\nexport class ComponentCloner {\n  /**\n   * Clone component.\n   * @param source - Clone source\n   * @param target - Clone target\n   */\n  static cloneComponent(source: Component, target: Component): void {\n    const cloneModes = CloneManager.getCloneMode(source.constructor);\n    const keys = Object.keys(source);\n    for (let i = 0, n = keys.length; i < n; i++) {\n      const k = keys[i];\n      const cloneMode = cloneModes[k];\n      switch (cloneMode) {\n        case undefined:\n        case CloneMode.Assignment:\n          target[k] = source[k];\n          break;\n        case CloneMode.Shallow:\n          const sourcePropS: Object = source[k];\n          if (sourcePropS instanceof Object) {\n            let tarProp = <Object>target[k];\n            tarProp == null && (tarProp = target[k] = sourcePropS.constructor());\n            Object.assign(tarProp, sourcePropS);\n          } else {\n            // Null or undefine and primitive type.\n            target[k] = sourcePropS;\n          }\n          break;\n        case CloneMode.Deep:\n          const sourcePropD: Object = source[k];\n          if (sourcePropD instanceof Object) {\n            let tarProp = <Object>target[k];\n            tarProp == null && (tarProp = target[k] = sourcePropD.constructor());\n            CloneManager.deepCloneObject(sourcePropD, tarProp);\n          } else {\n            // Null or undefine and primitive type.\n            target[k] = sourcePropD;\n          }\n          break;\n      }\n    }\n  }\n}\n","import { Component } from \"./Component\";\nimport { Entity } from \"./Entity\";\n\ntype ComponentConstructor = new (entity: Entity) => Component;\n\n/**\n * Used for component dependency registration.\n */\nexport class ComponentsDependencies {\n  /**\n   * @internal\n   */\n  private static _dependenciesMap = new Map<ComponentConstructor, ComponentConstructor[]>();\n  private static _invDependenciesMap = new Map<ComponentConstructor, ComponentConstructor[]>();\n\n  /**\n   * Register component dependencies.\n   * @param currentComponent - The component you want to be register.\n   * @param dependentComponent - The component's dependencies.\n   */\n  static register(currentComponent: ComponentConstructor, dependentComponent: ComponentConstructor) {\n    this._addDependency(currentComponent, dependentComponent, this._dependenciesMap);\n    this._addDependency(dependentComponent, currentComponent, this._invDependenciesMap);\n  }\n\n  /**\n   * @internal\n   */\n  static _addCheck(entity: Entity, type: ComponentConstructor) {\n    // Check if there are dependent components.\n    const dependencies = ComponentsDependencies._dependenciesMap.get(type);\n    if (dependencies) {\n      for (let i = 0, len = dependencies.length; i < len; i++) {\n        if (!entity.getComponent(dependencies[i])) {\n          throw `you should add ${dependencies[i]} before adding ${type}`;\n        }\n      }\n    }\n  }\n\n  /**\n   * @internal\n   */\n  static _removeCheck(entity: Entity, type: ComponentConstructor) {\n    const invDenpendencies = ComponentsDependencies._invDependenciesMap.get(type);\n    if (invDenpendencies) {\n      for (let i = 0, len = invDenpendencies.length; i < len; i++) {\n        if (entity.getComponent(invDenpendencies[i])) {\n          throw `you should remove ${invDenpendencies[i]} before adding ${type}`;\n        }\n      }\n    }\n  }\n\n  private static _addDependency(\n    currentComponent: ComponentConstructor,\n    dependentComponent: ComponentConstructor,\n    map: Map<any, any>\n  ) {\n    let components = map.get(currentComponent);\n    if (!components) {\n      components = [];\n      map.set(currentComponent, components);\n    }\n    if (components.indexOf(dependentComponent) === -1) {\n      components.push(dependentComponent);\n    }\n  }\n\n  private constructor() {}\n}\n\nexport function dependencies(...abilityClass: ComponentConstructor[]) {\n  return function <T extends ComponentConstructor>(target: T): void {\n    abilityClass.forEach((ability) => ComponentsDependencies.register(target, ability));\n  };\n}\n","/**\n * Layer, used for bit operations.\n */\nexport enum Layer {\n  Layer0 = 0x1,\n  Layer1 = 0x2,\n  Layer2 = 0x4,\n  Layer3 = 0x8,\n  Layer4 = 0x10,\n  Layer5 = 0x20,\n  Layer6 = 0x40,\n  Layer7 = 0x80,\n  Layer8 = 0x100,\n  Layer9 = 0x200,\n  Layer10 = 0x400,\n  Layer11 = 0x800,\n  Layer12 = 0x1000,\n  Layer13 = 0x2000,\n  Layer14 = 0x4000,\n  Layer15 = 0x8000,\n  Layer16 = 0x10000,\n  Layer17 = 0x20000,\n  Layer18 = 0x40000,\n  Layer19 = 0x80000,\n  Layer20 = 0x100000,\n  Layer21 = 0x200000,\n  Layer22 = 0x400000,\n  Layer23 = 0x800000,\n  Layer24 = 0x1000000,\n  Layer25 = 0x2000000,\n  Layer26 = 0x4000000,\n  Layer27 = 0x8000000,\n  Layer28 = 0x10000000,\n  Layer29 = 0x20000000,\n  Layer30 = 0x40000000,\n  Layer31 = 0x80000000,\n  Everything = 0xffffffff,\n  Nothing = 0x0\n}\n","import { EngineObject } from \"./base\";\nimport { assignmentClone, ignoreClone } from \"./clone/CloneManager\";\nimport { Engine } from \"./Engine\";\nimport { Entity } from \"./Entity\";\nimport { Scene } from \"./Scene\";\n\n/**\n * The base class of the components.\n */\nexport abstract class Component extends EngineObject {\n  /** @internal */\n  @ignoreClone\n  _entity: Entity;\n  /** @internal */\n  @ignoreClone\n  _destroyed: boolean = false;\n\n  @assignmentClone\n  private _enabled: boolean = true;\n  @ignoreClone\n  private _awaked: boolean = false;\n\n  /**\n   * Enabled getter, 'enabled' indicates whether the component is enabled.\n   */\n  get enabled(): boolean {\n    return this._enabled;\n  }\n\n  /**\n   * Enabled setter, indicates whether the component is enabled.\n   */\n  set enabled(value: boolean) {\n    if (value === this._enabled) {\n      return;\n    }\n    this._enabled = value;\n    if (value) {\n      this._entity.isActiveInHierarchy && this._onEnable();\n    } else {\n      this._entity.isActiveInHierarchy && this._onDisable();\n    }\n  }\n\n  /**\n   * Destroyed getter, 'destroyed' indicates whether the component is destroyed.\n   */\n  get destroyed(): boolean {\n    return this._destroyed;\n  }\n\n  /**\n   * The entitiy which the component belongs to.\n   */\n  get entity(): Entity {\n    return this._entity;\n  }\n\n  /**\n   * The scene which the component's entity belongs to.\n   */\n  get scene(): Scene {\n    return this._entity.scene;\n  }\n\n  /**\n   * The engine which the component's entity belongs to.\n   */\n  get engine(): Engine {\n    return this._entity.engine;\n  }\n\n  constructor(entity: Entity) {\n    super(entity.engine);\n    this._entity = entity;\n  }\n\n  /**\n   * Destory this instance.\n   */\n  destroy(): void {\n    if (this._destroyed) {\n      return;\n    }\n    this._entity._removeComponent(this);\n    if (this._entity.isActiveInHierarchy) {\n      this._enabled && this._onDisable();\n      this._onInActive();\n    }\n    this._destroyed = true;\n    this._onDestroy();\n  }\n\n  /**\n   * @internal\n   */\n  _onAwake(): void {}\n\n  /**\n   * @internal\n   */\n  _onEnable(): void {}\n\n  /**\n   * @internal\n   */\n  _onDisable(): void {}\n\n  /**\n   * @internal\n   */\n  _onDestroy(): void {}\n\n  /**\n   * @internal\n   */\n  _onActive(): void {}\n\n  /**\n   * @internal\n   */\n  _onInActive(): void {}\n\n  /**\n   * @internal\n   */\n  _setActive(value: boolean): void {\n    if (value) {\n      if (!this._awaked) {\n        this._awaked = true;\n        this._onAwake();\n      }\n      // You can do isActive = false in onAwake function.\n      if (this._entity._isActiveInHierarchy) {\n        this._onActive();\n        this._enabled && this._onEnable();\n      }\n    } else {\n      this._enabled && this._onDisable();\n      this._onInActive();\n    }\n  }\n\n  //---------------------------------------------Deprecated-----------------------------------------------------------------\n\n  private _renderPriority: number = 0;\n\n  /**\n   * @deprecated\n   * Rendering priority.\n   */\n  get renderPriority(): number {\n    return this._renderPriority;\n  }\n  set renderPriority(val: number) {\n    this._renderPriority = val;\n  }\n}\n","import { removeFromArray } from \"./base/Util\";\n\n/**\n * Used to update tags.\n */\nexport class UpdateFlag {\n  /** Flag. */\n  flag = true;\n\n  constructor(private _flags: UpdateFlag[] = []) {}\n\n  /**\n   * Destroy.\n   */\n  destroy(): void {\n    const flags = this._flags;\n    removeFromArray(flags, this);\n    this._flags = null;\n  }\n}\n","import { MathUtil, Matrix, Matrix3x3, Quaternion, Vector3 } from \"@oasis-engine/math\";\nimport { assignmentClone, deepClone, ignoreClone } from \"./clone/CloneManager\";\nimport { Component } from \"./Component\";\nimport { UpdateFlag } from \"./UpdateFlag\";\n\n/**\n * Used to implement transformation related functions.\n */\nexport class Transform extends Component {\n  private static _tempQuat0: Quaternion = new Quaternion();\n  private static _tempVec3: Vector3 = new Vector3();\n  private static _tempMat30: Matrix3x3 = new Matrix3x3();\n  private static _tempMat31: Matrix3x3 = new Matrix3x3();\n  private static _tempMat32: Matrix3x3 = new Matrix3x3();\n  private static _tempMat40: Matrix = new Matrix();\n  private static _tempMat41: Matrix = new Matrix();\n  private static _tempMat42: Matrix = new Matrix();\n  private static _tempMat43: Matrix = new Matrix();\n\n  private static _LOCAL_EULER_FLAG: number = 0x1;\n  private static _LOCAL_QUAT_FLAG: number = 0x2;\n  private static _WORLD_POSITION_FLAG: number = 0x4;\n  private static _WORLD_EULER_FLAG: number = 0x8;\n  private static _WORLD_QUAT_FLAG: number = 0x10;\n  private static _WORLD_SCALE_FLAG: number = 0x20;\n  private static _LOCAL_MATRIX_FLAG: number = 0x40;\n  private static _WORLD_MATRIX_FLAG: number = 0x80;\n\n  /** _WORLD_MATRIX_FLAG | _WORLD_POSITION_FLAG */\n  private static _WM_WP_FLAGS: number = 0x84;\n  /** _WORLD_MATRIX_FLAG | _WORLD_EULER_FLAG | _WORLD_QUAT_FLAG */\n  private static _WM_WE_WQ_FLAGS: number = 0x98;\n  /** _WORLD_MATRIX_FLAG | _WORLD_POSITION_FLAG | _WORLD_EULER_FLAG | _WORLD_QUAT_FLAG */\n  private static _WM_WP_WE_WQ_FLAGS: number = 0x9c;\n  /** Transform._WORLD_MATRIX_FLAG | Transform._WORLD_SCALE_FLAG */\n  private static _WM_WS_FLAGS: number = 0xa0;\n  /** Transform._WORLD_MATRIX_FLAG | Transform._WORLD_POSITION_FLAG | Transform._WORLD_SCALE_FLAG */\n  private static _WM_WP_WS_FLAGS: number = 0xa4;\n  /** Transform._WORLD_MATRIX_FLAG | Transform._WORLD_POSITION_FLAG | Transform._WORLD_EULER_FLAG | Transform._WORLD_QUAT_FLAG | Transform._WORLD_SCALE_FLAG */\n  private static _WM_WP_WE_WQ_WS_FLAGS: number = 0xbc;\n\n  @deepClone\n  private _position: Vector3 = new Vector3();\n  @deepClone\n  private _rotation: Vector3 = new Vector3();\n  @deepClone\n  private _rotationQuaternion: Quaternion = new Quaternion();\n  @deepClone\n  private _scale: Vector3 = new Vector3(1, 1, 1);\n  @deepClone\n  private _worldPosition: Vector3 = new Vector3();\n  @deepClone\n  private _worldRotation: Vector3 = new Vector3();\n  @deepClone\n  private _worldRotationQuaternion: Quaternion = new Quaternion();\n  @deepClone\n  private _lossyWorldScale: Vector3 = new Vector3(1, 1, 1);\n  @deepClone\n  private _localMatrix: Matrix = new Matrix();\n  @deepClone\n  private _worldMatrix: Matrix = new Matrix();\n  @ignoreClone\n  private _changeFlags: UpdateFlag[] = [];\n  @ignoreClone\n  private _isParentDirty: boolean = true;\n  @ignoreClone\n  private _parentTransformCache: Transform = null;\n\n  private _dirtyFlag: number = Transform._WM_WP_WE_WQ_WS_FLAGS;\n\n  /**\n   * Local position.\n   * @remarks Need to re-assign after modification to ensure that the modification takes effect.\n   */\n  get position(): Vector3 {\n    return this._position;\n  }\n\n  set position(value: Vector3) {\n    if (this._position !== value) {\n      value.cloneTo(this._position);\n    }\n    this._setDirtyFlagTrue(Transform._LOCAL_MATRIX_FLAG);\n    this._updateWorldPositionFlag();\n  }\n\n  /**\n   * World position.\n   * @remarks Need to re-assign after modification to ensure that the modification takes effect.\n   */\n  get worldPosition(): Vector3 {\n    if (this._isContainDirtyFlag(Transform._WORLD_POSITION_FLAG)) {\n      if (this._getParentTransform()) {\n        this.worldMatrix.getTranslation(this._worldPosition);\n      } else {\n        this._position.cloneTo(this._worldPosition);\n      }\n      this._setDirtyFlagFalse(Transform._WORLD_POSITION_FLAG);\n    }\n    return this._worldPosition;\n  }\n\n  set worldPosition(value: Vector3) {\n    if (this._worldPosition !== value) {\n      value.cloneTo(this._worldPosition);\n    }\n    const parent = this._getParentTransform();\n    if (parent) {\n      Matrix.invert(parent.worldMatrix, Transform._tempMat41);\n      Vector3.transformCoordinate(value, Transform._tempMat41, this._position);\n    } else {\n      value.cloneTo(this._position);\n    }\n    this.position = this._position;\n    this._setDirtyFlagFalse(Transform._WORLD_POSITION_FLAG);\n  }\n\n  /**\n   * Local rotation, defining the rotation value in degrees, Yaw/Pitch/Roll sequence.\n   * @remarks Need to re-assign after modification to ensure that the modification takes effect.\n   */\n  get rotation(): Vector3 {\n    if (this._isContainDirtyFlag(Transform._LOCAL_EULER_FLAG)) {\n      this._rotationQuaternion.toEuler(this._rotation);\n      this._rotation.scale(MathUtil.radToDegreeFactor); // radians to degrees\n\n      this._setDirtyFlagFalse(Transform._LOCAL_EULER_FLAG);\n    }\n    return this._rotation;\n  }\n\n  set rotation(value: Vector3) {\n    if (this._rotation !== value) {\n      value.cloneTo(this._rotation);\n    }\n    this._setDirtyFlagTrue(Transform._LOCAL_MATRIX_FLAG | Transform._LOCAL_QUAT_FLAG);\n    this._setDirtyFlagFalse(Transform._LOCAL_EULER_FLAG);\n    this._updateWorldRotationFlag();\n  }\n\n  /**\n   * World rotation, defining the rotation value in degrees, Yaw/Pitch/Roll sequence.\n   * @remarks Need to re-assign after modification to ensure that the modification takes effect.\n   */\n  get worldRotation(): Vector3 {\n    if (this._isContainDirtyFlag(Transform._WORLD_EULER_FLAG)) {\n      this.worldRotationQuaternion.toEuler(this._worldRotation);\n      this._worldRotation.scale(MathUtil.radToDegreeFactor); // Radian to angle\n      this._setDirtyFlagFalse(Transform._WORLD_EULER_FLAG);\n    }\n    return this._worldRotation;\n  }\n\n  set worldRotation(value: Vector3) {\n    if (this._worldRotation !== value) {\n      value.cloneTo(this._worldRotation);\n    }\n    Quaternion.rotationEuler(\n      MathUtil.degreeToRadian(value.x),\n      MathUtil.degreeToRadian(value.y),\n      MathUtil.degreeToRadian(value.z),\n      this._worldRotationQuaternion\n    );\n    this.worldRotationQuaternion = this._worldRotationQuaternion;\n    this._setDirtyFlagFalse(Transform._WORLD_EULER_FLAG);\n  }\n\n  /**\n   * Local rotaion, defining the rotation by using a unit quaternion.\n   * @remarks Need to re-assign after modification to ensure that the modification takes effect.\n   */\n  get rotationQuaternion(): Quaternion {\n    if (this._isContainDirtyFlag(Transform._LOCAL_QUAT_FLAG)) {\n      Quaternion.rotationEuler(\n        MathUtil.degreeToRadian(this._rotation.x),\n        MathUtil.degreeToRadian(this._rotation.y),\n        MathUtil.degreeToRadian(this._rotation.z),\n        this._rotationQuaternion\n      );\n      this._setDirtyFlagFalse(Transform._LOCAL_QUAT_FLAG);\n    }\n    return this._rotationQuaternion;\n  }\n\n  set rotationQuaternion(value: Quaternion) {\n    if (this._rotationQuaternion !== value) {\n      value.cloneTo(this._rotationQuaternion);\n    }\n    this._setDirtyFlagTrue(Transform._LOCAL_MATRIX_FLAG | Transform._LOCAL_EULER_FLAG);\n    this._setDirtyFlagFalse(Transform._LOCAL_QUAT_FLAG);\n    this._updateWorldRotationFlag();\n  }\n\n  /**\n   * World rotaion, defining the rotation by using a unit quaternion.\n   * @remarks Need to re-assign after modification to ensure that the modification takes effect.\n   */\n  get worldRotationQuaternion(): Quaternion {\n    if (this._isContainDirtyFlag(Transform._WORLD_QUAT_FLAG)) {\n      const parent = this._getParentTransform();\n      if (parent != null) {\n        Quaternion.multiply(parent.worldRotationQuaternion, this.rotationQuaternion, this._worldRotationQuaternion);\n      } else {\n        this.rotationQuaternion.cloneTo(this._worldRotationQuaternion);\n      }\n      this._setDirtyFlagFalse(Transform._WORLD_QUAT_FLAG);\n    }\n    return this._worldRotationQuaternion;\n  }\n\n  set worldRotationQuaternion(value: Quaternion) {\n    if (this._worldRotationQuaternion !== value) {\n      value.cloneTo(this._worldRotationQuaternion);\n    }\n    const parent = this._getParentTransform();\n    if (parent) {\n      Quaternion.invert(parent.worldRotationQuaternion, Transform._tempQuat0);\n      Quaternion.multiply(value, Transform._tempQuat0, this._rotationQuaternion);\n    } else {\n      value.cloneTo(this._rotationQuaternion);\n    }\n    this.rotationQuaternion = this._rotationQuaternion;\n    this._setDirtyFlagFalse(Transform._WORLD_QUAT_FLAG);\n  }\n\n  /**\n   * Local scaling.\n   * @remarks Need to re-assign after modification to ensure that the modification takes effect.\n   */\n  get scale(): Vector3 {\n    return this._scale;\n  }\n\n  set scale(value: Vector3) {\n    if (this._scale !== value) {\n      value.cloneTo(this._scale);\n    }\n    this._setDirtyFlagTrue(Transform._LOCAL_MATRIX_FLAG);\n    this._updateWorldScaleFlag();\n  }\n\n  /**\n   * Local lossy scaling.\n   * @remarks The value obtained may not be correct under certain conditions(for example, the parent node has scaling, and the child node has a rotation), the scaling will be tilted. Vector3 cannot be used to correctly represent the scaling. Must use Matrix3x3.\n   */\n  get lossyWorldScale(): Vector3 {\n    if (this._isContainDirtyFlag(Transform._WORLD_SCALE_FLAG)) {\n      if (this._getParentTransform()) {\n        const scaleMat = this._getScaleMatrix();\n        const e = scaleMat.elements;\n        this._lossyWorldScale.setValue(e[0], e[4], e[8]);\n      } else {\n        this._scale.cloneTo(this._lossyWorldScale);\n      }\n      this._setDirtyFlagFalse(Transform._WORLD_SCALE_FLAG);\n    }\n    return this._lossyWorldScale;\n  }\n\n  /**\n   * Local matrix.\n   * @remarks Need to re-assign after modification to ensure that the modification takes effect.\n   */\n  get localMatrix(): Matrix {\n    if (this._isContainDirtyFlag(Transform._LOCAL_MATRIX_FLAG)) {\n      Matrix.affineTransformation(this._scale, this.rotationQuaternion, this._position, this._localMatrix);\n      this._setDirtyFlagFalse(Transform._LOCAL_MATRIX_FLAG);\n    }\n    return this._localMatrix;\n  }\n\n  set localMatrix(value: Matrix) {\n    if (this._localMatrix !== value) {\n      value.cloneTo(this._localMatrix);\n    }\n    this._localMatrix.decompose(this._position, this._rotationQuaternion, this._scale);\n    this._setDirtyFlagTrue(Transform._LOCAL_EULER_FLAG);\n    this._setDirtyFlagFalse(Transform._LOCAL_MATRIX_FLAG);\n    this._updateAllWorldFlag();\n  }\n\n  /**\n   * World matrix.\n   * @remarks Need to re-assign after modification to ensure that the modification takes effect.\n   */\n  get worldMatrix(): Matrix {\n    if (this._isContainDirtyFlag(Transform._WORLD_MATRIX_FLAG)) {\n      const parent = this._getParentTransform();\n      if (parent) {\n        Matrix.multiply(parent.worldMatrix, this.localMatrix, this._worldMatrix);\n      } else {\n        this.localMatrix.cloneTo(this._worldMatrix);\n      }\n      this._setDirtyFlagFalse(Transform._WORLD_MATRIX_FLAG);\n    }\n    return this._worldMatrix;\n  }\n\n  set worldMatrix(value: Matrix) {\n    if (this._worldMatrix !== value) {\n      value.cloneTo(this._worldMatrix);\n    }\n    const parent = this._getParentTransform();\n    if (parent) {\n      Matrix.invert(parent.worldMatrix, Transform._tempMat42);\n      Matrix.multiply(value, Transform._tempMat42, this._localMatrix);\n    } else {\n      value.cloneTo(this._localMatrix);\n    }\n    this.localMatrix = this._localMatrix;\n    this._setDirtyFlagFalse(Transform._WORLD_MATRIX_FLAG);\n  }\n\n  /**\n   * Set local position by X, Y, Z value.\n   * @param x - X coordinate\n   * @param y - Y coordinate\n   * @param z - Z coordinate\n   */\n  setPosition(x: number, y: number, z: number): void {\n    this._position.setValue(x, y, z);\n    this.position = this._position;\n  }\n\n  /**\n   * Set local rotaion by the X, Y, Z components of the euler angle, unit in degrees, Yaw/Pitch/Roll sequence.\n   * @param x - The angle of rotation around the X axis\n   * @param y - The angle of rotation around the Y axis\n   * @param z - The angle of rotation around the Z axis\n   */\n  setRotation(x: number, y: number, z: number): void {\n    this._rotation.setValue(x, y, z);\n    this.rotation = this._rotation;\n  }\n\n  /**\n   * Set local rotaion by the X, Y, Z, and W components of the quaternion.\n   * @param x - X component of quaternion\n   * @param y - Y component of quaternion\n   * @param z - Z component of quaternion\n   * @param w - W component of quaternion\n   */\n  setRotationQuaternion(x: number, y: number, z: number, w: number): void {\n    this._rotationQuaternion.setValue(x, y, z, w);\n    this.rotationQuaternion = this._rotationQuaternion;\n  }\n\n  /**\n   * Set local scaling by scaling values along X, Y, Z axis.\n   * @param x - Scaling along X axis\n   * @param y - Scaling along Y axis\n   * @param z - Scaling along Z axis\n   */\n  setScale(x: number, y: number, z: number): void {\n    this._scale.setValue(x, y, z);\n    this.scale = this._scale;\n  }\n\n  /**\n   * Set world position by X, Y, Z value.\n   * @param x - X coordinate\n   * @param y - Y coordinate\n   * @param z - Z coordinate\n   */\n  setWorldPosition(x: number, y: number, z: number): void {\n    this._worldPosition.setValue(x, y, z);\n    this.worldPosition = this._worldPosition;\n  }\n\n  /**\n   * Set world rotaion by the X, Y, Z components of the euler angle, unit in degrees, Yaw/Pitch/Roll sequence.\n   * @param x - The angle of rotation around the X axis\n   * @param y - The angle of rotation around the Y axis\n   * @param z - The angle of rotation around the Z axis\n   */\n  setWorldRotation(x: number, y: number, z: number): void {\n    this._worldRotation.setValue(x, y, z);\n    this.worldRotation = this._worldRotation;\n  }\n\n  /**\n   * Set local rotaion by the X, Y, Z, and W components of the quaternion.\n   * @param x - X component of quaternion\n   * @param y - Y component of quaternion\n   * @param z - Z component of quaternion\n   * @param w - W component of quaternion\n   */\n  setWorldRotationQuaternion(x: number, y: number, z: number, w: number): void {\n    this._worldRotationQuaternion.setValue(x, y, z, w);\n    this.worldRotationQuaternion = this._worldRotationQuaternion;\n  }\n\n  /**\n   * Get the forward direction in world space.\n   * @param forward - Forward vector\n   * @returns Forward vector\n   */\n  getWorldForward(forward: Vector3): Vector3 {\n    const e = this.worldMatrix.elements;\n    forward.setValue(-e[8], -e[9], -e[10]);\n    return forward.normalize();\n  }\n\n  /**\n   * Get the right direction in world space.\n   * @param right - Right vector\n   * @returns Right vector\n   */\n  getWorldRight(right: Vector3): Vector3 {\n    const e = this.worldMatrix.elements;\n    right.setValue(e[0], e[1], e[2]);\n    return right.normalize();\n  }\n\n  /**\n   * Get the up direction in world space.\n   * @param up - Up vector\n   * @returns Up vector\n   */\n  getWorldUp(up: Vector3): Vector3 {\n    const e = this.worldMatrix.elements;\n    up.setValue(e[4], e[5], e[6]);\n    return up.normalize();\n  }\n\n  /**\n   * Translate along the passed Vector3.\n   * @param translation - Direction and distance of translation\n   * @param relativeToLocal - Relative to local space\n   */\n  translate(translation: Vector3, relativeToLocal?: boolean): void;\n\n  /**\n   * Translate along the passed X, Y, Z value.\n   * @param x - Translate direction and distance along x axis\n   * @param y - Translate direction and distance along y axis\n   * @param z - Translate direction and distance along z axis\n   * @param relativeToLocal - Relative to local space\n   */\n  translate(x: number, y: number, z: number, relativeToLocal?: boolean): void;\n\n  translate(\n    translationOrX: Vector3 | number,\n    relativeToLocalOrY?: boolean | number,\n    z?: number,\n    relativeToLocal?: boolean\n  ): void {\n    if (typeof translationOrX === \"number\") {\n      const translate = Transform._tempVec3;\n      translate.setValue(translationOrX, <number>relativeToLocalOrY, z);\n      this._translate(translate, relativeToLocal);\n    } else {\n      this._translate(translationOrX, <boolean>relativeToLocalOrY);\n    }\n  }\n\n  /**\n   * Rotate around the passed Vector3.\n   * @param rotation - Euler angle in degrees\n   * @param relativeToLocal - Relative to local space\n   */\n  rotate(rotation: Vector3, relativeToLocal?: boolean): void;\n\n  /**\n   * Rotate around the passed Vector3.\n   * @param x - Rotation along x axis, in degrees\n   * @param y - Rotation along y axis, in degrees\n   * @param z - Rotation along z axis, in degrees\n   * @param relativeToLocal - Relative to local space\n   */\n  rotate(x: number, y: number, z: number, relativeToLocal?: boolean): void;\n\n  rotate(\n    rotationOrX: Vector3 | number,\n    relativeToLocalOrY?: boolean | number,\n    z?: number,\n    relativeToLocal?: boolean\n  ): void {\n    if (typeof rotationOrX === \"number\") {\n      this._rotateXYZ(rotationOrX, <number>relativeToLocalOrY, z, relativeToLocal);\n    } else {\n      this._rotateXYZ(rotationOrX.x, rotationOrX.y, rotationOrX.z, <boolean>relativeToLocalOrY);\n    }\n  }\n\n  /**\n   * Rotate around the specified axis according to the specified angle.\n   * @param axis - Rotate axis\n   * @param angle - Rotate angle in degrees\n   * @param relativeToLocal - Relative to local space\n   */\n  rotateByAxis(axis: Vector3, angle: number, relativeToLocal: boolean = true): void {\n    const rad = angle * MathUtil.degreeToRadFactor;\n    Quaternion.rotationAxisAngle(axis, rad, Transform._tempQuat0);\n    this._rotateByQuat(Transform._tempQuat0, relativeToLocal);\n  }\n\n  /**\n   * Rotate and ensure that the world front vector points to the target world position.\n   * @param worldPosition - Target world position\n   * @param worldUp - Up direciton in world space, defalut is Vector3(0, 1, 0)\n   */\n  lookAt(worldPosition: Vector3, worldUp?: Vector3): void {\n    const position = this.worldPosition;\n    const EPSILON = MathUtil.zeroTolerance;\n    if (\n      Math.abs(position.x - worldPosition.x) < EPSILON &&\n      Math.abs(position.y - worldPosition.y) < EPSILON &&\n      Math.abs(position.z - worldPosition.z) < EPSILON\n    ) {\n      return;\n    }\n    const rotMat = Transform._tempMat43;\n    const worldRotationQuaternion = this._worldRotationQuaternion;\n\n    worldUp = worldUp ?? Transform._tempVec3.setValue(0, 1, 0);\n    Matrix.lookAt(position, worldPosition, worldUp, rotMat);\n    rotMat.getRotation(worldRotationQuaternion).invert();\n    this.worldRotationQuaternion = worldRotationQuaternion;\n  }\n\n  /**\n   * Register world transform change flag.\n   * @returns Change flag\n   */\n  registerWorldChangeFlag(): UpdateFlag {\n    const flag = new UpdateFlag(this._changeFlags);\n    this._changeFlags.push(flag);\n    return flag;\n  }\n\n  /**\n   * @internal\n   */\n  _parentChange(): void {\n    this._isParentDirty = true;\n    this._updateAllWorldFlag();\n  }\n\n  /**\n   * Get worldMatrix: Will trigger the worldMatrix update of itself and all parent entities.\n   * Get worldPosition: Will trigger the worldMatrix, local position update of itself and the worldMatrix update of all parent entities.\n   * In summary, any update of related variables will cause the dirty mark of one of the full process (worldMatrix or worldRotationQuaternion) to be false.\n   */\n  private _updateWorldPositionFlag(): void {\n    if (!this._isContainDirtyFlags(Transform._WM_WP_FLAGS)) {\n      this._worldAssociatedChange(Transform._WM_WP_FLAGS);\n      const nodeChildren = this._entity._children;\n      for (let i: number = 0, n: number = nodeChildren.length; i < n; i++) {\n        nodeChildren[i].transform?._updateWorldPositionFlag();\n      }\n    }\n  }\n\n  /**\n   * Get worldMatrix: Will trigger the worldMatrix update of itself and all parent entities.\n   * Get worldPosition: Will trigger the worldMatrix, local position update of itself and the worldMatrix update of all parent entities.\n   * Get worldRotationQuaternion: Will trigger the world rotation (in quaternion) update of itself and all parent entities.\n   * Get worldRotation: Will trigger the world rotation(in euler and quaternion) update of itself and world rotation(in quaternion) update of all parent entities.\n   * In summary, any update of related variables will cause the dirty mark of one of the full process (worldMatrix or worldRotationQuaternion) to be false.\n   */\n  private _updateWorldRotationFlag() {\n    if (!this._isContainDirtyFlags(Transform._WM_WE_WQ_FLAGS)) {\n      this._worldAssociatedChange(Transform._WM_WE_WQ_FLAGS);\n      const nodeChildren = this._entity._children;\n      for (let i: number = 0, n: number = nodeChildren.length; i < n; i++) {\n        nodeChildren[i].transform?._updateWorldPositionAndRotationFlag(); // Rotation update of parent entity will trigger world position and rotation update of all child entity.\n      }\n    }\n  }\n\n  /**\n   * Get worldMatrix: Will trigger the worldMatrix update of itself and all parent entities.\n   * Get worldPosition: Will trigger the worldMatrix, local position update of itself and the worldMatrix update of all parent entities.\n   * Get worldRotationQuaternion: Will trigger the world rotation (in quaternion) update of itself and all parent entities.\n   * Get worldRotation: Will trigger the world rotation(in euler and quaternion) update of itself and world rotation(in quaternion) update of all parent entities.\n   * In summary, any update of related variables will cause the dirty mark of one of the full process (worldMatrix or worldRotationQuaternion) to be false.\n   */\n  private _updateWorldPositionAndRotationFlag() {\n    if (!this._isContainDirtyFlags(Transform._WM_WP_WE_WQ_FLAGS)) {\n      this._worldAssociatedChange(Transform._WM_WP_WE_WQ_FLAGS);\n      const nodeChildren = this._entity._children;\n      for (let i: number = 0, n: number = nodeChildren.length; i < n; i++) {\n        nodeChildren[i].transform?._updateWorldPositionAndRotationFlag();\n      }\n    }\n  }\n\n  /**\n   * Get worldMatrix: Will trigger the worldMatrix update of itself and all parent entities.\n   * Get worldPosition: Will trigger the worldMatrix, local position update of itself and the worldMatrix update of all parent entities.\n   * Get worldScale: Will trigger the scaling update of itself and all parent entities.\n   * In summary, any update of related variables will cause the dirty mark of one of the full process (worldMatrix) to be false.\n   */\n  private _updateWorldScaleFlag() {\n    if (!this._isContainDirtyFlags(Transform._WM_WS_FLAGS)) {\n      this._worldAssociatedChange(Transform._WM_WS_FLAGS);\n      const nodeChildren = this._entity._children;\n      for (let i: number = 0, n: number = nodeChildren.length; i < n; i++) {\n        nodeChildren[i].transform?._updateWorldPositionAndScaleFlag();\n      }\n    }\n  }\n\n  /**\n   * Get worldMatrix: Will trigger the worldMatrix update of itself and all parent entities.\n   * Get worldPosition: Will trigger the worldMatrix, local position update of itself and the worldMatrix update of all parent entities.\n   * Get worldScale: Will trigger the scaling update of itself and all parent entities.\n   * In summary, any update of related variables will cause the dirty mark of one of the full process (worldMatrix) to be false.\n   */\n  private _updateWorldPositionAndScaleFlag(): void {\n    if (!this._isContainDirtyFlags(Transform._WM_WP_WS_FLAGS)) {\n      this._worldAssociatedChange(Transform._WM_WP_WS_FLAGS);\n      const nodeChildren = this._entity._children;\n      for (let i: number = 0, n: number = nodeChildren.length; i < n; i++) {\n        nodeChildren[i].transform?._updateWorldPositionAndScaleFlag();\n      }\n    }\n  }\n\n  /**\n   * Update all world transform property dirty flag, the principle is the same as above.\n   */\n  private _updateAllWorldFlag(): void {\n    if (!this._isContainDirtyFlags(Transform._WM_WP_WE_WQ_WS_FLAGS)) {\n      this._worldAssociatedChange(Transform._WM_WP_WE_WQ_WS_FLAGS);\n      const nodeChildren = this._entity._children;\n      for (let i: number = 0, n: number = nodeChildren.length; i < n; i++) {\n        nodeChildren[i].transform?._updateAllWorldFlag();\n      }\n    }\n  }\n\n  private _getParentTransform(): Transform | null {\n    if (!this._isParentDirty) {\n      return this._parentTransformCache;\n    }\n    let parentCache: Transform = null;\n    let parent = this._entity.parent;\n    while (parent) {\n      const transform = parent.transform;\n      if (transform) {\n        parentCache = transform;\n        break;\n      } else {\n        parent = parent.parent;\n      }\n    }\n    this._parentTransformCache = parentCache;\n    this._isParentDirty = false;\n    return parentCache;\n  }\n\n  private _getScaleMatrix(): Matrix3x3 {\n    const invRotation = Transform._tempQuat0;\n    const invRotationMat = Transform._tempMat30;\n    const worldRotScaMat = Transform._tempMat31;\n    const scaMat = Transform._tempMat32;\n    worldRotScaMat.setValueByMatrix(this.worldMatrix);\n    Quaternion.invert(this.worldRotationQuaternion, invRotation);\n    Matrix3x3.rotationQuaternion(invRotation, invRotationMat);\n    Matrix3x3.multiply(invRotationMat, worldRotScaMat, scaMat);\n    return scaMat;\n  }\n\n  private _isContainDirtyFlags(targetDirtyFlags: number): boolean {\n    return (this._dirtyFlag & targetDirtyFlags) === targetDirtyFlags;\n  }\n\n  private _isContainDirtyFlag(type: number): boolean {\n    return (this._dirtyFlag & type) != 0;\n  }\n\n  private _setDirtyFlagTrue(type: number) {\n    this._dirtyFlag |= type;\n  }\n\n  private _setDirtyFlagFalse(type: number) {\n    this._dirtyFlag &= ~type;\n  }\n\n  private _worldAssociatedChange(type: number): void {\n    this._dirtyFlag |= type;\n    const len = this._changeFlags.length;\n    for (let i = len - 1; i >= 0; i--) {\n      this._changeFlags[i].flag = true;\n    }\n  }\n\n  private _rotateByQuat(rotateQuat: Quaternion, relativeToLocal: boolean) {\n    if (relativeToLocal) {\n      Quaternion.multiply(this.rotationQuaternion, rotateQuat, this._rotationQuaternion);\n      this.rotationQuaternion = this._rotationQuaternion;\n    } else {\n      Quaternion.multiply(this.worldRotationQuaternion, rotateQuat, this._worldRotationQuaternion);\n      this.worldRotationQuaternion = this._worldRotationQuaternion;\n    }\n  }\n\n  private _translate(translation: Vector3, relativeToLocal: boolean = true): void {\n    if (relativeToLocal) {\n      const rotationMat = Transform._tempMat40;\n      Matrix.rotationQuaternion(this.rotationQuaternion, rotationMat);\n      Vector3.transformCoordinate(translation, rotationMat, Transform._tempVec3);\n      this.position = this._position.add(Transform._tempVec3);\n    } else {\n      this.worldPosition = this._worldPosition.add(translation);\n    }\n  }\n\n  private _rotateXYZ(x: number, y: number, z: number, relativeToLocal: boolean = true): void {\n    const radFactor = MathUtil.degreeToRadFactor;\n    const rotQuat = Transform._tempQuat0;\n    Quaternion.rotationEuler(x * radFactor, y * radFactor, z * radFactor, rotQuat);\n    this._rotateByQuat(rotQuat, relativeToLocal);\n  }\n\n  /**\n   * @deprecated Please use translate() function instead.\n   * Translate in the specified direction and distance.\n   * @param x - The direction and distance of translation in x axis\n   * @param y - The direction and distance of translation in y axis\n   * @param z - The direction and distance of translation in z axis\n   * @param relativeToLocal - Whether relative local space\n   */\n  translateXYZ(x: number, y: number, z: number, relativeToLocal: boolean = true): void {\n    this.translate(x, y, z, relativeToLocal);\n  }\n\n  /**\n   * @deprecated please use rotate() function instead.\n   * Rotate according to the specified Euler angle.\n   * @param x - The angle that rotate around of x axis (uint: angle)\n   * @param y - The angle that rotate around of y axis (uint: angle)\n   * @param z - The angle that rotate around of z axis (uint: angle)\n   * @param relativeToLocal - Whether relative local space\n   */\n  rotateXYZ(x: number, y: number, z: number, relativeToLocal: boolean = true): void {\n    this.rotate(x, y, z, relativeToLocal);\n  }\n}\n","import { Matrix, Quaternion, Vector3 } from \"@oasis-engine/math\";\nimport { EngineObject } from \"./base\";\nimport { ComponentCloner } from \"./clone/ComponentCloner\";\nimport { Component } from \"./Component\";\nimport { ComponentsDependencies } from \"./ComponentsDependencies\";\nimport { DisorderedArray } from \"./DisorderedArray\";\nimport { Engine } from \"./Engine\";\nimport { Layer } from \"./Layer\";\nimport { Scene } from \"./Scene\";\nimport { Transform } from \"./Transform\";\nimport { UpdateFlag } from \"./UpdateFlag\";\n\n/**\n * Entity, be used as components container.\n */\nexport class Entity extends EngineObject {\n  private static _entitys: DisorderedArray<Entity> = new DisorderedArray();\n\n  /**\n   * Find entity globally by name.\n   * @param name - The name of the entity which want to be finded.\n   * @returns The entity which be finded.\n   */\n  static findByName(name: string): Entity {\n    const entitys = Entity._entitys;\n    const elements = entitys._elements;\n    for (let i = entitys.length - 1; i >= 0; i--) {\n      const entity = elements[i];\n      if (entity.name === name) {\n        return entity;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Find entity globally by path, use the â€˜/â€™ symbol as the path separator.\n   * @deprecated Use scene find by path instead.\n   * @param scene - The scene be finded in.\n   * @param path - The path fo the entity eg: /root/entity.\n   * @returns The entity which be finded.\n   */\n  static findByPath(scene: Scene, path: string): Entity | null {\n    return scene.findEntityByPath(path);\n  }\n\n  /**\n   * @internal\n   */\n  static _findChildByName(root: Entity, name: string): Entity {\n    const children = root._children;\n    for (let i = children.length - 1; i >= 0; i--) {\n      const child = children[i];\n      if (child.name === name) {\n        return child;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * @internal\n   */\n  static _traverseSetOwnerScene(entity: Entity, scene: Scene): void {\n    entity._scene = scene;\n    const children = entity._children;\n    for (let i = entity.childCount - 1; i >= 0; i--) {\n      this._traverseSetOwnerScene(children[i], scene);\n    }\n  }\n\n  name: string;\n  /** The layer the entity belongs to. */\n  layer: Layer = Layer.Layer0;\n  readonly transform: Transform;\n\n  /** @internal */\n  _isActiveInHierarchy: boolean = false;\n  /** @internal */\n  _components: Component[] = [];\n  /** @internal */\n  _children: Entity[] = [];\n  /** @internal */\n  _scene: Scene;\n  /** @internal */\n  _isRoot: boolean = false;\n  /** @internal */\n  _isActive: boolean = true;\n\n  private _parent: Entity = null;\n  private _activeChangedComponents: Component[];\n\n  /**\n   * Whether to activate locally.\n   */\n  get isActive(): boolean {\n    return this._isActive;\n  }\n\n  set isActive(value: boolean) {\n    if (value !== this._isActive) {\n      this._isActive = value;\n      if (value) {\n        const parent = this._parent;\n        if (parent?._isActiveInHierarchy || (this._isRoot && this._scene._isActiveInEngine)) {\n          this._processActive();\n        }\n      } else {\n        if (this._isActiveInHierarchy) {\n          this._processInActive();\n        }\n      }\n    }\n  }\n\n  /**\n   * Whether it is active in the hierarchy.\n   */\n  get isActiveInHierarchy(): boolean {\n    return this._isActiveInHierarchy;\n  }\n\n  /**\n   * The parent entity.\n   */\n  get parent(): Entity {\n    return this._parent;\n  }\n\n  set parent(entity: Entity) {\n    if (entity !== this._parent) {\n      const oldParent = this._removeFromParent();\n      const newParent = (this._parent = entity);\n      if (newParent) {\n        newParent._children.push(this);\n        const parentScene = newParent._scene;\n        if (this._scene !== parentScene) {\n          Entity._traverseSetOwnerScene(this, parentScene);\n        }\n\n        if (newParent._isActiveInHierarchy) {\n          !this._isActiveInHierarchy && this._isActive && this._processActive();\n        } else {\n          this._isActiveInHierarchy && this._processInActive();\n        }\n      } else {\n        this._isActiveInHierarchy && this._processInActive();\n        if (oldParent) {\n          Entity._traverseSetOwnerScene(this, null);\n        }\n      }\n      this._setTransformDirty();\n    }\n  }\n\n  /**\n   * The children entities\n   */\n  get children(): Readonly<Entity[]> {\n    return this._children;\n  }\n\n  /**\n   * Number of the children entities\n   */\n  get childCount(): number {\n    return this._children.length;\n  }\n\n  /**\n   * The scene the entity belongs to.\n   */\n  get scene(): Scene {\n    return this._scene;\n  }\n\n  /**\n   * The engine the entity belongs to.\n   */\n  get engine(): Engine {\n    return this._engine;\n  }\n\n  /**\n   * Create a entity.\n   * @param engine - The engine the entity belongs to.\n   */\n  constructor(engine: Engine, name?: string) {\n    super(engine);\n    Entity._entitys.add(this);\n    this.name = name;\n    this.transform = this.addComponent(Transform);\n    this._inverseWorldMatFlag = this.transform.registerWorldChangeFlag();\n  }\n\n  /**\n   * Add component based on the component type.\n   * @param type - The type of the component.\n   * @returns\tThe component which has been added.\n   */\n  addComponent<T extends Component>(type: new (entity: Entity) => T): T {\n    ComponentsDependencies._addCheck(this, type);\n    const component = new type(this);\n    this._components.push(component);\n    if (this._isActiveInHierarchy) {\n      component._setActive(true);\n    }\n    return component;\n  }\n\n  /**\n   * Get component which match the type.\n   * @param type - The type of the component.\n   * @returns\tThe first component which match type.\n   */\n  getComponent<T extends Component>(type: new (entity: Entity) => T): T {\n    for (let i = this._components.length - 1; i >= 0; i--) {\n      const component = this._components[i];\n      if (component instanceof type) {\n        return component;\n      }\n    }\n  }\n\n  /**\n   * Get components which match the type.\n   * @param type - The type of the component.\n   * @param results - The components which match type.\n   * @returns\tThe components which match type.\n   */\n  getComponents<T extends Component>(type: new (entity: Entity) => T, results: T[]): T[] {\n    results.length = 0;\n    for (let i = this._components.length - 1; i >= 0; i--) {\n      const component = this._components[i];\n      if (component instanceof type) {\n        results.push(component);\n      }\n    }\n    return results;\n  }\n\n  /**\n   * Get the components which match the type of the entity and it's children.\n   * @param type - The component type.\n   * @param results - The components collection.\n   * @returns\tThe components collection which match the type.\n   */\n  getComponentsIncludeChildren<T extends Component>(type: new (entity: Entity) => T, results: T[]): T[] {\n    results.length = 0;\n    this._getComponentsInChildren<T>(type, results);\n    return results;\n  }\n\n  /**\n   * Add child entity.\n   * @param child - The child entity which want to be added.\n   */\n  addChild(child: Entity): void {\n    child.parent = this;\n  }\n\n  /**\n   * Remove child entitiy.\n   * @param child - The child entity which want to be removed.\n   */\n  removeChild(child: Entity): void {\n    child.parent = null;\n  }\n\n  /**\n   * Find child entity by index.\n   * @param index - The index of the child entity.\n   * @returns\tThe component which be finded.\n   */\n  getChild(index: number): Entity {\n    return this._children[index];\n  }\n\n  /**\n   * Find child entity by name.\n   * @param name - The name of the entity which want to be finded.\n   * @returns The component which be finded.\n   */\n  findByName(name: string): Entity {\n    const children = this._children;\n    const child = Entity._findChildByName(this, name);\n    if (child) return child;\n    for (let i = children.length - 1; i >= 0; i--) {\n      const child = children[i];\n      const grandson = child.findByName(name);\n      if (grandson) {\n        return grandson;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Find the entity by path.\n   * @param path - The path fo the entity eg: /entity.\n   * @returns The component which be finded.\n   */\n  findByPath(path: string): Entity {\n    const splits = path.split(\"/\");\n    let entity: Entity = this;\n    for (let i = 0, length = splits.length; i < length; ++i) {\n      const split = splits[i];\n      if (split) {\n        entity = Entity._findChildByName(entity, split);\n        if (!entity) {\n          return null;\n        }\n      }\n    }\n    return entity;\n  }\n\n  /**\n   * Create child entity.\n   * @param name - The child entity's name.\n   * @returns The child entity.\n   */\n  createChild(name?: string): Entity {\n    const child = new Entity(this.engine, name);\n    child.layer = this.layer;\n    child.parent = this;\n    return child;\n  }\n\n  /**\n   * Clear children entities.\n   */\n  clearChildren(): void {\n    const children = this._children;\n    for (let i = children.length - 1; i >= 0; i--) {\n      const child = children[i];\n      child._parent = null;\n      child._isActiveInHierarchy && child._processInActive();\n      Entity._traverseSetOwnerScene(child, null); // Must after child._processInActive().\n    }\n    children.length = 0;\n  }\n\n  /**\n   * Clone\n   * @returns Cloned entity.\n   */\n  clone(): Entity {\n    const cloneEntity = new Entity(this._engine, this.name);\n\n    cloneEntity._isActive = this._isActive;\n    cloneEntity.transform.localMatrix = this.transform.localMatrix;\n\n    const children = this._children;\n    for (let i = 0, len = this._children.length; i < len; i++) {\n      const child = children[i];\n      cloneEntity.addChild(child.clone());\n    }\n\n    const components = this._components;\n    for (let i = 0, n = components.length; i < n; i++) {\n      const sourceComp = components[i];\n      if (!(sourceComp instanceof Transform)) {\n        const targetComp = cloneEntity.addComponent(<new (entity: Entity) => Component>sourceComp.constructor);\n        ComponentCloner.cloneComponent(sourceComp, targetComp);\n      }\n    }\n\n    return cloneEntity;\n  }\n\n  /**\n   * Destroy self.\n   */\n  destroy(): void {\n    const abilityArray = this._components;\n    for (let i = abilityArray.length - 1; i >= 0; i--) {\n      abilityArray[i].destroy();\n    }\n    this._components.length = 0;\n\n    const children = this._children;\n    for (let i = children.length - 1; i >= 0; i--) {\n      children[i].destroy();\n    }\n    this._children.length = 0;\n\n    if (this._parent != null) {\n      const parentChildren = this._parent._children;\n      parentChildren.splice(parentChildren.indexOf(this), 1);\n    }\n    this._parent = null;\n    Entity._entitys.delete(this);\n  }\n\n  /**\n   * @internal\n   */\n  _removeComponent(component: Component): void {\n    ComponentsDependencies._removeCheck(this, component.constructor as any);\n    const components = this._components;\n    components.splice(components.indexOf(component), 1);\n  }\n\n  /**\n   * @internal\n   */\n  _removeFromParent(): Entity {\n    const oldParent = this._parent;\n    if (oldParent != null) {\n      const oldParentChildren = oldParent._children;\n      oldParentChildren.splice(oldParentChildren.indexOf(this), 1);\n      this._parent = null;\n    }\n    return oldParent;\n  }\n\n  /**\n   * @internal\n   */\n  _processActive(): void {\n    if (this._activeChangedComponents) {\n      throw \"Note: can't set the 'main inActive entity' active in hierarchy, if the operation is in main inActive entity or it's children script's onDisable Event.\";\n    }\n    this._activeChangedComponents = this._engine._componentsManager.getActiveChangedTempList();\n    this._setActiveInHierarchy(this._activeChangedComponents);\n    this._setActiveComponents(true);\n  }\n\n  /**\n   * @internal\n   */\n  _processInActive(): void {\n    if (this._activeChangedComponents) {\n      throw \"Note: can't set the 'main active entity' inActive in hierarchy, if the operation is in main active entity or it's children script's onEnable Event.\";\n    }\n    this._activeChangedComponents = this._engine._componentsManager.getActiveChangedTempList();\n    this._setInActiveInHierarchy(this._activeChangedComponents);\n    this._setActiveComponents(false);\n  }\n\n  private _getComponentsInChildren<T extends Component>(type: new (entity: Entity) => T, results: T[]): void {\n    for (let i = this._components.length - 1; i >= 0; i--) {\n      const component = this._components[i];\n      if (component instanceof type) {\n        results.push(component);\n      }\n    }\n    for (let i = this._children.length - 1; i >= 0; i--) {\n      this._children[i]._getComponentsInChildren<T>(type, results);\n    }\n  }\n\n  private _setActiveComponents(isActive: boolean): void {\n    const activeChangedComponents = this._activeChangedComponents;\n    for (let i = 0, length = activeChangedComponents.length; i < length; ++i) {\n      activeChangedComponents[i]._setActive(isActive);\n    }\n    this._engine._componentsManager.putActiveChangedTempList(activeChangedComponents);\n    this._activeChangedComponents = null;\n  }\n\n  private _setActiveInHierarchy(activeChangedComponents: Component[]): void {\n    this._isActiveInHierarchy = true;\n    const components = this._components;\n    for (let i = components.length - 1; i >= 0; i--) {\n      activeChangedComponents.push(components[i]);\n    }\n    const children = this._children;\n    for (let i = children.length - 1; i >= 0; i--) {\n      const child: Entity = children[i];\n      child.isActive && child._setActiveInHierarchy(activeChangedComponents);\n    }\n  }\n\n  private _setInActiveInHierarchy(activeChangedComponents: Component[]): void {\n    this._isActiveInHierarchy = false;\n    const components = this._components;\n    for (let i = components.length - 1; i >= 0; i--) {\n      activeChangedComponents.push(components[i]);\n    }\n    const children = this._children;\n    for (let i = children.length - 1; i >= 0; i--) {\n      const child: Entity = children[i];\n      child.isActive && child._setInActiveInHierarchy(activeChangedComponents);\n    }\n  }\n\n  private _setTransformDirty() {\n    if (this.transform) {\n      this.transform._parentChange();\n    } else {\n      for (let i = 0, len = this._children.length; i < len; i++) {\n        this._children[i]._setTransformDirty();\n      }\n    }\n  }\n\n  //--------------------------------------------------------------deprecated----------------------------------------------------------------\n  private _invModelMatrix: Matrix = new Matrix();\n  private _inverseWorldMatFlag: UpdateFlag;\n\n  /**\n   * @deprecated\n   * Use transform.position instead.\n   */\n  get position(): Vector3 {\n    return this.transform.position;\n  }\n\n  set position(val: Vector3) {\n    this.transform.position = val;\n  }\n\n  /**\n   * @deprecated\n   * Use transform.worldPosition instead.\n   */\n  get worldPosition(): Vector3 {\n    return this.transform.worldPosition;\n  }\n\n  set worldPosition(val: Vector3) {\n    this.transform.worldPosition = val;\n  }\n\n  /**\n   * @deprecated\n   * Use transform.rotationQuaternion instead.\n   */\n  get rotation(): Quaternion {\n    return this.transform.rotationQuaternion;\n  }\n\n  set rotation(val: Quaternion) {\n    this.transform.rotationQuaternion = val;\n  }\n\n  /**\n   * @deprecated\n   * Use transform.scale instead.\n   */\n  get scale(): Vector3 {\n    return this.transform.scale;\n  }\n\n  set scale(val: Vector3) {\n    this.transform.scale = val;\n  }\n\n  /**\n   * @deprecated\n   */\n  getInvModelMatrix(): Matrix {\n    if (this._inverseWorldMatFlag.flag) {\n      Matrix.invert(this.transform.worldMatrix, this._invModelMatrix);\n      this._inverseWorldMatFlag.flag = false;\n    }\n    return this._invModelMatrix;\n  }\n}\n","import { SceneFeature } from \"./SceneFeature\";\nimport { EngineFeature } from \"./EngineFeature\";\nimport { Scene } from \"./Scene\";\nimport { Engine } from \"./Engine\";\n\n/**\n * Manage a set of feature objects.\n */\nexport class FeatureManager<T extends EngineFeature | SceneFeature> {\n  private _features: Array<new (engine: Engine) => T> = [];\n\n  private _objects = [];\n\n  /**\n   * Register a feature.\n   * @param {SceneFeature|EngineFeature} Feature\n   */\n  public registerFeature(IFeature: new () => T): void {\n    const featureArray = this._features;\n\n    // Search by type, avoid adding\n    for (let i = 0, len = featureArray.length; i < len; i++) {\n      if (featureArray[i] === IFeature) {\n        return;\n      }\n    }\n\n    // Add to global array\n    featureArray.push(IFeature);\n\n    // Add to existing scene\n    const objectArray = this._objects;\n    for (let i = 0, len = objectArray.length; i < len; i++) {\n      objectArray[i].features.push(new IFeature());\n    }\n  }\n\n  /**\n   * Add an feature with functional characteristics.\n   * @param {Scene|Engine} obj - Scene or engine\n   */\n  public addObject(obj: Scene | Engine): void {\n    obj.features = [];\n    for (let i = 0, len = this._features.length; i < len; i++) {\n      obj.features.push(new this._features[i]((<any>obj).engine ?? <any>obj) as any);\n    }\n    this._objects.push(obj);\n  }\n\n  /**\n   * Call the specified method of the feature.\n   * @param obj - Scene or engine\n   * @param method - Method name\n   * @param args - Function args\n   */\n  public callFeatureMethod(obj: Scene | Engine, method: string, args: any[]): void {\n    const features = obj.features;\n    const count = features.length;\n\n    for (let i = 0; i < count; i++) {\n      const feature = features[i];\n      if (feature[method]) {\n        feature[method].apply(feature, args);\n      }\n    }\n  }\n\n  /**\n   * Find feature.\n   * @param obj - Scene or engine\n   * @param feature - plug-in\n   */\n\n  public findFeature(obj: Scene | Engine, IFeature: new () => T): T {\n    const features = obj.features;\n    const count = features.length;\n\n    for (let i = 0; i < count; i++) {\n      const feature = features[i];\n      if (feature.constructor === (IFeature as any)) {\n        return feature as any;\n      }\n    }\n    return undefined;\n  }\n}\n","import { Primitive } from \"../graphic\";\nimport { SubPrimitive } from \"../graphic/SubPrimitive\";\nimport { Material } from \"../material/Material\";\nimport { Renderer } from \"../Renderer\";\n\n/**\n * Render element.\n */\nexport class RenderElement {\n  private static _elementPoolIndex: number = 0;\n  private static _elementPool: RenderElement[] = [];\n\n  /**\n   * Get render element from pool.\n   * @remark The return value is only valid for the current frame, and the next frame will be automatically recycled for reuse.\n   */\n  static getFromPool(): RenderElement {\n    const { _elementPoolIndex: index, _elementPool: pool } = RenderElement;\n    RenderElement._elementPoolIndex++;\n    if (pool.length === index) {\n      const element = new RenderElement();\n      pool.push(element);\n      return element;\n    } else {\n      return pool[index];\n    }\n  }\n\n  /**\n   * @internal\n   */\n  static _restPool() {\n    RenderElement._elementPoolIndex = 0;\n  }\n\n  /** Render component. */\n  component: Renderer;\n  /** Primitive. */\n  primitive: Primitive;\n  /** Sub primitive. */\n  subPrimitive: SubPrimitive;\n  /** Material. */\n  material: Material;\n\n  setValue(component: Renderer, primitive: Primitive, subPrimitive: SubPrimitive, material: Material): void {\n    this.component = component;\n    this.primitive = primitive;\n    this.subPrimitive = subPrimitive;\n    this.material = material;\n  }\n}\n","import { Camera } from \"./Camera\";\nimport { Scene } from \"./Scene\";\n\n/**\n * Scene feature plug-in.\n * @deprecated\n */\nexport abstract class SceneFeature {\n  /**\n   * Callback before every scene update.\n   * @param scene - Scene\n   */\n  public preUpdate(scene: Scene): void {}\n\n  /**\n   * Callback after every scene update.\n   * @param scene - Scene\n   */\n  public postUpdate(scene: Scene): void {}\n\n  /**\n   * Callback before scene rendering.\n   * @param scene - Scene\n   * @param camera - Camera\n   */\n  public preRender(scene: Scene, camera: Camera): void {}\n\n  /**\n   * Callback after scene rendering.\n   * @param scene - Scene\n   * @param camera - Camera\n   */\n  public postRender(scene: Scene, camera: Camera): void {}\n\n  /**\n   * Callback after the scene is destroyed.\n   * @param scene - Scene\n   */\n  public destroy(scene: Scene): void {}\n}\n","/**\n * Blend factor.\n * @remarks defines which function is used for blending pixel arithmetic\n */\nexport enum BlendFactor {\n  /** (0, 0, 0, 0)*/\n  Zero,\n  /** (1, 1, 1, 1)*/\n  One,\n  /** (Rs, Gs, Bs, As) */\n  SourceColor,\n  /** (1 - Rs, 1 - Gs, 1 - Bs, 1 - As)*/\n  OneMinusSourceColor,\n  /** (Rd, Gd, Bd, Ad)*/\n  DestinationColor,\n  /** (1 - Rd, 1 - Gd, 1 - Bd, 1 - Ad)*/\n  OneMinusDestinationColor,\n  /** (As, As, As, As)*/\n  SourceAlpha,\n  /** (1 - As, 1 - As, 1 - As, 1 - As)*/\n  OneMinusSourceAlpha,\n  /** (Ad, Ad, Ad, Ad)*/\n  DestinationAlpha,\n  /** (1 - Ad, 1 - Ad, 1 - Ad, 1 - Ad)*/\n  OneMinusDestinationAlpha,\n  /** (min(As, 1 - Ad), min(As, 1 - Ad), min(As, 1 - Ad), 10)*/\n  SourceAlphaSaturate,\n  /** (Rc, Gc, Bc, Ac)*/\n  BlendColor,\n  /** (1 - Rc, 1 - Gc, 1 - Bc, 1 - Ac)*/\n  OneMinusBlendColor\n}\n","/**\n * Blend operation function.\n * @remarks defines how a new pixel is combined with a pixel.\n */\nexport enum BlendOperation {\n  /** src + dst. */\n  Add,\n  /** src - dst. */\n  Subtract,\n  /** dst - src. */\n  ReverseSubtract,\n  /** Minimum of source and destination. */\n  Min,\n  /** Maximum of source and destination. */\n  Max\n}\n","/**\n * Set which color channels can be rendered to frame buffer.\n * @remarks enumeration can be combined using bit operations.\n */\nexport enum ColorWriteMask {\n  /** Do not write to any channel. */\n  None = 0,\n  /** Write to the red channel. */\n  Red = 0x1,\n  /** Write to the green channel. */\n  Green = 0x2,\n  /** Write to the blue channel. */\n  Blue = 0x4,\n  /** Write to the alpha channel. */\n  Alpha = 0x8,\n  /** Write to all channel. */\n  All = 0xf\n}\n","/**\n * Depth/Stencil comparison function.\n * @remarks Specifies a function that compares incoming pixel depth/stencil to the current depth/stencil buffer value.\n */\nexport enum CompareFunction {\n  /** never pass. */\n  Never,\n  /** pass if the incoming value is less than the depth/stencil buffer value. */\n  Less,\n  /** pass if the incoming value equals the depth/stencil buffer value. */\n  Equal,\n  /** pass if the incoming value is less than or equal to the depth/stencil buffer value. */\n  LessEqual,\n  /** pass if the incoming value is greater than the depth/stencil buffer value. */\n  Greater,\n  /** pass if the incoming value is not equal to the depth/stencil buffer value. */\n  NotEqual,\n  /** pass if the incoming value is greater than or equal to the depth/stencil buffer value. */\n  GreaterEqual,\n  /** always pass. */\n  Always\n}\n","/**\n * Culling mode.\n * @remarks specifies whether or not front- and/or back-facing polygons can be culled.\n */\nexport enum CullMode {\n  /** Disable culling. */\n  Off,\n  /** cut the front-face of the polygons. */\n  Front,\n  /** cut the back-face of the polygons. */\n  Back\n}\n","/**\n * Stencil operation mode.\n * @remarks sets the front and/or back-facing stencil test actions.\n */\nexport enum StencilOperation {\n  /** Keeps the current value. */\n  Keep,\n  /** Sets the stencil buffer value to 0. */\n  Zero,\n  /** Sets the stencil buffer value to the reference value. */\n  Replace,\n  /** Increments the current stencil buffer value. Clamps to the maximum representable unsigned value. */\n  IncrementSaturate,\n  /** Decrements the current stencil buffer value. Clamps to 0. */\n  DecrementSaturate,\n  /** Inverts the current stencil buffer value bitwise. */\n  Invert,\n  /** Increments the current stencil buffer value. Wraps stencil buffer value to zero when incrementing the maximum representable unsigned value. */\n  IncrementWrap,\n  /** Decrements the current stencil buffer value. Wraps stencil buffer value to the maximum representable unsigned value when decrementing a stencil buffer value of 0. */\n  DecrementWrap\n}\n","/**\n * Render queue type.\n */\nexport enum RenderQueueType {\n  /** Opaque queue. */\n  Opaque = 1000,\n  /** Transparency cutoff queue. */\n  AlphaTest = 2000,\n  /** Transparent queue, rendering from back to front to ensure correct rendering of transparent objects. */\n  Transparent = 3000\n}\n","import { Vector3 } from \"@oasis-engine/math\";\nimport { Camera } from \"../Camera\";\nimport { Component } from \"../Component\";\nimport { Layer } from \"../Layer\";\nimport { RenderQueueType } from \"../material/enums/RenderQueueType\";\nimport { Material } from \"../material/Material\";\nimport { Renderer } from \"../Renderer\";\nimport { ShaderMacroCollection } from \"../shader/ShaderMacroCollection\";\nimport { RenderElement } from \"./RenderElement\";\n\ninterface SpriteElement {\n  component: Renderer;\n  positionQuad;\n  uvRect;\n  tintColor;\n  texture;\n  renderMode;\n  camera;\n}\n\ntype Item = RenderElement | SpriteElement;\n\n/**\n * Render collection.\n * @private\n */\nexport class RenderQueue {\n  /** @internal */\n  static readonly compileMacros: ShaderMacroCollection = new ShaderMacroCollection();\n\n  readonly items: Item[] = [];\n\n  /**\n   * Push a render element.\n   */\n  pushPrimitive(element: RenderElement): void {\n    this.items.push(element);\n  }\n\n  /**\n   * Sort the elements.\n   */\n  sort(cameraPosition: Vector3): void {\n    this.items.sort((a: Item, b: Item) => {\n      const aIsPrimitive = this._isPrimitive(a);\n      const bIsPrimitive = this._isPrimitive(b);\n\n      if (aIsPrimitive && bIsPrimitive) {\n        const aElement: RenderElement = <RenderElement>a;\n        const bElement: RenderElement = <RenderElement>b;\n        const aRenderQueue = aElement.material.renderQueueType;\n        const bRenderQueue = bElement.material.renderQueueType;\n\n        if (aRenderQueue > bRenderQueue) {\n          return 1;\n        }\n        if (aRenderQueue < bRenderQueue) {\n          return -1;\n        }\n\n        // sort transparent queue from back to front.\n        if (aRenderQueue >= RenderQueueType.Transparent && bRenderQueue >= RenderQueueType.Transparent) {\n          const aDistance = Vector3.distanceSquared(aElement.component.entity.transform.worldPosition, cameraPosition);\n          const bDistance = Vector3.distanceSquared(bElement.component.entity.transform.worldPosition, cameraPosition);\n\n          return bDistance - aDistance;\n        }\n\n        // reduce switching shaderProgram\n        return aElement.material.shader.name.localeCompare(bElement.material.shader.name);\n      } else if (aIsPrimitive && !bIsPrimitive) {\n        return -1;\n      } else if (!aIsPrimitive && bIsPrimitive) {\n        return 1;\n      }\n    });\n  }\n\n  pushSprite(component: Component, positionQuad, uvRect, tintColor, texture, renderMode, camera: Camera) {\n    const element: SpriteElement = {\n      // @ts-ignore\n      component,\n      positionQuad,\n      uvRect,\n      tintColor,\n      texture,\n      renderMode,\n      camera\n    };\n    this.items.push(element);\n  }\n\n  render(camera: Camera, replaceMaterial: Material, mask: Layer) {\n    const items = this.items;\n    if (items.length === 0) {\n      return;\n    }\n\n    const spriteMaterial = camera._renderPipeline._defaultSpriteMaterial;\n    const { engine, scene } = camera;\n    const renderCount = engine._renderCount;\n    const rhi = engine._hardwareRenderer;\n    const sceneData = scene.shaderData;\n    const cameraData = camera.shaderData;\n\n    for (let i = 0, n = items.length; i < n; i++) {\n      const item = items[i];\n      const renderPassFlag = item.component.entity.layer;\n\n      if (!(renderPassFlag & mask)) {\n        continue;\n      }\n\n      if (this._isPrimitive(item)) {\n        rhi.flushSprite(engine, spriteMaterial);\n\n        const compileMacros = RenderQueue.compileMacros;\n        const element = <RenderElement>item;\n        const renderer = element.component;\n        const material = replaceMaterial ? replaceMaterial : element.material;\n        const rendererData = renderer.shaderData;\n        const materialData = material.shaderData;\n\n        // @todo: temporary solution\n        material._preRender(element);\n\n        // union render global macro and material self macro.\n        ShaderMacroCollection.unionCollection(\n          renderer._globalShaderMacro,\n          materialData._macroCollection,\n          compileMacros\n        );\n        compileMacros.unionCollection(element.primitive._macroCollection); //CM&SS: temporary\n\n        const program = material.shader._getShaderProgram(engine, compileMacros);\n        if (!program.isValid) {\n          continue;\n        }\n\n        const switchProgram = program.bind();\n        const switchRenderCount = renderCount !== program._uploadRenderCount;\n\n        if (switchRenderCount) {\n          program.groupingOtherUniformBlock();\n          program.uploadAll(program.sceneUniformBlock, sceneData);\n          program.uploadAll(program.cameraUniformBlock, cameraData);\n          program.uploadAll(program.rendererUniformBlock, rendererData);\n          program.uploadAll(program.materialUniformBlock, materialData);\n          program._uploadCamera = camera;\n          program._uploadRenderer = renderer;\n          program._uploadMaterial = material;\n          program._uploadRenderCount = renderCount;\n        } else {\n          if (program._uploadCamera !== camera) {\n            program.uploadUniforms(program.cameraUniformBlock, cameraData);\n            program._uploadCamera = camera;\n          }\n\n          if (program._uploadRenderer !== renderer) {\n            program.uploadUniforms(program.rendererUniformBlock, rendererData);\n            program._uploadRenderer = renderer;\n          }\n\n          if (program._uploadMaterial !== material) {\n            program.uploadUniforms(program.materialUniformBlock, materialData);\n            program._uploadMaterial = material;\n          }\n\n          if (switchProgram) {\n            program.uploadTextures(program.sceneUniformBlock, sceneData);\n            program.uploadTextures(program.cameraUniformBlock, cameraData);\n            program.uploadTextures(program.rendererUniformBlock, rendererData);\n            program.uploadTextures(program.materialUniformBlock, materialData);\n          }\n        }\n\n        material.renderState._apply(camera.engine);\n\n        rhi.drawPrimitive(element.primitive, element.subPrimitive, program);\n      } else {\n        const spirteElement = <SpriteElement>item;\n        rhi.drawSprite(\n          spriteMaterial,\n          spirteElement.positionQuad,\n          spirteElement.uvRect,\n          spirteElement.tintColor,\n          spirteElement.texture,\n          spirteElement.renderMode,\n          spirteElement.camera\n        );\n      }\n    }\n\n    rhi.flushSprite(engine, spriteMaterial);\n  }\n\n  /**\n   * Clear collection.\n   */\n  clear(): void {\n    this.items.length = 0;\n  }\n\n  private _isPrimitive(item) {\n    return !!item.primitive;\n  }\n}\n","import pbr_common_frag_define from \"./common_frag_define.glsl\";\nimport pbr_util_frag_define from \"./util_frag_define.glsl\";\n\n/** IBL define */\nimport pbr_envmap_light_frag_define from \"./envmap_light_frag_define.glsl\";\n\n/** prop & texture */\nimport pbr_base_frag_define from \"./base_frag_define.glsl\";\nimport pbr_texture_frag_define from \"./texture_frag_define.glsl\";\n\n/** runtime context */\nimport pbr_runtime_frag_define from \"./runtime_frag_define.glsl\";\n\n// todo: generalize\nimport pbr_normal_frag_define from \"./normal_frag_define.glsl\";\n\n// todo: BxDF\nimport pbr_brdf_cook_torrance_frag_define from \"./brdf_cook_torrance_frag_define.glsl\";\n\n/** direct + IBL */\nimport pbr_direct_irradiance_frag_define from \"./direct_irradiance_frag_define.glsl\";\nimport pbr_ibl_specular_frag_define from \"./ibl_specular_frag_define.glsl\";\nimport pbr_ibl_diffuse_frag_define from \"./ibl_diffuse_frag_define.glsl\";\n\nimport pbr_begin_frag from \"./begin_frag.glsl\";\nimport pbr_direct_irradiance_frag from \"./direct_irradiance_frag.glsl\";\nimport pbr_ibl_diffuse_frag from \"./ibl_diffuse_frag.glsl\";\nimport pbr_ibl_specular_frag from \"./ibl_specular_frag.glsl\";\nimport pbr_end_frag from \"./end_frag.glsl\";\n\nexport default {\n  pbr_common_frag_define,\n  pbr_util_frag_define,\n\n  pbr_envmap_light_frag_define,\n\n  pbr_base_frag_define,\n  pbr_texture_frag_define,\n\n  pbr_runtime_frag_define,\n\n  pbr_normal_frag_define,\n\n  pbr_brdf_cook_torrance_frag_define,\n\n  pbr_direct_irradiance_frag_define,\n  pbr_ibl_specular_frag_define,\n  pbr_ibl_diffuse_frag_define,\n\n  pbr_begin_frag,\n  pbr_direct_irradiance_frag,\n  pbr_ibl_diffuse_frag,\n  pbr_ibl_specular_frag,\n  pbr_end_frag\n};\n","import common from \"./common.glsl\";\nimport common_vert from \"./common_vert.glsl\";\nimport common_frag from \"./common_frag.glsl\";\n\nimport color_share from \"./color_share.glsl\";\nimport normal_share from \"./normal_share.glsl\";\nimport uv_share from \"./uv_share.glsl\";\nimport worldpos_share from \"./worldpos_share.glsl\";\nimport shadow_share from \"./shadow_share.glsl\";\nimport fog_share from \"./fog_share.glsl\";\n\nimport begin_normal_vert from \"./begin_normal_vert.glsl\";\nimport begin_position_vert from \"./begin_position_vert.glsl\";\n\nimport morph_target_vert from \"./morph_target_vert.glsl\";\n\nimport position_vert from \"./position_vert.glsl\";\nimport color_vert from \"./color_vert.glsl\";\nimport normal_vert from \"./normal_vert.glsl\";\nimport skinning_vert from \"./skinning_vert.glsl\";\nimport uv_vert from \"./uv_vert.glsl\";\nimport worldpos_vert from \"./worldpos_vert.glsl\";\nimport shadow_vert from \"./shadow_vert.glsl\";\nimport morph_vert from \"./morph_vert.glsl\";\nimport fog_vert from \"./fog_vert.glsl\";\n\nimport ambient_light_frag from \"./ambient_light_frag.glsl\";\nimport direct_light_frag from \"./direct_light_frag.glsl\";\nimport point_light_frag from \"./point_light_frag.glsl\";\nimport spot_light_frag from \"./spot_light_frag.glsl\";\nimport mobile_material_frag from \"./mobile_material_frag.glsl\";\nimport fog_frag from \"./fog_frag.glsl\";\n\nimport begin_mobile_frag from \"./begin_mobile_frag.glsl\";\nimport begin_normal_frag from \"./begin_normal_frag.glsl\";\nimport begin_viewdir_frag from \"./begin_viewdir_frag.glsl\";\n\nimport mobile_blinnphong_frag from \"./mobile_blinnphong_frag.glsl\";\nimport mobile_lambert_frag from \"./mobile_lambert_frag.glsl\";\n\nimport noise_common from \"./noise_common.glsl\";\nimport noise_cellular_2D from \"./noise_cellular_2D.glsl\";\nimport noise_cellular_2x2 from \"./noise_cellular_2x2.glsl\";\nimport noise_cellular_2x2x2 from \"./noise_cellular_2x2x2.glsl\";\nimport noise_cellular_3D from \"./noise_cellular_3D.glsl\";\nimport noise_cellular from \"./noise_cellular.glsl\";\nimport noise_perlin_2D from \"./noise_perlin_2D.glsl\";\nimport noise_perlin_3D from \"./noise_perlin_3D.glsl\";\nimport noise_perlin_4D from \"./noise_perlin_4D.glsl\";\nimport noise_perlin from \"./noise_perlin.glsl\";\nimport noise_psrd_2D from \"./noise_psrd_2D.glsl\";\nimport noise_simplex_2D from \"./noise_simplex_2D.glsl\";\nimport noise_simplex_3D_grad from \"./noise_simplex_3D_grad.glsl\";\nimport noise_simplex_3D from \"./noise_simplex_3D.glsl\";\nimport noise_simplex_4D from \"./noise_simplex_4D.glsl\";\nimport noise_simplex from \"./noise_simplex.glsl\";\n\nimport perturbation_share from \"./perturbation_share.glsl\";\nimport perturbation_frag from \"./perturbation_frag.glsl\";\nimport refraction_share from \"./refraction_share.glsl\";\nimport refraction_frag from \"./refraction_frag.glsl\";\n\nimport clipPlane_vert_define from \"./clipPlane_vert_define.glsl\";\nimport clipPlane_vert from \"./clipPlane_vert.glsl\";\nimport clipPlane_frag_define from \"./clipPlane_frag_define.glsl\";\nimport clipPlane_frag from \"./clipPlane_frag.glsl\";\n\nimport gamma_frag from \"./gamma_frag.glsl\";\n\nimport PBRShaderLib from \"./pbr\";\nimport oit_frag from \"./oit/oit_frag.glsl\";\nimport oit_frag_define from \"./oit/oit_frag_define.glsl\";\n\nexport const ShaderLib = {\n  common,\n  common_vert,\n  common_frag,\n\n  color_share,\n  normal_share,\n  uv_share,\n  worldpos_share,\n  shadow_share,\n  fog_share,\n\n  begin_normal_vert,\n  begin_position_vert,\n\n  morph_target_vert,\n\n  position_vert,\n  color_vert,\n  normal_vert,\n  skinning_vert,\n  uv_vert,\n  worldpos_vert,\n  shadow_vert,\n  morph_vert,\n  fog_vert,\n\n  ambient_light_frag,\n  direct_light_frag,\n  point_light_frag,\n  spot_light_frag,\n  mobile_material_frag,\n  fog_frag,\n\n  begin_mobile_frag,\n  begin_normal_frag,\n  begin_viewdir_frag,\n\n  mobile_blinnphong_frag,\n  mobile_lambert_frag,\n\n  noise_common,\n  noise_cellular_2D,\n  noise_cellular_2x2,\n  noise_cellular_2x2x2,\n  noise_cellular_3D,\n  noise_cellular,\n  noise_perlin_2D,\n  noise_perlin_3D,\n  noise_perlin_4D,\n  noise_perlin,\n  noise_psrd_2D,\n  noise_simplex_2D,\n  noise_simplex_3D_grad,\n  noise_simplex_3D,\n  noise_simplex_4D,\n  noise_simplex,\n\n  perturbation_share,\n  perturbation_frag,\n  refraction_share,\n  refraction_frag,\n\n  clipPlane_vert_define,\n  clipPlane_vert,\n  clipPlane_frag_define,\n  clipPlane_frag,\n\n  gamma_frag,\n\n  oit_frag,\n  oit_frag_define,\n\n  ...PBRShaderLib\n};\n\nexport function InjectShaderSlices(obj) {\n  Object.assign(ShaderLib, obj);\n}\n","import { ShaderLib, InjectShaderSlices } from \"./ShaderLib\";\nimport { Logger } from \"../base/Logger\";\n\nclass ShaderFactory {\n  /**\n   * GLSL version.\n   * @param {string} version - \"100\" | \"300 es\"\n   * */\n  static parseVersion(version: string = \"100\") {\n    return `#version ${version}\\n`;\n  }\n\n  static parsePrecision(vertP: string, fragP: string, compileVert?: boolean) {\n    const downgrade = \"mediump\";\n\n    return `\n        #ifdef GL_FRAGMENT_PRECISION_HIGH\n          precision ${compileVert ? vertP : fragP} float;\n          precision ${compileVert ? vertP : fragP} int;\n\n          #define O3_VERTEX_PRECISION ${vertP}\n          #define O3_FRAGMENT_PRECISION ${fragP}\n        #else\n          precision ${downgrade} float;\n          precision ${downgrade} int;\n\n          #define O3_VERTEX_PRECISION ${downgrade}\n          #define O3_FRAGMENT_PRECISION ${downgrade}\n        #endif\n      `;\n  }\n\n  static parseShaderName(name) {\n    return `#define O3_SHADER_NAME ${name}\\n`;\n  }\n\n  static parseAttributeMacros(macros) {\n    return (\n      \"#define O3_ATTRIBUTE_MACROS_START\\n\" +\n      macros.map((m) => `#define ${m}\\n`).join(\"\") +\n      \"#define O3_ATTRIBUTE_MACROS_END\\n\"\n    );\n  }\n\n  static parseCustomMacros(macros: string[]) {\n    return (\n      \"#define O3_CUSTOM_MACROS_START\\n\" +\n      macros.map((m) => `#define ${m}\\n`).join(\"\") +\n      \"#define O3_CUSTOM_MACROS_END\\n\"\n    );\n  }\n\n  static parseShader(src) {\n    return ShaderFactory.parseIncludes(src);\n  }\n\n  static parseIncludes(src) {\n    const regex = /^[ \\t]*#include +<([\\w\\d.]+)>/gm;\n\n    function replace(match, slice) {\n      var replace = ShaderLib[slice];\n\n      if (replace === undefined) {\n        Logger.error(`Shader slice \"${match.trim()}\" not founded.`);\n        return \"\";\n      }\n\n      return ShaderFactory.parseIncludes(replace);\n    }\n\n    return src.replace(regex, replace);\n  }\n\n  static InjectShaderSlices(slices) {\n    InjectShaderSlices(slices);\n  }\n\n  /**\n   * GLSL extension.\n   * @param {string[]} extensions - such as [\"GL_EXT_shader_texture_lod\"]\n   * */\n  static parseExtension(extensions: string[]) {\n    return (\n      `#define O3_EXTENSION_START\\n` +\n      extensions.map((e) => `#extension ${e} : enable\\n`).join(\"\") +\n      `#define O3_EXTENSION_END\\n`\n    );\n  }\n\n  /**\n   * Convert lower GLSL version to GLSL 300 es.\n   * @param shader - code\n   * @param isFrag - Whether it is a fragment shader.\n   * */\n  static convertTo300(shader: string, isFrag?: boolean) {\n    /** replace attribute and in */\n    shader = shader.replace(/\\battribute\\b/g, \"in\");\n    shader = shader.replace(/\\bvarying\\b/g, isFrag ? \"in\" : \"out\");\n\n    /** replace api */\n    shader = shader.replace(/\\btexture(2D|Cube)\\s*\\(/g, \"texture(\");\n    shader = shader.replace(/\\btexture(2D|Cube)LodEXT\\s*\\(/g, \"textureLod(\");\n    if (isFrag) {\n      const isMRT = /\\bgl_FragData\\[.+?\\]/g.test(shader);\n      if (isMRT) {\n        shader = shader.replace(/\\bgl_FragColor\\b/g, \"gl_FragData[0]\");\n        const result = shader.match(/\\bgl_FragData\\[.+?\\]/g);\n        shader = this.replaceMRTShader(shader, result);\n      } else {\n        shader = shader.replace(/void\\s+?main\\s*\\(/g, `out vec4 glFragColor;\\nvoid main(`);\n        shader = shader.replace(/\\bgl_FragColor\\b/g, \"glFragColor\");\n      }\n    }\n\n    return shader;\n  }\n\n  /**\n   * Returns the length of the draw buffer in the corresponding shaderCode.\n   * @param shader - shader code\n   */\n  static getMaxDrawBuffers(shader: string): number {\n    const mrtIndexSet = new Set();\n    const result = shader.match(/\\bgl_FragData\\[.+?\\]/g) || [];\n\n    for (let i = 0; i < result.length; i++) {\n      const res = result[i].match(/\\bgl_FragData\\[(.+?)\\]/);\n      mrtIndexSet.add(res[1]);\n    }\n\n    return mrtIndexSet.size;\n  }\n\n  /**\n   * Compatible with gl_FragColor and gl_FragData simultaneous errors.\n   * */\n  static compatible(fragmentShader: string) {\n    const hasFragData = /\\bgl_FragData\\[.+?\\]/g.test(fragmentShader);\n    if (hasFragData) {\n      fragmentShader = fragmentShader.replace(/\\bgl_FragColor\\b/g, \"gl_FragData[0]\");\n    }\n    return fragmentShader;\n  }\n\n  private static replaceMRTShader(shader: string, result: string[]): string {\n    let declaration = \"\";\n    const mrtIndexSet = new Set();\n\n    for (let i = 0; i < result.length; i++) {\n      const res = result[i].match(/\\bgl_FragData\\[(.+?)\\]/);\n      mrtIndexSet.add(res[1]);\n    }\n\n    mrtIndexSet.forEach((index) => {\n      declaration += `layout(location=${index}) out vec4 fragOutColor${index};\\n`;\n    });\n    declaration += `void main(`;\n\n    shader = shader.replace(/\\bgl_FragData\\[(.+?)\\]/g, \"fragOutColor$1\");\n\n    shader = shader.replace(/void\\s+?main\\s*\\(/g, declaration);\n    return shader;\n  }\n}\n\nexport { ShaderFactory };\n","/**\n * Shader macroã€‚\n */\nexport class ShaderMacro {\n  /** name */\n  readonly name: string;\n\n  /** @internal */\n  _index: number;\n  /** @internal */\n  _value: number;\n\n  /**\n   * @internal\n   */\n  constructor(name: string, index: number, value: number) {\n    this.name = name;\n    this._index = index;\n    this._value = value;\n  }\n}\n","/**\n * Shader data grouping.\n */\nexport enum ShaderDataGroup {\n  /** Scene group. */\n  Scene,\n  /** Camera group. */\n  Camera,\n  /** Renderer group. */\n  Renderer,\n  /** material group. */\n  Material\n}\n","import { Color, Matrix, Vector2, Vector3, Vector4 } from \"@oasis-engine/math\";\nimport { Engine } from \"../Engine\";\nimport { HardwareRenderer } from \"../HardwareRenderer\";\nimport { Texture } from \"../texture/Texture\";\nimport { ShaderPropertyValueType } from \"./ShaderData\";\n\n/**\n * Shader uniformã€‚\n * @internal\n */\nexport class ShaderUniform {\n  name: string;\n  propertyId: number;\n  location: WebGLUniformLocation;\n  textureIndex: GLenum | GLenum[];\n  applyFunc: (shaderUniform: ShaderUniform, value: ShaderPropertyValueType) => void;\n  cacheValue: number | Vector2 | Vector3 | Vector4;\n\n  private _rhi: HardwareRenderer;\n  private _gl: WebGLRenderingContext;\n\n  constructor(engine: Engine) {\n    const rhi = engine._hardwareRenderer;\n    this._rhi = rhi;\n    this._gl = rhi.gl;\n  }\n\n  upload1f(shaderUniform: ShaderUniform, value: number): void {\n    if (this.cacheValue !== value) {\n      this._gl.uniform1f(shaderUniform.location, value);\n      this.cacheValue = value;\n    }\n  }\n\n  upload1fv(shaderUniform: ShaderUniform, value: Float32Array): void {\n    this._gl.uniform1fv(shaderUniform.location, value);\n  }\n\n  upload2f(shaderUniform: ShaderUniform, value: Vector2 | Vector3 | Vector4 | Color): void {\n    const cacheVaue = <Vector2>this.cacheValue;\n    if ((<Color>value).r !== undefined) {\n      if (cacheVaue.x !== (<Color>value).r || cacheVaue.y !== (<Color>value).g) {\n        this._gl.uniform2f(shaderUniform.location, (<Color>value).r, (<Color>value).g);\n        cacheVaue.x = (<Color>value).r;\n        cacheVaue.y = (<Color>value).g;\n      }\n    } else {\n      if (cacheVaue.x !== (<Vector2>value).x || cacheVaue.y !== (<Vector2>value).y) {\n        this._gl.uniform2f(shaderUniform.location, (<Vector2>value).x, (<Vector2>value).y);\n        cacheVaue.x = (<Vector2>value).x;\n        cacheVaue.y = (<Vector2>value).y;\n      }\n    }\n  }\n\n  upload2fv(shaderUniform: ShaderUniform, value: Float32Array): void {\n    this._gl.uniform2fv(shaderUniform.location, value);\n  }\n\n  upload3f(shaderUniform: ShaderUniform, value: Vector3 | Vector4 | Color): void {\n    const cacheVaue = <Vector3>this.cacheValue;\n    if ((<Color>value).r !== undefined) {\n      if (cacheVaue.x !== (<Color>value).r || cacheVaue.y !== (<Color>value).g || cacheVaue.z !== (<Color>value).b) {\n        this._gl.uniform3f(shaderUniform.location, (<Color>value).r, (<Color>value).g, (<Color>value).b);\n        cacheVaue.x = (<Color>value).r;\n        cacheVaue.y = (<Color>value).g;\n        cacheVaue.z = (<Color>value).b;\n      }\n    } else {\n      if (\n        cacheVaue.x !== (<Vector3>value).x ||\n        cacheVaue.y !== (<Vector3>value).y ||\n        cacheVaue.z !== (<Vector3>value).z\n      ) {\n        this._gl.uniform3f(shaderUniform.location, (<Vector3>value).x, (<Vector3>value).y, (<Vector3>value).z);\n        cacheVaue.x = (<Vector3>value).x;\n        cacheVaue.y = (<Vector3>value).y;\n        cacheVaue.z = (<Vector3>value).z;\n      }\n    }\n  }\n\n  upload3fv(shaderUniform: ShaderUniform, value: Float32Array): void {\n    this._gl.uniform3fv(shaderUniform.location, value);\n  }\n\n  upload4f(shaderUniform: ShaderUniform, value: Vector4 | Color): void {\n    const cacheVaue = <Vector4>this.cacheValue;\n    if ((<Color>value).r !== undefined) {\n      if (\n        cacheVaue.x !== (<Color>value).r ||\n        cacheVaue.y !== (<Color>value).g ||\n        cacheVaue.z !== (<Color>value).b ||\n        cacheVaue.w !== (<Color>value).a\n      ) {\n        this._gl.uniform4f(\n          shaderUniform.location,\n          (<Color>value).r,\n          (<Color>value).g,\n          (<Color>value).b,\n          (<Color>value).a\n        );\n        cacheVaue.x = (<Color>value).r;\n        cacheVaue.y = (<Color>value).g;\n        cacheVaue.z = (<Color>value).b;\n        cacheVaue.w = (<Color>value).a;\n      }\n    } else {\n      if (\n        cacheVaue.x !== (<Vector4>value).x ||\n        cacheVaue.y !== (<Vector4>value).y ||\n        cacheVaue.z !== (<Vector4>value).z ||\n        cacheVaue.w !== (<Vector4>value).w\n      ) {\n        this._gl.uniform4f(\n          shaderUniform.location,\n          (<Vector4>value).x,\n          (<Vector4>value).y,\n          (<Vector4>value).z,\n          (<Vector4>value).w\n        );\n        cacheVaue.x = (<Vector4>value).x;\n        cacheVaue.y = (<Vector4>value).y;\n        cacheVaue.z = (<Vector4>value).z;\n        cacheVaue.w = (<Vector4>value).w;\n      }\n    }\n  }\n\n  upload4fv(shaderUniform: ShaderUniform, value: Float32Array): void {\n    this._gl.uniform4fv(shaderUniform.location, value);\n  }\n\n  upload1i(shaderUniform: ShaderUniform, value: number): void {\n    if (this.cacheValue !== value) {\n      this._gl.uniform1i(shaderUniform.location, value);\n      this.cacheValue = value;\n    }\n  }\n\n  upload1iv(shaderUniform: ShaderUniform, value: Int32Array): void {\n    this._gl.uniform1iv(shaderUniform.location, value);\n  }\n\n  upload2i(shaderUniform: ShaderUniform, value: Vector2 | Vector3 | Vector4 | Color): void {\n    const cacheVaue = <Vector2>this.cacheValue;\n    if ((<Color>value).r !== undefined) {\n      if (cacheVaue.x !== (<Color>value).r || cacheVaue.y !== (<Color>value).g) {\n        this._gl.uniform2i(shaderUniform.location, (<Color>value).r, (<Color>value).g);\n        cacheVaue.x = (<Color>value).r;\n        cacheVaue.y = (<Color>value).g;\n      }\n    } else {\n      if (cacheVaue.x !== (<Vector2>value).x || cacheVaue.y !== (<Vector2>value).y) {\n        this._gl.uniform2i(shaderUniform.location, (<Vector2>value).x, (<Vector2>value).y);\n        cacheVaue.x = (<Vector2>value).x;\n        cacheVaue.y = (<Vector2>value).y;\n      }\n    }\n  }\n\n  upload2iv(shaderUniform: ShaderUniform, value: Int32Array): void {\n    this._gl.uniform2iv(shaderUniform.location, value);\n  }\n\n  upload3i(shaderUniform: ShaderUniform, value: Vector3 | Vector4 | Color): void {\n    const cacheVaue = <Vector3>this.cacheValue;\n    if ((<Color>value).r !== undefined) {\n      if (cacheVaue.x !== (<Color>value).r || cacheVaue.y !== (<Color>value).g || cacheVaue.z !== (<Color>value).b) {\n        this._gl.uniform3i(shaderUniform.location, (<Color>value).r, (<Color>value).g, (<Color>value).b);\n        cacheVaue.x = (<Color>value).r;\n        cacheVaue.y = (<Color>value).g;\n        cacheVaue.z = (<Color>value).b;\n      }\n    } else {\n      if (\n        cacheVaue.x !== (<Vector3>value).x ||\n        cacheVaue.y !== (<Vector3>value).y ||\n        cacheVaue.z !== (<Vector3>value).z\n      ) {\n        this._gl.uniform3i(shaderUniform.location, (<Vector3>value).x, (<Vector3>value).y, (<Vector3>value).z);\n        cacheVaue.x = (<Vector3>value).x;\n        cacheVaue.y = (<Vector3>value).y;\n        cacheVaue.z = (<Vector3>value).z;\n      }\n    }\n  }\n  upload3iv(shaderUniform: ShaderUniform, value: Int32Array): void {\n    this._gl.uniform3iv(shaderUniform.location, value);\n  }\n  upload4i(shaderUniform: ShaderUniform, value: Vector4 | Color): void {\n    const cacheVaue = <Vector4>this.cacheValue;\n    if ((<Color>value).r !== undefined) {\n      if (\n        cacheVaue.x !== (<Color>value).r ||\n        cacheVaue.y !== (<Color>value).g ||\n        cacheVaue.z !== (<Color>value).b ||\n        cacheVaue.w !== (<Color>value).a\n      ) {\n        this._gl.uniform4i(\n          shaderUniform.location,\n          (<Color>value).r,\n          (<Color>value).g,\n          (<Color>value).b,\n          (<Color>value).a\n        );\n        cacheVaue.x = (<Color>value).r;\n        cacheVaue.y = (<Color>value).g;\n        cacheVaue.z = (<Color>value).b;\n        cacheVaue.w = (<Color>value).a;\n      }\n    } else {\n      if (\n        cacheVaue.x !== (<Vector4>value).x ||\n        cacheVaue.y !== (<Vector4>value).y ||\n        cacheVaue.z !== (<Vector4>value).z ||\n        cacheVaue.w !== (<Vector4>value).w\n      ) {\n        this._gl.uniform4i(\n          shaderUniform.location,\n          (<Vector4>value).x,\n          (<Vector4>value).y,\n          (<Vector4>value).z,\n          (<Vector4>value).w\n        );\n        cacheVaue.x = (<Vector4>value).x;\n        cacheVaue.y = (<Vector4>value).y;\n        cacheVaue.z = (<Vector4>value).z;\n        cacheVaue.w = (<Vector4>value).w;\n      }\n    }\n  }\n\n  upload4iv(shaderUniform: ShaderUniform, value: Int32Array): void {\n    this._gl.uniform4iv(shaderUniform.location, value);\n  }\n\n  uploadMat4(shaderUniform: ShaderUniform, value: Matrix): void {\n    this._gl.uniformMatrix4fv(shaderUniform.location, false, value.elements);\n  }\n\n  uploadMat4v(shaderUniform: ShaderUniform, value: Float32Array): void {\n    this._gl.uniformMatrix4fv(shaderUniform.location, false, value);\n  }\n\n  uploadTexture(shaderUniform: ShaderUniform, value: Texture): void {\n    const rhi = this._rhi;\n    rhi.activeTexture(shaderUniform.textureIndex as GLenum);\n    rhi.bindTexture(value._target, value._glTexture);\n  }\n\n  uploadTextureArray(shaderUniform: ShaderUniform, value: Texture[]): void {\n    const rhi = this._rhi;\n    const textureIndices = shaderUniform.textureIndex as GLenum[];\n    for (let i = 0; i < value.length; i++) {\n      const texture = value[i];\n      rhi.activeTexture(textureIndices[i]);\n      rhi.bindTexture(texture._target, texture._glTexture);\n    }\n  }\n}\n","import { ShaderUniform } from \"./ShaderUniform\";\n\n/**\n * Shader uniform block.\n * @internal\n */\nexport class ShaderUniformBlock {\n  readonly constUniforms: ShaderUniform[] = [];\n  readonly textureUniforms: ShaderUniform[] = [];\n}\n","import { Vector2, Vector3, Vector4 } from \"@oasis-engine/math\";\nimport { Logger } from \"../base/Logger\";\nimport { Camera } from \"../Camera\";\nimport { Engine } from \"../Engine\";\nimport { HardwareRenderer } from \"../HardwareRenderer\";\nimport { Material } from \"../material/Material\";\nimport { Renderer } from \"../Renderer\";\nimport { ShaderDataGroup } from \"./enums/ShaderDataGroup\";\nimport { Shader } from \"./Shader\";\nimport { ShaderData } from \"./ShaderData\";\nimport { ShaderUniform } from \"./ShaderUniform\";\nimport { ShaderUniformBlock } from \"./ShaderUniformBlock\";\n\n/**\n * Shader program, corresponding to the GPU shader program.\n * @internal\n */\nexport class ShaderProgram {\n  private static _counter: number = 0;\n\n  private static _addLineNum(str: string) {\n    const lines = str.split(\"\\n\");\n    const limitLength = (lines.length + 1).toString().length + 6;\n    let prefix;\n    return lines\n      .map((line, index) => {\n        prefix = `0:${index + 1}`;\n        if (prefix.length >= limitLength) return prefix.substring(0, limitLength) + line;\n\n        for (let i = 0; i < limitLength - prefix.length; i++) prefix += \" \";\n\n        return prefix + line;\n      })\n      .join(\"\\n\");\n  }\n\n  id: number;\n\n  readonly sceneUniformBlock: ShaderUniformBlock = new ShaderUniformBlock();\n  readonly cameraUniformBlock: ShaderUniformBlock = new ShaderUniformBlock();\n  readonly rendererUniformBlock: ShaderUniformBlock = new ShaderUniformBlock();\n  readonly materialUniformBlock: ShaderUniformBlock = new ShaderUniformBlock();\n  readonly otherUniformBlock: ShaderUniformBlock = new ShaderUniformBlock();\n\n  /** @internal */\n  _uploadRenderCount: number = -1;\n  /** @internal */\n  _uploadCamera: Camera;\n  /** @internal */\n  _uploadRenderer: Renderer;\n  /** @internal */\n  _uploadMaterial: Material;\n\n  attributeLocation: Record<string, GLint> = Object.create(null);\n\n  // @todo: move to RHI.\n  private _isValid: boolean;\n  private _engine: Engine;\n  private _gl: WebGLRenderingContext;\n  private _vertexShader: WebGLShader;\n  private _fragmentShader: WebGLShader;\n  private _glProgram: WebGLProgram;\n  private _activeTextureUint: number = 0;\n\n  /**\n   * Whether this shader program is valid.\n   * @readonly\n   */\n  get isValid(): boolean {\n    return this._isValid;\n  }\n\n  constructor(engine: Engine, vertexSource: string, fragmentSource: string) {\n    this._engine = engine;\n    this._gl = engine._hardwareRenderer.gl;\n    this._glProgram = this._createProgram(vertexSource, fragmentSource);\n\n    if (this._glProgram) {\n      this._isValid = true;\n      this._recordLocation();\n    } else {\n      this._isValid = false;\n    }\n\n    this.id = ShaderProgram._counter++;\n  }\n\n  /**\n   * Upload all shader data in shader uniform block.\n   * @param uniformBlock - shader Uniform block\n   * @param shaderData - shader data\n   */\n  uploadAll(uniformBlock: ShaderUniformBlock, shaderData: ShaderData): void {\n    this.uploadUniforms(uniformBlock, shaderData);\n    this.uploadTextures(uniformBlock, shaderData);\n  }\n\n  /**\n   * Upload constant shader data in shader uniform block.\n   * @param uniformBlock - shader Uniform block\n   * @param shaderData - shader data\n   */\n  uploadUniforms(uniformBlock: ShaderUniformBlock, shaderData: ShaderData): void {\n    const properties = shaderData._properties;\n    const constUniforms = uniformBlock.constUniforms;\n\n    for (let i = 0, n = constUniforms.length; i < n; i++) {\n      const uniform = constUniforms[i];\n      const data = properties[uniform.propertyId];\n      data != null && uniform.applyFunc(uniform, data);\n    }\n  }\n\n  /**\n   * Upload texture shader data in shader uniform block.\n   * @param uniformBlock - shader Uniform block\n   * @param shaderData - shader data\n   */\n  uploadTextures(uniformBlock: ShaderUniformBlock, shaderData: ShaderData): void {\n    const properties = shaderData._properties;\n    const textureUniforms = uniformBlock.textureUniforms;\n    // textureUniforms property maybe null if ShaderUniformBlock not contain any texture.\n    if (textureUniforms) {\n      for (let i = 0, n = textureUniforms.length; i < n; i++) {\n        const uniform = textureUniforms[i];\n        uniform.applyFunc(uniform, properties[uniform.propertyId]);\n      }\n    }\n  }\n\n  /**\n   * Groupping other data.\n   */\n  groupingOtherUniformBlock() {\n    const { constUniforms, textureUniforms } = this.otherUniformBlock;\n    constUniforms.length > 0 && this._groupingSubOtherUniforms(constUniforms, false);\n    textureUniforms.length > 0 && this._groupingSubOtherUniforms(textureUniforms, true);\n  }\n\n  /**\n   * Bind this shader program.\n   * @returns Whether the shader program is switched.\n   */\n  bind(): boolean {\n    const rhi: HardwareRenderer = this._engine._hardwareRenderer;\n    if (rhi._currentBind !== this) {\n      this._gl.useProgram(this._glProgram);\n      rhi._currentBind = this;\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  /**\n   * Destroy this shader program.\n   */\n  destroy(): void {\n    const gl = this._gl;\n    this._vertexShader && gl.deleteShader(this._vertexShader);\n    this._fragmentShader && gl.deleteShader(this._fragmentShader);\n    this._glProgram && gl.deleteProgram(this._glProgram);\n  }\n\n  private _groupingSubOtherUniforms(unifroms: ShaderUniform[], isTexture: boolean) {\n    for (let i = unifroms.length - 1; i >= 0; i--) {\n      const uniform = unifroms[i];\n      const group = Shader._getShaderPropertyGroup(uniform.name);\n      if (group !== undefined) {\n        unifroms.splice(unifroms.indexOf(uniform), 1);\n        this._groupingUniform(uniform, group, isTexture);\n      }\n    }\n  }\n\n  private _groupingUniform(uniform: ShaderUniform, group: ShaderDataGroup, isTexture: boolean): void {\n    switch (group) {\n      case ShaderDataGroup.Scene:\n        if (isTexture) {\n          this.sceneUniformBlock.textureUniforms.push(uniform);\n        } else {\n          this.sceneUniformBlock.constUniforms.push(uniform);\n        }\n        break;\n      case ShaderDataGroup.Camera:\n        if (isTexture) {\n          this.cameraUniformBlock.textureUniforms.push(uniform);\n        } else {\n          this.cameraUniformBlock.constUniforms.push(uniform);\n        }\n        break;\n      case ShaderDataGroup.Renderer:\n        if (isTexture) {\n          this.rendererUniformBlock.textureUniforms.push(uniform);\n        } else {\n          this.rendererUniformBlock.constUniforms.push(uniform);\n        }\n        break;\n      case ShaderDataGroup.Material:\n        if (isTexture) {\n          this.materialUniformBlock.textureUniforms.push(uniform);\n        } else {\n          this.materialUniformBlock.constUniforms.push(uniform);\n        }\n        break;\n      default:\n        if (isTexture) {\n          this.otherUniformBlock.textureUniforms.push(uniform);\n        } else {\n          this.otherUniformBlock.constUniforms.push(uniform);\n        }\n    }\n  }\n\n  /**\n   * init and link program with shader.\n   */\n  private _createProgram(vertexSource: string, fragmentSource: string): WebGLProgram | null {\n    const gl = this._gl;\n\n    // create and compile shader\n    const vertexShader = this._createShader(gl.VERTEX_SHADER, vertexSource);\n    if (!vertexShader) {\n      return null;\n    }\n\n    const fragmentShader = this._createShader(gl.FRAGMENT_SHADER, fragmentSource);\n    if (!fragmentShader) {\n      return null;\n    }\n\n    // link program and shader\n    const program = gl.createProgram();\n    gl.attachShader(program, vertexShader);\n    gl.attachShader(program, fragmentShader);\n    gl.linkProgram(program);\n    gl.validateProgram(program);\n\n    if (gl.isContextLost()) {\n      Logger.error(\"Contex lost while linking program.\");\n      gl.deleteShader(vertexShader);\n      gl.deleteShader(fragmentShader);\n      return null;\n    }\n\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n      Logger.error(\"Could not link WebGL program. \\n\" + gl.getProgramInfoLog(program));\n      gl.deleteProgram(program);\n      return null;\n    }\n\n    this._vertexShader = vertexShader;\n    this._fragmentShader = fragmentShader;\n    return program;\n  }\n\n  private _createShader(shaderType: number, shaderSource: string): WebGLShader | null {\n    const gl = this._gl;\n    const shader = gl.createShader(shaderType);\n\n    if (!shader) {\n      Logger.error(\"Context lost while create shader.\");\n      return null;\n    }\n\n    gl.shaderSource(shader, shaderSource);\n    gl.compileShader(shader);\n\n    if (gl.isContextLost()) {\n      Logger.error(\"Context lost while compiling shader.\");\n      gl.deleteShader(shader);\n      return null;\n    }\n\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n      Logger.error(\n        `Could not compile WebGL shader.\\n${gl.getShaderInfoLog(shader)}`,\n        ShaderProgram._addLineNum(shaderSource)\n      );\n      gl.deleteShader(shader);\n      return null;\n    }\n\n    return shader;\n  }\n\n  /**\n   * record the location of uniform/attribute.\n   */\n  private _recordLocation() {\n    const gl = this._gl;\n    const program = this._glProgram;\n    const uniformInfos = this._getUniformInfos();\n    const attributeInfos = this._getAttributeInfos();\n\n    uniformInfos.forEach(({ name, size, type }) => {\n      const shaderUniform = new ShaderUniform(this._engine);\n      let isArray = false;\n      let isTexture = false;\n\n      if (name.indexOf(\"[0]\") > 0) {\n        name = name.substr(0, name.length - 3);\n        isArray = true;\n      }\n\n      const group = Shader._getShaderPropertyGroup(name);\n      const location = gl.getUniformLocation(program, name);\n      shaderUniform.name = name;\n      shaderUniform.propertyId = Shader.getPropertyByName(name)._uniqueId;\n      shaderUniform.location = location;\n\n      switch (type) {\n        case gl.FLOAT:\n          if (isArray) {\n            shaderUniform.applyFunc = shaderUniform.upload1fv;\n          } else {\n            shaderUniform.applyFunc = shaderUniform.upload1f;\n            shaderUniform.cacheValue = 0;\n          }\n          break;\n        case gl.FLOAT_VEC2:\n          if (isArray) {\n            shaderUniform.applyFunc = shaderUniform.upload2fv;\n          } else {\n            shaderUniform.applyFunc = shaderUniform.upload2f;\n            shaderUniform.cacheValue = new Vector2(0, 0);\n          }\n          break;\n        case gl.FLOAT_VEC3:\n          if (isArray) {\n            shaderUniform.applyFunc = shaderUniform.upload3fv;\n          } else {\n            shaderUniform.applyFunc = shaderUniform.upload3f;\n            shaderUniform.cacheValue = new Vector3(0, 0, 0);\n          }\n          break;\n        case gl.FLOAT_VEC4:\n          if (isArray) {\n            shaderUniform.applyFunc = shaderUniform.upload4fv;\n          } else {\n            shaderUniform.applyFunc = shaderUniform.upload4f;\n            shaderUniform.cacheValue = new Vector4(0, 0, 0, 0);\n          }\n          break;\n        case gl.BOOL:\n        case gl.INT:\n          if (isArray) {\n            shaderUniform.applyFunc = shaderUniform.upload1iv;\n          } else {\n            shaderUniform.applyFunc = shaderUniform.upload1i;\n            shaderUniform.cacheValue = 0;\n          }\n          break;\n        case gl.BOOL_VEC2:\n        case gl.INT_VEC2:\n          if (isArray) {\n            shaderUniform.applyFunc = shaderUniform.upload2iv;\n          } else {\n            shaderUniform.applyFunc = shaderUniform.upload2i;\n            shaderUniform.cacheValue = new Vector2(0, 0);\n          }\n          break;\n        case gl.BOOL_VEC3:\n        case gl.INT_VEC3:\n          if (isArray) {\n          } else {\n          }\n          shaderUniform.applyFunc = isArray ? shaderUniform.upload3iv : shaderUniform.upload3i;\n          shaderUniform.cacheValue = new Vector3(0, 0, 0);\n          break;\n        case gl.BOOL_VEC4:\n        case gl.INT_VEC4:\n          if (isArray) {\n            shaderUniform.applyFunc = shaderUniform.upload4iv;\n          } else {\n            shaderUniform.applyFunc = shaderUniform.upload4i;\n            shaderUniform.cacheValue = new Vector4(0, 0, 0);\n          }\n          break;\n        case gl.FLOAT_MAT4:\n          shaderUniform.applyFunc = isArray ? shaderUniform.uploadMat4v : shaderUniform.uploadMat4;\n          break;\n        case gl.SAMPLER_2D:\n        case gl.SAMPLER_CUBE:\n          isTexture = true;\n          if (isArray) {\n            const textureIndices = new Int32Array(size);\n            const glTextureIndices = new Array<number>(size);\n            for (let i = 0; i < size; i++) {\n              textureIndices[i] = this._activeTextureUint;\n              glTextureIndices[i] = gl.TEXTURE0 + this._activeTextureUint++;\n            }\n            shaderUniform.textureIndex = glTextureIndices;\n            shaderUniform.applyFunc = shaderUniform.uploadTextureArray;\n            this.bind();\n            gl.uniform1iv(location, textureIndices);\n          } else {\n            const textureIndex = gl.TEXTURE0 + this._activeTextureUint;\n            shaderUniform.textureIndex = textureIndex;\n            shaderUniform.applyFunc = shaderUniform.uploadTexture;\n            this.bind();\n            gl.uniform1i(location, this._activeTextureUint++);\n          }\n          break;\n      }\n      this._groupingUniform(shaderUniform, group, isTexture);\n    });\n\n    attributeInfos.forEach(({ name }) => {\n      this.attributeLocation[name] = gl.getAttribLocation(program, name);\n    });\n  }\n\n  private _getUniformInfos(): WebGLActiveInfo[] {\n    const gl = this._gl;\n    const program = this._glProgram;\n    const uniformInfos: WebGLActiveInfo[] = [];\n\n    const uniformCount = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);\n    for (let i = 0; i < uniformCount; ++i) {\n      const info = gl.getActiveUniform(program, i);\n      uniformInfos[i] = info;\n    }\n\n    return uniformInfos;\n  }\n\n  private _getAttributeInfos(): WebGLActiveInfo[] {\n    const gl = this._gl;\n    const program = this._glProgram;\n    const attributeInfos: WebGLActiveInfo[] = [];\n\n    const attributeCount = gl.getProgramParameter(program, gl.ACTIVE_ATTRIBUTES);\n    for (let i = 0; i < attributeCount; ++i) {\n      const info = gl.getActiveAttrib(program, i);\n      attributeInfos[i] = info;\n    }\n\n    return attributeInfos;\n  }\n}\n","import { ShaderDataGroup } from \"./enums/ShaderDataGroup\";\n\n/**\n * Shader property.\n */\nexport class ShaderProperty {\n  private static _propertyNameCounter: number = 0;\n\n  /** @internal */\n  _uniqueId: number;\n  /** @internal */\n  _group: ShaderDataGroup;\n\n  /**\n   * @internal\n   */\n  constructor() {\n    this._uniqueId = ShaderProperty._propertyNameCounter++;\n  }\n}\n","import { Engine } from \"../Engine\";\nimport { RenderQueue } from \"../RenderPipeline/RenderQueue\";\nimport { ShaderFactory } from \"../shaderlib/ShaderFactory\";\nimport { ShaderDataGroup } from \"./enums/ShaderDataGroup\";\nimport { ShaderMacro } from \"./ShaderMacro\";\nimport { ShaderMacroCollection } from \"./ShaderMacroCollection\";\nimport { ShaderProgram } from \"./ShaderProgram\";\nimport { ShaderProperty } from \"./ShaderProperty\";\n\n/**\n * Shader containing vertex and fragment source.\n */\nexport class Shader {\n  private static _shaderCounter: number = 0;\n  private static _shaderMap: Record<string, Shader> = Object.create(null);\n  private static _propertyNameMap: Record<string, ShaderProperty> = Object.create(null);\n  private static _macroMaskMap: string[][] = [];\n  private static _macroCounter: number = 0;\n  private static _macroMap: Record<string, ShaderMacro> = Object.create(null);\n  private static _shaderExtension = [\"GL_EXT_shader_texture_lod\", \"GL_OES_standard_derivatives\", \"GL_EXT_draw_buffers\"];\n\n  /**\n   * Create a shader.\n   * @param name - Name of the shader\n   * @param vertexSource - Vertex source code\n   * @param fragmentSource - Fragment source code\n   */\n  static create(name: string, vertexSource: string, fragmentSource: string): Shader {\n    const shaderMap = Shader._shaderMap;\n    if (shaderMap[name]) {\n      throw `Shader named \"${name}\" already exists.`;\n    }\n    return (shaderMap[name] = new Shader(name, vertexSource, fragmentSource));\n  }\n\n  /**\n   * Find a shader by name.\n   * @param name - Name of the shader\n   */\n  static find(name: string): Shader {\n    return Shader._shaderMap[name];\n  }\n\n  /**\n   * Get shader macro by name.\n   * @param name - Name of the shader macro\n   * @returns Shader macro\n   */\n  static getMacroByName(name: string): ShaderMacro {\n    let macro = Shader._macroMap[name];\n    if (!macro) {\n      const maskMap = Shader._macroMaskMap;\n      const counter = Shader._macroCounter;\n      const index = Math.floor(counter / 32);\n      const bit = counter % 32;\n      macro = new ShaderMacro(name, index, 1 << bit);\n      Shader._macroMap[name] = macro;\n      if (index == maskMap.length) {\n        maskMap.length++;\n        maskMap[index] = new Array<string>(32);\n      }\n      maskMap[index][bit] = name;\n      Shader._macroCounter++;\n    }\n    return macro;\n  }\n\n  /**\n   * Get shader property by name.\n   * @param name - Name of the shader property\n   * @returns Shader property\n   */\n  static getPropertyByName(name: string): ShaderProperty {\n    const propertyNameMap = Shader._propertyNameMap;\n    if (propertyNameMap[name] != null) {\n      return propertyNameMap[name];\n    } else {\n      const property = new ShaderProperty();\n      propertyNameMap[name] = property;\n      return property;\n    }\n  }\n\n  /**\n   * @internal\n   */\n  static _getShaderPropertyGroup(propertyName: string): ShaderDataGroup | null {\n    const shaderProperty = Shader._propertyNameMap[propertyName];\n    return shaderProperty?._group;\n  }\n\n  private static _getNamesByMacros(macros: ShaderMacroCollection, out: string[]): void {\n    const maskMap = Shader._macroMaskMap;\n    const mask = macros._mask;\n    out.length = 0;\n    for (let i = 0, n = macros._length; i < n; i++) {\n      const subMaskMap = maskMap[i];\n      const subMask = mask[i];\n      const n = subMask < 0 ? 32 : Math.floor(Math.log2(subMask)) + 1; // if is negative must contation 1 << 31.\n      for (let j = 0; j < n; j++) {\n        if (subMask & (1 << j)) {\n          out.push(subMaskMap[j]);\n        }\n      }\n    }\n  }\n\n  /** The name of shader. */\n  readonly name: string;\n\n  /** @internal */\n  _shaderId: number = 0;\n\n  private _vertexSource: string;\n  private _fragmentSource: string;\n\n  private constructor(name: string, vertexSource: string, fragmentSource: string) {\n    this._shaderId = Shader._shaderCounter++;\n    this.name = name;\n    this._vertexSource = vertexSource;\n    this._fragmentSource = fragmentSource;\n  }\n\n  /**\n   * Compile shader variant by macro name list.\n   *\n   * @remarks\n   * Usually a shader contains some macros,any combination of macros is called shader variant.\n   *\n   * @param engine - Engine to which the shader variant belongs\n   * @param macros - Macro name list\n   */\n  compileVariant(engine: Engine, macros: string[]): void {\n    const compileMacros = RenderQueue.compileMacros;\n    compileMacros.clear();\n    for (let i = 0, n = macros.length; i < n; i++) {\n      compileMacros.enable(Shader.getMacroByName(macros[i]));\n    }\n    this._getShaderProgram(engine, compileMacros);\n  }\n\n  /**\n   * @internal\n   */\n  _getShaderProgram(engine: Engine, macroCollection: ShaderMacroCollection): ShaderProgram {\n    const shaderProgramPool = engine._getShaderProgramPool(this);\n    let shaderProgram = shaderProgramPool.get(macroCollection);\n    if (shaderProgram) {\n      return shaderProgram;\n    }\n\n    const isWebGL2: boolean = engine._hardwareRenderer.isWebGL2;\n    const macroNameList = [];\n    Shader._getNamesByMacros(macroCollection, macroNameList);\n    const macroNameStr = ShaderFactory.parseCustomMacros(macroNameList);\n    const shaderNameStr = ShaderFactory.parseShaderName(this.name || \"VOID\");\n    const versionStr = isWebGL2 ? \"#version 300 es\" : \"#version 100\";\n    const precisionStr = `\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      precision highp int;\n      #define O3_VERTEX_PRECISION highp\n      #define O3_FRAGMENT_PRECISION highp\n    #else\n      precision mediump float;\n      precision mediump int;\n      #define O3_VERTEX_PRECISION mediump\n      #define O3_FRAGMENT_PRECISION mediump\n    #endif\n    `;\n\n    let vertexSource = ShaderFactory.parseShader(\n      ` ${versionStr}\n        ${shaderNameStr}\n        ${precisionStr}\n        ${macroNameStr}\n        ` + this._vertexSource\n    );\n\n    let fragmentSource = ShaderFactory.parseShader(\n      ` ${versionStr}\n        ${shaderNameStr}\n        ${isWebGL2 ? \"\" : ShaderFactory.parseExtension(Shader._shaderExtension)}\n        ${precisionStr}\n        ${macroNameStr}\n      ` + this._fragmentSource\n    );\n\n    if (isWebGL2) {\n      vertexSource = ShaderFactory.convertTo300(vertexSource);\n      fragmentSource = ShaderFactory.convertTo300(fragmentSource, true);\n    }\n\n    shaderProgram = new ShaderProgram(engine, vertexSource, fragmentSource);\n\n    shaderProgramPool.cache(shaderProgram);\n    return shaderProgram;\n  }\n}\n","import { Matrix } from \"@oasis-engine/math\";\nimport { Component } from \"../Component\";\nimport { LightFeature } from \"./LightFeature\";\n\n/**\n * Light base class.\n */\nexport class Light extends Component {\n  /**\n   * Each type of light source is at most 10, beyond which it will not take effect.\n   * */\n  protected static _maxLight: number = 10;\n\n  private _viewMat: Matrix;\n  private _inverseViewMat: Matrix;\n\n  /**\n   * Mount to the current Scene.\n   * @internal\n   * @override\n   */\n  _onEnable() {\n    this.scene.findFeature(LightFeature).attachRenderLight(this);\n  }\n\n  /**\n   * Unmount from the current Scene.\n   * @internal\n   * @override\n   */\n  _onDisable() {\n    this.scene.findFeature(LightFeature).detachRenderLight(this);\n  }\n\n  /**\n   * View matrix.\n   * @readonly\n   */\n  get viewMatrix() {\n    if (!this._viewMat) this._viewMat = new Matrix();\n    Matrix.invert(this.entity.transform.worldMatrix, this._viewMat);\n    return this._viewMat;\n  }\n\n  /**\n   * Inverse view matrix.\n   * @readonly\n   */\n  get inverseViewMatrix() {\n    if (!this._inverseViewMat) this._inverseViewMat = new Matrix();\n    Matrix.invert(this.viewMatrix, this._inverseViewMat);\n    return this._inverseViewMat;\n  }\n}\n","import { Color } from \"@oasis-engine/math\";\nimport { Entity } from \"../Entity\";\nimport { Shader } from \"../shader\";\nimport { ShaderProperty } from \"../shader/ShaderProperty\";\nimport { Light } from \"./Light\";\n\n/**\n * Ambient light.\n */\nexport class AmbientLight extends Light {\n  private static _colorProperty: ShaderProperty = Shader.getPropertyByName(\"u_ambientLightColor\");\n\n  /**\n   * Ambient light color.\n   */\n  get color(): Color {\n    return this._color;\n  }\n\n  set color(value: Color) {\n    this._color = value;\n    this.scene.shaderData.setColor(AmbientLight._colorProperty, this.lightColor);\n  }\n\n  /**\n   * Ambient light intensity.\n   */\n  get intensity(): number {\n    return this._intensity;\n  }\n\n  set intensity(value: number) {\n    this._intensity = value;\n    this.scene.shaderData.setColor(AmbientLight._colorProperty, this.lightColor);\n  }\n\n  /**\n   * Get the final light color.\n   * @readonly\n   */\n  get lightColor(): Color {\n    this._lightColor.r = this._color.r * this._intensity;\n    this._lightColor.g = this._color.g * this._intensity;\n    this._lightColor.b = this._color.b * this._intensity;\n    this._lightColor.a = this._color.a * this._intensity;\n    return this._lightColor;\n  }\n\n  private _color: Color = new Color(1, 1, 1, 1);\n  private _intensity: number = 1;\n  private _lightColor: Color = new Color(1, 1, 1, 1);\n\n  constructor(entity: Entity) {\n    super(entity);\n    this.color = this._color;\n  }\n}\n","import { Color, Vector3 } from \"@oasis-engine/math\";\nimport { Shader } from \"../shader\";\nimport { ShaderData } from \"../shader/ShaderData\";\nimport { ShaderProperty } from \"../shader/ShaderProperty\";\nimport { Light } from \"./Light\";\n\n/**\n * Directional light.\n */\nexport class DirectLight extends Light {\n  private static _colorProperty: ShaderProperty = Shader.getPropertyByName(\"u_directLightColor\");\n  private static _directionProperty: ShaderProperty = Shader.getPropertyByName(\"u_directLightDirection\");\n\n  private static _combinedData = {\n    color: new Float32Array(3 * Light._maxLight),\n    direction: new Float32Array(3 * Light._maxLight)\n  };\n\n  /**\n   * @internal\n   */\n  static _updateShaderData(shaderData: ShaderData): void {\n    const data = DirectLight._combinedData;\n\n    shaderData.setFloatArray(DirectLight._colorProperty, data.color);\n    shaderData.setFloatArray(DirectLight._directionProperty, data.direction);\n  }\n\n  color: Color = new Color(1, 1, 1, 1);\n  intensity: number = 1;\n\n  private _forward: Vector3 = new Vector3();\n  private _lightColor: Color = new Color(1, 1, 1, 1);\n  private _reverseDirection: Vector3 = new Vector3();\n\n  /**\n   * Get direction.\n   * @readonly\n   */\n  get direction(): Vector3 {\n    this.entity.transform.getWorldForward(this._forward);\n    return this._forward;\n  }\n\n  /**\n   * Get the final light color.\n   * @readonly\n   */\n  get lightColor(): Color {\n    this._lightColor.r = this.color.r * this.intensity;\n    this._lightColor.g = this.color.g * this.intensity;\n    this._lightColor.b = this.color.b * this.intensity;\n    this._lightColor.a = this.color.a * this.intensity;\n    return this._lightColor;\n  }\n\n  /**\n   * Get the opposite direction of the directional light direction.\n   * @readonly\n   */\n  get reverseDirection(): Vector3 {\n    Vector3.scale(this.direction, -1, this._reverseDirection);\n    return this._reverseDirection;\n  }\n\n  /**\n   * @internal\n   */\n  _appendData(lightIndex: number): void {\n    const colorStart = lightIndex * 3;\n    const directionStart = lightIndex * 3;\n    const lightColor = this.lightColor;\n    const direction = this.direction;\n\n    const data = DirectLight._combinedData;\n\n    data.color[colorStart] = lightColor.r;\n    data.color[colorStart + 1] = lightColor.g;\n    data.color[colorStart + 2] = lightColor.b;\n    data.direction[directionStart] = direction.x;\n    data.direction[directionStart + 1] = direction.y;\n    data.direction[directionStart + 2] = direction.z;\n  }\n}\n","import { Color } from \"@oasis-engine/math\";\nimport { Entity } from \"../Entity\";\nimport { Shader } from \"../shader\";\nimport { ShaderData } from \"../shader/ShaderData\";\nimport { ShaderMacro } from \"../shader/ShaderMacro\";\nimport { ShaderProperty } from \"../shader/ShaderProperty\";\nimport { TextureCubeMap } from \"../texture\";\nimport { Light } from \"./Light\";\n\n/**\n * Environment light.\n */\nexport class EnvironmentMapLight extends Light {\n  private static _diffuseMacro: ShaderMacro = Shader.getMacroByName(\"O3_USE_DIFFUSE_ENV\");\n  private static _specularMacro: ShaderMacro = Shader.getMacroByName(\"O3_USE_SPECULAR_ENV\");\n  private static _diffuseTextureProperty: ShaderProperty = Shader.getPropertyByName(\"u_env_diffuseSampler\");\n  private static _specularTextureProperty: ShaderProperty = Shader.getPropertyByName(\"u_env_specularSampler\");\n  private static _mipLevelProperty: ShaderProperty = Shader.getPropertyByName(\"u_envMapLight.mipMapLevel\");\n  private static _diffuseColorProperty: ShaderProperty = Shader.getPropertyByName(\"u_envMapLight.diffuse\");\n  private static _specularColorProperty: ShaderProperty = Shader.getPropertyByName(\"u_envMapLight.specular\");\n  private static _diffuseIntensityProperty: ShaderProperty = Shader.getPropertyByName(\"u_envMapLight.diffuseIntensity\");\n  private static _specularIntensityProperty: ShaderProperty = Shader.getPropertyByName(\n    \"u_envMapLight.specularIntensity\"\n  );\n  private static _transformMatrixProperty: ShaderProperty = Shader.getPropertyByName(\"u_envMapLight.transformMatrix\");\n\n  /**\n   * @internal\n   */\n  static _updateShaderData(shaderData: ShaderData, light: EnvironmentMapLight): void {\n    // support rotation\n    const transformMatrix = light.entity.transform.worldMatrix;\n    shaderData.setMatrix(EnvironmentMapLight._transformMatrixProperty, transformMatrix);\n  }\n\n  /**\n   * Diffuse cube texture.\n   */\n  get diffuseTexture(): TextureCubeMap {\n    return this._diffuseTexture;\n  }\n\n  set diffuseTexture(value: TextureCubeMap) {\n    this._diffuseTexture = value;\n    const shaderData = this.scene.shaderData;\n\n    if (value) {\n      shaderData.setTexture(EnvironmentMapLight._diffuseTextureProperty, value);\n      shaderData.enableMacro(EnvironmentMapLight._diffuseMacro);\n    } else {\n      shaderData.disableMacro(EnvironmentMapLight._diffuseMacro);\n    }\n  }\n\n  /**\n   * Specular cube texture.\n   */\n  get specularTexture(): TextureCubeMap {\n    return this._specularTexture;\n  }\n\n  set specularTexture(value: TextureCubeMap) {\n    this._specularTexture = value;\n    const shaderData = this.scene.shaderData;\n\n    if (value) {\n      shaderData.setTexture(EnvironmentMapLight._specularTextureProperty, value);\n      shaderData.setFloat(EnvironmentMapLight._mipLevelProperty, this.specularTexture.mipmapCount);\n      shaderData.enableMacro(EnvironmentMapLight._specularMacro);\n    } else {\n      shaderData.disableMacro(EnvironmentMapLight._specularMacro);\n    }\n  }\n\n  /**\n   * Diffuse color.\n   */\n  get diffuseColor(): Color {\n    return this._diffuseColor;\n  }\n\n  set diffuseColor(value: Color) {\n    this._diffuseColor = value;\n\n    this.scene.shaderData.setColor(EnvironmentMapLight._diffuseColorProperty, value);\n  }\n\n  /**\n   * Specular color.\n   */\n  get specularColor(): Color {\n    return this._specularColor;\n  }\n\n  set specularColor(value: Color) {\n    this._specularColor = value;\n\n    this.scene.shaderData.setColor(EnvironmentMapLight._specularColorProperty, value);\n  }\n\n  /**\n   * Diffuse intensity.\n   */\n  get diffuseIntensity(): number {\n    return this._diffuseIntensity;\n  }\n\n  set diffuseIntensity(value: number) {\n    this._diffuseIntensity = value;\n\n    this.scene.shaderData.setFloat(EnvironmentMapLight._diffuseIntensityProperty, value);\n  }\n\n  /**\n   * Specular intensity.\n   */\n  get specularIntensity(): number {\n    return this._specularIntensity;\n  }\n\n  set specularIntensity(value: number) {\n    this._specularIntensity = value;\n\n    this.scene.shaderData.setFloat(EnvironmentMapLight._specularIntensityProperty, value);\n  }\n\n  private _diffuseTexture: TextureCubeMap;\n  private _specularTexture: TextureCubeMap;\n  private _diffuseColor: Color = new Color(0.3, 0.3, 0.3, 1);\n  private _specularColor: Color = new Color(0.5, 0.5, 0.5, 1);\n  private _diffuseIntensity: number = 1;\n  private _specularIntensity: number = 1;\n\n  constructor(entity: Entity) {\n    super(entity);\n    this.diffuseColor = this._diffuseColor;\n    this.specularColor = this._specularColor;\n    this.diffuseIntensity = this._diffuseIntensity;\n    this.specularIntensity = this._specularIntensity;\n  }\n}\n","import { Color, Vector3 } from \"@oasis-engine/math\";\nimport { Shader } from \"../shader\";\nimport { ShaderData } from \"../shader/ShaderData\";\nimport { ShaderProperty } from \"../shader/ShaderProperty\";\nimport { Light } from \"./Light\";\n\n/**\n * Point light.\n */\nexport class PointLight extends Light {\n  private static _colorProperty: ShaderProperty = Shader.getPropertyByName(\"u_pointLightColor\");\n  private static _positionProperty: ShaderProperty = Shader.getPropertyByName(\"u_pointLightPosition\");\n  private static _distanceProperty: ShaderProperty = Shader.getPropertyByName(\"u_pointLightDistance\");\n  private static _decayProperty: ShaderProperty = Shader.getPropertyByName(\"u_pointLightDecay\");\n\n  private static _combinedData = {\n    color: new Float32Array(3 * Light._maxLight),\n    position: new Float32Array(3 * Light._maxLight),\n    distance: new Float32Array(Light._maxLight),\n    decay: new Float32Array(Light._maxLight)\n  };\n\n  /**\n   * @internal\n   */\n  static _updateShaderData(shaderData: ShaderData): void {\n    const data = PointLight._combinedData;\n\n    shaderData.setFloatArray(PointLight._colorProperty, data.color);\n    shaderData.setFloatArray(PointLight._positionProperty, data.position);\n    shaderData.setFloatArray(PointLight._distanceProperty, data.distance);\n    shaderData.setFloatArray(PointLight._decayProperty, data.decay);\n  }\n\n  color: Color = new Color(1, 1, 1, 1);\n  intensity: number = 1.0;\n  distance: number = 100;\n  decay: number = 0;\n\n  private _lightColor: Color = new Color(1, 1, 1, 1);\n\n  /**\n   * Get light position.\n   * @readonly\n   */\n  get position(): Vector3 {\n    return this.entity.transform.worldPosition;\n  }\n\n  /**\n   * Get the final light color.\n   * @readonly\n   */\n  get lightColor(): Color {\n    this._lightColor.r = this.color.r * this.intensity;\n    this._lightColor.g = this.color.g * this.intensity;\n    this._lightColor.b = this.color.b * this.intensity;\n    this._lightColor.a = this.color.a * this.intensity;\n    return this._lightColor;\n  }\n\n  /**\n   * @internal\n   */\n  _appendData(lightIndex: number): void {\n    const colorStart = lightIndex * 3;\n    const positionStart = lightIndex * 3;\n    const distanceStart = lightIndex;\n    const decayStart = lightIndex;\n\n    const lightColor = this.lightColor;\n    const lightPosition = this.position;\n\n    const data = PointLight._combinedData;\n\n    data.color[colorStart] = lightColor.r;\n    data.color[colorStart + 1] = lightColor.g;\n    data.color[colorStart + 2] = lightColor.b;\n    data.position[positionStart] = lightPosition.x;\n    data.position[positionStart + 1] = lightPosition.y;\n    data.position[positionStart + 2] = lightPosition.z;\n    data.distance[distanceStart] = this.distance;\n    data.decay[decayStart] = this.decay;\n  }\n}\n","import { Color, Vector3 } from \"@oasis-engine/math\";\nimport { Shader } from \"../shader\";\nimport { ShaderData } from \"../shader/ShaderData\";\nimport { ShaderProperty } from \"../shader/ShaderProperty\";\nimport { Light } from \"./Light\";\n\n/**\n * Spot light.\n */\nexport class SpotLight extends Light {\n  private static _colorProperty: ShaderProperty = Shader.getPropertyByName(\"u_spotLightColor\");\n  private static _positionProperty: ShaderProperty = Shader.getPropertyByName(\"u_spotLightPosition\");\n  private static _directionProperty: ShaderProperty = Shader.getPropertyByName(\"u_spotLightDirection\");\n  private static _distanceProperty: ShaderProperty = Shader.getPropertyByName(\"u_spotLightDistance\");\n  private static _decayProperty: ShaderProperty = Shader.getPropertyByName(\"u_spotLightDecay\");\n  private static _angleProperty: ShaderProperty = Shader.getPropertyByName(\"u_spotLightAngle\");\n  private static _penumbraProperty: ShaderProperty = Shader.getPropertyByName(\"u_spotLightPenumbra\");\n  private static _penumbraCosProperty: ShaderProperty = Shader.getPropertyByName(\"u_spotLightPenumbraCos\");\n  private static _coneCosProperty: ShaderProperty = Shader.getPropertyByName(\"u_spotLightConeCos\");\n\n  private static _combinedData = {\n    color: new Float32Array(3 * Light._maxLight),\n    position: new Float32Array(3 * Light._maxLight),\n    direction: new Float32Array(3 * Light._maxLight),\n    distance: new Float32Array(Light._maxLight),\n    decay: new Float32Array(Light._maxLight),\n    angle: new Float32Array(Light._maxLight),\n    penumbra: new Float32Array(Light._maxLight),\n    penumbraCos: new Float32Array(Light._maxLight),\n    coneCos: new Float32Array(Light._maxLight)\n  };\n\n  /**\n   * @internal\n   */\n  static _updateShaderData(shaderData: ShaderData): void {\n    const data = SpotLight._combinedData;\n\n    shaderData.setFloatArray(SpotLight._colorProperty, data.color);\n    shaderData.setFloatArray(SpotLight._positionProperty, data.position);\n    shaderData.setFloatArray(SpotLight._directionProperty, data.direction);\n    shaderData.setFloatArray(SpotLight._distanceProperty, data.distance);\n    shaderData.setFloatArray(SpotLight._decayProperty, data.decay);\n    shaderData.setFloatArray(SpotLight._angleProperty, data.angle);\n    shaderData.setFloatArray(SpotLight._penumbraProperty, data.penumbra);\n    shaderData.setFloatArray(SpotLight._penumbraCosProperty, data.penumbraCos);\n    shaderData.setFloatArray(SpotLight._coneCosProperty, data.coneCos);\n  }\n\n  color: Color = new Color(1, 1, 1, 1);\n  penumbra: number = 0.2;\n  distance: number = 100;\n  intensity: number = 1.0;\n  decay: number = 0;\n  angle: number = Math.PI / 6;\n\n  private _forward: Vector3 = new Vector3();\n  private _lightColor: Color = new Color(1, 1, 1, 1);\n  private _inverseDirection: Vector3 = new Vector3();\n\n  /**\n   * Get light position.\n   * @readonly\n   */\n  get position(): Vector3 {\n    return this.entity.transform.worldPosition;\n  }\n\n  /**\n   * Get light direction.\n   * @readonly\n   */\n  get direction(): Vector3 {\n    this.entity.transform.getWorldForward(this._forward);\n    return this._forward;\n  }\n\n  /**\n   * Get the opposite direction of the spotlight.\n   * @readonly\n   */\n  get reverseDirection(): Vector3 {\n    Vector3.scale(this.direction, -1, this._inverseDirection);\n    return this._inverseDirection;\n  }\n\n  /**\n   * Get the final light color.\n   * @readonly\n   */\n  get lightColor(): Color {\n    this._lightColor.r = this.color.r * this.intensity;\n    this._lightColor.g = this.color.g * this.intensity;\n    this._lightColor.b = this.color.b * this.intensity;\n    this._lightColor.a = this.color.a * this.intensity;\n    return this._lightColor;\n  }\n\n  /**\n   * @internal\n   */\n  _appendData(lightIndex: number): void {\n    const colorStart = lightIndex * 3;\n    const positionStart = lightIndex * 3;\n    const directionStart = lightIndex * 3;\n    const distanceStart = lightIndex;\n    const decayStart = lightIndex;\n    const angleStart = lightIndex;\n    const penumbraStart = lightIndex;\n    const penumbraCosStart = lightIndex;\n    const coneCosStart = lightIndex;\n\n    const color = this.lightColor;\n    const position = this.position;\n    const direction = this.direction;\n\n    const data = SpotLight._combinedData;\n\n    data.color[colorStart] = color.r;\n    data.color[colorStart + 1] = color.g;\n    data.color[colorStart + 2] = color.b;\n    data.position[positionStart] = position.x;\n    data.position[positionStart + 1] = position.y;\n    data.position[positionStart + 2] = position.z;\n    data.direction[directionStart] = direction.x;\n    data.direction[directionStart + 1] = direction.y;\n    data.direction[directionStart + 2] = direction.z;\n    data.distance[distanceStart] = this.distance;\n    data.decay[decayStart] = this.decay;\n    data.angle[angleStart] = this.angle;\n    data.penumbra[penumbraStart] = this.penumbra;\n    data.penumbraCos[penumbraCosStart] = Math.cos(this.angle * (1 - this.penumbra));\n    data.coneCos[coneCosStart] = Math.cos(this.angle);\n  }\n}\n","import { Logger } from \"../base/Logger\";\nimport { SceneFeature } from \"../SceneFeature\";\nimport { Shader } from \"../shader\";\nimport { ShaderData } from \"../shader/ShaderData\";\nimport { ShaderMacro } from \"../shader/ShaderMacro\";\nimport { AmbientLight } from \"./AmbientLight\";\nimport { DirectLight } from \"./DirectLight\";\nimport { EnvironmentMapLight } from \"./EnvironmentMapLight\";\nimport { Light } from \"./Light\";\nimport { PointLight } from \"./PointLight\";\nimport { SpotLight } from \"./SpotLight\";\n\n/**\n * Determine whether there are lights in the scene.\n * @returns Has light\n */\nexport function hasLight(): boolean {\n  return this.findFeature(LightFeature).visibleLights.length > 0;\n}\n\n/**\n * Light plug-in.\n */\nexport class LightFeature extends SceneFeature {\n  private static _ambientMacro: ShaderMacro = Shader.getMacroByName(\"O3_HAS_AMBIENT_LIGHT\");\n  private static _envMacro: ShaderMacro = Shader.getMacroByName(\"O3_HAS_ENVMAP_LIGHT\");\n\n  visibleLights: Light[];\n\n  constructor() {\n    super();\n    this.visibleLights = [];\n  }\n\n  /**\n   * Register a light object to the current scene.\n   * @param light\n   */\n  attachRenderLight(light: Light): void {\n    const index = this.visibleLights.indexOf(light);\n    if (index == -1) {\n      this.visibleLights.push(light);\n    } else {\n      Logger.warn(\"Light already attached.\");\n    }\n  }\n\n  /**\n   * Remove a light object from the current scene.\n   * @param light\n   */\n  detachRenderLight(light: Light): void {\n    const index = this.visibleLights.indexOf(light);\n    if (index != -1) {\n      this.visibleLights.splice(index, 1);\n    }\n  }\n\n  /**\n   * @internal\n   */\n  _updateShaderData(shaderData: ShaderData) {\n    /**\n     * ambientLight and envMapLight only use the last one in the scene\n     * */\n    let ambientLightCount = 0;\n    let envMapLightCount = 0;\n    let directLightCount = 0;\n    let pointLightCount = 0;\n    let spotLightCount = 0;\n\n    let lights = this.visibleLights;\n    for (let i = 0, len = lights.length; i < len; i++) {\n      const light = lights[i];\n      if (light instanceof AmbientLight) {\n        ambientLightCount++;\n      } else if (light instanceof EnvironmentMapLight) {\n        EnvironmentMapLight._updateShaderData(shaderData, light);\n        envMapLightCount++;\n      } else if (light instanceof DirectLight) {\n        light._appendData(directLightCount++);\n      } else if (light instanceof PointLight) {\n        light._appendData(pointLightCount++);\n      } else if (light instanceof SpotLight) {\n        light._appendData(spotLightCount++);\n      }\n    }\n\n    if (ambientLightCount) {\n      shaderData.enableMacro(LightFeature._ambientMacro);\n    } else {\n      shaderData.disableMacro(LightFeature._ambientMacro);\n    }\n\n    if (envMapLightCount) {\n      shaderData.enableMacro(LightFeature._envMacro);\n    } else {\n      shaderData.disableMacro(LightFeature._envMacro);\n    }\n\n    if (directLightCount) {\n      DirectLight._updateShaderData(shaderData);\n      shaderData.enableMacro(\"O3_DIRECT_LIGHT_COUNT\", directLightCount.toString());\n    } else {\n      shaderData.disableMacro(\"O3_DIRECT_LIGHT_COUNT\");\n    }\n\n    if (pointLightCount) {\n      PointLight._updateShaderData(shaderData);\n      shaderData.enableMacro(\"O3_POINT_LIGHT_COUNT\", pointLightCount.toString());\n    } else {\n      shaderData.disableMacro(\"O3_POINT_LIGHT_COUNT\");\n    }\n\n    if (spotLightCount) {\n      SpotLight._updateShaderData(shaderData);\n      shaderData.enableMacro(\"O3_SPOT_LIGHT_COUNT\", spotLightCount.toString());\n    } else {\n      shaderData.disableMacro(\"O3_SPOT_LIGHT_COUNT\");\n    }\n  }\n}\n","import { EngineObject } from \"../base/EngineObject\";\nimport { Engine } from \"../Engine\";\nimport { IRefObject } from \"./IRefObject\";\n\n/**\n * The base class of assets, with reference counting capability.\n */\nexport abstract class RefObject extends EngineObject implements IRefObject {\n  /** Whether to ignore the garbage collection check, if it is true, it will not be affected by ResourceManager.gc(). */\n  isGCIgnored: boolean = false;\n\n  private _refCount: number = 0;\n  private _destroyed: boolean = false;\n\n  /**\n   * Counted by valid references.\n   */\n  get refCount(): number {\n    return this._refCount;\n  }\n\n  /**\n   * Whether it has been destroyed.\n   */\n  get destroyed(): boolean {\n    return this._destroyed;\n  }\n\n  protected constructor(engine: Engine) {\n    super(engine);\n    engine.resourceManager._addRefObject(this.instanceId, this);\n  }\n\n  /**\n   * Destroy self.\n   * @param force - Whether to force the destruction, if it is fasle, refCount = 0 can be released successfully.\n   * @returns Whether the release was successful.\n   */\n  destroy(force: boolean = false): boolean {\n    if (this._destroyed) return true;\n    if (!force && this._refCount !== 0) return false;\n    const resourceManager = this._engine.resourceManager;\n    // resourceManager maybe null,because engine has destroyed.\n    // TODO:the right way to fix this is to ensure destroy all when call engine.destroy,thus don't need to add this project.\n    if (resourceManager) {\n      resourceManager._deleteAsset(this);\n      resourceManager._deleteRefObject(this.instanceId);\n    }\n\n    const refCount = this._getRefCount();\n    if (refCount > 0) {\n      this._addRefCount(-refCount);\n    }\n    this._engine = null;\n    this._onDestroy();\n    this._destroyed = true;\n    return true;\n  }\n\n  /**\n   * @internal\n   */\n  _getRefCount(): number {\n    return this._refCount;\n  }\n\n  /**\n   * @internal\n   * Add reference resource.\n   */\n  _addRefCount(value: number): void {\n    this._refCount += value;\n  }\n\n  /**\n   * @internal\n   * Remove reference resource.\n   */\n  _addToResourceManager(path: string): void {\n    this._engine.resourceManager._addAsset(path, this);\n  }\n\n  /**\n   * Called when the resource is destroyed.\n   * Subclasses can override this function.\n   */\n  protected abstract _onDestroy(): void;\n}\n","export interface TextureFormatDetail {\n  internalFormat: GLint;\n  baseFormat?: GLenum;\n  dataType?: GLenum;\n  isCompressed: boolean;\n  attachment?: GLenum;\n}\n\n/**\n * @deprecated\n */\nexport enum GLCompressedTextureInternalFormat {\n  // astc\n  RGBA_ASTC_4X4_KHR = 0x93b0,\n  RGBA_ASTC_5X4_KHR = 0x93b1,\n  RGBA_ASTC_5X5_KHR = 0x93b2,\n  RGBA_ASTC_6X5_KHR = 0x93b3,\n  RGBA_ASTC_6X6_KHR = 0x93b4,\n  RGBA_ASTC_8X5_KHR = 0x93b5,\n  RGBA_ASTC_8X6_KHR = 0x93b6,\n  RGBA_ASTC_8X8_KHR = 0x93b7,\n  RGBA_ASTC_10X5_KHR = 0x93b8,\n  RGBA_ASTC_10X6_KHR = 0x93b9,\n  RGBA_ASTC_10X8_KHR = 0x93ba,\n  RGBA_ASTC_10X10_KHR = 0x93bb,\n  RGBA_ASTC_12X10_KHR = 0x93bc,\n  RGBA_ASTC_12X12_KHR = 0x93bd,\n  SRGB8_ALPHA8_ASTC_4X4_KHR = 0x93d0,\n  SRGB8_ALPHA8_ASTC_5X4_KHR = 0x93d1,\n  SRGB8_ALPHA8_ASTC_5X5_KHR = 0x93d2,\n  SRGB8_ALPHA8_ASTC_6X5_KHR = 0x93d3,\n  SRGB8_ALPHA8_ASTC_6X6_KHR = 0x93d4,\n  SRGB8_ALPHA8_ASTC_8X5_KHR = 0x93d5,\n  SRGB8_ALPHA8_ASTC_8X6_KHR = 0x93d6,\n  SRGB8_ALPHA8_ASTC_8X8_KHR = 0x93d7,\n  SRGB8_ALPHA8_ASTC_10X5_KHR = 0x93d8,\n  SRGB8_ALPHA8_ASTC_10X6_KHR = 0x93d9,\n  SRGB8_ALPHA8_ASTC_10X8_KHR = 0x93da,\n  SRGB8_ALPHA8_ASTC_10X10_KHR = 0x93db,\n  SRGB8_ALPHA8_ASTC_12X10_KHR = 0x93dc,\n  SRGB8_ALPHA8_ASTC_12X12_KHR = 0x93dd,\n\n  // etc1\n  RGB_ETC1_WEBGL = 0x8d64,\n\n  // etc2\n  R11_EAC = 0x9270,\n  SIGNED_R11_EAC = 0x9271,\n  RG11_EAC = 0x9272,\n  SIGNED_RG11_EAC = 0x9273,\n  RGB8_ETC2 = 0x9274,\n  SRGB8_ETC2 = 0x9275,\n  RGB8_PUNCHTHROUGH_ALPHA1_ETC2 = 0x9276,\n  SRGB8_PUNCHTHROUGH_ALPHA1_ETC2 = 0x9277,\n  RGBA8_ETC2_EAC = 0x9278,\n  SRGB8_ALPHA8_ETC2_EAC = 0x9279,\n\n  // pvrtc\n  RGB_PVRTC_4BPPV1_IMG = 0x8c00,\n  RGB_PVRTC_2BPPV1_IMG = 0x8c01,\n  RGBA_PVRTC_4BPPV1_IMG = 0x8c02,\n  RGBA_PVRTC_2BPPV1_IMG = 0x8c03,\n\n  // s3tc\n  RGB_S3TC_DXT1_EXT = 0x83f0,\n  RGBA_S3TC_DXT1_EXT = 0x83f1,\n  RGBA_S3TC_DXT3_EXT = 0x83f2,\n  RGBA_S3TC_DXT5_EXT = 0x83f3\n}\n","/**\n * The rendering buffer color format enumeration.\n */\nexport enum RenderBufferColorFormat {\n  /** RGB format,8 bits per channel. */\n  R8G8B8,\n  /** RGBA format,8 bits per channel. */\n  R8G8B8A8,\n  /** RGBA format,4 bits per channel. */\n  R4G4B4A4,\n  /** RGBA format,5 bits in R cahnnel, 5 bits in G channel, 5 bits in B cahnnel, 1 bit in A channel. */\n  R5G5B5A1,\n  /** RGB format,5 bits in R cahnnel, 6 bits in G channel, 5 bits in B cahnnel. */\n  R5G6B5,\n  /** transparent format, 8 bits. */\n  Alpha8,\n  /** RGBA format,16 bits per channel. */\n  R16G16B16A16,\n  /** RGBA format,32 bits per channel. */\n  R32G32B32A32\n}\n","/**\n * Render buffer depth format enumeration.\n */\nexport enum RenderBufferDepthFormat {\n  /** Render to depth buffer,engine will automatically select the supported precision. */\n  Depth = 0,\n  /** Render to depth stencil buffer, engine will automatically select the supported precision. */\n  DepthStencil = 1,\n  /** Render to stencil buffer. */\n  Stencil = 2,\n\n  /** Force 16-bit depth buffer. */\n  Depth16 = 3,\n  /** Force 24-bit depth buffer. */\n  Depth24 = 4,\n  /** Force 32-bit depth buffer. */\n  Depth32 = 5,\n  /** Force 16-bit depth + 8-bit stencil buffer. */\n  Depth24Stencil8 = 6,\n  /** Force 32-bit depth + 8-bit stencil buffer. */\n  Depth32Stencil8 = 7\n}\n","/**\n * The filter mode of the texture.\n */\nexport enum TextureFilterMode {\n  /** Point filtering. */\n  Point = 0,\n  /** Bilinear fitering. */\n  Bilinear = 1,\n  /** Trilinear filtering. */\n  Trilinear = 2\n}\n","/**\n * Texture format enumeration.\n */\nexport enum TextureFormat {\n  /** RGB format,8 bits per channel. */\n  R8G8B8,\n  /** RGBA format,8 bits per channel. */\n  R8G8B8A8,\n  /** RGBA format,4 bits per channel. */\n  R4G4B4A4,\n  /** RGBA format,5 bits in R channel,5 bits in G channel,5 bits in B channel, 1 bit in A channel. */\n  R5G5B5A1,\n  /** RGB format,5 bits in R channel,6 bits in G channel,5 bits in B channel. */\n  R5G6B5,\n  /** Transparent format,8 bits. */\n  Alpha8,\n  /** RGBA format,32 bits per channel. */\n  R32G32B32A32,\n  /** RGB compressed formatã€‚*/\n  DXT1,\n  /** RGBA compressed formatã€‚*/\n  DXT5,\n  /** RGB compressed format,4 bits per pixelã€‚*/\n  ETC1_RGB,\n  /** RGB compressed format,4 bits per pixelã€‚*/\n  ETC2_RGB,\n  /** RGBA compressed format,5 bits per pixel,4 bit in RGB, 1 bit in A. */\n  ETC2_RGBA5,\n  /** RGB compressed format,8 bits per pixel. */\n  ETC2_RGBA8,\n  /** RGB compressed format,2 bits per pixel. */\n  PVRTC_RGB2,\n  /** RGBA compressed format,2 bits per pixel. */\n  PVRTC_RGBA2,\n  /** RGB compressed format,4 bits per pixel. */\n  PVRTC_RGB4,\n  /** RGBA compressed format,4 bits per pixel. */\n  PVRTC_RGBA4,\n  /** RGB(A) compressed format,128 bits per 4x4 pixel block. */\n  ASTC_4x4,\n  /** RGB(A) compressed format,128 bits per 5x5 pixel block. */\n  ASTC_5x5,\n  /** RGB(A) compressed format,128 bits per 6x6 pixel block. */\n  ASTC_6x6,\n  /** RGB(A) compressed format,128 bits per 8x8 pixel block. */\n  ASTC_8x8,\n  /** RGB(A) compressed format,128 bits per 10x10 pixel block. */\n  ASTC_10x10,\n  /** RGB(A) compressed format,128 bits per 12x12 pixel block. */\n  ASTC_12x12\n}\n","/**\n * Wrapping mode of the texture.\n */\nexport enum TextureWrapMode {\n  /** Clampping mode. use the color of edge pixels beyond the texture boundary. */\n  Clamp = 0,\n  /** Repeating mode. tiling will be repeated if it exceeds the texture boundary. */\n  Repeat = 1,\n  /** Mirror repeat mode. tiling will be mirrored and repeated if it exceeds the texture boundary. */\n  Mirror = 2\n}\n","import { RefObject } from \"../asset/RefObject\";\nimport { GLCapabilityType } from \"../base/Constant\";\nimport { Logger } from \"../base/Logger\";\nimport { HardwareRenderer } from \"../HardwareRenderer\";\nimport { GLCompressedTextureInternalFormat, TextureFormatDetail } from \"../material/type\";\nimport { RenderBufferColorFormat } from \"./enums/RenderBufferColorFormat\";\nimport { RenderBufferDepthFormat } from \"./enums/RenderBufferDepthFormat\";\nimport { TextureCubeFace } from \"./enums/TextureCubeFace\";\nimport { TextureFilterMode } from \"./enums/TextureFilterMode\";\nimport { TextureFormat } from \"./enums/TextureFormat\";\nimport { TextureWrapMode } from \"./enums/TextureWrapMode\";\n\n/**\n * The base class of texture, contains some common functions of texture-related classes.\n */\nexport abstract class Texture extends RefObject {\n  /** @internal */\n  static _readFrameBuffer: WebGLFramebuffer = null;\n\n  /** @internal */\n  static _isPowerOf2(v: number): boolean {\n    return (v & (v - 1)) === 0;\n  }\n\n  /**\n   * Get more texture info from TextureFormat.\n   * @internal\n   */\n  static _getFormatDetail(\n    format: TextureFormat,\n    gl: WebGLRenderingContext & WebGL2RenderingContext,\n    isWebGL2: boolean\n  ): TextureFormatDetail {\n    switch (format) {\n      case TextureFormat.R8G8B8:\n        return {\n          internalFormat: isWebGL2 ? gl.RGB8 : gl.RGB,\n          baseFormat: gl.RGB,\n          dataType: gl.UNSIGNED_BYTE,\n          isCompressed: false\n        };\n      case TextureFormat.R8G8B8A8:\n        return {\n          internalFormat: isWebGL2 ? gl.RGBA8 : gl.RGBA,\n          baseFormat: gl.RGBA,\n          dataType: gl.UNSIGNED_BYTE,\n          isCompressed: false\n        };\n      case TextureFormat.R4G4B4A4:\n        return {\n          internalFormat: isWebGL2 ? gl.RGBA4 : gl.RGBA,\n          baseFormat: gl.RGBA,\n          dataType: gl.UNSIGNED_SHORT_4_4_4_4,\n          isCompressed: false\n        };\n      case TextureFormat.R5G5B5A1:\n        return {\n          internalFormat: isWebGL2 ? gl.RGB5_A1 : gl.RGBA,\n          baseFormat: gl.RGBA,\n          dataType: gl.UNSIGNED_SHORT_5_5_5_1,\n          isCompressed: false\n        };\n      case TextureFormat.R5G6B5:\n        return {\n          internalFormat: isWebGL2 ? gl.RGB565 : gl.RGB,\n          baseFormat: gl.RGB,\n          dataType: gl.UNSIGNED_SHORT_5_6_5,\n          isCompressed: false\n        };\n      case TextureFormat.Alpha8:\n        return {\n          internalFormat: gl.ALPHA,\n          baseFormat: gl.ALPHA,\n          dataType: gl.UNSIGNED_BYTE,\n          isCompressed: false\n        };\n      case TextureFormat.R32G32B32A32:\n        return {\n          internalFormat: gl.RGBA32F,\n          baseFormat: gl.RGBA,\n          dataType: gl.FLOAT,\n          isCompressed: false\n        };\n      case TextureFormat.DXT1:\n        return {\n          internalFormat: GLCompressedTextureInternalFormat.RGB_S3TC_DXT1_EXT,\n          isCompressed: true\n        };\n      case TextureFormat.DXT5:\n        return {\n          internalFormat: GLCompressedTextureInternalFormat.RGBA_S3TC_DXT5_EXT,\n          isCompressed: true\n        };\n      case TextureFormat.ETC1_RGB:\n        return {\n          internalFormat: GLCompressedTextureInternalFormat.RGB_ETC1_WEBGL,\n          isCompressed: true\n        };\n      case TextureFormat.ETC2_RGB:\n        return {\n          internalFormat: GLCompressedTextureInternalFormat.RGB8_ETC2,\n          isCompressed: true\n        };\n      case TextureFormat.ETC2_RGBA5:\n        return {\n          internalFormat: GLCompressedTextureInternalFormat.RGB8_PUNCHTHROUGH_ALPHA1_ETC2,\n          isCompressed: true\n        };\n      case TextureFormat.ETC2_RGBA8:\n        return {\n          internalFormat: GLCompressedTextureInternalFormat.RGBA8_ETC2_EAC,\n          isCompressed: true\n        };\n      case TextureFormat.PVRTC_RGB2:\n        return {\n          internalFormat: GLCompressedTextureInternalFormat.RGB_PVRTC_2BPPV1_IMG,\n          isCompressed: true\n        };\n      case TextureFormat.PVRTC_RGBA2:\n        return {\n          internalFormat: GLCompressedTextureInternalFormat.RGBA_PVRTC_2BPPV1_IMG,\n          isCompressed: true\n        };\n      case TextureFormat.PVRTC_RGB4:\n        return {\n          internalFormat: GLCompressedTextureInternalFormat.RGB_PVRTC_4BPPV1_IMG,\n          isCompressed: true\n        };\n      case TextureFormat.PVRTC_RGBA4:\n        return {\n          internalFormat: GLCompressedTextureInternalFormat.RGBA_PVRTC_4BPPV1_IMG,\n          isCompressed: true\n        };\n      case TextureFormat.ASTC_4x4:\n        return {\n          internalFormat: GLCompressedTextureInternalFormat.RGBA_ASTC_4X4_KHR,\n          isCompressed: true\n        };\n      case TextureFormat.ASTC_5x5:\n        return {\n          internalFormat: GLCompressedTextureInternalFormat.RGBA_ASTC_5X5_KHR,\n          isCompressed: true\n        };\n      case TextureFormat.ASTC_6x6:\n        return {\n          internalFormat: GLCompressedTextureInternalFormat.RGBA_ASTC_6X6_KHR,\n          isCompressed: true\n        };\n      case TextureFormat.ASTC_8x8:\n        return {\n          internalFormat: GLCompressedTextureInternalFormat.RGBA_ASTC_8X8_KHR,\n          isCompressed: true\n        };\n      case TextureFormat.ASTC_10x10:\n        return {\n          internalFormat: GLCompressedTextureInternalFormat.RGBA_ASTC_10X10_KHR,\n          isCompressed: true\n        };\n      case TextureFormat.ASTC_12x12:\n        return {\n          internalFormat: GLCompressedTextureInternalFormat.RGBA_ASTC_12X12_KHR,\n          isCompressed: true\n        };\n      default:\n        throw new Error(`this TextureFormat is not supported in Oasis Engine: ${format}`);\n    }\n  }\n\n  /**\n   * @internal\n   */\n  static _getRenderBufferColorFormatDetail(\n    format: RenderBufferColorFormat,\n    gl: WebGLRenderingContext & WebGL2RenderingContext,\n    isWebGL2: boolean\n  ): TextureFormatDetail {\n    switch (format) {\n      case RenderBufferColorFormat.R8G8B8:\n        return {\n          internalFormat: isWebGL2 ? gl.RGB8 : gl.RGB,\n          baseFormat: gl.RGB,\n          dataType: gl.UNSIGNED_BYTE,\n          isCompressed: false\n        };\n      case RenderBufferColorFormat.R8G8B8A8:\n        return {\n          internalFormat: isWebGL2 ? gl.RGBA8 : gl.RGBA,\n          baseFormat: gl.RGBA,\n          dataType: gl.UNSIGNED_BYTE,\n          isCompressed: false\n        };\n      case RenderBufferColorFormat.R4G4B4A4:\n        return {\n          internalFormat: isWebGL2 ? gl.RGBA4 : gl.RGBA,\n          baseFormat: gl.RGBA,\n          dataType: gl.UNSIGNED_SHORT_4_4_4_4,\n          isCompressed: false\n        };\n      case RenderBufferColorFormat.R5G5B5A1:\n        return {\n          internalFormat: isWebGL2 ? gl.RGB5_A1 : gl.RGBA,\n          baseFormat: gl.RGBA,\n          dataType: gl.UNSIGNED_SHORT_5_5_5_1,\n          isCompressed: false\n        };\n      case RenderBufferColorFormat.R5G6B5:\n        return {\n          internalFormat: isWebGL2 ? gl.RGB565 : gl.RGB,\n          baseFormat: gl.RGB,\n          dataType: gl.UNSIGNED_SHORT_5_6_5,\n          isCompressed: false\n        };\n      case RenderBufferColorFormat.Alpha8:\n        return {\n          internalFormat: gl.ALPHA,\n          baseFormat: gl.ALPHA,\n          dataType: gl.UNSIGNED_BYTE,\n          isCompressed: false\n        };\n      case RenderBufferColorFormat.R16G16B16A16:\n        return {\n          internalFormat: gl.RGBA16F,\n          baseFormat: gl.RGBA,\n          dataType: gl.HALF_FLOAT,\n          isCompressed: false\n        };\n      case RenderBufferColorFormat.R32G32B32A32:\n        return {\n          internalFormat: gl.RGBA32F,\n          baseFormat: gl.RGBA,\n          dataType: gl.FLOAT,\n          isCompressed: false\n        };\n      default:\n        throw new Error(`this RenderBufferColorFormat is not supported in Oasis Engine: ${format}`);\n    }\n  }\n\n  /**\n   * @internal\n   * @remarks In WebGL 1, internalformat must be the same as baseFormat when call texImage2D.\n   */\n  static _getRenderBufferDepthFormatDetail(\n    format: RenderBufferDepthFormat,\n    gl: WebGLRenderingContext & WebGL2RenderingContext,\n    isWebGL2: boolean\n  ): TextureFormatDetail {\n    switch (format) {\n      case RenderBufferDepthFormat.Depth:\n        return {\n          internalFormat: isWebGL2 ? gl.DEPTH_COMPONENT32F : gl.DEPTH_COMPONENT16,\n          baseFormat: gl.DEPTH_COMPONENT,\n          dataType: isWebGL2 ? gl.FLOAT : gl.UNSIGNED_INT,\n          isCompressed: false,\n          attachment: gl.DEPTH_ATTACHMENT\n        };\n      case RenderBufferDepthFormat.DepthStencil:\n        return {\n          internalFormat: isWebGL2 ? gl.DEPTH24_STENCIL8 : gl.DEPTH_STENCIL,\n          baseFormat: gl.DEPTH_STENCIL,\n          dataType: gl.UNSIGNED_INT_24_8,\n          isCompressed: false,\n          attachment: gl.DEPTH_STENCIL_ATTACHMENT\n        };\n      case RenderBufferDepthFormat.Stencil:\n        return {\n          internalFormat: gl.STENCIL_INDEX8,\n          baseFormat: gl.STENCIL_ATTACHMENT,\n          dataType: gl.UNSIGNED_BYTE,\n          isCompressed: false,\n          attachment: gl.STENCIL_ATTACHMENT\n        };\n      case RenderBufferDepthFormat.Depth16:\n        return {\n          internalFormat: isWebGL2 ? gl.DEPTH_COMPONENT16 : gl.DEPTH_COMPONENT16,\n          baseFormat: gl.DEPTH_COMPONENT,\n          dataType: gl.UNSIGNED_INT,\n          isCompressed: false,\n          attachment: gl.DEPTH_ATTACHMENT\n        };\n      case RenderBufferDepthFormat.Depth24:\n        return {\n          internalFormat: gl.DEPTH_COMPONENT24,\n          baseFormat: gl.DEPTH_COMPONENT,\n          dataType: gl.UNSIGNED_INT,\n          isCompressed: false,\n          attachment: gl.DEPTH_ATTACHMENT\n        };\n      case RenderBufferDepthFormat.Depth32:\n        return {\n          internalFormat: gl.DEPTH_COMPONENT32F,\n          baseFormat: gl.DEPTH_COMPONENT,\n          dataType: gl.FLOAT,\n          isCompressed: false,\n          attachment: gl.DEPTH_ATTACHMENT\n        };\n      case RenderBufferDepthFormat.Depth24Stencil8:\n        return {\n          internalFormat: isWebGL2 ? gl.DEPTH24_STENCIL8 : gl.DEPTH_STENCIL,\n          baseFormat: gl.DEPTH_STENCIL,\n          dataType: gl.UNSIGNED_INT_24_8,\n          isCompressed: false,\n          attachment: gl.DEPTH_STENCIL_ATTACHMENT\n        };\n      case RenderBufferDepthFormat.Depth32Stencil8:\n        return {\n          internalFormat: gl.DEPTH32F_STENCIL8,\n          baseFormat: gl.DEPTH_STENCIL,\n          dataType: gl.FLOAT_32_UNSIGNED_INT_24_8_REV,\n          isCompressed: false,\n          attachment: gl.DEPTH_STENCIL_ATTACHMENT\n        };\n      default:\n        throw new Error(`this RenderBufferDepthFormat is not supported in Oasis Engine: ${format}`);\n    }\n  }\n\n  /**\n   * Check whether the corresponding texture format is supported.\n   * @internal\n   */\n  static _supportTextureFormat(format: TextureFormat, rhi): boolean {\n    let isSupported = true;\n\n    switch (format) {\n      case TextureFormat.R32G32B32A32:\n        {\n          if (!rhi.canIUse(GLCapabilityType.textureFloat)) {\n            isSupported = false;\n          }\n        }\n        break;\n    }\n\n    return isSupported;\n  }\n\n  /**\n   * @internal\n   */\n  static _supportRenderBufferColorFormat(format: RenderBufferColorFormat, rhi): boolean {\n    let isSupported = true;\n\n    switch (format) {\n      case RenderBufferColorFormat.R32G32B32A32:\n        {\n          if (!rhi.canIUse(GLCapabilityType.colorBufferFloat) || !rhi.canIUse(GLCapabilityType.textureFloat)) {\n            isSupported = false;\n          }\n        }\n        break;\n      case RenderBufferColorFormat.R16G16B16A16:\n        {\n          if (!rhi.canIUse(GLCapabilityType.colorBufferHalfFloat) || !rhi.canIUse(GLCapabilityType.textureHalfFloat)) {\n            isSupported = false;\n          }\n        }\n        break;\n    }\n\n    return isSupported;\n  }\n\n  /**\n   * @internal\n   */\n  static _supportRenderBufferDepthFormat(format: RenderBufferDepthFormat, rhi, isTexture: boolean): boolean {\n    const isWebGL2: boolean = rhi.isWebGL2;\n    let isSupported = true;\n\n    if (isTexture && !rhi.canIUse(GLCapabilityType.depthTexture)) {\n      return false;\n    }\n\n    switch (format) {\n      case RenderBufferDepthFormat.Stencil:\n        {\n          isSupported = false;\n        }\n        break;\n      case RenderBufferDepthFormat.Depth24:\n      case RenderBufferDepthFormat.Depth32:\n      case RenderBufferDepthFormat.Depth32Stencil8:\n        {\n          if (!isWebGL2) {\n            isSupported = false;\n          }\n        }\n        break;\n    }\n\n    return isSupported;\n  }\n\n  name: string;\n\n  _glTexture: WebGLTexture;\n  /** @internal */\n  _target: GLenum;\n  /** @internal */\n  _formatDetail: TextureFormatDetail;\n\n  protected _width: number;\n  protected _height: number;\n\n  /** @internal */\n  protected _rhi: HardwareRenderer;\n  /** @internal */\n  protected _mipmap: boolean;\n  /** @internal */\n  protected _mipmapCount: number;\n\n  private _wrapModeU: TextureWrapMode;\n  private _wrapModeV: TextureWrapMode;\n  private _filterMode: TextureFilterMode;\n  private _anisoLevel: number = 1;\n\n  /**\n   * The width of the texture.\n   */\n  get width(): number {\n    return this._width;\n  }\n\n  /**\n   * The height of the texture.\n   */\n  get height(): number {\n    return this._height;\n  }\n\n  /**\n   * Wrapping mode for texture coordinate S.\n   */\n  get wrapModeU(): TextureWrapMode {\n    return this._wrapModeU;\n  }\n\n  set wrapModeU(value: TextureWrapMode) {\n    if (value === this._wrapModeU) return;\n\n    const gl: WebGLRenderingContext & WebGL2RenderingContext = this._rhi.gl;\n\n    this._wrapModeU = value;\n\n    this._bind();\n    this._setWrapMode(value, gl.TEXTURE_WRAP_S);\n    this._unbind();\n  }\n\n  /**\n   * Wrapping mode for texture coordinate T.\n   */\n  get wrapModeV(): TextureWrapMode {\n    return this._wrapModeV;\n  }\n\n  set wrapModeV(value: TextureWrapMode) {\n    if (value === this._wrapModeV) return;\n\n    const gl: WebGLRenderingContext & WebGL2RenderingContext = this._rhi.gl;\n\n    this._wrapModeV = value;\n\n    this._bind();\n    this._setWrapMode(value, gl.TEXTURE_WRAP_T);\n    this._unbind();\n  }\n\n  /**\n   * Texture mipmapping count.\n   */\n  get mipmapCount(): number {\n    return this._mipmapCount;\n  }\n\n  /**\n   * Filter mode for texture.\n   */\n  get filterMode(): TextureFilterMode {\n    return this._filterMode;\n  }\n\n  set filterMode(value: TextureFilterMode) {\n    if (value === this._filterMode) return;\n\n    const gl: WebGLRenderingContext & WebGL2RenderingContext = this._rhi.gl;\n\n    this._filterMode = value;\n\n    this._bind();\n    switch (value) {\n      case TextureFilterMode.Point:\n        gl.texParameteri(this._target, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n        gl.texParameteri(this._target, gl.TEXTURE_MIN_FILTER, this._mipmap ? gl.NEAREST_MIPMAP_NEAREST : gl.NEAREST);\n        break;\n      case TextureFilterMode.Bilinear:\n        gl.texParameteri(this._target, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        gl.texParameteri(this._target, gl.TEXTURE_MIN_FILTER, this._mipmap ? gl.LINEAR_MIPMAP_NEAREST : gl.LINEAR);\n        break;\n      case TextureFilterMode.Trilinear:\n        gl.texParameteri(this._target, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        gl.texParameteri(this._target, gl.TEXTURE_MIN_FILTER, this._mipmap ? gl.LINEAR_MIPMAP_LINEAR : gl.LINEAR);\n        break;\n    }\n    this._unbind();\n  }\n\n  /**\n   * Anisotropic level for texture.\n   */\n  get anisoLevel(): number {\n    return this._anisoLevel;\n  }\n\n  set anisoLevel(value: number) {\n    const max = this._rhi.capability.maxAnisoLevel;\n\n    if (value > max) {\n      Logger.warn(`anisoLevel:${value}, exceeds the limit and is automatically downgraded to:${max}`);\n      value = max;\n    }\n\n    if (value < 1) {\n      Logger.warn(`anisoLevel:${value}, must be greater than 0, and is automatically downgraded to 1`);\n      value = 1;\n    }\n\n    if (value === this._anisoLevel) return;\n\n    const gl: WebGLRenderingContext & WebGL2RenderingContext & EXT_texture_filter_anisotropic = this._rhi.gl;\n\n    this._anisoLevel = value;\n\n    this._bind();\n    gl.texParameterf(this._target, gl.TEXTURE_MAX_ANISOTROPY_EXT, value);\n    this._unbind();\n  }\n\n  /**\n   * Generate multi-level textures based on the 0th level data.\n   */\n  public generateMipmaps(): void {\n    if (!this._mipmap) return;\n\n    const gl: WebGLRenderingContext & WebGL2RenderingContext = this._rhi.gl;\n\n    this._bind();\n    gl.generateMipmap(this._target);\n    this._unbind();\n  }\n\n  /**\n   * @override\n   */\n  _onDestroy() {\n    const gl: WebGLRenderingContext & WebGL2RenderingContext = this._rhi.gl;\n    gl.deleteTexture(this._glTexture);\n    this._glTexture = null;\n    this._formatDetail = null;\n    // TODO: delete\n    this._rhi = null;\n  }\n\n  /** @internal */\n  _bind(): void {\n    this._rhi.bindTexture(this._target, this._glTexture);\n  }\n\n  /** @internal */\n  _unbind(): void {\n    this._rhi.bindTexture(this._target, null);\n  }\n\n  /**\n   * Get the pixel color buffer according to the specified area.\n   * @internal\n   * @param face - If it is a cube texture, you can choose which surface to read\n   * @param x - X coordinate of area start\n   * @param y - Y coordinate of area start\n   * @param width - Area width\n   * @param height - Area height\n   * @param out - Color buffer\n   */\n  protected _getPixelBuffer(\n    face: TextureCubeFace | null,\n    x: number,\n    y: number,\n    width: number,\n    height: number,\n    out: ArrayBufferView\n  ): void {\n    const gl: WebGLRenderingContext & WebGL2RenderingContext = this._rhi.gl;\n    const { baseFormat, dataType } = this._formatDetail;\n\n    if (!Texture._readFrameBuffer) {\n      Texture._readFrameBuffer = gl.createFramebuffer();\n    }\n\n    gl.bindFramebuffer(gl.FRAMEBUFFER, Texture._readFrameBuffer);\n\n    if (face != null) {\n      gl.framebufferTexture2D(\n        gl.FRAMEBUFFER,\n        gl.COLOR_ATTACHMENT0,\n        gl.TEXTURE_CUBE_MAP_POSITIVE_X + face,\n        this._glTexture,\n        0\n      );\n    } else {\n      gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this._glTexture, 0);\n    }\n    gl.readPixels(x, y, width, height, baseFormat, dataType, out);\n\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n  }\n\n  /**\n   * Pre-development mipmapping GPU memory.\n   * @internal\n   */\n  protected _initMipmap(isCube: boolean): void {\n    const gl: WebGLRenderingContext & WebGL2RenderingContext = this._rhi.gl;\n    const isWebGL2 = this._rhi.isWebGL2;\n    let { internalFormat, baseFormat, dataType } = this._formatDetail;\n\n    this._bind();\n\n    if (isWebGL2) {\n      gl.texStorage2D(this._target, this._mipmapCount, internalFormat, this._width, this._height);\n    } else {\n      // In WebGL 1, internalformat must be the same as baseFormat\n      if (baseFormat !== internalFormat) {\n        internalFormat = baseFormat;\n      }\n\n      if (!isCube) {\n        for (let i = 0; i < this._mipmapCount; i++) {\n          const width = Math.max(1, this._width >> i);\n          const height = Math.max(1, this._height >> i);\n\n          gl.texImage2D(this._target, i, internalFormat, width, height, 0, baseFormat, dataType, null);\n        }\n      } else {\n        for (let i = 0; i < this._mipmapCount; i++) {\n          const size = Math.max(1, this._width >> i);\n          for (let faceIndex = 0; faceIndex < 6; faceIndex++) {\n            gl.texImage2D(\n              gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex,\n              i,\n              internalFormat,\n              size,\n              size,\n              0,\n              baseFormat,\n              dataType,\n              null\n            );\n          }\n        }\n      }\n    }\n\n    this._unbind();\n  }\n\n  /**\n   * Get the maximum mip level of the corresponding size:rounding down\n   * @remarks http://download.nvidia.com/developer/Papers/2005/NP2_Mipmapping/NP2_Mipmap_Creation.pdf\n   * @internal\n   */\n  protected _getMaxMiplevel(size: number): number {\n    return Math.floor(Math.log2(size));\n  }\n\n  /**\n   * @internal\n   */\n  protected _getMipmapCount(): number {\n    return this._mipmap ? Math.floor(Math.log2(Math.max(this._width, this._height))) + 1 : 1;\n  }\n\n  /**\n   * @internal\n   */\n  private _setWrapMode(value: TextureWrapMode, pname: GLenum): void {\n    const gl: WebGLRenderingContext & WebGL2RenderingContext = this._rhi.gl;\n    const isWebGL2: boolean = this._rhi.isWebGL2;\n\n    if (\n      !isWebGL2 &&\n      value !== TextureWrapMode.Clamp &&\n      (!Texture._isPowerOf2(this._width) || !Texture._isPowerOf2(this._height))\n    ) {\n      Logger.warn(\n        \"non-power-2 texture is not supported for REPEAT or MIRRORED_REPEAT in WebGL1,and has automatically downgraded to CLAMP_TO_EDGE\"\n      );\n      value = TextureWrapMode.Clamp;\n    }\n\n    switch (value) {\n      case TextureWrapMode.Clamp:\n        gl.texParameteri(this._target, pname, gl.CLAMP_TO_EDGE);\n        break;\n      case TextureWrapMode.Repeat:\n        gl.texParameteri(this._target, pname, gl.REPEAT);\n        break;\n      case TextureWrapMode.Mirror:\n        gl.texParameteri(this._target, pname, gl.MIRRORED_REPEAT);\n        break;\n    }\n  }\n}\n","import { IClone } from \"@oasis-engine/design\";\nimport { Color, Matrix, Vector2, Vector3, Vector4 } from \"@oasis-engine/math\";\nimport { IRefObject } from \"../asset/IRefObject\";\nimport { CloneManager } from \"../clone/CloneManager\";\nimport { Texture } from \"../texture/Texture\";\nimport { ShaderDataGroup } from \"./enums/ShaderDataGroup\";\nimport { Shader } from \"./Shader\";\nimport { ShaderMacro } from \"./ShaderMacro\";\nimport { ShaderMacroCollection } from \"./ShaderMacroCollection\";\nimport { ShaderProperty } from \"./ShaderProperty\";\n\nexport type ShaderPropertyValueType =\n  | number\n  | Vector2\n  | Vector3\n  | Vector4\n  | Color\n  | Matrix\n  | Texture\n  | Texture[]\n  | Int32Array\n  | Float32Array;\n\n/**\n * Shader data collection,Correspondence includes shader properties data and macros data.\n */\nexport class ShaderData implements IRefObject, IClone {\n  /** @internal */\n  _group: ShaderDataGroup;\n  /** @internal */\n  _properties: Record<number, ShaderPropertyValueType> = Object.create(null);\n  /** @internal */\n  _macroCollection: ShaderMacroCollection = new ShaderMacroCollection();\n\n  private _variableMacros: Record<string, string> = Object.create(null);\n  private _refCount: number = 0;\n\n  /**\n   * @internal\n   */\n  constructor(group: ShaderDataGroup) {\n    this._group = group;\n  }\n\n  /**\n   * Get float by shader property name.\n   * @param propertyName - Shader property name\n   * @returns Float\n   */\n  getFloat(propertyName: string): number;\n\n  /**\n   * Get float by shader property.\n   * @param property - Shader property\n   * @returns Float\n   */\n  getFloat(property: ShaderProperty): number;\n\n  getFloat(property: string | ShaderProperty): number {\n    return this._getData(property);\n  }\n\n  /**\n   * Set float by shader property name.\n   * @remarks Corresponding float shader property type.\n   * @param propertyName - Shader property name\n   * @param value - Float\n   */\n  setFloat(propertyName: string, value: number): void;\n\n  /**\n   * Set float by shader property.\n   * @remarks Corresponding float shader property type.\n   * @param property - Shader property\n   * @param value - Float\n   */\n  setFloat(property: ShaderProperty, value: number): void;\n\n  setFloat(property: string | ShaderProperty, value: number): void {\n    this._setData(property, value);\n  }\n\n  /**\n   * Get int by shader property name.\n   * @param propertyName - Shader property name\n   * @returns Int\n   */\n  getInt(propertyName: string): number;\n\n  /**\n   * Get int by shader property.\n   * @param property - Shader property\n   * @returns Int\n   */\n  getInt(property: ShaderProperty): number;\n\n  getInt(property: string | ShaderProperty): number {\n    return this._getData(property);\n  }\n\n  /**\n   * Set int by shader property name.\n   * @remarks Correspondence includes int and bool shader property type.\n   * @param propertyName - Shader property name\n   * @param value - Int\n   */\n  setInt(propertyName: string, value: number): void;\n\n  /**\n   * Set int by shader property.\n   * @remarks Correspondence includes int and bool shader property type.\n   * @param property - Shader property\n   * @param value - Int\n   */\n  setInt(property: ShaderProperty, value: number): void;\n\n  setInt(property: string | ShaderProperty, value: number): void {\n    this._setData(property, value);\n  }\n\n  /**\n   * Get float array by shader property name.\n   * @param propertyName - Shader property name\n   * @returns Float array\n   */\n  getFloatArray(propertyName: string): Float32Array;\n\n  /**\n   * Get float array by shader property.\n   * @param property - Shader property\n   * @returns Float array\n   */\n  getFloatArray(property: ShaderProperty): Float32Array;\n\n  getFloatArray(property: string | ShaderProperty): Float32Array {\n    return this._getData(property);\n  }\n\n  /**\n   * Set float array by shader property name.\n   * @remarks Correspondence includes float arrayã€vec2 arrayã€vec3 arrayã€vec4 array and matrix array shader property type.\n   * @param propertyName - Shader property name\n   * @param value - Float array\n   */\n  setFloatArray(propertyName: string, value: Float32Array): void;\n\n  /**\n   * Set float array by shader property.\n   * @remarks Correspondence includes float arrayã€vec2 arrayã€vec3 arrayã€vec4 array and matrix array shader property type.\n   * @param property - Shader property\n   * @param value - Float array\n   */\n  setFloatArray(property: ShaderProperty, value: Float32Array): void;\n\n  setFloatArray(property: string | ShaderProperty, value: Float32Array): void {\n    this._setData(property, value);\n  }\n\n  /**\n   * Get int array by shader property name.\n   * @param propertyName - Shader property name\n   * @returns Int Array\n   */\n  getIntArray(propertyName: string): Int32Array;\n\n  /**\n   * Get int array by shader property.\n   * @param property - Shader property\n   * @returns Int Array\n   */\n  getIntArray(property: ShaderProperty): Int32Array;\n\n  getIntArray(property: string | ShaderProperty): Int32Array {\n    return this._getData(property);\n  }\n\n  /**\n   * Set int array by shader property name.\n   * @remarks Correspondence includes bool arrayã€int arrayã€bvec2 arrayã€bvec3 arrayã€bvec4 arrayã€ivec2 arrayã€ivec3 array and ivec4 array shader property type.\n   * @param propertyName - Shader property name\n   * @param value - Int Array\n   */\n  setIntArray(propertyName: string, value: Int32Array): void;\n\n  /**\n   * Set int array by shader property.\n   * @remarks Correspondence includes bool arrayã€int arrayã€bvec2 arrayã€bvec3 arrayã€bvec4 arrayã€ivec2 arrayã€ivec3 array and ivec4 array shader property type.\n   * @param property - Shader property\n   * @param value - Int Array\n   */\n  setIntArray(property: ShaderProperty, value: Int32Array): void;\n\n  setIntArray(property: string | ShaderProperty, value: Int32Array): void {\n    this._setData(property, value);\n  }\n\n  /**\n   * Get two-dimensional from shader property name.\n   * @param propertyName - Shader property name\n   * @returns Two-dimensional vector\n   */\n  getVector2(propertyName: string): Vector2;\n\n  /**\n   * Get two-dimensional from shader property.\n   * @param property - Shader property\n   * @returns Two-dimensional vector\n   */\n  getVector2(property: ShaderProperty): Vector2;\n\n  getVector2(property: string | ShaderProperty): Vector2 {\n    return this._getData(property);\n  }\n\n  /**\n   * Set two-dimensional vector from shader property name.\n   * @remarks Correspondence includes vec2ã€ivec2 and bvec2 shader property type.\n   * @param propertyName - Shader property name\n   * @param value - Two-dimensional vector\n   */\n  setVector2(property: string, value: Vector2): void;\n\n  /**\n   * Set two-dimensional vector from shader property.\n   * @remarks Correspondence includes vec2ã€ivec2 and bvec2 shader property type.\n   * @param property - Shader property\n   * @param value - Two-dimensional vector\n   */\n  setVector2(property: ShaderProperty, value: Vector2): void;\n\n  setVector2(property: string | ShaderProperty, value: Vector2): void {\n    this._setData(property, value);\n  }\n\n  /**\n   * Get vector3 by shader property name.\n   * @param propertyName - Shader property name\n   * @returns Three-dimensional vector\n   */\n  getVector3(propertyName: string): Vector3;\n\n  /**\n   * Get vector3 by shader property.\n   * @param property - Shader property\n   * @returns Three-dimensional vector\n   */\n  getVector3(property: ShaderProperty): Vector3;\n\n  getVector3(property: string | ShaderProperty): Vector3 {\n    return this._getData(property);\n  }\n\n  /**\n   * Set three dimensional vector by shader property name.\n   * @remarks Correspondence includes vec3ã€ivec3 and bvec3 shader property type.\n   * @param propertyName - Shader property name\n   * @param value - Three-dimensional vector\n   */\n  setVector3(property: string, value: Vector3): void;\n\n  /**\n   * Set three dimensional vector by shader property.\n   * @remarks Correspondence includes vec3ã€ivec3 and bvec3 shader property type.\n   * @param property - Shader property\n   * @param value - Three-dimensional vector\n   */\n  setVector3(property: ShaderProperty, value: Vector3): void;\n\n  setVector3(property: string | ShaderProperty, value: Vector3): void {\n    this._setData(property, value);\n  }\n\n  /**\n   * Get vector4 by shader property name.\n   * @param propertyName - Shader property name\n   * @returns Four-dimensional vector\n   */\n  getVector4(propertyName: string): Vector4;\n\n  /**\n   * Get vector4 by shader property.\n   * @param property - Shader property\n   * @returns Four-dimensional vector\n   */\n  getVector4(property: ShaderProperty): Vector4;\n\n  getVector4(property: string | ShaderProperty): Vector4 {\n    return this._getData(property);\n  }\n\n  /**\n   * Set four-dimensional vector by shader property name.\n   * @remarks Correspondence includes vec4ã€ivec4 and bvec4 shader property type.\n   * @param propertyName - Shader property name\n   * @param value - Four-dimensional vector\n   */\n  setVector4(property: string, value: Vector4): void;\n\n  /**\n   * Set four-dimensional vector by shader property.\n   * @remarks Correspondence includes vec4ã€ivec4 and bvec4 shader property type.\n   * @param property - Shader property\n   * @param value - Four-dimensional vector\n   */\n  setVector4(property: ShaderProperty, value: Vector4): void;\n\n  setVector4(property: string | ShaderProperty, value: Vector4): void {\n    this._setData(property, value);\n  }\n\n  /**\n   * Get matrix by shader property name.\n   * @param propertyName - Shader property name\n   * @returns Matrix\n   */\n  getMatrix(propertyName: string): Matrix;\n\n  /**\n   * Get matrix by shader property.\n   * @param property - Shader property\n   * @returns Matrix\n   */\n  getMatrix(property: ShaderProperty): Matrix;\n\n  getMatrix(property: string | ShaderProperty): Matrix {\n    return this._getData(property);\n  }\n\n  /**\n   * Set matrix by shader property name.\n   * @remarks Correspondence includes matrix shader property type.\n   * @param propertyName - Shader property name\n   * @param value - Matrix\n   */\n  setMatrix(propertyName: string, value: Matrix);\n\n  /**\n   * Set matrix by shader property.\n   * @remarks Correspondence includes matrix shader property type.\n   * @param property - Shader property\n   * @param value - Matrix\n   */\n  setMatrix(property: ShaderProperty, value: Matrix);\n\n  setMatrix(property: string | ShaderProperty, value: Matrix): void {\n    this._setData(property, value);\n  }\n\n  /**\n   * Get color by shader property name.\n   * @param propertyName - Shader property name\n   * @returns Color\n   */\n  getColor(propertyName: string): Color;\n\n  /**\n   * Get color by shader property.\n   * @param property - Shader property\n   * @returns Color\n   */\n  getColor(property: ShaderProperty): Color;\n\n  getColor(property: string | ShaderProperty): Color {\n    return this._getData(property);\n  }\n\n  /**\n   * Set color by shader property name.\n   * @remarks Correspondence includes vec4 shader property type.\n   * @param propertyName - Shader property name\n   * @param value - Color\n   */\n  setColor(propertyName: string, value: Color): void;\n\n  /**\n   * Set color by shader property.\n   * @remarks Correspondence includes vec4 shader property type.\n   * @param property - Shader property\n   * @param value - Color\n   */\n  setColor(property: ShaderProperty, value: Color): void;\n\n  setColor(property: string | ShaderProperty, value: Color): void {\n    this._setData(property, value);\n  }\n\n  /**\n   * Get texture by shader property name.\n   * @param propertyName - Shader property name\n   * @returns Texture\n   */\n  getTexture(propertyName: string): Texture;\n\n  /**\n   * Get texture by shader property.\n   * @param property - Shader property\n   * @returns Texture\n   */\n  getTexture(property: ShaderProperty): Texture;\n\n  getTexture(property: string | ShaderProperty): Texture {\n    return this._getData(property);\n  }\n\n  /**\n   * Set texture by shader property name.\n   * @param propertyName - Shader property name\n   * @param value - Texture\n   */\n  setTexture(propertyName: string, value: Texture): void;\n\n  /**\n   * Set texture by shader property.\n   * @param property - Shader property\n   * @param value - Texture\n   */\n  setTexture(property: ShaderProperty, value: Texture): void;\n\n  setTexture(property: string | ShaderProperty, value: Texture): void {\n    if (this._getRefCount() > 0) {\n      const lastValue = this._getData<Texture>(property);\n      lastValue && lastValue._addRefCount(-1);\n      value && value._addRefCount(1);\n    }\n    this._setData(property, value);\n  }\n\n  /**\n   * Get texture array by shader property name.\n   * @param propertyName - Shader property name\n   * @returns Texture array\n   */\n  getTextureArray(propertyName: string): Texture[];\n\n  /**\n   * Get texture array by shader property.\n   * @param property - Shader property\n   * @returns Texture array\n   */\n  getTextureArray(property: ShaderProperty): Texture[];\n\n  getTextureArray(property: string | ShaderProperty): Texture[] {\n    return this._getData(property);\n  }\n\n  /**\n   * Set texture array by shader property name.\n   * @param propertyName - Shader property name\n   * @param value - Texture array\n   */\n  setTextureArray(propertyName: string, value: Texture[]): void;\n\n  /**\n   * Set texture array by shader property.\n   * @param property - Shader property\n   * @param value - Texture array\n   */\n  setTextureArray(property: ShaderProperty, value: Texture[]): void;\n\n  setTextureArray(property: string | ShaderProperty, value: Texture[]): void {\n    if (this._getRefCount() > 0) {\n      const lastValue = this._getData<Texture[]>(property);\n      if (lastValue) {\n        for (let i = 0, n = lastValue.length; i < n; i++) {\n          lastValue[i]._addRefCount(-1);\n        }\n      }\n      if (value) {\n        for (let i = 0, n = value.length; i < n; i++) {\n          value[i]._addRefCount(1);\n        }\n      }\n    }\n    this._setData(property, value);\n  }\n\n  /**\n   * Enable macro.\n   * @param macroName - Macro name\n   */\n  enableMacro(macroName: string): void;\n\n  /**\n   * Enable macro.\n   * @param macro - Shader macro\n   */\n  enableMacro(macro: ShaderMacro): void;\n\n  /**\n   * Enable macro.\n   * @remarks Name and value will combine one macro, it's equal the macro of \"name value\".\n   * @param name - Macro name\n   * @param value - Macro value\n   */\n  enableMacro(name: string, value: string): void;\n\n  enableMacro(macro: string | ShaderMacro, value: string = null): void {\n    if (value) {\n      this._enableVariableMacro(<string>macro, value);\n    } else {\n      if (typeof macro === \"string\") {\n        macro = Shader.getMacroByName(macro);\n      }\n      this._macroCollection.enable(macro);\n    }\n  }\n\n  /**\n   * Disable macro\n   * @param macroName - Macro name\n   */\n  disableMacro(macroName: string): void;\n\n  /**\n   * Disable macro\n   * @param macro - Shader macro\n   */\n  disableMacro(macro: ShaderMacro): void;\n\n  disableMacro(macro: string | ShaderMacro): void {\n    if (typeof macro === \"string\") {\n      // @todo: should optimization variable macros disable performance\n      const variableValue = this._variableMacros[macro];\n      if (variableValue) {\n        this._disableVariableMacro(macro, variableValue);\n      } else {\n        macro = Shader.getMacroByName(macro);\n        this._macroCollection.disable(macro);\n      }\n    } else {\n      this._macroCollection.disable(macro);\n    }\n  }\n\n  clone(): ShaderData {\n    const shaderData = new ShaderData(this._group);\n    this.cloneTo(shaderData);\n    return shaderData;\n  }\n\n  cloneTo(target: ShaderData): void {\n    CloneManager.deepCloneObject(this._macroCollection, target._macroCollection);\n    Object.assign(target._variableMacros, this._variableMacros);\n\n    const properties = this._properties;\n    const targetProperties = target._properties;\n    const keys = Object.keys(properties);\n    for (let i = 0, n = keys.length; i < n; i++) {\n      const k = keys[i];\n      const property: ShaderPropertyValueType = properties[k];\n      if (property != null) {\n        if (typeof property === \"number\") {\n          targetProperties[k] = property;\n        } else if (property instanceof Texture) {\n          targetProperties[k] = property;\n        } else if (property instanceof Array || property instanceof Float32Array || property instanceof Int32Array) {\n          targetProperties[k] = property.slice();\n        } else {\n          targetProperties[k] = property.clone();\n        }\n      } else {\n        targetProperties[k] = property;\n      }\n    }\n  }\n\n  /**\n   * @internal\n   */\n  _getData<T extends ShaderPropertyValueType>(property: string | ShaderProperty): T {\n    if (typeof property === \"string\") {\n      property = Shader.getPropertyByName(property);\n    }\n    return this._properties[property._uniqueId] as T;\n  }\n\n  /**\n   * @internal\n   */\n  _setData<T extends ShaderPropertyValueType>(property: string | ShaderProperty, value: T): void {\n    if (typeof property === \"string\") {\n      property = Shader.getPropertyByName(property);\n    }\n\n    if (property._group !== this._group) {\n      if (property._group === undefined) {\n        property._group = this._group;\n      } else {\n        throw `This property has been used as ${ShaderDataGroup[property._group]} property.`;\n      }\n    }\n\n    this._properties[property._uniqueId] = value;\n  }\n\n  /**\n   * @internal\n   */\n  _getRefCount(): number {\n    return this._refCount;\n  }\n\n  /**\n   * @internal\n   */\n  _addRefCount(value: number): void {\n    this._refCount += value;\n    const properties = this._properties;\n    for (var k in properties) {\n      const property = properties[k];\n      // @todo: Seperate array to speed performace.\n      if (property && property instanceof Texture) {\n        property._addRefCount(value);\n      }\n    }\n  }\n\n  private _enableVariableMacro(name: string, value: string): void {\n    const variableMacro = this._variableMacros;\n    const variableValue = variableMacro[name];\n    if (variableValue !== value) {\n      variableValue && this._disableVariableMacro(name, variableValue);\n\n      const macro = Shader.getMacroByName(`${name} ${value}`);\n      this._macroCollection.enable(macro);\n      variableMacro[name] = value;\n    }\n  }\n\n  private _disableVariableMacro(name: string, value: string): void {\n    const oldMacro = Shader.getMacroByName(`${name} ${value}`);\n    this._macroCollection.disable(oldMacro);\n    delete this._variableMacros[name];\n  }\n}\n","import { Vector2, Vector3, Vector4 } from \"@oasis-engine/math\";\nimport { EngineObject, GLCapabilityType, Logger } from \"./base\";\nimport { Camera } from \"./Camera\";\nimport { Engine } from \"./Engine\";\nimport { Entity } from \"./Entity\";\nimport { FeatureManager } from \"./FeatureManager\";\nimport { Layer } from \"./Layer\";\nimport { LightFeature } from \"./lighting/LightFeature\";\nimport { SceneFeature } from \"./SceneFeature\";\nimport { ShaderDataGroup } from \"./shader/enums/ShaderDataGroup\";\nimport { Shader } from \"./shader/Shader\";\nimport { ShaderData } from \"./shader/ShaderData\";\n\n/**\n * Scene.\n */\nexport class Scene extends EngineObject {\n  private static _resolutionProperty = Shader.getPropertyByName(\"u_resolution\");\n\n  static sceneFeatureManager = new FeatureManager<SceneFeature>();\n\n  /** scene-related shaderdata  */\n  readonly shaderData: ShaderData = new ShaderData(ShaderDataGroup.Scene);\n\n  /** scene name */\n  name: string;\n\n  /**\n   * @private\n   * @deprecated\n   * @todo: Migrate to camera\n   * Clipping surface, plane equations. The fragments below the clipping plane will be discard.\n   * @example\n   * ```ts\n   * scene.clipPlanes = [[0,1,0,0]];\n   * ```\n   * */\n  clipPlanes: Vector4[] = [];\n  _activeCameras: Camera[] = [];\n  _isActiveInEngine: boolean = false;\n\n  private _destroyed: boolean = false;\n  private _rootEntities: Entity[] = [];\n  private _resolution: Vector2 = new Vector2();\n\n  /**\n   * Get the scene's engine.\n   * @readonly\n   */\n  get engine(): Engine {\n    return this._engine;\n  }\n\n  /**\n   * Count of root entities.\n   * @readonly\n   */\n  get rootEntitiesCount(): number {\n    return this._rootEntities.length;\n  }\n\n  /**\n   * Root entity collection.\n   * @readonly\n   */\n  get rootEntities(): Readonly<Entity[]> {\n    return this._rootEntities;\n  }\n\n  /**\n   * Whether it's destroyed.\n   * @readonly\n   */\n  get destroyed(): boolean {\n    return this._destroyed;\n  }\n\n  /**\n   * Create scene.\n   * @param engine - Engine\n   * @param name - Name\n   */\n  constructor(engine: Engine, name?: string) {\n    super(engine);\n    this.name = name || \"\";\n\n    const shaderData = this.shaderData;\n    Scene.sceneFeatureManager.addObject(this);\n    shaderData._addRefCount(1);\n\n    // @todo: this is deviec macro,should add when compile shader.\n    if (this._engine._hardwareRenderer.canIUse(GLCapabilityType.shaderTextureLod)) {\n      shaderData.enableMacro(\"HAS_TEX_LOD\");\n    }\n    if (this._engine._hardwareRenderer.canIUse(GLCapabilityType.standardDerivatives)) {\n      shaderData.enableMacro(\"HAS_DERIVATIVES\");\n    }\n  }\n\n  /**\n   * Create root entity.\n   * @param name - Entity name\n   * @returns Entity\n   */\n  createRootEntity(name?: string): Entity {\n    const entity = new Entity(this._engine, name);\n    this.addRootEntity(entity);\n    return entity;\n  }\n\n  /**\n   * Append an entity.\n   * @param entity - The root entity to add\n   */\n  addRootEntity(entity: Entity): void {\n    const isRoot = entity._isRoot;\n\n    // let entity become root\n    if (!isRoot) {\n      entity._isRoot = true;\n      entity._removeFromParent();\n    }\n\n    // add or remove from scene's rootEntities\n    const oldScene = entity._scene;\n    if (oldScene !== this) {\n      if (oldScene && isRoot) {\n        oldScene._removeEntity(entity);\n      }\n      this._rootEntities.push(entity);\n      Entity._traverseSetOwnerScene(entity, this);\n    } else if (!isRoot) {\n      this._rootEntities.push(entity);\n    }\n\n    // process entity active/inActive\n    if (this._isActiveInEngine) {\n      !entity._isActiveInHierarchy && entity._isActive && entity._processActive();\n    } else {\n      entity._isActiveInHierarchy && entity._processInActive();\n    }\n  }\n\n  /**\n   * Remove an entity.\n   * @param entity - The root entity to remove\n   */\n  removeRootEntity(entity: Entity): void {\n    if (entity._isRoot && entity._scene == this) {\n      this._removeEntity(entity);\n      this._isActiveInEngine && entity._processInActive();\n      Entity._traverseSetOwnerScene(entity, null);\n    }\n  }\n\n  /**\n   * Get root entity from index.\n   * @param index - Index\n   * @returns Entity\n   */\n  getRootEntity(index: number = 0): Entity | null {\n    return this._rootEntities[index];\n  }\n\n  /**\n   * Find entity globally by name.\n   * @param name - Entity name\n   * @returns Entity\n   */\n  findEntityByName(name: string): Entity | null {\n    const children = this._rootEntities;\n    for (let i = children.length - 1; i >= 0; i--) {\n      const child = children[i];\n      if (child.name === name) {\n        return child;\n      }\n    }\n\n    for (let i = children.length - 1; i >= 0; i--) {\n      const child = children[i];\n      const entity = child.findByName(name);\n      if (entity) {\n        return entity;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Find entity globally by name,use â€˜/â€™ symbol as a path separator.\n   * @param path - Entity's path\n   * @returns Entity\n   */\n  findEntityByPath(path: string): Entity | null {\n    const splits = path.split(\"/\").filter(Boolean);\n    for (let i = 0, n = this.rootEntitiesCount; i < n; i++) {\n      let findEntity = this.getRootEntity(i);\n      if (findEntity.name != splits[0]) continue;\n      for (let j = 1, m = splits.length; j < m; ++j) {\n        findEntity = Entity._findChildByName(findEntity, splits[j]);\n        if (!findEntity) break;\n      }\n      return findEntity;\n    }\n    return null;\n  }\n\n  /**\n   * Destroy this scene.\n   */\n  destroy(): void {\n    if (this._destroyed) {\n      return;\n    }\n    this._isActiveInEngine && (this._engine.sceneManager.activeScene = null);\n    Scene.sceneFeatureManager.callFeatureMethod(this, \"destroy\", [this]);\n    for (let i = 0, n = this.rootEntitiesCount; i < n; i++) {\n      this._rootEntities[i].destroy();\n    }\n    this._rootEntities.length = 0;\n    this._activeCameras.length = 0;\n    (Scene.sceneFeatureManager as any)._objects = [];\n    this.shaderData._addRefCount(-1);\n    this._destroyed = true;\n  }\n\n  /**\n   * Append a camera to this scene.\n   * @param camera  - Camera\n   */\n  attachRenderCamera(camera: Camera): void {\n    const index = this._activeCameras.indexOf(camera);\n    if (index === -1) {\n      this._activeCameras.push(camera);\n    } else {\n      Logger.warn(\"Camera already attached.\");\n    }\n  }\n\n  /**\n   * Remove a camera from this scene.\n   * @param camera - Camera\n   */\n  detachRenderCamera(camera: Camera): void {\n    const index = this._activeCameras.indexOf(camera);\n    if (index !== -1) {\n      this._activeCameras.splice(index, 1);\n    }\n  }\n\n  /**\n   * @internal\n   */\n  _processActive(active: boolean): void {\n    this._isActiveInEngine = active;\n    const rootEntities = this._rootEntities;\n    for (let i = rootEntities.length - 1; i >= 0; i--) {\n      const entity = rootEntities[i];\n      if (entity._isActive) {\n        active ? entity._processActive() : entity._processInActive();\n      }\n    }\n  }\n\n  /**\n   * @internal\n   */\n  _updateShaderData() {\n    const lightMgr = this.findFeature(LightFeature);\n    const shaderData = this.shaderData;\n    const canvas = this.engine.canvas;\n    const resolution = this._resolution;\n\n    lightMgr._updateShaderData(shaderData);\n\n    resolution.setValue(canvas.width, canvas.height);\n    shaderData.setVector2(Scene._resolutionProperty, resolution);\n  }\n\n  private _removeEntity(entity: Entity): void {\n    const oldRootEntities = this._rootEntities;\n    oldRootEntities.splice(oldRootEntities.indexOf(entity), 1);\n  }\n\n  //-----------------------------------------@deprecated-----------------------------------\n  static registerFeature(Feature: new () => SceneFeature) {\n    Scene.sceneFeatureManager.registerFeature(Feature);\n  }\n\n  findFeature<T extends SceneFeature>(Feature: { new (): T }): T {\n    return Scene.sceneFeatureManager.findFeature(this, Feature) as T;\n  }\n\n  features: SceneFeature[] = [];\n\n  /**\n   * Raycast.\n   * @deprecated\n   * @param ray\n   */\n  public raycast(ray: { origin: Vector3; direction: Vector3 }, outPos?: Vector3, tag?: Layer): any {}\n}\n","import { AssetPromise } from \"./asset/AssetPromise\";\nimport { Engine } from \"./Engine\";\nimport { Scene } from \"./Scene\";\n\n/**\n * Scene manager.\n */\nexport class SceneManager {\n  _activeScene: Scene;\n\n  /**\n   * Get the activated scene.\n   */\n  get activeScene(): Scene {\n    return this._activeScene;\n  }\n\n  set activeScene(scene: Scene) {\n    const oldScene = this._activeScene;\n    if (oldScene !== scene) {\n      oldScene && oldScene._processActive(false);\n      scene && scene._processActive(true);\n      this._activeScene = scene;\n    }\n  }\n\n  /**\n   * @internal\n   */\n  constructor(public readonly engine: Engine) {}\n\n  /**\n   * Load and activate scene.\n   * @param url - the path of the scene\n   * @param destroyOldScene - whether to destroy old scene information\n   * @returns scene promise\n   */\n  loadScene(url: string, destroyOldScene: boolean = true): AssetPromise<Scene> {\n    const scenePromise = this.engine.resourceManager.load<Scene>(url);\n    scenePromise.then((scene: Scene) => {\n      const oldScene: Scene = this._activeScene;\n      this.activeScene = scene;\n      if (oldScene && destroyOldScene) {\n        oldScene.destroy();\n      }\n    });\n    return scenePromise;\n  }\n\n  /**\n   * Merge the source scene into the target scene.\n   * @remarks the global information of destScene will be used after the merge, and the lightingMap information will be merged.\n   * @param sourceScene - source scene\n   * @param destScene - target scene\n   */\n  mergeScenes(sourceScene: Scene, destScene: Scene): void {\n    const oldRootEntities = sourceScene.rootEntities;\n    for (let i: number = 0, n: number = oldRootEntities.length; i < n; i++) {\n      destScene.addRootEntity(oldRootEntities[i]);\n    }\n  }\n}\n","import blinnPhongFs from \"../shaderlib/extra/blinn-phong.fs.glsl\";\nimport blinnPhongVs from \"../shaderlib/extra/blinn-phong.vs.glsl\";\nimport particleFs from \"../shaderlib/extra/particle.fs.glsl\";\nimport particleVs from \"../shaderlib/extra/particle.vs.glsl\";\nimport pbrFs from \"../shaderlib/extra/pbr.fs.glsl\";\nimport pbrVs from \"../shaderlib/extra/pbr.vs.glsl\";\nimport shadowMapFs from \"../shaderlib/extra/shadow-map.fs.glsl\";\nimport shadowMapVs from \"../shaderlib/extra/shadow-map.vs.glsl\";\nimport shadowFs from \"../shaderlib/extra/shadow.fs.glsl\";\nimport skyboxFs from \"../shaderlib/extra/skybox.fs.glsl\";\nimport skyboxVs from \"../shaderlib/extra/skybox.vs.glsl\";\nimport unlitFs from \"../shaderlib/extra/unlit.fs.glsl\";\nimport unlitVs from \"../shaderlib/extra/unlit.vs.glsl\";\nimport { Shader } from \"./Shader\";\n\n/**\n * Internal shader pool.\n * @internal\n */\nexport class ShaderPool {\n  static init(): void {\n    Shader.create(\"blinn-phong\", blinnPhongVs, blinnPhongFs);\n    Shader.create(\"pbr\", pbrVs, pbrFs);\n    Shader.create(\"unlit\", unlitVs, unlitFs);\n    Shader.create(\"shadow-map\", shadowMapVs, shadowMapFs);\n    Shader.create(\"shadow\", shadowMapVs, shadowFs);\n    Shader.create(\"skybox\", skyboxVs, skyboxFs);\n    Shader.create(\"particle-shader\", particleVs, particleFs);\n  }\n}\n","import { ShaderMacroCollection } from \"./ShaderMacroCollection\";\nimport { ShaderProgram } from \"./ShaderProgram\";\n\n/**\n * Shader program pool.\n * @internal\n */\nexport class ShaderProgramPool {\n  private _cacheHierarchy: number = 1;\n  private _cacheMap: object = Object.create(null);\n  private _lastQueryMap: Record<number, ShaderProgram>;\n  private _lastQueryKey: number;\n\n  /**\n   * Get shader program by macro collection.\n   * @param macros - macro collection\n   * @returns shader program\n   */\n  get(macros: ShaderMacroCollection): ShaderProgram | null {\n    let cacheMap = this._cacheMap;\n    const maskLength = macros._length;\n    if (maskLength > this._cacheHierarchy) {\n      this._resizeCacheMapHierarchy(cacheMap, 0, maskLength);\n    }\n\n    const mask = macros._mask;\n    const endIndex = macros._length - 1;\n    const maxEndIndex = this._cacheHierarchy - 1;\n    for (let i = 0; i < maxEndIndex; i++) {\n      const subMask = endIndex < i ? 0 : mask[i];\n      let subCacheShaders: object = cacheMap[subMask];\n      subCacheShaders || (cacheMap[subMask] = subCacheShaders = Object.create(null));\n      cacheMap = subCacheShaders;\n    }\n\n    const cacheKey = endIndex < maxEndIndex ? 0 : mask[maxEndIndex];\n    const shader = (<Record<number, ShaderProgram>>cacheMap)[cacheKey];\n    if (!shader) {\n      this._lastQueryKey = cacheKey;\n      this._lastQueryMap = <Record<number, ShaderProgram>>cacheMap;\n    }\n    return shader;\n  }\n\n  /**\n   * Cache the shader program.\n   *\n   * @remarks\n   * The method must return an empty value after calling get() to run normally.\n   *\n   * @param shaderProgram - shader program\n   */\n  cache(shaderProgram: ShaderProgram): void {\n    this._lastQueryMap[this._lastQueryKey] = shaderProgram;\n  }\n\n  private _resizeCacheMapHierarchy(cacheMap: object, hierarchy: number, resizeLength: number): void {\n    // only expand but not shrink.\n    const end = this._cacheHierarchy - 1;\n    if (hierarchy == end) {\n      for (let k in cacheMap) {\n        const shader: ShaderProgram = cacheMap[k];\n        for (let i = 0, n = resizeLength - end; i < n; i++) {\n          if (i == n - 1) {\n            cacheMap[0] = shader;\n          } else {\n            cacheMap = cacheMap[i == 0 ? k : 0] = Object.create(null);\n          }\n        }\n      }\n      this._cacheHierarchy = resizeLength;\n    } else {\n      for (let k in cacheMap) {\n        this._resizeCacheMapHierarchy(cacheMap[k], ++hierarchy, resizeLength);\n      }\n    }\n  }\n}\n","import { BlendOperation } from \"../enums/BlendOperation\";\nimport { BlendFactor } from \"../enums/BlendFactor\";\nimport { ColorWriteMask } from \"../enums/ColorWriteMask\";\n\n/**\n * The blend state of the render target.\n */\nexport class RenderTargetBlendState {\n  /** color (RGB) blend operation. */\n  colorBlendOperation: BlendOperation = BlendOperation.Add;\n  /** alpha (A) blend operation. */\n  alphaBlendOperation: BlendOperation = BlendOperation.Add;\n  /** color blend factor (RGB) for source. */\n  sourceColorBlendFactor: BlendFactor = BlendFactor.One;\n  /** alpha blend factor (A) for source. */\n  sourceAlphaBlendFactor: BlendFactor = BlendFactor.One;\n  /** color blend factor (RGB) for destination. */\n  destinationColorBlendFactor: BlendFactor = BlendFactor.Zero;\n  /** alpha blend factor (A) for destination. */\n  destinationAlphaBlendFactor: BlendFactor = BlendFactor.Zero;\n  /** color mask. */\n  colorWriteMask: ColorWriteMask = ColorWriteMask.All;\n\n  /** @internal */\n  _blendEnable: boolean = false;\n}\n","import { Color } from \"@oasis-engine/math\";\nimport { HardwareRenderer } from \"../../HardwareRenderer\";\nimport { BlendFactor } from \"../enums/BlendFactor\";\nimport { BlendOperation } from \"../enums/BlendOperation\";\nimport { ColorWriteMask } from \"../enums/ColorWriteMask\";\nimport { RenderState } from \"./RenderState\";\nimport { RenderTargetBlendState } from \"./RenderTargetBlendState\";\n\n/**\n * Blend state.\n */\nexport class BlendState {\n  private static _getGLBlendFactor(blendFactor: BlendFactor): number {\n    switch (blendFactor) {\n      case BlendFactor.Zero:\n        return WebGLRenderingContext.ZERO;\n      case BlendFactor.One:\n        return WebGLRenderingContext.ONE;\n      case BlendFactor.SourceColor:\n        return WebGLRenderingContext.SRC_COLOR;\n      case BlendFactor.OneMinusSourceColor:\n        return WebGLRenderingContext.ONE_MINUS_SRC_COLOR;\n      case BlendFactor.DestinationColor:\n        return WebGLRenderingContext.DST_COLOR;\n      case BlendFactor.OneMinusDestinationColor:\n        return WebGLRenderingContext.ONE_MINUS_DST_COLOR;\n      case BlendFactor.SourceAlpha:\n        return WebGLRenderingContext.SRC_ALPHA;\n      case BlendFactor.OneMinusSourceAlpha:\n        return WebGLRenderingContext.ONE_MINUS_SRC_ALPHA;\n      case BlendFactor.DestinationAlpha:\n        return WebGLRenderingContext.DST_ALPHA;\n      case BlendFactor.OneMinusDestinationAlpha:\n        return WebGLRenderingContext.ONE_MINUS_DST_ALPHA;\n      case BlendFactor.SourceAlphaSaturate:\n        return WebGLRenderingContext.SRC_ALPHA_SATURATE;\n      case BlendFactor.BlendColor:\n        return WebGLRenderingContext.CONSTANT_COLOR;\n      case BlendFactor.OneMinusBlendColor:\n        return WebGLRenderingContext.ONE_MINUS_CONSTANT_COLOR;\n    }\n  }\n\n  private static _getGLBlendOperation(blendOperation: BlendOperation): number {\n    switch (blendOperation) {\n      case BlendOperation.Add:\n        return WebGLRenderingContext.FUNC_ADD;\n      case BlendOperation.Subtract:\n        return WebGLRenderingContext.FUNC_SUBTRACT;\n      case BlendOperation.ReverseSubtract:\n        return WebGLRenderingContext.FUNC_REVERSE_SUBTRACT;\n      case BlendOperation.Min:\n        return WebGL2RenderingContext.MIN; // in webgl1.0 is an extension\n      case BlendOperation.Max:\n        return WebGL2RenderingContext.MAX; // in webgl1.0 is an extension\n    }\n  }\n\n  /** The blend state of the render target. */\n  readonly targetBlendState: RenderTargetBlendState = new RenderTargetBlendState();\n  /** Constant blend color. */\n  readonly blendColor: Color = new Color(0, 0, 0, 0);\n  /** Whether to use (Alpha-to-Coverage) technolog. */\n  alphaToCoverage: boolean = false;\n\n  /**\n   * @internal\n   * Apply the current blend state by comparing with the last blend state.\n   */\n  _apply(hardwareRenderer: HardwareRenderer, lastRenderState: RenderState): void {\n    this._platformApply(hardwareRenderer, lastRenderState.blendState);\n  }\n\n  private _platformApply(rhi: HardwareRenderer, lastState: BlendState): void {\n    const gl = <WebGLRenderingContext>rhi.gl;\n    const lastTargetBlendState = lastState.targetBlendState;\n\n    const {\n      colorBlendOperation,\n      alphaBlendOperation,\n      sourceColorBlendFactor,\n      destinationColorBlendFactor,\n      sourceAlphaBlendFactor,\n      destinationAlphaBlendFactor,\n      colorWriteMask\n    } = this.targetBlendState;\n\n    const blendEnable = !(\n      sourceColorBlendFactor === BlendFactor.One &&\n      destinationColorBlendFactor === BlendFactor.Zero &&\n      sourceAlphaBlendFactor === BlendFactor.One &&\n      destinationAlphaBlendFactor === BlendFactor.Zero &&\n      (colorBlendOperation === BlendOperation.Add || colorBlendOperation === BlendOperation.Subtract) &&\n      (alphaBlendOperation === BlendOperation.Add || alphaBlendOperation === BlendOperation.Subtract)\n    );\n\n    if (blendEnable !== lastTargetBlendState._blendEnable) {\n      if (blendEnable) {\n        gl.enable(gl.BLEND);\n      } else {\n        gl.disable(gl.BLEND);\n      }\n      lastTargetBlendState._blendEnable = blendEnable;\n    }\n\n    if (blendEnable) {\n      // apply blend factor.\n      if (\n        sourceColorBlendFactor !== lastTargetBlendState.sourceColorBlendFactor ||\n        destinationColorBlendFactor !== lastTargetBlendState.destinationColorBlendFactor ||\n        sourceAlphaBlendFactor !== lastTargetBlendState.sourceAlphaBlendFactor ||\n        destinationAlphaBlendFactor !== lastTargetBlendState.destinationAlphaBlendFactor\n      ) {\n        gl.blendFuncSeparate(\n          BlendState._getGLBlendFactor(sourceColorBlendFactor),\n          BlendState._getGLBlendFactor(destinationColorBlendFactor),\n          BlendState._getGLBlendFactor(sourceAlphaBlendFactor),\n          BlendState._getGLBlendFactor(destinationAlphaBlendFactor)\n        );\n        lastTargetBlendState.sourceColorBlendFactor = sourceColorBlendFactor;\n        lastTargetBlendState.destinationColorBlendFactor = destinationColorBlendFactor;\n        lastTargetBlendState.sourceAlphaBlendFactor = sourceAlphaBlendFactor;\n        lastTargetBlendState.destinationAlphaBlendFactor = destinationAlphaBlendFactor;\n      }\n\n      // apply blend operation.\n      if (\n        colorBlendOperation !== lastTargetBlendState.colorBlendOperation ||\n        alphaBlendOperation !== lastTargetBlendState.alphaBlendOperation\n      ) {\n        gl.blendEquationSeparate(\n          BlendState._getGLBlendOperation(colorBlendOperation),\n          BlendState._getGLBlendOperation(alphaBlendOperation)\n        );\n        lastTargetBlendState.colorBlendOperation = colorBlendOperation;\n        lastTargetBlendState.alphaBlendOperation = alphaBlendOperation;\n      }\n\n      // apply blend color.\n      const blendColor = this.blendColor;\n      if (!Color.equals(lastState.blendColor, blendColor)) {\n        gl.blendColor(blendColor.r, blendColor.g, blendColor.b, blendColor.a);\n        blendColor.cloneTo(lastState.blendColor);\n      }\n    }\n\n    // apply color mask.\n    if (colorWriteMask !== lastTargetBlendState.colorWriteMask) {\n      gl.colorMask(\n        (colorWriteMask & ColorWriteMask.Red) !== 0,\n        (colorWriteMask & ColorWriteMask.Green) !== 0,\n        (colorWriteMask & ColorWriteMask.Blue) !== 0,\n        (colorWriteMask & ColorWriteMask.Alpha) !== 0\n      );\n      lastTargetBlendState.colorWriteMask = colorWriteMask;\n    }\n\n    // apply alpha to coverage.\n    const alphaToCoverage = this.alphaToCoverage;\n    if (alphaToCoverage !== lastState.alphaToCoverage) {\n      if (alphaToCoverage) {\n        gl.enable(gl.SAMPLE_ALPHA_TO_COVERAGE);\n      } else {\n        gl.disable(gl.SAMPLE_ALPHA_TO_COVERAGE);\n      }\n      lastState.alphaToCoverage = alphaToCoverage;\n    }\n  }\n}\n","import { HardwareRenderer } from \"../../HardwareRenderer\";\nimport { CompareFunction } from \"../enums/CompareFunction\";\nimport { RenderState } from \"./RenderState\";\n\n/**\n * Depth state.\n */\nexport class DepthState {\n  private static _getGLCompareFunction(compareFunction: CompareFunction): number {\n    switch (compareFunction) {\n      case CompareFunction.Never:\n        return WebGLRenderingContext.NEVER;\n      case CompareFunction.Less:\n        return WebGLRenderingContext.LESS;\n      case CompareFunction.Equal:\n        return WebGLRenderingContext.EQUAL;\n      case CompareFunction.LessEqual:\n        return WebGL2RenderingContext.LEQUAL;\n      case CompareFunction.Greater:\n        return WebGL2RenderingContext.GREATER;\n      case CompareFunction.NotEqual:\n        return WebGL2RenderingContext.NOTEQUAL;\n      case CompareFunction.GreaterEqual:\n        return WebGL2RenderingContext.GEQUAL;\n      case CompareFunction.Always:\n        return WebGL2RenderingContext.ALWAYS;\n    }\n  }\n\n  /** Whether to enable the depth test. */\n  enabled: boolean = true;\n  /** Whether the depth value can be written.*/\n  writeEnabled: boolean = true;\n  /** Depth comparison function. */\n  compareFunction: CompareFunction = CompareFunction.Less;\n\n  /**\n   * @internal\n   * Apply the current depth state by comparing with the last depth state.\n   */\n  _apply(hardwareRenderer: HardwareRenderer, lastRenderState: RenderState): void {\n    this._platformApply(hardwareRenderer, lastRenderState.depthState);\n  }\n\n  private _platformApply(rhi: HardwareRenderer, lastState: DepthState): void {\n    const gl = <WebGLRenderingContext>rhi.gl;\n    const { enabled, compareFunction, writeEnabled } = this;\n\n    if (enabled != lastState.enabled) {\n      if (enabled) {\n        gl.enable(gl.DEPTH_TEST);\n      } else {\n        gl.disable(gl.DEPTH_TEST);\n      }\n      lastState.enabled = enabled;\n    }\n\n    if (enabled) {\n      // apply compare func.\n      if (compareFunction != lastState.compareFunction) {\n        gl.depthFunc(DepthState._getGLCompareFunction(compareFunction));\n        lastState.compareFunction = compareFunction;\n      }\n\n      // apply write enabled.\n      if (writeEnabled != lastState.writeEnabled) {\n        gl.depthMask(writeEnabled);\n        lastState.writeEnabled = writeEnabled;\n      }\n    }\n  }\n}\n","import { HardwareRenderer } from \"../../HardwareRenderer\";\nimport { CullMode } from \"../enums/CullMode\";\nimport { RenderState } from \"./RenderState\";\n\n/**\n * Raster state.\n */\nexport class RasterState {\n  /** specifies whether or not front- and/or back-facing polygons can be culled. */\n  cullMode: CullMode = CullMode.Back;\n  /** the multiplier by which an implementation-specific value is multiplied with to create a constant depth offset. */\n  depthBias: number = 0;\n  /** the scale factor for the variable depth offset for each polygon. */\n  slopeScaledDepthBias: number = 0;\n\n  /** @internal */\n  _cullFaceEnable: boolean = true;\n\n  /**\n   * @internal\n   */\n  _apply(hardwareRenderer: HardwareRenderer, lastRenderState: RenderState): void {\n    this._platformApply(hardwareRenderer, lastRenderState.rasterState);\n  }\n\n  private _platformApply(rhi: HardwareRenderer, lastState: RasterState): void {\n    const gl = <WebGLRenderingContext>rhi.gl;\n    const { cullMode, depthBias, slopeScaledDepthBias } = this;\n\n    const cullFaceEnable = cullMode !== CullMode.Off;\n    if (cullFaceEnable !== lastState._cullFaceEnable) {\n      if (cullFaceEnable) {\n        gl.enable(gl.CULL_FACE);\n      } else {\n        gl.disable(gl.CULL_FACE);\n      }\n      lastState._cullFaceEnable = cullFaceEnable;\n    }\n\n    // apply front face.\n    if (cullFaceEnable) {\n      if (cullMode !== lastState.cullMode) {\n        if (cullMode == CullMode.Back) {\n          gl.cullFace(gl.BACK);\n        } else {\n          gl.cullFace(gl.FRONT);\n        }\n        lastState.cullMode = cullMode;\n      }\n    }\n\n    // apply polygonOffset.\n    if (depthBias !== lastState.depthBias || slopeScaledDepthBias !== lastState.slopeScaledDepthBias) {\n      if (depthBias !== 0 || slopeScaledDepthBias !== 0) {\n        gl.enable(gl.POLYGON_OFFSET_FILL);\n        gl.polygonOffset(slopeScaledDepthBias, depthBias);\n      } else {\n        gl.disable(gl.POLYGON_OFFSET_FILL);\n      }\n      lastState.depthBias = depthBias;\n      lastState.slopeScaledDepthBias = slopeScaledDepthBias;\n    }\n  }\n}\n","import { HardwareRenderer } from \"../../HardwareRenderer\";\nimport { CompareFunction } from \"../enums/CompareFunction\";\nimport { StencilOperation } from \"../enums/StencilOperation\";\nimport { RenderState } from \"./RenderState\";\n\n/**\n * Stencil state.\n */\nexport class StencilState {\n  private static _getGLCompareFunction(compareFunction: CompareFunction): number {\n    switch (compareFunction) {\n      case CompareFunction.Never:\n        return WebGLRenderingContext.NEVER;\n      case CompareFunction.Less:\n        return WebGLRenderingContext.LESS;\n      case CompareFunction.Equal:\n        return WebGLRenderingContext.EQUAL;\n      case CompareFunction.LessEqual:\n        return WebGLRenderingContext.LEQUAL;\n      case CompareFunction.Greater:\n        return WebGLRenderingContext.GREATER;\n      case CompareFunction.NotEqual:\n        return WebGLRenderingContext.NOTEQUAL;\n      case CompareFunction.GreaterEqual:\n        return WebGLRenderingContext.GEQUAL;\n      case CompareFunction.Always:\n        return WebGLRenderingContext.ALWAYS;\n    }\n  }\n\n  private static _getGLStencilOperation(compareFunction: StencilOperation): number {\n    switch (compareFunction) {\n      case StencilOperation.Keep:\n        return WebGLRenderingContext.KEEP;\n      case StencilOperation.Zero:\n        return WebGLRenderingContext.ZERO;\n      case StencilOperation.Replace:\n        return WebGLRenderingContext.REPLACE;\n      case StencilOperation.IncrementSaturate:\n        return WebGLRenderingContext.INCR;\n      case StencilOperation.DecrementSaturate:\n        return WebGLRenderingContext.DECR;\n      case StencilOperation.Invert:\n        return WebGLRenderingContext.INVERT;\n      case StencilOperation.IncrementWrap:\n        return WebGLRenderingContext.INCR_WRAP;\n      case StencilOperation.DecrementWrap:\n        return WebGLRenderingContext.DECR_WRAP;\n    }\n  }\n\n  /** Whether to enable stencil test. */\n  enabled: boolean = false;\n  /** Write the reference value of the stencil buffer. */\n  referenceValue: number = 0;\n  /** Specifying a bit-wise mask that is used to AND the reference value and the stored stencil value when the test is done. */\n  mask: number = 0xff;\n  /** Specifying a bit mask to enable or disable writing of individual bits in the stencil planes. */\n  writeMask: number = 0xff;\n  /** The comparison function of the reference value of the front face of the geometry and the current buffer storage value. */\n  compareFunctionFront: CompareFunction = CompareFunction.Always;\n  /** The comparison function of the reference value of the back of the geometry and the current buffer storage value. */\n  compareFunctionBack: CompareFunction = CompareFunction.Always;\n  /** specifying the function to use for front face when both the stencil test and the depth test pass. */\n  passOperationFront: StencilOperation = StencilOperation.Keep;\n  /** specifying the function to use for back face when both the stencil test and the depth test pass. */\n  passOperationBack: StencilOperation = StencilOperation.Keep;\n  /** specifying the function to use for front face when the stencil test fails. */\n  failOperationFront: StencilOperation = StencilOperation.Keep;\n  /** specifying the function to use for back face when the stencil test fails. */\n  failOperationBack: StencilOperation = StencilOperation.Keep;\n  /** specifying the function to use for front face when the stencil test passes, but the depth test fails. */\n  zFailOperationFront: StencilOperation = StencilOperation.Keep;\n  /** specifying the function to use for back face when the stencil test passes, but the depth test fails. */\n  zFailOperationBack: StencilOperation = StencilOperation.Keep;\n\n  /**\n   * @internal\n   */\n  _apply(hardwareRenderer: HardwareRenderer, lastRenderState: RenderState): void {\n    this._platformApply(hardwareRenderer, lastRenderState.stencilState);\n  }\n\n  private _platformApply(rhi: HardwareRenderer, lastState: StencilState): void {\n    const gl = <WebGLRenderingContext>rhi.gl;\n    const {\n      enabled,\n      referenceValue,\n      mask,\n      compareFunctionFront,\n      compareFunctionBack,\n      failOperationFront,\n      zFailOperationFront,\n      passOperationFront,\n      failOperationBack,\n      zFailOperationBack,\n      passOperationBack,\n      writeMask\n    } = this;\n\n    if (enabled != lastState.enabled) {\n      if (enabled) {\n        gl.enable(gl.STENCIL_TEST);\n      } else {\n        gl.disable(WebGLRenderingContext.STENCIL_TEST);\n      }\n      lastState.enabled = enabled;\n    }\n\n    if (enabled) {\n      // apply stencil func.\n      const referenceOrMaskChange = referenceValue !== lastState.referenceValue || mask !== lastState.mask;\n      if (referenceOrMaskChange || compareFunctionFront !== lastState.compareFunctionFront) {\n        gl.stencilFuncSeparate(\n          gl.FRONT,\n          StencilState._getGLCompareFunction(compareFunctionFront),\n          referenceValue,\n          mask\n        );\n        lastState.compareFunctionFront = compareFunctionFront;\n      }\n\n      if (referenceOrMaskChange || compareFunctionBack !== lastState.compareFunctionBack) {\n        gl.stencilFuncSeparate(gl.BACK, StencilState._getGLCompareFunction(compareFunctionBack), referenceValue, mask);\n        lastState.compareFunctionBack = this.compareFunctionBack;\n      }\n      if (referenceOrMaskChange) {\n        lastState.referenceValue = this.referenceValue;\n        lastState.mask = this.mask;\n      }\n\n      // apply stencil operation.\n      if (\n        failOperationFront !== lastState.failOperationFront ||\n        zFailOperationFront !== lastState.zFailOperationFront ||\n        passOperationFront !== lastState.passOperationFront\n      ) {\n        gl.stencilOpSeparate(\n          gl.FRONT,\n          StencilState._getGLStencilOperation(failOperationFront),\n          StencilState._getGLStencilOperation(zFailOperationFront),\n          StencilState._getGLStencilOperation(passOperationFront)\n        );\n        lastState.failOperationFront = failOperationFront;\n        lastState.zFailOperationFront = zFailOperationFront;\n        lastState.passOperationFront = passOperationFront;\n      }\n\n      if (\n        failOperationBack !== lastState.failOperationBack ||\n        zFailOperationBack !== lastState.zFailOperationBack ||\n        passOperationBack !== lastState.passOperationBack\n      ) {\n        gl.stencilOpSeparate(\n          gl.BACK,\n          StencilState._getGLStencilOperation(failOperationBack),\n          StencilState._getGLStencilOperation(zFailOperationBack),\n          StencilState._getGLStencilOperation(passOperationBack)\n        );\n        lastState.failOperationBack = failOperationBack;\n        lastState.zFailOperationBack = zFailOperationBack;\n        lastState.passOperationBack = passOperationBack;\n      }\n\n      // apply write mask.\n      if (writeMask !== lastState.writeMask) {\n        gl.stencilMask(writeMask);\n        lastState.writeMask = writeMask;\n      }\n    }\n  }\n}\n","import { Engine } from \"../../Engine\";\nimport { BlendState } from \"./BlendState\";\nimport { DepthState } from \"./DepthState\";\nimport { RasterState } from \"./RasterState\";\nimport { StencilState } from \"./StencilState\";\n\n/**\n * Render state.\n */\nexport class RenderState {\n  /** Blend state. */\n  readonly blendState: BlendState = new BlendState();\n  /** Depth state. */\n  readonly depthState: DepthState = new DepthState();\n  /** Stencil state. */\n  readonly stencilState: StencilState = new StencilState();\n  /** Raster state. */\n  readonly rasterState: RasterState = new RasterState();\n\n  /** @internal */\n  _apply(engine: Engine): void {\n    const hardwareRenderer = engine._hardwareRenderer;\n    const lastRenderState = engine._lastRenderState;\n    this.blendState._apply(hardwareRenderer, lastRenderState);\n    this.depthState._apply(hardwareRenderer, lastRenderState);\n    this.stencilState._apply(hardwareRenderer, lastRenderState);\n    this.rasterState._apply(hardwareRenderer, lastRenderState);\n  }\n}\n","import { ResourceManager } from \"./asset/ResourceManager\";\nimport { Event, EventDispatcher, Logger, Time } from \"./base\";\nimport { Canvas } from \"./Canvas\";\nimport { ComponentsManager } from \"./ComponentsManager\";\nimport { EngineFeature } from \"./EngineFeature\";\nimport { Entity } from \"./Entity\";\nimport { FeatureManager } from \"./FeatureManager\";\nimport { HardwareRenderer } from \"./HardwareRenderer\";\nimport { RenderElement } from \"./RenderPipeline/RenderElement\";\nimport { Scene } from \"./Scene\";\nimport { SceneManager } from \"./SceneManager\";\nimport { Shader } from \"./shader/Shader\";\nimport { ShaderPool } from \"./shader/ShaderPool\";\nimport { ShaderProgramPool } from \"./shader/ShaderProgramPool\";\nimport { RenderState } from \"./shader/state/RenderState\";\n\n/** TODO: delete */\nconst engineFeatureManager = new FeatureManager<EngineFeature>();\nShaderPool.init();\n\n/**\n * Engine.\n */\nexport class Engine extends EventDispatcher {\n  _componentsManager: ComponentsManager = new ComponentsManager();\n  _hardwareRenderer: HardwareRenderer;\n  _lastRenderState: RenderState = new RenderState();\n\n  /* @internal */\n  _renderCount: number = 0;\n  /* @internal */\n  _shaderProgramPools: ShaderProgramPool[] = [];\n\n  protected _canvas: Canvas;\n  private _resourceManager: ResourceManager = new ResourceManager(this);\n  private _sceneManager: SceneManager = new SceneManager(this);\n  private _vSyncCount: number = 1;\n  private _targetFrameRate: number = 60;\n  private _time: Time = new Time();\n  private _isPaused: boolean = true;\n  private _requestId: number;\n  private _timeoutId: number;\n  private _vSyncCounter: number = 1;\n  private _targetFrameInterval: number = 1000 / 60;\n\n  private _animate = () => {\n    if (this._vSyncCount) {\n      this._requestId = requestAnimationFrame(this._animate);\n      if (this._vSyncCounter++ % this._vSyncCount === 0) {\n        this.update();\n        this._vSyncCounter = 1;\n      }\n    } else {\n      this._timeoutId = window.setTimeout(this._animate, this._targetFrameInterval);\n      this.update();\n    }\n  };\n\n  /**\n   * The canvas to use for rendering.\n   * @readonly\n   */\n  get canvas(): Canvas {\n    return this._canvas;\n  }\n\n  /**\n   * Get the resource manager.\n   * @readonly\n   */\n  get resourceManager(): ResourceManager {\n    return this._resourceManager;\n  }\n\n  /**\n   * Get the scene manager.\n   * @readonly\n   */\n  get sceneManager(): SceneManager {\n    return this._sceneManager;\n  }\n\n  /**\n   * Get the Time class.\n   * @readonly\n   */\n  get time(): Time {\n    return this._time;\n  }\n\n  /**\n   * Whether the engine is paused.\n   * @readonly\n   */\n  get isPaused(): boolean {\n    return this._isPaused;\n  }\n\n  /**\n   * The number of vertical synchronization means the number of vertical blanking for one frame.\n   * @remarks 0 means that the vertical synchronization is turned off.\n   */\n  get vSyncCount(): number {\n    return this._vSyncCount;\n  }\n\n  set vSyncCount(value: number) {\n    this._vSyncCount = Math.max(0, Math.floor(value));\n  }\n\n  /**\n   * Set the target frame rate you want to achieve.\n   * @remarks\n   * It only takes effect when vSyncCount = 0 (ie, vertical synchronization is turned off).\n   * The larger the value, the higher the target frame rate, Number.POSITIVE_INFINIT represents the infinite target frame rate.\n   */\n  get targetFrameRate(): number {\n    return this._targetFrameRate;\n  }\n\n  set targetFrameRate(value: number) {\n    value = Math.max(0.000001, value);\n    this._targetFrameRate = value;\n    this._targetFrameInterval = 1000 / value;\n  }\n\n  /**\n   * Graphics API renderer.\n   * @deprecated\n   */\n  get renderhardware(): HardwareRenderer {\n    return this._hardwareRenderer;\n  }\n\n  /**\n   * Create engine.\n   * @param canvas - The canvas to use for rendering\n   * @param hardwareRenderer - Graphics API renderer\n   */\n  constructor(canvas: Canvas, hardwareRenderer: HardwareRenderer) {\n    super(null);\n    this._hardwareRenderer = hardwareRenderer;\n    this._hardwareRenderer.init(canvas);\n    this._canvas = canvas;\n    // @todo delete\n    engineFeatureManager.addObject(this);\n    this._sceneManager.activeScene = new Scene(this, \"DefaultScene\");\n  }\n\n  /**\n   * Create an entity.\n   * @param name - The name of the entity\n   * @returns Entity\n   */\n  createEntity(name?: string): Entity {\n    return new Entity(this, name);\n  }\n\n  /**\n   * Pause the engine.\n   */\n  pause(): void {\n    this._isPaused = true;\n    cancelAnimationFrame(this._requestId);\n    clearTimeout(this._timeoutId);\n  }\n\n  /**\n   * Resume the engine.\n   */\n  resume(): void {\n    if (!this._isPaused) return;\n    this._isPaused = false;\n    this.time.reset();\n    requestAnimationFrame(this._animate);\n  }\n\n  /**\n   * Update the engine loop manually. If you call engine.run(), you generally don't need to call this function.\n   */\n  update(): void {\n    const time = this._time;\n    const deltaTime = time.deltaTime;\n\n    time.tick();\n    RenderElement._restPool();\n\n    engineFeatureManager.callFeatureMethod(this, \"preTick\", [this, this._sceneManager._activeScene]);\n\n    const scene = this._sceneManager._activeScene;\n    const componentsManager = this._componentsManager;\n    if (scene) {\n      componentsManager.callScriptOnStart();\n      componentsManager.callScriptOnUpdate(deltaTime);\n      componentsManager.callAnimationUpdate(deltaTime);\n      componentsManager.callScriptOnLateUpdate(deltaTime);\n\n      this._render(scene);\n    }\n\n    this._componentsManager.callComponentDestory();\n\n    engineFeatureManager.callFeatureMethod(this, \"postTick\", [this, this._sceneManager._activeScene]);\n  }\n\n  /**\n   * Execution engine loop.\n   */\n  run(): void {\n    // @todo: delete\n    engineFeatureManager.callFeatureMethod(this, \"preLoad\", [this]);\n    this.resume();\n    this.trigger(new Event(\"run\", this));\n  }\n\n  /**\n   * Destroy engine.\n   */\n  destroy(): void {\n    if (this._sceneManager) {\n      // -- event\n      this.trigger(new Event(\"shutdown\", this));\n      engineFeatureManager.callFeatureMethod(this, \"shutdown\", [this]);\n\n      // -- cancel animation\n      this.pause();\n\n      this._animate = null;\n\n      this._sceneManager._activeScene.destroy();\n      this._sceneManager = null;\n      this._resourceManager.gc();\n      this._resourceManager = null;\n\n      this._canvas = null;\n\n      this.features = [];\n      this._time = null;\n\n      // todo: delete\n      (engineFeatureManager as any)._objects = [];\n    }\n  }\n\n  /**\n   * @internal\n   */\n  _getShaderProgramPool(shader: Shader): ShaderProgramPool {\n    const index = shader._shaderId;\n    const shaderProgramPools = this._shaderProgramPools;\n    let pool = shaderProgramPools[index];\n    if (!pool) {\n      const length = index + 1;\n      if (length < shaderProgramPools.length) {\n        shaderProgramPools.length = length;\n      }\n      shaderProgramPools[index] = pool = new ShaderProgramPool();\n    }\n    return pool;\n  }\n\n  _render(scene: Scene): void {\n    const cameras = scene._activeCameras;\n    const componentsManager = this._componentsManager;\n    const deltaTime = this.time.deltaTime;\n    componentsManager.callRendererOnUpdate(deltaTime);\n\n    scene._updateShaderData();\n\n    if (cameras.length > 0) {\n      // Sort on priority\n      //@ts-ignore\n      cameras.sort((camera1, camera2) => camera1.priority - camera2.priority);\n      for (let i = 0, l = cameras.length; i < l; i++) {\n        const camera = cameras[i];\n        const cameraEntity = camera.entity;\n        if (camera.enabled && cameraEntity.isActiveInHierarchy) {\n          componentsManager.callCameraOnBeginRender(camera);\n          Scene.sceneFeatureManager.callFeatureMethod(scene, \"preRender\", [scene, camera]); //TODO: will be removed\n          camera.render();\n          Scene.sceneFeatureManager.callFeatureMethod(scene, \"postRender\", [scene, camera]); //TODO: will be removed\n          componentsManager.callCameraOnEndRender(camera);\n        }\n      }\n    } else {\n      Logger.debug(\"NO active camera.\");\n    }\n  }\n\n  //-----------------------------------------@deprecated-----------------------------------\n\n  findFeature(Feature) {\n    return engineFeatureManager.findFeature(this, Feature);\n  }\n\n  static registerFeature(Feature: new () => EngineFeature): void {\n    engineFeatureManager.registerFeature(Feature);\n  }\n\n  features: EngineFeature[] = [];\n}\n","/**\n * System info.\n */\nexport class SystemInfo {\n  /**\n   * The pixel ratio of the device.\n   */\n  static get devicePixelRatio(): number {\n    return window.devicePixelRatio;\n  }\n}\n","import { Engine } from \"./Engine\";\nimport { Scene } from \"./Scene\";\n\n/**\n * Engine feature plug-in.\n * @deprecated\n */\nexport class EngineFeature {\n  /**\n   * Callback before the engine main loop runs,used to load resource.\n   * @param engine - Engine\n   */\n  public preLoad(engine: Engine): void {}\n\n  /**\n   * Callback before every engine tick.\n   * @param engine - Engine\n   * @param currentScene - Scene\n   */\n  public preTick(engine: Engine, currentScene: Scene): void {}\n\n  /**\n   * Callback after every engine tick.\n   * @param  engine - Engine\n   */\n  public postTick(engine: Engine, currentScene: Scene): void {}\n\n  /**\n   * Callback after the engine is destroyed.\n   * @param engine - Engine\n   */\n  public shutdown(engine: Engine): void {}\n}\n","import { Camera } from \"./Camera\";\nimport { ignoreClone } from \"./clone/CloneManager\";\nimport { Component } from \"./Component\";\n\n/**\n * Script class, used for logic writing.\n */\nexport class Script extends Component {\n  /** @internal */\n  @ignoreClone\n  _started: boolean = false;\n  /** @internal */\n  @ignoreClone\n  _onStartIndex: number = -1;\n  /** @internal */\n  @ignoreClone\n  _onUpdateIndex: number = -1;\n  /** @internal */\n  @ignoreClone\n  _onLateUpdateIndex: number = -1;\n  /** @internal */\n  @ignoreClone\n  _onPreRenderIndex: number = -1;\n  /** @internal */\n  @ignoreClone\n  _onPostRenderIndex: number = -1;\n\n  /**\n   * Called when be enabled first time, only once.\n   */\n  onAwake(): void {}\n\n  /**\n   * Called when be enabled.\n   */\n  onEnable(): void {}\n\n  /**\n   * Called before the frame-level loop start for the first time, only once.\n   */\n  onStart(): void {}\n\n  /**\n   * The main loop, called frame by frame.\n   * @param deltaTime - The deltaTime when the script update.\n   */\n  onUpdate(deltaTime: number): void {}\n\n  /**\n   * Called after the onUpdate finished, called frame by frame.\n   * @param deltaTime - The deltaTime when the script update.\n   */\n  onLateUpdate(deltaTime: number): void {}\n\n  /**\n   * Called before camera rendering, called per camera.\n   * @param camera - Current camera.\n   */\n  onBeginRender(camera: Camera): void {}\n\n  /**\n   * Called after camera rendering, called per camera.\n   * @param camera - Current camera.\n   */\n  onEndRender(camera: Camera): void {}\n\n  /**\n   * Called when be diabled.\n   */\n  onDisable(): void {}\n\n  /**\n   * Called at the end of the destroyed frame.\n   */\n  onDestroy(): void {}\n\n  /**\n   * @internal\n   * @inheritDoc\n   * @override\n   */\n  _onAwake(): void {\n    this.onAwake();\n  }\n\n  /**\n   * @internal\n   * @inheritDoc\n   * @override\n   */\n  _onEnable(): void {\n    const componentsManager = this.engine._componentsManager;\n    const prototype = Script.prototype;\n    if (!this._started) {\n      componentsManager.addOnStartScript(this);\n    }\n    if (this.onUpdate !== prototype.onUpdate) {\n      componentsManager.addOnUpdateScript(this);\n    }\n    if (this.onLateUpdate !== prototype.onLateUpdate) {\n      componentsManager.addOnLateUpdateScript(this);\n    }\n    this.onEnable();\n  }\n\n  /**\n   * @internal\n   * @inheritDoc\n   * @override\n   */\n  _onDisable(): void {\n    const componentsManager = this.engine._componentsManager;\n    // Use \"xxIndex\" is more safe.\n    // When call onDisable it maybe it still not in script queue,for example write \"entity.isActive = false\" in onWake().\n    if (this._onStartIndex !== -1) {\n      componentsManager.removeOnStartScript(this);\n    }\n    if (this._onUpdateIndex !== -1) {\n      componentsManager.removeOnUpdateScript(this);\n    }\n    if (this._onLateUpdateIndex !== -1) {\n      componentsManager.removeOnLateUpdateScript(this);\n    }\n    this.onDisable();\n  }\n\n  /**\n   * @internal\n   * @inheritDoc\n   * @override\n   */\n  _onDestroy(): void {\n    this.engine._componentsManager.addDestoryComponent(this);\n  }\n}\n","import { BoundingBox, Matrix, Vector3 } from \"@oasis-engine/math\";\nimport { Camera } from \"./Camera\";\nimport { deepClone, ignoreClone } from \"./clone/CloneManager\";\nimport { Component } from \"./Component\";\nimport { Entity } from \"./Entity\";\nimport { RenderContext } from \"./RenderPipeline/RenderContext\";\nimport { Shader } from \"./shader\";\nimport { ShaderDataGroup } from \"./shader/enums/ShaderDataGroup\";\nimport { ShaderData } from \"./shader/ShaderData\";\nimport { ShaderMacroCollection } from \"./shader/ShaderMacroCollection\";\nimport { UpdateFlag } from \"./UpdateFlag\";\n\n/**\n * Renderable components.\n */\nexport abstract class Renderer extends Component {\n  private static _localMatrixProperty = Shader.getPropertyByName(\"u_localMat\");\n  private static _worldMatrixProperty = Shader.getPropertyByName(\"u_modelMat\");\n  private static _mvMatrixProperty = Shader.getPropertyByName(\"u_MVMat\");\n  private static _mvpMatrixProperty = Shader.getPropertyByName(\"u_MVPMat\");\n  private static _mvInvMatrixProperty = Shader.getPropertyByName(\"u_MVInvMat\");\n  private static _normalMatrixProperty = Shader.getPropertyByName(\"u_normalMat\");\n\n  /** ShaderData related to renderer. */\n  @deepClone\n  readonly shaderData: ShaderData = new ShaderData(ShaderDataGroup.Renderer);\n  /** Whether it is clipped by the frustum, needs to be turned on camera.enableFrustumCullingã€‚ */\n  @ignoreClone\n  isCulled: boolean = false;\n\n  /** @internal */\n  @ignoreClone\n  _onUpdateIndex: number = -1;\n\n  /** @internal */\n  @ignoreClone\n  _rendererIndex: number = -1;\n\n  /** @internal */\n  @ignoreClone\n  _globalShaderMacro: ShaderMacroCollection = new ShaderMacroCollection();\n\n  @ignoreClone\n  protected _overrideUpdate: boolean = false;\n\n  @ignoreClone\n  private _transformChangeFlag: UpdateFlag;\n  @deepClone\n  private _bounds: BoundingBox = new BoundingBox(new Vector3(), new Vector3());\n  @ignoreClone\n  private _mvMatrix: Matrix = new Matrix();\n  @ignoreClone\n  private _mvpMatrix: Matrix = new Matrix();\n  @ignoreClone\n  private _mvInvMatrix: Matrix = new Matrix();\n  @ignoreClone\n  private _normalMatrix: Matrix = new Matrix();\n\n  /**\n   * The bounding volume of the renderer.\n   */\n  get bounds(): BoundingBox {\n    const changeFlag = this._transformChangeFlag;\n    if (changeFlag.flag) {\n      this._updateBounds(this._bounds);\n      changeFlag.flag = false;\n    }\n    return this._bounds;\n  }\n\n  /**\n   * @internal\n   */\n  constructor(entity: Entity) {\n    super(entity);\n    const prototype = Renderer.prototype;\n    this._overrideUpdate = this.update !== prototype.update;\n    this._transformChangeFlag = this.entity.transform.registerWorldChangeFlag();\n    this.shaderData._addRefCount(1);\n  }\n\n  /**\n   * @internal\n   */\n  _updateShaderData(context: RenderContext) {\n    const shaderData = this.shaderData;\n    const worldMatrix = this.entity.transform.worldMatrix;\n    const mvMatrix = this._mvMatrix;\n    const mvpMatrix = this._mvpMatrix;\n    const mvInvMatrix = this._mvInvMatrix;\n    const normalMatrix = this._normalMatrix;\n\n    Matrix.multiply(context._camera.viewMatrix, worldMatrix, mvMatrix);\n    Matrix.multiply(context._viewProjectMatrix, worldMatrix, mvpMatrix);\n    Matrix.invert(mvMatrix, mvInvMatrix);\n    Matrix.invert(worldMatrix, normalMatrix);\n    normalMatrix.transpose();\n\n    shaderData.setMatrix(Renderer._localMatrixProperty, this.entity.transform.localMatrix);\n    shaderData.setMatrix(Renderer._worldMatrixProperty, worldMatrix);\n    shaderData.setMatrix(Renderer._mvMatrixProperty, mvMatrix);\n    shaderData.setMatrix(Renderer._mvpMatrixProperty, mvpMatrix);\n    shaderData.setMatrix(Renderer._mvInvMatrixProperty, mvInvMatrix);\n    shaderData.setMatrix(Renderer._normalMatrixProperty, normalMatrix);\n  }\n\n  /**\n   * @internal\n   */\n  _onDestroy(): void {\n    const flag = this._transformChangeFlag;\n    if (flag) {\n      flag.destroy();\n      this._transformChangeFlag = null;\n    }\n    this.shaderData._addRefCount(-1);\n  }\n\n  abstract render(camera: Camera): void;\n\n  update(deltaTime: number): void {}\n\n  protected _updateBounds(worldBounds: any): void {}\n\n  _onEnable() {\n    const componentsManager = this.engine._componentsManager;\n    if (this._overrideUpdate) {\n      componentsManager.addOnUpdateRenderers(this);\n    }\n    componentsManager.addRenderer(this);\n  }\n\n  _onDisable() {\n    const componentsManager = this.engine._componentsManager;\n    if (this._overrideUpdate) {\n      componentsManager.removeOnUpdateRenderers(this);\n    }\n    componentsManager.removeRenderer(this);\n  }\n\n  _render(camera: Camera) {\n    this.render(camera);\n  }\n}\n","/**\n * Transparent mode.\n */\nexport enum AlphaMode {\n  /** Opaque mode. */\n  Opaque,\n  /** Color blending mode. */\n  Blend,\n  /** Transparency cutoff mode. */\n  CutOff\n}\n","import { IClone } from \"@oasis-engine/design\";\nimport { RefObject } from \"../asset/RefObject\";\nimport { CloneManager } from \"../clone/CloneManager\";\nimport { Engine } from \"../Engine\";\nimport { RenderElement } from \"../RenderPipeline/RenderElement\";\nimport { ShaderDataGroup } from \"../shader/enums/ShaderDataGroup\";\nimport { Shader } from \"../shader/Shader\";\nimport { ShaderData } from \"../shader/ShaderData\";\nimport { RenderState } from \"../shader/state/RenderState\";\nimport { RenderQueueType } from \"./enums/RenderQueueType\";\n\n/**\n * Material.\n */\nexport class Material extends RefObject implements IClone {\n  /** Shader used by the material. */\n  shader: Shader;\n  /** Render queue type. */\n  renderQueueType: RenderQueueType = RenderQueueType.Opaque;\n  /** Shader data. */\n  readonly shaderData: ShaderData = new ShaderData(ShaderDataGroup.Material);\n  /** Render state. */\n  readonly renderState: RenderState = new RenderState(); // todo: later will as a part of shaderData when shader effect frame is OK, that is more powerful and flexible.\n\n  /**\n   * Create a material instance.\n   * @param engine - Engine to which the material belongs\n   * @param shader - Shader used by the material\n   */\n  constructor(engine: Engine, shader: Shader) {\n    super(engine);\n    this.shader = shader;\n  }\n\n  /**\n   * Clone and return the instance.\n   */\n  clone(): Material {\n    const dest = new Material(this._engine, this.shader);\n    this.cloneTo(dest);\n    return dest;\n  }\n\n  /**\n   * Clone to the target material.\n   * @param target - target material\n   */\n  cloneTo(target: Material): void {\n    target.shader = this.shader;\n    target.renderQueueType = this.renderQueueType;\n    this.shaderData.cloneTo(target.shaderData);\n    CloneManager.deepCloneObject(this.renderState, target.renderState);\n  }\n\n  /**\n   * @override\n   */\n  _addRefCount(value: number): void {\n    super._addRefCount(value);\n    this.shaderData._addRefCount(value);\n  }\n\n  /**\n   * @internal\n   * @todo:temporary solution\n   */\n  _preRender(renderElement: RenderElement) {}\n\n  /**\n   * @override\n   */\n  protected _onDestroy(): void {}\n}\n","import { Color } from \"@oasis-engine/math\";\nimport { Engine } from \"../Engine\";\nimport { BlendFactor } from \"../shader/enums/BlendFactor\";\nimport { BlendOperation } from \"../shader/enums/BlendOperation\";\nimport { CullMode } from \"../shader/enums/CullMode\";\nimport { Shader } from \"../shader/Shader\";\nimport { Texture2D } from \"../texture/Texture2D\";\nimport { AlphaMode } from \"./enums/AlphaMode\";\nimport { RenderQueueType } from \"./enums/RenderQueueType\";\nimport { Material } from \"./Material\";\n\n/**\n * Blinn-phong Material.\n */\nexport class BlinnPhongMaterial extends Material {\n  private _emissiveColor: Color = new Color(0, 0, 0, 1);\n  private _diffuseColor: Color = new Color(1, 1, 1, 1);\n  private _specularColor: Color = new Color(1, 1, 1, 1);\n  private _emissiveTexture: Texture2D;\n  private _diffuseTexture: Texture2D;\n  private _specularTexture: Texture2D;\n  private _shininess: number = 16;\n  private _alphaMode: AlphaMode = AlphaMode.Opaque;\n  private _doubleSided: boolean = false;\n\n  /**\n   * Emissive color.\n   */\n  get emissiveColor(): Color {\n    return this._emissiveColor;\n  }\n\n  set emissiveColor(value: Color) {\n    this._emissiveColor = value;\n    this.shaderData.setColor(\"u_emissiveColor\", value);\n  }\n\n  /**\n   * Emissive texture.\n   */\n  get emissiveTexture(): Texture2D {\n    return this._emissiveTexture;\n  }\n\n  set emissiveTexture(value: Texture2D) {\n    this._emissiveTexture = value;\n\n    if (value) {\n      this.shaderData.enableMacro(\"O3_EMISSIVE_TEXTURE\");\n      this.shaderData.setTexture(\"u_emissiveTexture\", value);\n    } else {\n      this.shaderData.disableMacro(\"O3_EMISSIVE_TEXTURE\");\n    }\n  }\n\n  /**\n   * Diffuse color.\n   */\n  get diffuseColor(): Color {\n    return this._diffuseColor;\n  }\n\n  set diffuseColor(value: Color) {\n    this._diffuseColor = value;\n    this.shaderData.setColor(\"u_diffuseColor\", value);\n  }\n\n  /**\n   * Diffuse texture.\n   */\n  get diffuseTexture(): Texture2D {\n    return this._diffuseTexture;\n  }\n\n  set diffuseTexture(value: Texture2D) {\n    this._diffuseTexture = value;\n\n    if (value) {\n      this.shaderData.enableMacro(\"O3_DIFFUSE_TEXTURE\");\n      this.shaderData.setTexture(\"u_diffuseTexture\", value);\n    } else {\n      this.shaderData.disableMacro(\"O3_DIFFUSE_TEXTURE\");\n    }\n  }\n\n  /**\n   * Specular color.\n   */\n  get specularColor(): Color {\n    return this._specularColor;\n  }\n\n  set specularColor(value: Color) {\n    this._specularColor = value;\n    this.shaderData.setColor(\"u_specularColor\", value);\n  }\n\n  /**\n   * Specular texture.\n   */\n  get specularTexture(): Texture2D {\n    return this._specularTexture;\n  }\n\n  set specularTexture(value: Texture2D) {\n    this._specularTexture = value;\n\n    if (value) {\n      this.shaderData.enableMacro(\"O3_SPECULAR_TEXTURE\");\n      this.shaderData.setTexture(\"u_specularTexture\", value);\n    } else {\n      this.shaderData.disableMacro(\"O3_SPECULAR_TEXTURE\");\n    }\n  }\n\n  /**\n   * Set the specular reflection coefficient, the larger the value, the more convergent the specular reflection effect.\n   */\n  get shininess(): number {\n    return this._shininess;\n  }\n\n  set shininess(value: number) {\n    this._shininess = value;\n    this.shaderData.setFloat(\"u_shininess\", value);\n  }\n\n  /**\n   * Transparent mode.\n   */\n  get alphaMode(): AlphaMode {\n    return this._alphaMode;\n  }\n\n  set alphaMode(v: AlphaMode) {\n    const target = this.renderState.blendState.targetBlendState;\n    const depthState = this.renderState.depthState;\n\n    switch (v) {\n      case AlphaMode.Opaque:\n      case AlphaMode.CutOff:\n        {\n          target.sourceColorBlendFactor = target.sourceAlphaBlendFactor = BlendFactor.One;\n          target.destinationColorBlendFactor = target.destinationAlphaBlendFactor = BlendFactor.Zero;\n          target.colorBlendOperation = target.alphaBlendOperation = BlendOperation.Add;\n          depthState.writeEnabled = true;\n          this.renderQueueType = RenderQueueType.Opaque;\n        }\n        break;\n      case AlphaMode.Blend:\n        {\n          target.sourceColorBlendFactor = target.sourceAlphaBlendFactor = BlendFactor.SourceAlpha;\n          target.destinationColorBlendFactor = target.destinationAlphaBlendFactor = BlendFactor.OneMinusSourceAlpha;\n          target.colorBlendOperation = target.alphaBlendOperation = BlendOperation.Add;\n          depthState.writeEnabled = false;\n          this.renderQueueType = RenderQueueType.Transparent;\n        }\n        break;\n    }\n  }\n\n  /**\n   * Whether to render both sides.\n   * @remarks Only the front side is rendered by default\n   */\n  get doubleSided(): boolean {\n    return this._doubleSided;\n  }\n\n  set doubleSided(v: boolean) {\n    if (v) {\n      this.renderState.rasterState.cullMode = CullMode.Off;\n    } else {\n      this.renderState.rasterState.cullMode = CullMode.Back;\n    }\n  }\n\n  constructor(engine: Engine) {\n    super(engine, Shader.find(\"blinn-phong\"));\n    this.shaderData.enableMacro(\"O3_NEED_WORLDPOS\");\n\n    this.emissiveColor = this._emissiveColor;\n    this.diffuseColor = this._diffuseColor;\n    this.specularColor = this._specularColor;\n    this.shininess = this._shininess;\n  }\n\n  /**\n   * @override\n   */\n  clone(): BlinnPhongMaterial {\n    var dest: BlinnPhongMaterial = new BlinnPhongMaterial(this._engine);\n    this.cloneTo(dest);\n    return dest;\n  }\n}\n","import { Color, Matrix } from \"@oasis-engine/math\";\nimport { Engine } from \"../Engine\";\nimport { BlendFactor } from \"../shader/enums/BlendFactor\";\nimport { BlendOperation } from \"../shader/enums/BlendOperation\";\nimport { CullMode } from \"../shader/enums/CullMode\";\nimport { Shader } from \"../shader/Shader\";\nimport { TextureCubeMap } from \"../texture\";\nimport { Texture2D } from \"../texture/Texture2D\";\nimport { AlphaMode } from \"./enums/AlphaMode\";\nimport { RenderQueueType } from \"./enums/RenderQueueType\";\nimport { Material } from \"./Material\";\n\n/**\n * PBR (Physically-Based Rendering) Material.\n */\nexport abstract class PBRBaseMaterial extends Material {\n  private _baseColor: Color = new Color(1, 1, 1, 1);\n  private _normalScale: number = 1;\n  private _emissiveColor = new Color(0, 0, 0, 1);\n  private _occlusionStrength: number = 1;\n  private _alphaCutoff: number = 0.5;\n  private _envMapIntensity: number = 1;\n  private _refractionRatio: number = 1 / 1.33;\n  private _refractionDepth: number = 1;\n  private _perturbationUOffset: number = 0;\n  private _perturbationVOffset: number = 0;\n  private _PTMMatrix = new Matrix(0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.5, 0.5, 0.5, 1.0);\n  private _baseColorTexture: Texture2D;\n  private _opacityTexture: Texture2D;\n  private _normalTexture: Texture2D;\n  private _emissiveTexture: Texture2D;\n  private _occlusionTexture: Texture2D;\n  private _reflectionTexture: TextureCubeMap;\n  private _refractionTexture: Texture2D;\n  private _perturbationTexture: Texture2D;\n\n  private _srgb: boolean = false;\n  private _srgbFast: boolean = false;\n  private _gamma: boolean = false;\n  private _getOpacityFromRGB: boolean = false;\n  private _envMapModeRefract: boolean = false;\n  private _alphaMode: AlphaMode = AlphaMode.Opaque;\n  private _doubleSided: boolean = false;\n\n  /**\n   * Base color.\n   */\n  get baseColor(): Color {\n    return this._baseColor;\n  }\n\n  set baseColor(v: Color) {\n    this._baseColor = v;\n    this.shaderData.setColor(\"u_baseColorFactor\", v);\n  }\n\n  /**\n   * Base color texture.\n   */\n  get baseColorTexture(): Texture2D {\n    return this._baseColorTexture;\n  }\n\n  set baseColorTexture(v: Texture2D) {\n    this._baseColorTexture = v;\n\n    if (v) {\n      this.shaderData.enableMacro(\"HAS_BASECOLORMAP\");\n      this.shaderData.setTexture(\"u_baseColorSampler\", v);\n    } else {\n      this.shaderData.disableMacro(\"HAS_BASECOLORMAP\");\n    }\n  }\n\n  /**\n   * Transparent coefficient.\n   */\n  get opacity(): number {\n    return this.baseColor.a;\n  }\n\n  set opacity(val: number) {\n    this.baseColor.a = val;\n  }\n\n  /**\n   * Transparent texture.\n   * */\n  get opacityTexture(): Texture2D {\n    return this._opacityTexture;\n  }\n\n  set opacityTexture(v: Texture2D) {\n    this._opacityTexture = v;\n\n    if (v) {\n      this.shaderData.enableMacro(\"HAS_OPACITYMAP\");\n      this.shaderData.setTexture(\"u_opacitySampler\", v);\n    } else {\n      this.shaderData.disableMacro(\"HAS_OPACITYMAP\");\n    }\n  }\n\n  /**\n   * Normal texture.\n   */\n  get normalTexture(): Texture2D {\n    return this._normalTexture;\n  }\n\n  set normalTexture(v: Texture2D) {\n    this._normalTexture = v;\n\n    if (v) {\n      this.shaderData.enableMacro(\"O3_HAS_NORMALMAP\");\n      this.shaderData.setTexture(\"u_normalSampler\", v);\n    } else {\n      this.shaderData.disableMacro(\"O3_HAS_NORMALMAP\");\n    }\n  }\n\n  /**\n   * Normal scale factor.\n   */\n  get normalScale(): number {\n    return this._normalScale;\n  }\n\n  set normalScale(v: number) {\n    this._normalScale = v;\n    this.shaderData.setFloat(\"u_normalScale\", v);\n  }\n\n  /**\n   * Emissive texture.\n   */\n  get emissiveTexture(): Texture2D {\n    return this._emissiveTexture;\n  }\n\n  set emissiveTexture(v: Texture2D) {\n    this._emissiveTexture = v;\n\n    if (v) {\n      this.shaderData.enableMacro(\"HAS_EMISSIVEMAP\");\n      this.shaderData.setTexture(\"u_emissiveSampler\", v);\n    } else {\n      this.shaderData.disableMacro(\"HAS_EMISSIVEMAP\");\n    }\n  }\n\n  /**\n   * Emissive color.\n   */\n  get emissiveColor(): Color {\n    return this._emissiveColor;\n  }\n\n  set emissiveColor(v: Color) {\n    this._emissiveColor = v;\n    this.shaderData.setColor(\"u_emissiveFactor\", v);\n  }\n\n  /**\n   * Occlusive texture.\n   */\n  get occlusionTexture(): Texture2D {\n    return this._occlusionTexture;\n  }\n\n  set occlusionTexture(v: Texture2D) {\n    this._occlusionTexture = v;\n\n    if (v) {\n      this.shaderData.enableMacro(\"HAS_OCCLUSIONMAP\");\n      this.shaderData.setTexture(\"u_occlusionSampler\", v);\n    } else {\n      this.shaderData.disableMacro(\"HAS_OCCLUSIONMAP\");\n    }\n  }\n\n  /**\n   * Occlusive intensity.\n   */\n  get occlusionStrength(): number {\n    return this._occlusionStrength;\n  }\n\n  set occlusionStrength(v: number) {\n    this._occlusionStrength = v;\n    this.shaderData.setFloat(\"u_occlusionStrength\", v);\n  }\n\n  /**\n   * Alpha cutoff value.\n   * @remarks fragments with alpha channel lower than cutoff value will be discarded.\n   */\n  get alphaCutoff(): number {\n    return this._alphaCutoff;\n  }\n\n  set alphaCutoff(v: number) {\n    this._alphaCutoff = v;\n    this.shaderData.setFloat(\"u_alphaCutoff\", v);\n  }\n\n  /**\n   * Reflection texture.\n   * @remarks if this texture is not set, the global environmentMapLight's specularTexture will be used.\n   */\n  get reflectionTexture(): TextureCubeMap {\n    return this._reflectionTexture;\n  }\n\n  set reflectionTexture(v: TextureCubeMap) {\n    this._reflectionTexture = v;\n\n    if (v) {\n      this.shaderData.enableMacro(\"HAS_REFLECTIONMAP\");\n      this.shaderData.setTexture(\"u_reflectionSampler\", v);\n    } else {\n      this.shaderData.disableMacro(\"HAS_REFLECTIONMAP\");\n    }\n  }\n\n  /**\n   * Reflection intensity.\n   */\n  get envMapIntensity(): number {\n    return this._envMapIntensity;\n  }\n\n  set envMapIntensity(v: number) {\n    this._envMapIntensity = v;\n    this.shaderData.setFloat(\"u_envMapIntensity\", v);\n  }\n\n  /**\n   * The ratio of IOR(index of refraction) from air to medium.eg. 1 / 1.33 from air to water.\n   */\n  get refractionRatio(): number {\n    return this._refractionRatio;\n  }\n\n  set refractionRatio(v: number) {\n    this._refractionRatio = v;\n    this.shaderData.setFloat(\"u_refractionRatio\", v);\n  }\n\n  /**\n   * The depth value of the local refraction texture, used to simulate the refraction distance.\n   */\n  get refractionDepth(): number {\n    return this._refractionDepth;\n  }\n\n  set refractionDepth(v: number) {\n    this._refractionDepth = v;\n    this.shaderData.setFloat(\"u_refractionDepth\", v);\n  }\n\n  /**\n   * Local refraction texture.\n   */\n  get refractionTexture(): Texture2D {\n    return this._refractionTexture;\n  }\n\n  set refractionTexture(v: Texture2D) {\n    this._refractionTexture = v;\n\n    if (v) {\n      this.shaderData.enableMacro(\"HAS_REFRACTIONMAP\");\n      this.shaderData.setTexture(\"u_refractionSampler\", v);\n      this.shaderData.setMatrix(\"u_PTMMatrix\", this._PTMMatrix);\n    } else {\n      this.shaderData.disableMacro(\"HAS_REFRACTIONMAP\");\n    }\n  }\n\n  /**\n   * Perturbation texture.\n   */\n  get perturbationTexture(): Texture2D {\n    return this._perturbationTexture;\n  }\n\n  set perturbationTexture(v: Texture2D) {\n    this._perturbationTexture = v;\n\n    if (v) {\n      this.shaderData.enableMacro(\"HAS_PERTURBATIONMAP\");\n      this.shaderData.setTexture(\"u_perturbationSampler\", v);\n    } else {\n      this.shaderData.disableMacro(\"HAS_PERTURBATIONMAP\");\n    }\n  }\n\n  /**\n   * Offset of the perturbation texture coordinate on S.\n   */\n  get perturbationUOffset(): number {\n    return this._perturbationUOffset;\n  }\n\n  set perturbationUOffset(v: number) {\n    this._perturbationUOffset = v;\n    this.shaderData.setFloat(\"u_perturbationUOffset\", v);\n  }\n\n  /**\n   * Offset of the perturbation texture coordinate on T.\n   */\n  get perturbationVOffset(): number {\n    return this._perturbationVOffset;\n  }\n\n  set perturbationVOffset(v: number) {\n    this._perturbationVOffset = v;\n    this.shaderData.setFloat(\"u_perturbationVOffset\", v);\n  }\n\n  /**\n   * Whether to use SRGB color space.\n   */\n  get srgb(): boolean {\n    return this._srgb;\n  }\n\n  set srgb(v: boolean) {\n    this._srgb = v;\n\n    if (v) {\n      this.shaderData.enableMacro(\"MANUAL_SRGB\");\n    } else {\n      this.shaderData.disableMacro(\"MANUAL_SRGB\");\n    }\n  }\n\n  /**\n   * Whether sRGB linear correction uses approximate fast algorithm.\n   * */\n  get srgbFast(): boolean {\n    return this._srgbFast;\n  }\n\n  set srgbFast(v: boolean) {\n    this._srgbFast = v;\n\n    if (v) {\n      this.shaderData.enableMacro(\"SRGB_FAST_APPROXIMATION\");\n    } else {\n      this.shaderData.disableMacro(\"SRGB_FAST_APPROXIMATION\");\n    }\n  }\n\n  /**\n   * Whether to use Gamma correction.\n   */\n  get gamma(): boolean {\n    return this._gamma;\n  }\n\n  set gamma(v: boolean) {\n    this._gamma = v;\n\n    if (v) {\n      this.shaderData.enableMacro(\"GAMMA\");\n    } else {\n      this.shaderData.disableMacro(\"GAMMA\");\n    }\n  }\n\n  /**\n   * Whether to take the brightness value of the opacityTexture as the transparency.\n   */\n  get getOpacityFromRGB(): boolean {\n    return this._getOpacityFromRGB;\n  }\n\n  set getOpacityFromRGB(v: boolean) {\n    this._getOpacityFromRGB = v;\n\n    if (v) {\n      this.shaderData.enableMacro(\"GETOPACITYFROMRGB\");\n    } else {\n      this.shaderData.disableMacro(\"GETOPACITYFROMRGB\");\n    }\n  }\n\n  /**\n   * Whether to refract global environmentMapLight, default reflection.\n   * */\n  get envMapModeRefract(): boolean {\n    return this._envMapModeRefract;\n  }\n\n  set envMapModeRefract(v: boolean) {\n    this._envMapModeRefract = v;\n\n    if (v) {\n      this.shaderData.enableMacro(\"ENVMAPMODE_REFRACT\");\n    } else {\n      this.shaderData.disableMacro(\"ENVMAPMODE_REFRACT\");\n    }\n  }\n\n  /**\n   * Transparent mode.\n   */\n  get alphaMode(): AlphaMode {\n    return this._alphaMode;\n  }\n\n  set alphaMode(v: AlphaMode) {\n    const target = this.renderState.blendState.targetBlendState;\n    const depthState = this.renderState.depthState;\n\n    this.shaderData.disableMacro(\"ALPHA_CUTOFF\");\n    this.shaderData.disableMacro(\"ALPHA_BLEND\");\n\n    switch (v) {\n      case AlphaMode.Opaque:\n        {\n          target.sourceColorBlendFactor = target.sourceAlphaBlendFactor = BlendFactor.One;\n          target.destinationColorBlendFactor = target.destinationAlphaBlendFactor = BlendFactor.Zero;\n          target.colorBlendOperation = target.alphaBlendOperation = BlendOperation.Add;\n          depthState.writeEnabled = true;\n          this.renderQueueType = RenderQueueType.Opaque;\n        }\n        break;\n      case AlphaMode.Blend:\n        {\n          this.shaderData.enableMacro(\"ALPHA_BLEND\");\n          target.sourceColorBlendFactor = target.sourceAlphaBlendFactor = BlendFactor.SourceAlpha;\n          target.destinationColorBlendFactor = target.destinationAlphaBlendFactor = BlendFactor.OneMinusSourceAlpha;\n          target.colorBlendOperation = target.alphaBlendOperation = BlendOperation.Add;\n          depthState.writeEnabled = false;\n          this.renderQueueType = RenderQueueType.Transparent;\n        }\n        break;\n      case AlphaMode.CutOff:\n        {\n          this.shaderData.enableMacro(\"ALPHA_CUTOFF\");\n          target.sourceColorBlendFactor = target.sourceAlphaBlendFactor = BlendFactor.One;\n          target.destinationColorBlendFactor = target.destinationAlphaBlendFactor = BlendFactor.Zero;\n          target.colorBlendOperation = target.alphaBlendOperation = BlendOperation.Add;\n          depthState.writeEnabled = true;\n          this.renderQueueType = RenderQueueType.AlphaTest;\n        }\n        break;\n    }\n  }\n\n  /**\n   * Whether to render both sides.\n   * @remarks Only the front side is rendered by default\n   */\n  get doubleSided(): boolean {\n    return this._doubleSided;\n  }\n\n  set doubleSided(v: boolean) {\n    if (v) {\n      this.renderState.rasterState.cullMode = CullMode.Off;\n    } else {\n      this.renderState.rasterState.cullMode = CullMode.Back;\n    }\n  }\n\n  /**\n   * Create a pbr base material instance.\n   * @param engine - Engine to which the material belongs\n   */\n  constructor(engine: Engine) {\n    super(engine, Shader.find(\"pbr\"));\n    this.shaderData.enableMacro(\"O3_NEED_WORLDPOS\");\n\n    this.baseColor = this._baseColor;\n    this.normalScale = this._normalScale;\n    this.emissiveColor = this._emissiveColor;\n    this.occlusionStrength = this._occlusionStrength;\n    this.alphaCutoff = this._alphaCutoff;\n    this.envMapIntensity = this._envMapIntensity;\n    this.refractionRatio = this._refractionRatio;\n    this.refractionDepth = this._refractionDepth;\n    this.perturbationUOffset = this._perturbationUOffset;\n    this.perturbationVOffset = this._perturbationVOffset;\n\n    this.srgb = this._srgb;\n    this.srgbFast = this._srgbFast;\n    this.gamma = this._gamma;\n    this.getOpacityFromRGB = this._getOpacityFromRGB;\n    this.envMapModeRefract = this._envMapModeRefract;\n    this.alphaMode = this._alphaMode;\n  }\n}\n","import { Engine } from \"../Engine\";\nimport { Texture2D } from \"../texture/Texture2D\";\nimport { PBRBaseMaterial } from \"./PBRBaseMaterial\";\n\n/**\n * PBR (Metallic-Roughness Workflow) Material.\n */\nexport class PBRMaterial extends PBRBaseMaterial {\n  private _metallicFactor: number = 1;\n  private _roughnessFactor: number = 1;\n  private _metallicTexture: Texture2D;\n  private _roughnessTexture: Texture2D;\n  private _metallicRoughnessTexture: Texture2D;\n\n  /**\n   * Metallic factor.\n   */\n  get metallicFactor(): number {\n    return this._metallicFactor;\n  }\n\n  set metallicFactor(v: number) {\n    this._metallicFactor = v;\n    this.shaderData.setFloat(\"u_metal\", v);\n  }\n\n  /**\n   * Rough factor.\n   */\n  get roughnessFactor(): number {\n    return this._roughnessFactor;\n  }\n\n  set roughnessFactor(v: number) {\n    this._roughnessFactor = v;\n    this.shaderData.setFloat(\"u_roughness\", v);\n  }\n\n  /**\n   * Metallic texture.\n   */\n  get metallicTexture(): Texture2D {\n    return this._metallicTexture;\n  }\n\n  set metallicTexture(v: Texture2D) {\n    this._metallicTexture = v;\n\n    if (v) {\n      this.shaderData.enableMacro(\"HAS_METALMAP\");\n      this.shaderData.setTexture(\"u_metallicSampler\", v);\n    } else {\n      this.shaderData.disableMacro(\"HAS_METALMAP\");\n    }\n  }\n\n  /**\n   * Rough texture.\n   */\n  get roughnessTexture(): Texture2D {\n    return this._roughnessTexture;\n  }\n\n  set roughnessTexture(v: Texture2D) {\n    this._roughnessTexture = v;\n\n    if (v) {\n      this.shaderData.enableMacro(\"HAS_ROUGHNESSMAP\");\n      this.shaderData.setTexture(\"u_roughnessSampler\", v);\n    } else {\n      this.shaderData.disableMacro(\"HAS_ROUGHNESSMAP\");\n    }\n  }\n\n  /**\n   * Metallic rough texture.\n   */\n  get metallicRoughnessTexture(): Texture2D {\n    return this._metallicRoughnessTexture;\n  }\n\n  set metallicRoughnessTexture(v: Texture2D) {\n    this._metallicRoughnessTexture = v;\n\n    if (v) {\n      this.shaderData.enableMacro(\"HAS_METALROUGHNESSMAP\");\n      this.shaderData.setTexture(\"u_metallicRoughnessSampler\", v);\n    } else {\n      this.shaderData.disableMacro(\"HAS_METALROUGHNESSMAP\");\n    }\n  }\n\n  /**\n   * Create a pbr metallic-roughness workflow material instance.\n   * @param engine - Engine to which the material belongs\n   */\n  constructor(engine: Engine) {\n    super(engine);\n    this.shaderData.enableMacro(\"IS_METALLIC_WORKFLOW\");\n\n    this.metallicFactor = this._metallicFactor;\n    this.roughnessFactor = this._roughnessFactor;\n  }\n\n  /**\n   * @override\n   */\n  clone(): PBRMaterial {\n    const dest = new PBRMaterial(this._engine);\n    this.cloneTo(dest);\n    return dest;\n  }\n}\n","import { Color } from \"@oasis-engine/math\";\nimport { Engine } from \"../Engine\";\nimport { Texture2D } from \"../texture/Texture2D\";\nimport { PBRBaseMaterial } from \"./PBRBaseMaterial\";\n\n/**\n * PBR (Specular-Glossiness Workflow) Material.\n */\nexport class PBRSpecularMaterial extends PBRBaseMaterial {\n  private _specularColor = new Color(1, 1, 1, 1);\n  private _glossinessFactor: number = 1;\n  private _specularGlossinessTexture: Texture2D;\n\n  /**\n   * Specular color.\n   */\n  get specularColor(): Color {\n    return this._specularColor;\n  }\n\n  set specularColor(v: Color) {\n    this._specularColor = v;\n    this.shaderData.setColor(\"u_specularFactor\", v);\n  }\n\n  /**\n   * Glossiness factor.\n   */\n  get glossinessFactor(): number {\n    return this._glossinessFactor;\n  }\n\n  set glossinessFactor(v: number) {\n    this._glossinessFactor = v;\n    this.shaderData.setFloat(\"u_glossinessFactor\", v);\n  }\n\n  /**\n   * Specular and glossiness texture.\n   */\n  get specularGlossinessTexture(): Texture2D {\n    return this._specularGlossinessTexture;\n  }\n\n  set specularGlossinessTexture(v: Texture2D) {\n    this._specularGlossinessTexture = v;\n\n    if (v) {\n      this.shaderData.enableMacro(\"HAS_SPECULARGLOSSINESSMAP\");\n      this.shaderData.setTexture(\"u_specularGlossinessSampler\", v);\n    } else {\n      this.shaderData.disableMacro(\"HAS_SPECULARGLOSSINESSMAP\");\n    }\n  }\n\n  /**\n   * Create a pbr specular-glossiness workflow material instance.\n   * @param engine - Engine to which the material belongs\n   */\n  constructor(engine: Engine) {\n    super(engine);\n\n    this.specularColor = this._specularColor;\n    this.glossinessFactor = this._glossinessFactor;\n  }\n\n  /**\n   * @override\n   */\n  clone(): PBRSpecularMaterial {\n    const dest = new PBRSpecularMaterial(this._engine);\n    this.cloneTo(dest);\n    return dest;\n  }\n}\n","import { Color } from \"@oasis-engine/math\";\nimport { Engine } from \"../Engine\";\nimport { BlendFactor } from \"../shader/enums/BlendFactor\";\nimport { BlendOperation } from \"../shader/enums/BlendOperation\";\nimport { CullMode } from \"../shader/enums/CullMode\";\nimport { Shader } from \"../shader/Shader\";\nimport { Texture2D } from \"../texture/Texture2D\";\nimport { AlphaMode } from \"./enums/AlphaMode\";\nimport { RenderQueueType } from \"./enums/RenderQueueType\";\nimport { Material } from \"./Material\";\n\n/**\n * Unlit Material.\n */\nexport class UnlitMaterial extends Material {\n  private _baseColor: Color = new Color(1, 1, 1, 1);\n  private _baseColorTexture: Texture2D;\n  private _alphaMode: AlphaMode = AlphaMode.Opaque;\n  private _doubleSided: boolean = false;\n\n  /**\n   * Base color.\n   */\n  get baseColor(): Color {\n    return this._baseColor;\n  }\n\n  set baseColor(value: Color) {\n    this._baseColor = value;\n    this.shaderData.setColor(\"u_baseColor\", value);\n  }\n\n  /**\n   * Base color texture.\n   */\n  get baseColorTexture(): Texture2D {\n    return this._baseColorTexture;\n  }\n\n  set baseColorTexture(value: Texture2D) {\n    this._baseColorTexture = value;\n\n    if (value) {\n      this.shaderData.enableMacro(\"O3_BASECOLOR_TEXTURE\");\n      this.shaderData.setTexture(\"u_baseColorTexture\", value);\n    } else {\n      this.shaderData.disableMacro(\"O3_BASECOLOR_TEXTURE\");\n    }\n  }\n\n  /**\n   * Transparent mode.\n   */\n  get alphaMode(): AlphaMode {\n    return this._alphaMode;\n  }\n\n  set alphaMode(v: AlphaMode) {\n    const target = this.renderState.blendState.targetBlendState;\n    const depthState = this.renderState.depthState;\n\n    switch (v) {\n      case AlphaMode.Opaque:\n      case AlphaMode.CutOff:\n        {\n          target.sourceColorBlendFactor = target.sourceAlphaBlendFactor = BlendFactor.One;\n          target.destinationColorBlendFactor = target.destinationAlphaBlendFactor = BlendFactor.Zero;\n          target.colorBlendOperation = target.alphaBlendOperation = BlendOperation.Add;\n          depthState.writeEnabled = true;\n          this.renderQueueType = RenderQueueType.Opaque;\n        }\n        break;\n      case AlphaMode.Blend:\n        {\n          target.sourceColorBlendFactor = target.sourceAlphaBlendFactor = BlendFactor.SourceAlpha;\n          target.destinationColorBlendFactor = target.destinationAlphaBlendFactor = BlendFactor.OneMinusSourceAlpha;\n          target.colorBlendOperation = target.alphaBlendOperation = BlendOperation.Add;\n          depthState.writeEnabled = false;\n          this.renderQueueType = RenderQueueType.Transparent;\n        }\n        break;\n    }\n  }\n\n  /**\n   * Whether to render both sides.\n   * @remarks Only the front side is rendered by default\n   */\n  get doubleSided(): boolean {\n    return this._doubleSided;\n  }\n\n  set doubleSided(v: boolean) {\n    if (v) {\n      this.renderState.rasterState.cullMode = CullMode.Off;\n    } else {\n      this.renderState.rasterState.cullMode = CullMode.Back;\n    }\n  }\n\n  /**\n   * Create a unlit material instance.\n   * @param engine - Engine to which the material belongs\n   */\n  constructor(engine: Engine) {\n    super(engine, Shader.find(\"unlit\"));\n    this.shaderData.enableMacro(\"OMIT_NORMAL\");\n\n    this.baseColor = this._baseColor;\n  }\n\n  /**\n   * @override\n   */\n  clone(): UnlitMaterial {\n    var dest = new UnlitMaterial(this._engine);\n    this.cloneTo(dest);\n    return dest;\n  }\n}\n","import { Vector4 } from \"@oasis-engine/math\";\nimport { ClearMode } from \"../base/Constant\";\nimport { Camera } from \"../Camera\";\nimport { Layer } from \"../Layer\";\nimport { Material } from \"../material/Material\";\nimport { RenderTarget } from \"../texture/RenderTarget\";\nimport { RenderQueue } from \"./RenderQueue\";\n\nlet passNum = 0;\n\n/**\n * RednerPass.\n */\nclass RenderPass {\n  public name: string;\n  public enabled: boolean;\n  public priority: number;\n  public renderTarget: RenderTarget;\n  public replaceMaterial: Material;\n  public mask: Layer;\n  public renderOverride: boolean;\n  public clearMode;\n  private _clearParam;\n\n  /**\n   * Create a RenderPass.\n   * @param name - Pass name\n   * @param priority - Priority, less than 0 before the default pass, greater than 0 after the default pass\n   * @param renderTarget - The specified Render Target\n   * @param replaceMaterial -  Replaced material\n   * @param mask - Perform bit and operations with Entity.Layer to filter the objects that this Pass needs to render\n   * @param clearParam - Clear the background color of renderTarget\n   */\n  constructor(\n    name = `RENDER_PASS${passNum++}`,\n    priority = 0,\n    renderTarget = null,\n    replaceMaterial = null,\n    mask = null,\n    clearParam = new Vector4(0, 0, 0, 0)\n  ) {\n    this.name = name;\n    this.enabled = true;\n    this.priority = priority;\n    this.renderTarget = renderTarget;\n    this.replaceMaterial = replaceMaterial;\n    this.mask = mask || Layer.Everything;\n    this.renderOverride = false; // If renderOverride is set to true, you need to implement the render method\n\n    this.clearMode = ClearMode.SOLID_COLOR;\n    this._clearParam = clearParam; // PASS use render target's clearParam\n  }\n\n  /**\n   * Canvas clear parameters, the default is to use the clearColor of RenderTarget.\n   */\n  get clearParam() {\n    return this._clearParam;\n  }\n\n  set clearParam(v) {\n    this._clearParam = v;\n  }\n\n  /**\n   * Rendering callback, will be executed if renderOverride is set to true.\n   * @param camera - Camera\n   * @param queue - RenderQueue\n   */\n  render(camera: Camera, queue: RenderQueue) {}\n\n  /**\n   * Post rendering callback.\n   * @param camera - Camera\n   * @param queue - RenderQueue\n   */\n  preRender(camera: Camera, queue: RenderQueue) {}\n\n  /**\n   * Post rendering callback.\n   * @param camera - Camera\n   * @param queue - RenderQueue\n   */\n  postRender(camera: Camera, queue: RenderQueue) {}\n}\n\nexport { RenderPass };\n","import { Vector3 } from \"@oasis-engine/math\";\nimport { ClearMode } from \"../base\";\nimport { Camera } from \"../Camera\";\nimport { RenderPass } from \"./RenderPass\";\n\n/**\n * @private\n */\nexport class SeparateSpritePass extends RenderPass {\n  private _spriteItems;\n\n  constructor(name = \"SeparateSprite\", priority = 10) {\n    super(name, priority);\n\n    this.clearMode = ClearMode.DONT_CLEAR;\n    this.renderOverride = true;\n\n    this._spriteItems = [];\n  }\n\n  get isUsed() {\n    return this._spriteItems.length > 0;\n  }\n\n  preRender() {\n    this.enabled = this.isUsed;\n  }\n\n  render(camera) {\n    const rhi = camera.renderHardware;\n\n    this._sortByDistance(camera.eyePos);\n    const items = this._spriteItems;\n    const material = camera._renderPipeline._defaultSpriteMaterial;\n\n    for (let i = 0; i < items.length; i++) {\n      const item = items[i];\n      rhi.drawSprite(\n        material,\n        item.positionQuad,\n        item.uvRect,\n        item.tintColor,\n        item.texture,\n        item.renderMode,\n        item.camera\n      );\n    }\n\n    items.length = 0;\n  }\n\n  postRender(camera) {\n    if (this.enabled) {\n      camera.renderHardware.flushSprite(camera.engine, camera._hardwareRenderer._defaultSpriteMaterial);\n    }\n  }\n\n  _sortByDistance(eyePos) {\n    if (this._spriteItems.length > 1) {\n      this._spriteItems = this._spriteItems.sort(function (item1, item2) {\n        if (item1.component.renderPriority === item2.component.renderPriority) {\n          const pos1 = item1.component.node.worldPosition;\n          const pos2 = item2.component.node.worldPosition;\n\n          const dis = Vector3.distanceSquared(pos2, eyePos) - Vector3.distanceSquared(pos1, eyePos);\n          return dis;\n        } else {\n          return item1.component.renderPriority - item2.component.renderPriority;\n        }\n      });\n    }\n  }\n\n  pushSprite(component, positionQuad, uvRect, tintColor, texture, renderMode, camera: Camera) {\n    this._spriteItems.push({\n      component,\n      positionQuad,\n      uvRect,\n      tintColor,\n      texture,\n      renderMode,\n      camera\n    });\n  }\n}\n","import { Vector4 } from \"@oasis-engine/math\";\nimport { ClearMode } from \"../base\";\nimport { Camera } from \"../Camera\";\nimport { Component } from \"../Component\";\nimport { Layer } from \"../Layer\";\nimport { RenderQueueType } from \"../material\";\nimport { Material } from \"../material/Material\";\nimport { BlendFactor, BlendOperation, CullMode, Shader } from \"../shader\";\nimport { TextureCubeFace } from \"../texture/enums/TextureCubeFace\";\nimport { RenderTarget } from \"../texture/RenderTarget\";\nimport { RenderContext } from \"./RenderContext\";\nimport { RenderElement } from \"./RenderElement\";\nimport { RenderPass } from \"./RenderPass\";\nimport { RenderQueue } from \"./RenderQueue\";\nimport { SeparateSpritePass } from \"./SeparateSpritePass\";\n\n/**\n * Basic render pipeline.\n */\nexport class BasicRenderPipeline {\n  _defaultSpriteMaterial: Material;\n  protected _camera: Camera;\n  private _queue: RenderQueue;\n  private _defaultPass: RenderPass;\n  protected _renderPassArray: Array<RenderPass>;\n  private _canvasDepthPass;\n  private _separateSpritePass;\n\n  /**\n   * Create a basic render pipeline.\n   * @param camera - Camera\n   */\n  constructor(camera: Camera) {\n    this._camera = camera;\n    this._queue = new RenderQueue();\n\n    this._renderPassArray = [];\n    this._defaultPass = new RenderPass(\"default\", 0, null, null, 0);\n    this.addRenderPass(this._defaultPass);\n\n    // TODO: remove in next version.\n    const material = (this._defaultSpriteMaterial = new Material(camera.engine, Shader.find(\"Sprite\")));\n    const target = material.renderState.blendState.targetBlendState;\n    target.sourceColorBlendFactor = target.sourceAlphaBlendFactor = BlendFactor.SourceAlpha;\n    target.destinationColorBlendFactor = target.destinationAlphaBlendFactor = BlendFactor.OneMinusSourceAlpha;\n    target.colorBlendOperation = target.alphaBlendOperation = BlendOperation.Add;\n    material.renderState.depthState.writeEnabled = false;\n    material.renderQueueType = RenderQueueType.Transparent;\n    material.renderState.rasterState.cullMode = CullMode.Off;\n  }\n\n  /**\n   * Default render pass.\n   */\n  get defaultRenderPass() {\n    return this._defaultPass;\n  }\n\n  /**\n   * Add render pass.\n   * @param nameOrPass - The name of this Pass or RenderPass object. When it is a name, the following parameters need to be provided\n   * @param priority - Priority, less than 0 before the default pass, greater than 0 after the default pass\n   * @param renderTarget - The specified Render Target\n   * @param replaceMaterial -  Replaced material\n   * @param mask - Perform bit and operations with Entity.Layer to filter the objects that this Pass needs to render\n   * @param clearParam - Clear the background color of renderTarget\n   */\n  addRenderPass(\n    nameOrPass: string | RenderPass,\n    priority: number = null,\n    renderTarget: RenderTarget = null,\n    replaceMaterial: Material = null,\n    mask: Layer = null,\n    clearParam = new Vector4(0, 0, 0, 0)\n  ) {\n    if (typeof nameOrPass === \"string\") {\n      const renderPass = new RenderPass(nameOrPass, priority, renderTarget, replaceMaterial, mask, clearParam);\n      this._renderPassArray.push(renderPass);\n    } else if (nameOrPass instanceof RenderPass) {\n      this._renderPassArray.push(nameOrPass);\n    }\n\n    this._renderPassArray.sort(function (p1, p2) {\n      return p1.priority - p2.priority;\n    });\n  }\n\n  /**\n   * Remove render pass by name or render pass object.\n   * @param nameOrPass - Render pass name or render pass object\n   */\n  removeRenderPass(nameOrPass: string | RenderPass): void {\n    let pass: RenderPass;\n    if (typeof nameOrPass === \"string\") pass = this.getRenderPass(nameOrPass);\n    else if (nameOrPass instanceof RenderPass) pass = nameOrPass;\n    if (pass) {\n      const idx = this._renderPassArray.indexOf(pass);\n      this._renderPassArray.splice(idx, 1);\n    }\n  }\n\n  /**\n   * Get render pass by name.\n   * @param  name - Render pass name\n   */\n  getRenderPass(name: string) {\n    for (let i = 0, len = this._renderPassArray.length; i < len; i++) {\n      const pass = this._renderPassArray[i];\n      if (pass.name === name) return pass;\n    }\n\n    return null;\n  }\n\n  /**\n   * Render queue.\n   */\n  get queue(): RenderQueue {\n    return this._queue;\n  }\n\n  /**\n   * Destroy internal resources.\n   */\n  destroy() {}\n\n  /**\n   * Perform scene rendering.\n   * @param context - Render context\n   * @param cubeFace - Render surface of cube texture\n   */\n  render(context: RenderContext, cubeFace?: TextureCubeFace) {\n    const camera = this._camera;\n    const queue = this._queue;\n\n    queue.clear();\n\n    camera.engine._componentsManager.callRender(context);\n\n    queue.sort(camera.entity.transform.worldPosition);\n\n    if (this._canvasDepthPass) this._canvasDepthPass.enabled = false;\n\n    if (this._separateSpritePass && this._separateSpritePass.isUsed) {\n      // If the default rendertarget is not canvas, you need to draw on the canvas again to ensure that there is depth information\n      if (this._defaultPass.renderTarget) {\n        if (!this._canvasDepthPass) {\n          this._canvasDepthPass = new RenderPass(\"CanvasDepthRenderPass\", 0, null, null, 0);\n          this._canvasDepthPass.clearMode = ClearMode.DONT_CLEAR;\n          this.addRenderPass(this._canvasDepthPass);\n        }\n        this._canvasDepthPass.enabled = true;\n      }\n    }\n\n    for (let i = 0, len = this._renderPassArray.length; i < len; i++) {\n      this._drawRenderPass(this._renderPassArray[i], camera, cubeFace);\n    }\n  }\n\n  private _drawRenderPass(pass: RenderPass, camera: Camera, cubeFace?: TextureCubeFace) {\n    pass.preRender(camera, this.queue);\n\n    if (pass.enabled) {\n      const rhi = camera.scene.engine._hardwareRenderer;\n      const renderTarget = camera.renderTarget || pass.renderTarget;\n      rhi.activeRenderTarget(renderTarget, camera);\n      rhi.setRenderTargetFace(renderTarget, cubeFace);\n      rhi.clearRenderTarget(camera.engine, pass.clearMode, pass.clearParam);\n\n      if (pass.renderOverride) {\n        pass.render(camera, this.queue);\n      } else {\n        this.queue.render(camera, pass.replaceMaterial, pass.mask);\n      }\n\n      rhi.blitRenderTarget(renderTarget);\n    }\n\n    pass.postRender(camera, this.queue);\n  }\n\n  /**\n   * Push a render element to the render queue.\n   * @param element - Render element\n   */\n  pushPrimitive(element: RenderElement) {\n    this._queue.pushPrimitive(element);\n  }\n\n  pushSprite(component: Component, positionQuad, uvRect, tintColor, texture, renderMode, camera: Camera) {\n    if ((component as any).separateDraw) {\n      if (!this._separateSpritePass) {\n        this._separateSpritePass = new SeparateSpritePass();\n        this.addRenderPass(this._separateSpritePass);\n      }\n\n      this._separateSpritePass.pushSprite(component, positionQuad, uvRect, tintColor, texture, renderMode, camera);\n      return;\n    }\n\n    this.queue.pushSprite(component, positionQuad, uvRect, tintColor, texture, renderMode, camera);\n  }\n}\n","import { Matrix } from \"@oasis-engine/math\";\nimport { Camera } from \"../Camera\";\n\n/**\n * Rendering context.\n */\nexport class RenderContext {\n  private static _renderContext: RenderContext = new RenderContext();\n\n  /**\n   * @internal\n   */\n  static _getRenderContext(camera: Camera): RenderContext {\n    const context = RenderContext._renderContext;\n    context._camera = camera;\n    Matrix.multiply(camera.projectionMatrix, camera.viewMatrix, context._viewProjectMatrix);\n    return context;\n  }\n\n  /** @internal */\n  _camera: Camera;\n  /** @internal */\n  _viewProjectMatrix: Matrix = new Matrix();\n}\n","import { BoundingFrustum, MathUtil, Matrix, Ray, Vector2, Vector3, Vector4 } from \"@oasis-engine/math\";\nimport { ClearMode } from \"./base\";\nimport { deepClone, ignoreClone } from \"./clone/CloneManager\";\nimport { Component } from \"./Component\";\nimport { dependencies } from \"./ComponentsDependencies\";\nimport { Entity } from \"./Entity\";\nimport { Layer } from \"./Layer\";\nimport { BasicRenderPipeline } from \"./RenderPipeline/BasicRenderPipeline\";\nimport { RenderContext } from \"./RenderPipeline/RenderContext\";\nimport { ShaderDataGroup } from \"./shader/enums/ShaderDataGroup\";\nimport { Shader } from \"./shader/Shader\";\nimport { ShaderData } from \"./shader/ShaderData\";\nimport { ShaderMacroCollection } from \"./shader/ShaderMacroCollection\";\nimport { TextureCubeFace } from \"./texture/enums/TextureCubeFace\";\nimport { RenderTarget } from \"./texture/RenderTarget\";\nimport { Transform } from \"./Transform\";\nimport { UpdateFlag } from \"./UpdateFlag\";\n\n/**\n * @todo\n */\ntype Sky = {};\n\nclass MathTemp {\n  static tempMat4 = new Matrix();\n  static tempVec4 = new Vector4();\n  static tempVec3 = new Vector3();\n}\n\n/**\n * ClearFlag, which controls camera's background.\n */\nexport enum ClearFlags {\n  /* Clear depth and skybox. */\n  DepthSky,\n  /* Clear depth and color. */\n  DepthColor,\n  /* Clear depth only. */\n  Depth,\n  /* Do nothing. */\n  None\n}\n\n/**\n * Camera component, as the entrance to the three-dimensional world.\n */\n@dependencies(Transform)\nexport class Camera extends Component {\n  private static _viewMatrixProperty = Shader.getPropertyByName(\"u_viewMat\");\n  private static _projectionMatrixProperty = Shader.getPropertyByName(\"u_projMat\");\n  private static _vpMatrixProperty = Shader.getPropertyByName(\"u_VPMat\");\n  private static _inverseViewMatrixProperty = Shader.getPropertyByName(\"u_viewInvMat\");\n  private static _inverseProjectionMatrixProperty = Shader.getPropertyByName(\"u_projInvMat\");\n  private static _cameraPositionProperty = Shader.getPropertyByName(\"u_cameraPos\");\n\n  /** Rendering priority - A Camera with higher priority will be rendererd on top of a camera with lower priority. */\n  priority: number = 0;\n\n  /** Whether to enable frustum culling, it is enabled by default. */\n  enableFrustumCulling: boolean = true;\n\n  /**\n   * Culling mask - which layers the camera renders.\n   * @remarks Support bit manipulation, conresponding to Entity's layer.\n   */\n  cullingMask: Layer = Layer.Everything;\n\n  /** Shader data. */\n  readonly shaderData: ShaderData = new ShaderData(ShaderDataGroup.Camera);\n\n  /** @internal */\n  _globalShaderMacro: ShaderMacroCollection = new ShaderMacroCollection();\n  /** @internal */\n  @deepClone\n  _frustum: BoundingFrustum = new BoundingFrustum();\n  /** @internal */\n  @ignoreClone\n  _renderPipeline: BasicRenderPipeline;\n\n  private _isOrthographic: boolean = false;\n  private _isProjMatSetting = false;\n  private _clearMode: ClearMode = ClearMode.SOLID_COLOR;\n  private _nearClipPlane: number = 0.1;\n  private _farClipPlane: number = 100;\n  private _fieldOfView: number = 45;\n  private _orthographicSize: number = 10;\n  private _isProjectionDirty = true;\n  private _isInvProjMatDirty: boolean = true;\n  private _isFrustumProjectDirty: boolean = true;\n  private _customAspectRatio: number | undefined = undefined;\n  private _renderTarget: RenderTarget = null;\n\n  @ignoreClone\n  private _frustumViewChangeFlag: UpdateFlag;\n  @ignoreClone\n  private _transform: Transform;\n  @ignoreClone\n  private _isViewMatrixDirty: UpdateFlag;\n  @ignoreClone\n  private _isInvViewProjDirty: UpdateFlag;\n  @deepClone\n  private _projectionMatrix: Matrix = new Matrix();\n  @deepClone\n  private _viewMatrix: Matrix = new Matrix();\n  @deepClone\n  private _backgroundColor: Vector4 = new Vector4();\n  @deepClone\n  private _viewport: Vector4 = new Vector4(0, 0, 1, 1);\n  @deepClone\n  private _inverseProjectionMatrix: Matrix = new Matrix();\n  @deepClone\n  private _inverseViewMatrix: Matrix = new Matrix();\n  @deepClone\n  private _lastAspectSize: Vector2 = new Vector2(0, 0);\n  @deepClone\n  private _invViewProjMat: Matrix = new Matrix();\n\n  /**\n   * Near clip plane - the cloest point to the camera when rendering occurs.\n   */\n  get nearClipPlane(): number {\n    return this._nearClipPlane;\n  }\n\n  set nearClipPlane(value: number) {\n    this._nearClipPlane = value;\n    this._projMatChange();\n  }\n\n  /**\n   * Far clip plane - the furthest point to the camera when rendering occurs.\n   */\n  get farClipPlane(): number {\n    return this._farClipPlane;\n  }\n\n  set farClipPlane(value: number) {\n    this._farClipPlane = value;\n    this._projMatChange();\n  }\n\n  /**\n   * The camera's view angle. activing when camera use perspective projection.\n   */\n  get fieldOfView(): number {\n    return this._fieldOfView;\n  }\n\n  set fieldOfView(value: number) {\n    this._fieldOfView = value;\n    this._projMatChange();\n  }\n\n  /**\n   * Aspect ratio. The default is automatically calculated by the viewport's aspect ratio. If it is manually set, the manual value will be kept. Call resetAspectRatio() to restore it.\n   */\n  get aspectRatio(): number {\n    const canvas = this._entity.engine.canvas;\n    return this._customAspectRatio ?? (canvas.width * this._viewport.z) / (canvas.height * this._viewport.w);\n  }\n\n  set aspectRatio(value: number) {\n    this._customAspectRatio = value;\n    this._projMatChange();\n  }\n\n  /**\n   * Viewport, normalized expression, the upper left corner is (0, 0), and the lower right corner is (1, 1).\n   * @remarks Re-assignment is required after modification to ensure that the modification takes effect.\n   */\n  get viewport(): Vector4 {\n    return this._viewport;\n  }\n\n  set viewport(value: Vector4) {\n    if (value !== this._viewport) {\n      value.cloneTo(this._viewport);\n    }\n    this._projMatChange();\n  }\n\n  /**\n   * Whether it is orthogonal, the default is false. True will use orthographic projection, false will use perspective projection.\n   */\n  get isOrthographic(): boolean {\n    return this._isOrthographic;\n  }\n\n  set isOrthographic(value: boolean) {\n    this._isOrthographic = value;\n    this._projMatChange();\n  }\n\n  /**\n   * Half the size of the camera in orthographic mode.\n   */\n  get orthographicSize(): number {\n    return this._orthographicSize;\n  }\n\n  set orthographicSize(value: number) {\n    this._orthographicSize = value;\n    this._projMatChange();\n  }\n\n  /**\n   * Clear background flags.\n   */\n  get clearFlags(): ClearFlags {\n    throw \"not implemented\";\n  }\n\n  /**\n   * @todo Skybox refactor\n   */\n  set clearFlags(value: ClearFlags) {\n    throw \"not implemented\";\n  }\n\n  /**\n   * Clear the background color of the viewport, which takes effect when clearFlags is DepthColor.\n   */\n  get backgroundColor(): Vector4 {\n    return this._backgroundColor;\n  }\n\n  set backgroundColor(value: Vector4) {\n    this.setClearMode(this._clearMode, value);\n  }\n\n  /**\n   * Clear the background sky of the viewport, active when clearFlags is DepthSky.\n   * @todo Render pipeline modification\n   */\n  get backgroundSky(): Sky {\n    throw new Error(\"not implemented\");\n  }\n\n  /**\n   * View matrix.\n   */\n  get viewMatrix(): Readonly<Matrix> {\n    // Remove scale\n    if (this._isViewMatrixDirty.flag) {\n      this._isViewMatrixDirty.flag = false;\n      Matrix.invert(this._transform.worldMatrix, this._viewMatrix);\n    }\n    return this._viewMatrix;\n  }\n\n  /**\n   * The projection matrix is â€‹â€‹calculated by the relevant parameters of the camera by default. If it is manually set, the manual value will be maintained. Call resetProjectionMatrix() to restore it.\n   */\n  set projectionMatrix(value: Matrix) {\n    this._projectionMatrix = value;\n    this._isProjMatSetting = true;\n    this._projMatChange();\n  }\n\n  get projectionMatrix(): Matrix {\n    const canvas = this._entity.engine.canvas;\n    if (\n      (!this._isProjectionDirty || this._isProjMatSetting) &&\n      this._lastAspectSize.x === canvas.width &&\n      this._lastAspectSize.y === canvas.height\n    ) {\n      return this._projectionMatrix;\n    }\n    this._isProjectionDirty = false;\n    this._lastAspectSize.x = canvas.width;\n    this._lastAspectSize.y = canvas.height;\n    const aspectRatio = this.aspectRatio;\n    if (!this._isOrthographic) {\n      Matrix.perspective(\n        MathUtil.degreeToRadian(this._fieldOfView),\n        aspectRatio,\n        this._nearClipPlane,\n        this._farClipPlane,\n        this._projectionMatrix\n      );\n    } else {\n      const width = this._orthographicSize * aspectRatio;\n      const height = this._orthographicSize;\n      Matrix.ortho(-width, width, -height, height, this._nearClipPlane, this._farClipPlane, this._projectionMatrix);\n    }\n    return this._projectionMatrix;\n  }\n\n  /**\n   * Whether to enable HDR.\n   * @todo When render pipeline modification\n   */\n  get enableHDR(): boolean {\n    console.log(\"not implemention\");\n    return false;\n  }\n\n  set enableHDR(value: boolean) {\n    console.log(\"not implemention\");\n  }\n\n  /**\n   * RenderTarget. After setting, it will be rendered to the renderTarget. If it is empty, it will be rendered to the main canvas.\n   */\n  get renderTarget(): RenderTarget | null {\n    return this._renderTarget;\n  }\n\n  set renderTarget(value: RenderTarget | null) {\n    this._renderTarget = value;\n  }\n\n  /**\n   * Create the Camera component.\n   * @param entity - Entity\n   */\n  constructor(entity: Entity) {\n    super(entity);\n\n    const transform = this.entity.transform;\n    this._transform = transform;\n    this._isViewMatrixDirty = transform.registerWorldChangeFlag();\n    this._isInvViewProjDirty = transform.registerWorldChangeFlag();\n    this._frustumViewChangeFlag = transform.registerWorldChangeFlag();\n    this._renderPipeline = new BasicRenderPipeline(this);\n    this.shaderData._addRefCount(1);\n\n    this.setClearMode();\n  }\n\n  /**\n   * Restore the automatic calculation of projection matrix through fieldOfView, nearClipPlane and farClipPlane.\n   */\n  resetProjectionMatrix(): void {\n    this._isProjMatSetting = false;\n    this._projMatChange();\n  }\n\n  /**\n   * Restore the automatic calculation of the aspect ratio through the viewport aspect ratio.\n   */\n  resetAspectRatio(): void {\n    this._customAspectRatio = undefined;\n    this._projMatChange();\n  }\n\n  /**\n   * Transform a point from world space to viewport space.\n   * @param point - Point in world space\n   * @param out - A point in the viewport space, X and Y are the viewport space coordinates, Z is the viewport depth, the near clipping plane is 0, the far clipping plane is 1, and W is the world unit distance from the camera\n   * @returns Point in viewport space\n   */\n  worldToViewportPoint(point: Vector3, out: Vector4): Vector4 {\n    Matrix.multiply(this.projectionMatrix, this.viewMatrix, MathTemp.tempMat4);\n    MathTemp.tempVec4.setValue(point.x, point.y, point.z, 1.0);\n    Vector4.transform(MathTemp.tempVec4, MathTemp.tempMat4, MathTemp.tempVec4);\n\n    const w = MathTemp.tempVec4.w;\n    const nx = MathTemp.tempVec4.x / w;\n    const ny = MathTemp.tempVec4.y / w;\n    const nz = MathTemp.tempVec4.z / w;\n\n    // Transform of coordinate axis.\n    out.x = (nx + 1.0) * 0.5;\n    out.y = (1.0 - ny) * 0.5;\n    out.z = nz;\n    out.w = w;\n    return out;\n  }\n\n  /**\n   * Transform a point from viewport space to world space.\n   * @param point - Point in viewport. X and Y are the viewport space coordinates, Z is the viewport depth. The near clipping plane is 0, and the far clipping plane is 1.\n   * @param out - Point in world space\n   * @returns Point in world space\n   */\n  viewportToWorldPoint(point: Vector3, out: Vector3): Vector3 {\n    const invViewProjMat = this.invViewProjMat;\n    return this._innerViewportToWorldPoint(point, invViewProjMat, out);\n  }\n\n  /**\n   * Generate a ray by a point in viewport.\n   * @param point Point in viewport point.\n   * @param out - Ray\n   * @returns Ray\n   */\n  viewportPointToRay(point: Vector2, out: Ray): Ray {\n    const clipPoint = MathTemp.tempVec3;\n    // Use the intersection of the near clipping plane as the origin point.\n    clipPoint.setValue(point.x, point.y, 0);\n    const origin = this.viewportToWorldPoint(clipPoint, out.origin);\n    // Use the intersection of the far clipping plane as the origin point.\n    clipPoint.z = 1.0;\n    const farPoint: Vector3 = this._innerViewportToWorldPoint(clipPoint, this._invViewProjMat, clipPoint);\n    Vector3.subtract(farPoint, origin, out.direction);\n    out.direction.normalize();\n\n    return out;\n  }\n\n  /**\n   * Transform the X and Y coordinates of a point from screen space to viewport space\n   * @param point - Point in screen space\n   * @param out - Point in viewport space\n   * @returns Point in viewport space\n   */\n  screenToViewportPoint<T extends Vector2 | Vector3>(point: Vector3 | Vector2, out: T): T {\n    const canvas = this.engine.canvas;\n    const viewport = this.viewport;\n    out.x = (point.x / canvas.width - viewport.x) / viewport.z;\n    out.y = (point.y / canvas.height - viewport.y) / viewport.w;\n    return out;\n  }\n\n  /**\n   * Transform the X and Y coordinates of a point from viewport space to screen space.\n   * @param point - Point in viewport space\n   * @param out - Point in screen space\n   * @returns Point in screen space\n   */\n  viewportToScreenPoint<T extends Vector2 | Vector3 | Vector4>(point: T, out: T): T {\n    const canvas = this.engine.canvas;\n    const viewport = this.viewport;\n    out.x = (viewport.x + point.x * viewport.z) * canvas.width;\n    out.y = (viewport.y + point.y * viewport.w) * canvas.height;\n    return out;\n  }\n\n  /**\n   * Transform a point from world space to screen space.\n   * @param point - Point in world space\n   * @param out - Point of screen space\n   * @returns Point of screen space\n   */\n  worldToScreenPoint(point: Vector3, out: Vector4): Vector4 {\n    this.worldToViewportPoint(point, out);\n    return this.viewportToScreenPoint(out, out);\n  }\n\n  /**\n   * Transform a point from screen space to world space.\n   * @param point - Screen space point\n   * @param out - Point in world space\n   * @returns Point in world space\n   */\n  screenToWorldPoint(point: Vector3, out: Vector3): Vector3 {\n    this.screenToViewportPoint(point, out);\n    return this.viewportToWorldPoint(out, out);\n  }\n\n  /**\n   * Manually call the rendering of the camera.\n   * @param cubeFace - Cube rendering surface collection\n   */\n  render(cubeFace?: TextureCubeFace): void {\n    // compute cull frustm.\n    const context = RenderContext._getRenderContext(this);\n    if (this.enableFrustumCulling && (this._frustumViewChangeFlag.flag || this._isFrustumProjectDirty)) {\n      this._frustum.calculateFromMatrix(context._viewProjectMatrix);\n      this._frustumViewChangeFlag.flag = false;\n      this._isFrustumProjectDirty = false;\n    }\n\n    this._updateShaderData(context);\n\n    // union scene and camera macro.\n    ShaderMacroCollection.unionCollection(\n      this.scene.shaderData._macroCollection,\n      this.shaderData._macroCollection,\n      this._globalShaderMacro\n    );\n\n    this._renderPipeline.render(context, cubeFace);\n    this._engine._renderCount++;\n  }\n\n  /**\n   * @override\n   * @inheritdoc\n   */\n  _onActive() {\n    this.entity.scene.attachRenderCamera(this);\n  }\n\n  /**\n   * @override\n   * @inheritdoc\n   */\n  _onInActive() {\n    this.entity.scene.detachRenderCamera(this);\n  }\n\n  /**\n   * @override\n   * @inheritdoc\n   */\n  _onDestroy() {\n    this._renderPipeline?.destroy();\n    this._isInvViewProjDirty.destroy();\n    this._isViewMatrixDirty.destroy();\n    this.shaderData._addRefCount(-1);\n  }\n\n  private _projMatChange() {\n    this._isFrustumProjectDirty = true;\n    this._isProjectionDirty = true;\n    this._isInvProjMatDirty = true;\n    this._isInvViewProjDirty.flag = true;\n  }\n\n  private _innerViewportToWorldPoint(point: Vector3, invViewProjMat: Matrix, out: Vector3): Vector3 {\n    // Depth is a normalized value, 0 is nearPlane, 1 is farClipPlane.\n    const depth = point.z * 2 - 1;\n    // Transform to clipping space matrix\n    const clipPoint = MathTemp.tempVec4;\n    clipPoint.setValue(point.x * 2 - 1, 1 - point.y * 2, depth, 1);\n    Vector4.transform(clipPoint, invViewProjMat, clipPoint);\n    const invW = 1.0 / clipPoint.w;\n    out.x = clipPoint.x * invW;\n    out.y = clipPoint.y * invW;\n    out.z = clipPoint.z * invW;\n    return out;\n  }\n\n  private _updateShaderData(context: RenderContext) {\n    const shaderData = this.shaderData;\n    shaderData.setMatrix(Camera._viewMatrixProperty, this.viewMatrix);\n    shaderData.setMatrix(Camera._projectionMatrixProperty, this.projectionMatrix);\n    shaderData.setMatrix(Camera._vpMatrixProperty, context._viewProjectMatrix);\n    shaderData.setMatrix(Camera._inverseViewMatrixProperty, this.inverseViewMatrix);\n    shaderData.setMatrix(Camera._inverseProjectionMatrixProperty, this.inverseProjectionMatrix);\n    shaderData.setVector3(Camera._cameraPositionProperty, this._transform.worldPosition);\n  }\n\n  /**\n   * @private\n   * The inverse matrix of view projection matrix.\n   */\n  get invViewProjMat(): Matrix {\n    if (this._isInvViewProjDirty.flag) {\n      this._isInvViewProjDirty.flag = false;\n      Matrix.multiply(this.inverseViewMatrix, this.inverseProjectionMatrix, this._invViewProjMat);\n    }\n    return this._invViewProjMat;\n  }\n\n  /**\n   * @private\n   * The inverse of the projection matrix.\n   */\n  get inverseProjectionMatrix(): Readonly<Matrix> {\n    if (this._isInvProjMatDirty) {\n      this._isInvProjMatDirty = false;\n      Matrix.invert(this.projectionMatrix, this._inverseProjectionMatrix);\n    }\n    return this._inverseProjectionMatrix;\n  }\n\n  //-------------------------------------------------deprecated---------------------------------------------------\n\n  /**\n   * @deprecated\n   * View matrix inverse matrix.\n   */\n  get inverseViewMatrix(): Readonly<Matrix> {\n    this._transform.worldMatrix.cloneTo(this._inverseViewMatrix);\n    return this._inverseViewMatrix;\n  }\n\n  /**\n   * @deprecated\n   * @todo Involving the rendering pipeline to modify the rhi.clearRenderTarget method.\n   * @param clearMode\n   * @param backgroundColor\n   */\n  setClearMode(\n    clearMode: ClearMode = ClearMode.SOLID_COLOR,\n    backgroundColor: Vector4 = new Vector4(0.25, 0.25, 0.25, 1)\n  ): void {\n    this._clearMode = clearMode;\n    this._backgroundColor = backgroundColor;\n    this._renderPipeline.defaultRenderPass.clearParam = backgroundColor;\n    this._renderPipeline.defaultRenderPass.clearMode = clearMode;\n  }\n}\n","import { AssetPromise } from \"./AssetPromise\";\n\nconst mimeType = {\n  json: \"json\",\n  gltf: \"json\",\n  mtl: \"json\",\n  prefab: \"json\",\n  txt: \"text\",\n  bin: \"arraybuffer\",\n  png: \"image\",\n  webp: \"image\",\n  jpg: \"image\"\n};\n\nconst defaultRetryCount = 4;\nconst defaultTimeout = 15000;\nconst defaultInterval = 500;\n\nexport type RequestConfig = {\n  type?: XMLHttpRequestResponseType | \"image\";\n  retryCount?: number;\n  retryInterval?: number;\n  timeout?: number;\n} & RequestInit;\n\n/**\n * Web request.\n * @param url - The link\n * @param config - Load configuration\n */\nexport function request<T>(url: string, config: RequestConfig = {}): AssetPromise<T> {\n  return new AssetPromise((resolve, reject, setProgress) => {\n    const retryCount = config.retryCount ?? defaultRetryCount;\n    const retryInterval = config.retryInterval ?? defaultInterval;\n    config.timeout = config.timeout ?? defaultTimeout;\n    config.type = config.type ?? getMimeTypeFromUrl(url);\n    const realRequest = config.type === \"image\" ? requestImage : requestRes;\n    let lastError: Error;\n    const executor = new MultiExecutor(\n      () => {\n        return realRequest<T>(url, config)\n          .onProgress(setProgress)\n          .then((res) => {\n            resolve(res);\n            executor.stop();\n          })\n          .catch((err) => (lastError = err));\n      },\n      retryCount,\n      retryInterval\n    );\n    executor.start(() => {\n      reject(lastError);\n    });\n  });\n}\n\nfunction requestImage<T>(url: string, config: RequestConfig): AssetPromise<T> {\n  return new AssetPromise((resolve, reject) => {\n    const { timeout } = config;\n    const img = new Image();\n    const onerror = () => {\n      reject(new Error(`request ${url} fail`));\n    };\n    img.onerror = onerror;\n\n    img.onabort = onerror;\n\n    const timeoutId = setTimeout(() => {\n      reject(new Error(`request ${url} timeout`));\n    }, timeout);\n\n    img.onload = ((timeoutId) => {\n      return () => {\n        // Call requestAnimationFrame to avoid iOS's bug.\n        requestAnimationFrame(() => {\n          //@ts-ignore\n          resolve(img);\n        });\n        clearTimeout(timeoutId);\n      };\n    })(timeoutId);\n\n    img.crossOrigin = \"anonymous\";\n\n    img.src = url;\n  });\n}\n\nfunction requestRes<T>(url: string, config: RequestConfig): AssetPromise<T> {\n  return new AssetPromise((resolve, reject, setProgress) => {\n    const xhr = new XMLHttpRequest();\n    xhr.timeout = config.timeout;\n    config.method = config.method ?? \"get\";\n    xhr.onload = () => {\n      if (xhr.status < 200 || xhr.status >= 300) {\n        reject(new Error(`request failed from: ${url}`));\n        return;\n      }\n      const result = xhr.response ?? xhr.responseText;\n      resolve(result);\n    };\n    xhr.onerror = () => {\n      reject(new Error(`request failed from: ${url}`));\n    };\n    xhr.ontimeout = () => {\n      reject(new Error(`request timeout from: ${url}`));\n    };\n    xhr.onprogress = (e) => {\n      setProgress(e.loaded / e.total);\n    };\n    xhr.open(config.method, url, true);\n    xhr.withCredentials = config.credentials === \"include\";\n    //@ts-ignore\n    xhr.responseType = config.type;\n    const headers = config.headers;\n    if (headers) {\n      Object.keys(headers).forEach((name) => {\n        xhr.setRequestHeader(name, headers[name]);\n      });\n    }\n    xhr.send(config.body);\n  });\n}\n\nfunction getMimeTypeFromUrl(url: string) {\n  const extname = url.substring(url.lastIndexOf(\".\") + 1);\n  return mimeType[extname];\n}\n\nexport class MultiExecutor {\n  private _timeoutId: number = -100;\n  private _currentCount = 0;\n  constructor(\n    private execFunc: (count?: number) => Promise<any>,\n    private totalCount: number,\n    private interval: number\n  ) {\n    this.exec = this.exec.bind(this);\n  }\n\n  private done: Function;\n  start(done?: Function): void {\n    this.done = done;\n    this.exec();\n  }\n\n  stop(): void {\n    clearTimeout(this._timeoutId);\n  }\n\n  private exec(): void {\n    if (this._currentCount >= this.totalCount) {\n      this.done && this.done();\n      return;\n    }\n    this._currentCount++;\n    this.execFunc(this._currentCount).then(() => {\n      //@ts-ignore\n      this._timeoutId = setTimeout(this.exec, this.interval);\n    });\n  }\n}\n","import { LoadItem } from \"./LoadItem\";\nimport { AssetPromise } from \"./AssetPromise\";\nimport { RequestConfig, request } from \"./request\";\nimport { ResourceManager } from \"./ResourceManager\";\n/**\n * Loader abstract class.\n */\nexport abstract class Loader<T> {\n  request: <U>(url: string, config: RequestConfig) => AssetPromise<U> = request;\n  abstract load(item: LoadItem, resouceManager: ResourceManager): AssetPromise<T>;\n  constructor(public readonly useCache: boolean) {}\n}\n","/**\n * Asset Type.\n */\nexport enum AssetType {\n  /**\n   * Plain text.\n   * @remarks Will not be cached based on url in ResourceManager.\n   */\n  Text = 0,\n  /**\n   * JSON.\n   * @remarks Will not be cached based on url in ResourceManager.\n   */\n  JSON = 1,\n  /**\n   * ArrayBuffer.\n   * @remarks Will not be cached based on url in ResourceManager.\n   */\n  Buffer = 2,\n  /** 2D Texture. */\n  Texture2D = 3,\n  /** Cube Texture. */\n  TextureCube = 4,\n  /** Material. */\n  Material = 5,\n  /** Mesh. */\n  Mesh = 6,\n  /** Animation Clip. */\n  AnimationClip = 7,\n  /** Prefab.*/\n  Perfab = 8,\n  /** Compress Texture. */\n  KTX = 9,\n  /** Cube Compress Texture. */\n  KTXCube = 10\n  /** @todo Scene. */\n  // Scene = 9\n}\n","import { SceneFeature } from \"../SceneFeature\";\nimport { Collider } from \"./Collider\";\n\nexport class ColliderFeature extends SceneFeature {\n  colliders: Collider[];\n  constructor() {\n    super();\n\n    this.colliders = [];\n  }\n\n  /**\n   * Add a collider component.\n   * @param collider - The collider component to add\n   */\n  attachCollider(collider: Collider) {\n    this.colliders.push(collider);\n  }\n\n  /**\n   * Remove a collider component.\n   * @param collider - The collider component to remove\n   */\n  detachCollider(collider: Collider) {\n    const index = this.colliders.indexOf(collider);\n    if (index != -1) {\n      this.colliders.splice(index, 1);\n    }\n  }\n}\n","import { Component } from \"../Component\";\nimport { Entity } from \"../Entity\";\nimport { ColliderFeature } from \"./ColliderFeature\";\n\n/**\n * Define collider data.\n */\nexport class Collider extends Component {\n  /**\n   * @param {Entity} entity\n   */\n  constructor(entity: Entity) {\n    super(entity);\n  }\n\n  _onEnable(): void {\n    this.scene.findFeature(ColliderFeature).attachCollider(this);\n  }\n\n  _onDisable(): void {\n    this.scene.findFeature(ColliderFeature).detachCollider(this);\n  }\n}\n","import { Vector3 } from \"@oasis-engine/math\";\nimport { Entity } from \"../Entity\";\nimport { Collider } from \"./Collider\";\n\n/**\n * Axis Aligned Bound Box (AABB).\n * @extends Collider\n */\nexport class ABoxCollider extends Collider {\n  private static _tempVec3: Vector3 = new Vector3();\n\n  public boxMin: Vector3;\n  public boxMax: Vector3;\n  private _corners: Array<Vector3> = [];\n  private _cornerFlag: boolean = false;\n\n  /**\n   * Constructor of ABoxCollider.\n   * @param entity - Entity which the box belongs to\n   */\n  constructor(entity: Entity) {\n    super(entity);\n    this.boxMin = new Vector3(-0.5, -0.5, -0.5);\n    this.boxMax = new Vector3(0.5, 0.5, 0.5);\n  }\n\n  /**\n   * Set box from the minimum point of the box and the maximum point of the box.\n   * @param min - The minimum point of the box\n   * @param max - The maximum point of the box\n   */\n  setBoxMinMax(min: Vector3, max: Vector3) {\n    this.boxMin = min;\n    this.boxMax = max;\n\n    this._cornerFlag = true;\n  }\n\n  /**\n   * Set box from the center point and the size of the bounding box.\n   * @param center - The center point\n   * @param size - The size of the bounding box\n   */\n  setBoxCenterSize(center: Vector3, size: Vector3) {\n    const halfSize = ABoxCollider._tempVec3;\n    Vector3.scale(size, 0.5, halfSize);\n    Vector3.add(center, halfSize, this.boxMax);\n    Vector3.subtract(center, halfSize, this.boxMin);\n\n    this._cornerFlag = true;\n  }\n\n  /**\n   * Get the eight corners of this bounding box.\n   */\n  getCorners(): Vector3[] {\n    if (this._cornerFlag) {\n      const minX = this.boxMin.x;\n      const minY = this.boxMin.y;\n      const minZ = this.boxMin.z;\n      const w = this.boxMax.x - minX;\n      const h = this.boxMax.y - minY;\n      const d = this.boxMax.z - minZ;\n\n      if (this._corners.length === 0) {\n        for (let i = 0; i < 8; ++i) {\n          this._corners.push(new Vector3());\n        }\n      }\n\n      this._corners[0].setValue(minX + w, minY + h, minZ + d);\n      this._corners[1].setValue(minX, minY + h, minZ + d);\n      this._corners[2].setValue(minX, minY, minZ + d);\n      this._corners[3].setValue(minX + w, minY, minZ + d);\n      this._corners[4].setValue(minX + w, minY + h, minZ);\n      this._corners[5].setValue(minX, minY + h, minZ);\n      this._corners[6].setValue(minX, minY, minZ);\n      this._corners[7].setValue(minX + w, minY, minZ);\n\n      this._cornerFlag = false;\n    }\n\n    return this._corners;\n    // if (this._corners.length === 0) {\n    //   const minX = this.boxMin.x;\n    //   const minY = this.boxMin.y;\n    //   const minZ = this.boxMin.z;\n    //   const w = this.boxMax.x - minX;\n    //   const h = this.boxMax.y - minY;\n    //   const d = this.boxMax.z - minZ;\n\n    //   this._corners = [\n    //     new Vector3(minX + w, minY + h, minZ + d),\n    //     new Vector3(minX, minY + h, minZ + d),\n    //     new Vector3(minX, minY, minZ + d),\n    //     new Vector3(minX + w, minY, minZ + d),\n    //     new Vector3(minX + w, minY + h, minZ),\n    //     new Vector3(minX, minY + h, minZ),\n    //     new Vector3(minX, minY, minZ),\n    //     new Vector3(minX + w, minY, minZ)\n    //   ];\n    // }\n\n    // return this._corners;\n  }\n}\n","import { Collider } from \"./Collider\";\nimport { Vector3 } from \"@oasis-engine/math\";\nimport { Entity } from \"../Entity\";\n/**\n * A bounding sphere.\n */\nexport class ASphereCollider extends Collider {\n  center: Vector3;\n\n  radius: number;\n  /**\n   * Constructor of ASphereCollider.\n   * @param  entity - Entity which the sphere belongs to\n   */\n  constructor(entity: Entity) {\n    super(entity);\n\n    /** The center point of the sphere. */\n    this.center = new Vector3();\n\n    /** The radius of the sphere. */\n    this.radius = 1;\n  }\n\n  /**\n   * Set the center and radius of the sphere.\n   * @param center - The center point of the sphere\n   * @param radius - The radius of the sphere\n   */\n  setSphere(center: Vector3, radius: number) {\n    this.center = center;\n    this.radius = radius;\n  }\n}\n","import { Collider } from \"./Collider\";\nimport { Vector3 } from \"@oasis-engine/math\";\nimport { Entity } from \"../Entity\";\n\n/**\n * Represents a plane in three dimensional space.\n */\nexport class PlaneCollider extends Collider {\n  planePoint: Vector3;\n\n  normal: Vector3;\n\n  /**\n   * Constructor of PlaneCollider.\n   * @param entity - Entity which the plane belongs to\n   */\n  constructor(entity: Entity) {\n    super(entity);\n\n    /** The point through the plane. */\n    this.planePoint = new Vector3();\n\n    /** The normal direction of the plane. */\n    this.normal = new Vector3(0, 1, 0);\n  }\n\n  /**\n   * Set a plane from point and normal.\n   * @param  point - The point through the plane\n   * @param  normal - The normal direction of the plane\n   */\n  setPlane(point: Vector3, normal: Vector3) {\n    this.planePoint = point;\n    this.normal = normal;\n  }\n}\n","import { Vector3 } from \"@oasis-engine/math\";\n\n/**\n * The result of raycast test.\n */\nexport class RaycastHit {\n  public distance: number;\n  public collider: any;\n  public point: Vector3;\n  /**\n   * Constructor of RaycastHit.\n   */\n  constructor() {\n    /** The distance from the collider point to the origin of the ray. */\n    this.distance = Number.MAX_VALUE;\n\n    /** The collider that has been intersecting. */\n    this.collider = null;\n\n    /** The point where the ray intersects.  */\n    this.point = null;\n  }\n}\n","import { BoundingBox, BoundingSphere, Matrix, Plane, Ray, Vector3 } from \"@oasis-engine/math\";\nimport { ABoxCollider } from \"../collider/ABoxCollider\";\nimport { ASphereCollider } from \"../collider/ASphereCollider\";\nimport { ColliderFeature } from \"../collider/ColliderFeature\";\nimport { PlaneCollider } from \"../collider/PlaneCollider\";\nimport { Layer } from \"../Layer\";\nimport { Scene } from \"../Scene\";\nimport { RaycastHit } from \"./RaycastHit\";\n\n// TODO\n/** @internal */\nconst _tempVec3 = new Vector3();\n/** @internal */\nconst _tempPlane = new Plane();\n/** @internal */\nconst _tepmBox = new BoundingBox();\n/** @internal */\nconst _tempShpere = new BoundingSphere();\n\n/**\n * Perform ray detection on all Colliders in the scene and return to the one closest to the beginning of the ray.\n * @param _ray - The ray to perform\n * @param _outPos - The point where the ray intersects\n * @return The collider that has been intersecting\n */\n(Scene.prototype as any).raycast = function (ray: Ray, _outPos: Vector3, tag: Layer = Layer.Everything) {\n  const cf = this.findFeature(ColliderFeature);\n  const colliders = cf.colliders;\n\n  let nearestHit = new RaycastHit();\n\n  for (let i = 0, len = colliders.length; i < len; i++) {\n    const collider = colliders[i];\n    if (!collider.entity.isActiveInHierarchy) {\n      continue;\n    }\n\n    if (!(collider.entity.layer & tag)) {\n      continue;\n    }\n    const hit = new RaycastHit();\n    if (collider.raycast(ray, hit)) {\n      if (hit.distance < nearestHit.distance) {\n        nearestHit = hit;\n      }\n    }\n  } // end of for\n\n  if (_outPos && nearestHit.collider) {\n    nearestHit.point.cloneTo(_outPos);\n  }\n\n  return nearestHit.collider;\n};\n\n/**\n * Perform ray cast.\n * @param ray - The ray\n * @param hit - The raycasthit\n */\n(ABoxCollider.prototype as any).raycast = function (ray, hit) {\n  const localRay = _getLocalRay(this, ray);\n  // TODO\n  this.boxMin.cloneTo(_tepmBox.min);\n  this.boxMax.cloneTo(_tepmBox.max);\n  const intersect = localRay.intersectBox(_tepmBox);\n  if (intersect !== -1) {\n    _updateHitResult(this, localRay, intersect, hit, ray.origin);\n    return true;\n  } else {\n    return false;\n  } // end of else\n};\n\n(ASphereCollider.prototype as any).raycast = function (ray, hit) {\n  const localRay = _getLocalRay(this, ray);\n  // TODO\n  this.center.cloneTo(_tempShpere.center);\n  _tempShpere.radius = this.radio;\n  const intersect = localRay.intersectSphere(_tempShpere);\n  if (intersect !== -1) {\n    _updateHitResult(this, localRay, intersect, hit, ray.origin);\n    return true;\n  } else {\n    return false;\n  } // end of else\n};\n\n(PlaneCollider.prototype as any).raycast = function (ray, hit) {\n  const localRay = _getLocalRay(this, ray);\n  // TODO\n  this.normal.cloneTo(_tempPlane.normal);\n  _tempPlane.distance = -Vector3.dot(this.planePoint, _tempPlane.normal);\n  const intersect = localRay.intersectPlane(_tempPlane);\n  if (intersect !== -1) {\n    _updateHitResult(this, localRay, intersect, hit, ray.origin);\n    return true;\n  } else {\n    return false;\n  } // end of else\n};\n\n/**\n * Calculate the raycasthit in world space.\n * @param ray - The ray\n * @param distance - The distance\n * @param outHit - The raycasthit\n */\nfunction _updateHitResult(collider, ray: Ray, distance: number, outHit: RaycastHit, origin: Vector3) {\n  const hitPos = _tempVec3;\n  ray.getPoint(distance, hitPos);\n  Vector3.transformCoordinate(hitPos, collider.entity.transform.worldMatrix, hitPos);\n\n  outHit.distance = Vector3.distance(origin, hitPos);\n  outHit.collider = collider;\n  outHit.point = hitPos;\n}\n\n/**\n * transform ray to local space\n * @param {Ray} ray\n * @private\n */\n\nfunction _getLocalRay(collider, ray) {\n  const worldToLocal = collider.entity.getInvModelMatrix();\n\n  // o = worldToLocal * vec4(ray.origin, 1)\n  const o = new Vector3();\n  Vector3.transformCoordinate(ray.origin, worldToLocal, o);\n\n  // d = worldToLocal * vec4(ray.direction, 0)\n  const d = new Vector3();\n  _transformDirection(d, ray.direction, worldToLocal);\n\n  return new Ray(o, d);\n}\n\n// a: vec3\n// m: mat4\n// return m * vec3(a, 0)\nfunction _transformDirection(out: Vector3, a: Vector3, m: Matrix) {\n  const x = a.x;\n  const y = a.y;\n  const z = a.z;\n  const e = m.elements;\n  out.x = x * e[0] + y * e[4] + z * e[8];\n  out.y = x * e[1] + y * e[5] + z * e[9];\n  out.z = x * e[2] + y * e[6] + z * e[10];\n  return out;\n}\n","import { BoundingBox, Vector3 } from \"@oasis-engine/math\";\nimport { Engine, EngineObject } from \"..\";\nimport { Primitive } from \"../graphic/Primitive\";\nimport { SubPrimitive } from \"../graphic/SubPrimitive\";\n\n/**\n * Mesh Asset Object\n */\nexport class Mesh extends EngineObject {\n  name: string;\n  primitives: Primitive[] = [];\n  groups: SubPrimitive[] = [];\n  weights: number[];\n  readonly bounds: BoundingBox = new BoundingBox(new Vector3(), new Vector3());\n\n  /**\n   * Contructor of mesh\n   * @param name - Name\n   */\n  constructor(engine: Engine, name?: string) {\n    super(engine);\n    this.name = name;\n  }\n\n  updatePrimitiveWeightsIndices(weightsIndices: number[]) {\n    // this.primitives.forEach((primitive) => {\n    //   primitive.updateWeightsIndices(weightsIndices);\n    // });\n  }\n\n  destroy() {\n    this.primitives = null;\n  }\n}\n","import { Matrix } from \"@oasis-engine/math\";\nimport { EngineObject } from \"../base/EngineObject\";\n\nlet skinID = 0;\n\n/**\n * Mesh skin data, equal glTF skins define\n */\nexport class Skin extends EngineObject {\n  public inverseBindMatrices: Matrix[];\n  public joints: string[];\n  public skeleton: string;\n  /**\n   * Contructor of skin\n   * @param name - name\n   */\n  constructor(name: string) {\n    super(null);\n\n    this.inverseBindMatrices = []; // inverse bind matrix array, element type: gl-matrix.mat4\n    this.joints = []; // joints name array, element type: string\n    this.skeleton = \"none\"; // root bone name\n  }\n}\n","import { BoundingBox } from \"@oasis-engine/math\";\nimport { Logger } from \"../base/Logger\";\nimport { Camera } from \"../Camera\";\nimport { ignoreClone, shallowClone } from \"../clone/CloneManager\";\nimport { Entity } from \"../Entity\";\nimport { Material } from \"../material/Material\";\nimport { Renderer } from \"../Renderer\";\nimport { RenderElement } from \"../RenderPipeline/RenderElement\";\nimport { Mesh } from \"./Mesh\";\n\nfunction addPrimitivesRefCount(mesh: Mesh, refCount: number): void {\n  const primitives = mesh.primitives;\n  for (let i = 0, l = primitives.length; i < l; i++) {\n    primitives[i]._addRefCount(refCount);\n  }\n}\n\n/**\n * MeshRenderer Component\n */\nexport class MeshRenderer extends Renderer {\n  private _mesh: Mesh;\n  @ignoreClone\n  private _instanceMaterials: Material[] = [];\n  @shallowClone\n  private _sharedMaterials: Material[] = [];\n\n  constructor(entity: Entity) {\n    super(entity);\n\n    this._mesh = null; // Mesh Asset Object\n  }\n\n  /**\n   * Current mesh object.\n   */\n  get mesh() {\n    return this._mesh;\n  }\n\n  /**\n   * Specify mesh which will be used to render.\n   * @param mesh - Mesh Object\n   */\n  set mesh(mesh: Mesh) {\n    if (this._mesh) {\n      addPrimitivesRefCount(this._mesh, -1);\n    }\n    addPrimitivesRefCount(mesh, 1);\n    this._mesh = mesh;\n    this._sharedMaterials = [];\n    this._instanceMaterials = [];\n  }\n\n  /**\n   * Specify a material that will be used by a primitive and the material could be shared.\n   * @param primitiveIndex - Primitive's index\n   * @param material - Material.\n   */\n  setSharedMaterial(primitiveIndex: number, material: Material) {\n    if (this._sharedMaterials[primitiveIndex]) {\n      this._sharedMaterials[primitiveIndex]._addRefCount(-1);\n    }\n    material._addRefCount(1);\n    this._sharedMaterials[primitiveIndex] = material;\n  }\n\n  /**\n   * Specify a material that will be used by a primitive.\n   * @param primitiveIndex - Primitive's index\n   * @param material - Material\n   */\n  setMaterial(primitiveIndex: number, material: Material) {\n    if (this._instanceMaterials[primitiveIndex]) {\n      this._instanceMaterials[primitiveIndex]._addRefCount(-1);\n    }\n    material._addRefCount(1);\n    this._instanceMaterials[primitiveIndex] = material;\n  }\n\n  /**\n   * Get the material object exclusive to this component\n   * @param primitiveIndex - Primitive's index\n   * @return Material\n   */\n  getInstanceMaterial(primitiveIndex: number): Material {\n    return this._instanceMaterials[primitiveIndex];\n  }\n\n  /**\n   * Get the shared primitive material object\n   * @param primitiveIndex Primitive's index\n   * @return Material\n   */\n  getSharedMaterial(primitiveIndex: number): Material {\n    return this._sharedMaterials[primitiveIndex];\n  }\n\n  /**\n   * Execute render\n   * @param camera\n   */\n  render(camera: Camera) {\n    const mesh = this._mesh;\n    if (!mesh) {\n      return;\n    }\n\n    const renderPipeline = camera._renderPipeline;\n    const { primitives, groups } = mesh;\n\n    //-- render every primitive\n    for (let i = 0, len = primitives.length; i < len; i++) {\n      const primitive = primitives[i];\n      const material = this._instanceMaterials[i] || this._sharedMaterials[i];\n      if (material) {\n        const element = RenderElement.getFromPool();\n        element.setValue(this, primitive, groups[i], material);\n        renderPipeline.pushPrimitive(element);\n      } else {\n        Logger.error(\"Primitive has no material: \" + primitive.name);\n      }\n    } // end of for\n  }\n\n  /**\n   * Destroy the component.\n   */\n  destroy() {\n    super.destroy();\n\n    //-- release mesh\n    this._mesh = null;\n\n    //-- materials\n    this._instanceMaterials = [];\n    this._sharedMaterials = [];\n\n    // delete reference count\n    for (let i = 0; i < this._instanceMaterials.length; i++) {\n      this._instanceMaterials[i]._addRefCount(-1);\n    }\n\n    // delete reference count\n    for (let i = 0; i < this._sharedMaterials.length; i++) {\n      this._sharedMaterials[i]._addRefCount(-1);\n    }\n\n    if (this._mesh) {\n      addPrimitivesRefCount(this._mesh, -1);\n    }\n  }\n\n  /**\n   * @override\n   */\n  protected _updateBounds(worldBounds: BoundingBox): void {\n    const localBounds = this.mesh.bounds;\n    const worldMatrix = this._entity.transform.worldMatrix;\n\n    BoundingBox.transform(localBounds, worldMatrix, worldBounds);\n  }\n}\n","import { Logger } from \"../base/Logger\";\nimport { Engine } from \"../Engine\";\nimport { TextureFilterMode } from \"./enums/TextureFilterMode\";\nimport { TextureFormat } from \"./enums/TextureFormat\";\nimport { TextureWrapMode } from \"./enums/TextureWrapMode\";\nimport { Texture } from \"./Texture\";\n\n/**\n * Two-dimensional texture.\n */\nexport class Texture2D extends Texture {\n  private _format: TextureFormat;\n  /** Backward compatible with WebGL1.0. */\n  private _compressedMipFilled: number = 0;\n\n  /**\n   * Texture format.\n   * @readonly\n   */\n  get format(): TextureFormat {\n    return this._format;\n  }\n\n  /**\n   * Create Texture2D.\n   * @param engine - Define the engine to use to render this texture\n   * @param width - Texture width\n   * @param height - Texture height\n   * @param format - Texture format. default  `TextureFormat.R8G8B8A8`\n   * @param mipmap - Whether to use multi-level texture\n   */\n  constructor(\n    engine: Engine,\n    width: number,\n    height: number,\n    format: TextureFormat = TextureFormat.R8G8B8A8,\n    mipmap: boolean = true\n  ) {\n    super(engine);\n    const rhi = engine._hardwareRenderer;\n    const gl: WebGLRenderingContext & WebGL2RenderingContext = rhi.gl;\n    const isWebGL2: boolean = rhi.isWebGL2;\n\n    if (!Texture._supportTextureFormat(format, rhi)) {\n      throw new Error(`Texture format is not supported:${TextureFormat[format]}`);\n    }\n\n    if (mipmap && !isWebGL2 && (!Texture._isPowerOf2(width) || !Texture._isPowerOf2(height))) {\n      Logger.warn(\n        \"non-power-2 texture is not supported for mipmap in WebGL1,and has automatically downgraded to non-mipmap\"\n      );\n      mipmap = false;\n    }\n\n    const formatDetail = Texture._getFormatDetail(format, gl, isWebGL2);\n\n    this._glTexture = gl.createTexture();\n    this._formatDetail = formatDetail;\n    this._rhi = rhi;\n    this._target = gl.TEXTURE_2D;\n    this._mipmap = mipmap;\n    this._width = width;\n    this._height = height;\n    this._format = format;\n    this._mipmapCount = this._getMipmapCount();\n\n    (formatDetail.isCompressed && !isWebGL2) || this._initMipmap(false);\n\n    this.filterMode = TextureFilterMode.Bilinear;\n    this.wrapModeU = this.wrapModeV = TextureWrapMode.Repeat;\n  }\n\n  /**\n   * Setting pixels data through color buffer data, designated area and texture mipmapping level,it's also applicable to compressed formats.\n   * @remarks If it is the WebGL1.0 platform and the texture format is compressed, the first upload must be filled with textures.\n   * @param colorBuffer - Color buffer data\n   * @param mipLevel - Texture mipmapping level\n   * @param x - X coordinate of area start\n   * @param y - Y coordinate of area start\n   * @param width - Data width. if it's empty, width is the width corresponding to mipLevel minus x , width corresponding to mipLevel is Math.max(1, this.width >> mipLevel)\n   * @param height - Data height. if it's empty, height is the height corresponding to mipLevel minus y , height corresponding to mipLevel is Math.max(1, this.height >> mipLevel)\n   */\n  setPixelBuffer(\n    colorBuffer: ArrayBufferView,\n    mipLevel: number = 0,\n    x?: number,\n    y?: number,\n    width?: number,\n    height?: number\n  ): void {\n    const gl: WebGLRenderingContext & WebGL2RenderingContext = this._rhi.gl;\n    const isWebGL2: boolean = this._rhi.isWebGL2;\n    const { internalFormat, baseFormat, dataType, isCompressed } = this._formatDetail;\n    const mipWidth = Math.max(1, this._width >> mipLevel);\n    const mipHeight = Math.max(1, this._height >> mipLevel);\n\n    x = x || 0;\n    y = y || 0;\n    width = width || mipWidth - x;\n    height = height || mipHeight - y;\n\n    this._bind();\n\n    gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, 0);\n    gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, 0);\n\n    if (isCompressed) {\n      const mipBit = 1 << mipLevel;\n      if (isWebGL2 || this._compressedMipFilled & mipBit) {\n        gl.compressedTexSubImage2D(this._target, mipLevel, x, y, width, height, internalFormat, colorBuffer);\n      } else {\n        gl.compressedTexImage2D(this._target, mipLevel, internalFormat, width, height, 0, colorBuffer);\n        this._compressedMipFilled |= mipBit;\n      }\n    } else {\n      gl.texSubImage2D(this._target, mipLevel, x, y, width, height, baseFormat, dataType, colorBuffer);\n    }\n\n    this._unbind();\n  }\n\n  /**\n   * Setting pixels data through TexImageSource, designated area and texture mipmapping level.\n   * @param imageSource - The source of texture\n   * @param mipLevel - Texture mipmapping level\n   * @param flipY - Whether to flip the Y axis\n   * @param premultiplyAlpha - Whether to premultiply the transparent channel\n   * @param x - X coordinate of area start\n   * @param y - Y coordinate of area start\n   */\n  setImageSource(\n    imageSource: TexImageSource,\n    mipLevel: number = 0,\n    flipY: boolean = false,\n    premultiplyAlpha: boolean = false,\n    x?: number,\n    y?: number\n  ): void {\n    const gl: WebGLRenderingContext & WebGL2RenderingContext = this._rhi.gl;\n    const { baseFormat, dataType } = this._formatDetail;\n\n    this._bind();\n    gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, +flipY);\n    gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, +premultiplyAlpha);\n    gl.texSubImage2D(this._target, mipLevel, x || 0, y || 0, baseFormat, dataType, imageSource);\n    this._unbind();\n  }\n\n  /**\n   * Get the pixel color buffer according to the specified area.\n   * @param x - X coordinate of area start\n   * @param y - Y coordinate of area start\n   * @param width - Area width\n   * @param height - Area height\n   * @param out - Color buffer\n   */\n  getPixelBuffer(x: number, y: number, width: number, height: number, out: ArrayBufferView): void {\n    if (this._formatDetail.isCompressed) {\n      throw new Error(\"Unable to read compressed texture\");\n    }\n    super._getPixelBuffer(null, x, y, width, height, out);\n  }\n}\n","import { Matrix } from \"@oasis-engine/math\";\nimport { Logger } from \"../base/Logger\";\nimport { Camera } from \"../Camera\";\nimport { ignoreClone } from \"../clone/CloneManager\";\nimport { Entity } from \"../Entity\";\nimport { RenderContext } from \"../RenderPipeline/RenderContext\";\nimport { Shader } from \"../shader\";\nimport { ShaderProperty } from \"../shader/ShaderProperty\";\nimport { TextureFilterMode } from \"../texture/enums/TextureFilterMode\";\nimport { TextureFormat } from \"../texture/enums/TextureFormat\";\nimport { Texture2D } from \"../texture/Texture2D\";\nimport { MeshRenderer } from \"./MeshRenderer\";\nimport { Skin } from \"./Skin\";\n\n/**\n * SkinnedMeshRenderer\n */\nexport class SkinnedMeshRenderer extends MeshRenderer {\n  private static _jointCountProperty: ShaderProperty = Shader.getPropertyByName(\"u_jointCount\");\n  private static _jointSamplerProperty: ShaderProperty = Shader.getPropertyByName(\"u_jointSampler\");\n  private static _jointMatrixProperty: ShaderProperty = Shader.getPropertyByName(\"u_jointMatrix\");\n\n  private static _maxJoints: number = 0;\n\n  @ignoreClone\n  public matrixPalette: Float32Array;\n  @ignoreClone\n  public jointNodes: Entity[];\n  @ignoreClone\n  public jointTexture: Texture2D;\n\n  @ignoreClone\n  private _hasInitJoints: boolean = false;\n  @ignoreClone\n  private _mat: Matrix;\n  @ignoreClone\n  private _weights: number[];\n  @ignoreClone\n  private weightsIndices: number[] = [];\n  @ignoreClone\n  /** Whether to use joint texture. Automatically used when the device can't support the maxium number of bones. */\n  private _useJointTexture: boolean = false;\n\n  private _skin: Skin;\n\n  /**\n   * Constructor of SkinnedMeshRenderer\n   * @param entity - Entity\n   */\n  constructor(entity: Entity) {\n    super(entity);\n    this._mat = new Matrix();\n    this._weights = null;\n    this._skin = null;\n  }\n\n  /**\n   * @internal\n   */\n  _updateShaderData(context: RenderContext) {\n    super._updateShaderData(context);\n\n    if (!this._useJointTexture && this.matrixPalette) {\n      this.shaderData.setFloatArray(SkinnedMeshRenderer._jointMatrixProperty, this.matrixPalette);\n    }\n  }\n\n  /**\n   * Set morph target weights\n   * @param weights - Weights\n   */\n  setWeights(weights: number[]) {\n    this._weights = weights;\n    if (!weights) {\n      return;\n    }\n    const len = weights.length;\n    for (let i = 0; i < len; i++) {\n      this.weightsIndices[i] = i;\n    }\n\n    const weightsIndices = this.weightsIndices;\n\n    for (let i = 0; i < len - 1; i++) {\n      for (let j = i + 1; j < len; j++) {\n        if (weights[j] > weights[i]) {\n          let t = weights[i];\n          weights[i] = weights[j];\n          weights[j] = t;\n          t = weightsIndices[i];\n          weightsIndices[i] = weightsIndices[j];\n          weightsIndices[j] = t;\n        }\n      }\n    }\n    this.mesh.updatePrimitiveWeightsIndices(weightsIndices);\n  }\n\n  /**\n   * Skin Object.\n   */\n  get skin() {\n    return this._skin;\n  }\n\n  set skin(skin) {\n    this._skin = skin;\n  }\n\n  get weights() {\n    return this._weights;\n  }\n\n  _initJoints() {\n    if (!this._skin) return;\n    const skin = this._skin;\n\n    const joints = skin.joints;\n    const jointNodes = [];\n    for (let i = joints.length - 1; i >= 0; i--) {\n      jointNodes[i] = this.findByNodeName(this.entity, joints[i]);\n    } // end of for\n    this.matrixPalette = new Float32Array(jointNodes.length * 16);\n    this.jointNodes = jointNodes;\n\n    /** Whether to use a skeleton texture */\n    const rhi = this.entity.engine._hardwareRenderer;\n    if (!rhi) return;\n    const maxAttribUniformVec4 = rhi.renderStates.getParameter(rhi.gl.MAX_VERTEX_UNIFORM_VECTORS);\n    const maxJoints = Math.floor((maxAttribUniformVec4 - 20) / 4);\n    const shaderData = this.shaderData;\n    const jointCount = this.jointNodes?.length;\n    if (jointCount) {\n      shaderData.enableMacro(\"O3_HAS_SKIN\");\n      shaderData.setInt(SkinnedMeshRenderer._jointCountProperty, jointCount);\n      if (joints.length > maxJoints) {\n        if (rhi.canIUseMoreJoints) {\n          this._useJointTexture = true;\n          shaderData.enableMacro(\"O3_USE_JOINT_TEXTURE\");\n          shaderData.setTexture(SkinnedMeshRenderer._jointSamplerProperty, this.jointTexture);\n        } else {\n          Logger.error(\n            `component's joints count(${joints}) greater than device's MAX_VERTEX_UNIFORM_VECTORS number ${maxAttribUniformVec4}, and don't support jointTexture in this device. suggest joint count less than ${maxJoints}.`,\n            this\n          );\n        }\n      } else {\n        const maxJoints = Math.max(SkinnedMeshRenderer._maxJoints, joints.length);\n        SkinnedMeshRenderer._maxJoints = maxJoints;\n        shaderData.disableMacro(\"O3_USE_JOINT_TEXTURE\");\n        shaderData.enableMacro(\"O3_JOINTS_NUM\", maxJoints.toString());\n      }\n    } else {\n      shaderData.disableMacro(\"O3_HAS_SKIN\");\n    }\n  }\n\n  private findByNodeName(entity: Entity, nodeName: string) {\n    if (!entity) return null;\n\n    const n = entity.findByName(nodeName);\n\n    if (n) return n;\n\n    return this.findByNodeName(entity.parent, nodeName);\n  }\n\n  private _findParent(entity: Entity, nodeName: string) {\n    if (entity) {\n      const parent = entity.parent;\n      if (!parent) return null;\n      if (parent.name === nodeName) return parent;\n\n      const brother = parent.findByName(nodeName);\n      if (brother) return brother;\n\n      return this._findParent(parent, nodeName);\n    }\n    return null;\n  }\n\n  /**\n   * @internal\n   */\n  update() {\n    if (!this._hasInitJoints) {\n      this._initJoints();\n      this._hasInitJoints = true;\n    }\n    if (this._skin) {\n      const joints = this.jointNodes;\n      const ibms = this._skin.inverseBindMatrices;\n      const matrixPalette = this.matrixPalette;\n      const worldToLocal = this.entity.getInvModelMatrix();\n\n      const mat = this._mat;\n      for (let i = joints.length - 1; i >= 0; i--) {\n        mat.identity();\n        if (joints[i]) {\n          Matrix.multiply(joints[i].transform.worldMatrix, ibms[i], mat);\n        } else {\n          ibms[i].cloneTo(mat);\n        }\n        Matrix.multiply(worldToLocal, mat, mat);\n        matrixPalette.set(mat.elements, i * 16);\n      } // end of for\n      if (this._useJointTexture) {\n        this.createJointTexture();\n      }\n    }\n  }\n\n  /**\n   * Generate joint texture.\n   * Format: (4 * RGBA) * jointCont\n   */\n  createJointTexture() {\n    if (!this.jointTexture) {\n      const engine = this.engine;\n      const rhi = engine._hardwareRenderer;\n      if (!rhi) return;\n      this.jointTexture = new Texture2D(engine, 4, this.jointNodes.length, TextureFormat.R32G32B32A32, false);\n      this.jointTexture.filterMode = TextureFilterMode.Point;\n    }\n    this.jointTexture.setPixelBuffer(this.matrixPalette);\n  }\n}\n","import { Vector3 } from \"@oasis-engine/math\";\nimport { Camera } from \"../Camera\";\nimport { Renderer } from \"../Renderer\";\n\n/**\n * LOD rendering group\n */\nexport class LODGroup extends Renderer {\n  private _lods = [];\n\n  /**\n   * Add a LOD level.\n   * @param distance - Distance between current entity and the camera.\n   * @param renderer - Renderer, when LOD level enabled, use this renderer to render.\n   */\n  addLod(distance: number, renderer: Renderer) {\n    // Disable component render function.\n    renderer.enabled = false;\n\n    this._lods.push({\n      distance,\n      rendererAbility: renderer\n    });\n\n    this._lods.sort((a, b) => b.distance - a.distance);\n  }\n\n  /**\n   * @private\n   */\n  render(camera: Camera) {\n    if (this._lods.length <= 0) return;\n\n    const dist = Vector3.distance(camera.entity.transform.worldPosition, this.entity.transform.worldPosition);\n\n    const lods = this._lods;\n    let activeLevel = 0;\n    for (let i = lods.length - 1; i >= 0; i--) {\n      const lod = lods[i];\n      if (dist < lod.distance) {\n        activeLevel = i;\n        break;\n      }\n    } // end of for\n\n    const lod = lods[activeLevel];\n    lod.rendererAbility.render(camera);\n  }\n}\n","/**\n * Define the face of the cube texture.\n */\nexport enum TextureCubeFace {\n  /** Positive X face for a cube-mapped texture. */\n  PositiveX = 0,\n  /** Negative X face for a cube-mapped texture. */\n  NegativeX = 1,\n  /** Positive Y face for a cube-mapped texture. */\n  PositiveY = 2,\n  /** Negative Y face for a cube-mapped texture. */\n  NegativeY = 3,\n  /** Positive Z face for a cube-mapped texture. */\n  PositiveZ = 4,\n  /** Negative Z face for a cube-mapped texture. */\n  NegativeZ = 5\n}\n","import { Logger } from \"../base/Logger\";\nimport { Engine } from \"../Engine\";\nimport { TextureCubeFace } from \"./enums/TextureCubeFace\";\nimport { TextureFilterMode } from \"./enums/TextureFilterMode\";\nimport { TextureFormat } from \"./enums/TextureFormat\";\nimport { TextureWrapMode } from \"./enums/TextureWrapMode\";\nimport { Texture } from \"./Texture\";\n\n/**\n * Cube texture.\n */\nexport class TextureCubeMap extends Texture {\n  private _format: TextureFormat;\n  /** Backward compatible with WebGL1.0. */\n  private _compressedFaceFilled: number[] = [0, 0, 0, 0, 0, 0];\n\n  /**\n   * Texture format.\n   */\n  get format(): TextureFormat {\n    return this._format;\n  }\n\n  /**\n   * Create TextureCube.\n   * @param engine - Define the engine to use to render this texture\n   * @param size - Texture size. texture width must be equal to height in cube texture\n   * @param format - Texture format,default TextureFormat.R8G8B8A8\n   * @param mipmap - Whether to use multi-level texture\n   */\n  constructor(engine: Engine, size: number, format: TextureFormat = TextureFormat.R8G8B8A8, mipmap: boolean = true) {\n    super(engine);\n    const rhi = engine._hardwareRenderer;\n    const gl: WebGLRenderingContext & WebGL2RenderingContext = rhi.gl;\n    const isWebGL2: boolean = rhi.isWebGL2;\n\n    if (!Texture._supportTextureFormat(format, rhi)) {\n      throw new Error(`Texture format is not supported:${TextureFormat[format]}`);\n    }\n\n    if (mipmap && !isWebGL2 && !Texture._isPowerOf2(size)) {\n      Logger.warn(\n        \"non-power-2 texture is not supported for mipmap in WebGL1,and has automatically downgraded to non-mipmap\"\n      );\n      mipmap = false;\n    }\n\n    const formatDetail = Texture._getFormatDetail(format, gl, isWebGL2);\n\n    this._glTexture = gl.createTexture();\n    this._formatDetail = formatDetail;\n    this._rhi = rhi;\n    this._target = gl.TEXTURE_CUBE_MAP;\n    this._mipmap = mipmap;\n    this._width = size;\n    this._height = size;\n    this._format = format;\n    this._mipmapCount = this._getMipmapCount();\n\n    (formatDetail.isCompressed && !isWebGL2) || this._initMipmap(true);\n\n    this.filterMode = TextureFilterMode.Bilinear;\n    this.wrapModeU = this.wrapModeV = TextureWrapMode.Clamp;\n  }\n\n  /**\n   * Setting pixels data through cube face,color buffer data, designated area and texture mipmapping level,it's also applicable to compressed formats.\n   * @remarks When compressed texture is in WebGL1, the texture must be filled first before writing the sub-region\n   * @param face - Cube face\n   * @param colorBuffer - Color buffer data\n   * @param mipLevel - Texture mipmapping level\n   * @param x - X coordinate of area start\n   * @param y -  Y coordinate of area start\n   * @param width - Data width.if it's empty, width is the width corresponding to mipLevel minus x , width corresponding to mipLevel is Math.max(1, this.width >> mipLevel)\n   * @param height - Data height.if it's empty, height is the height corresponding to mipLevel minus y , height corresponding to mipLevel is Math.max(1, this.height >> mipLevel)\n   */\n  setPixelBuffer(\n    face: TextureCubeFace,\n    colorBuffer: ArrayBufferView,\n    mipLevel: number = 0,\n    x?: number,\n    y?: number,\n    width?: number,\n    height?: number\n  ): void {\n    const gl: WebGLRenderingContext & WebGL2RenderingContext = this._rhi.gl;\n    const isWebGL2: boolean = this._rhi.isWebGL2;\n    const { internalFormat, baseFormat, dataType, isCompressed } = this._formatDetail;\n    const mipSize = Math.max(1, this._width >> mipLevel);\n\n    x = x || 0;\n    y = y || 0;\n    width = width || mipSize - x;\n    height = height || mipSize - y;\n\n    this._bind();\n\n    gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, 0);\n    gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, 0);\n\n    if (isCompressed) {\n      const mipBit = 1 << mipLevel;\n      if (isWebGL2 || this._compressedFaceFilled[face] & mipBit) {\n        gl.compressedTexSubImage2D(\n          gl.TEXTURE_CUBE_MAP_POSITIVE_X + face,\n          mipLevel,\n          x,\n          y,\n          width,\n          height,\n          internalFormat,\n          colorBuffer\n        );\n      } else {\n        gl.compressedTexImage2D(\n          gl.TEXTURE_CUBE_MAP_POSITIVE_X + face,\n          mipLevel,\n          internalFormat,\n          width,\n          height,\n          0,\n          colorBuffer\n        );\n        this._compressedFaceFilled[face] |= mipBit;\n      }\n    } else {\n      gl.texSubImage2D(\n        gl.TEXTURE_CUBE_MAP_POSITIVE_X + face,\n        mipLevel,\n        x,\n        y,\n        width,\n        height,\n        baseFormat,\n        dataType,\n        colorBuffer\n      );\n    }\n\n    this._unbind();\n  }\n\n  /**\n   * Setting pixels data through cube face, TexImageSource, designated area and texture mipmapping level.\n   * @param face - Cube face\n   * @param imageSource - The source of texture\n   * @param mipLevel - Texture mipmapping level\n   * @param flipY - Whether to flip the Y axis\n   * @param premultipltAlpha - Whether to premultiply the transparent channel\n   * @param x - X coordinate of area start\n   * @param y - Y coordinate of area start\n   */\n  setImageSource(\n    face: TextureCubeFace,\n    imageSource: TexImageSource,\n    mipLevel: number = 0,\n    flipY: boolean = false,\n    premultiplyAlpha: boolean = false,\n    x?: number,\n    y?: number\n  ): void {\n    const gl: WebGLRenderingContext & WebGL2RenderingContext = this._rhi.gl;\n    const { baseFormat, dataType } = this._formatDetail;\n\n    this._bind();\n\n    gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, +flipY);\n    gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, +premultiplyAlpha);\n    gl.texSubImage2D(\n      gl.TEXTURE_CUBE_MAP_POSITIVE_X + face,\n      mipLevel,\n      x || 0,\n      y || 0,\n      baseFormat,\n      dataType,\n      imageSource\n    );\n    this._unbind();\n  }\n\n  /**\n   * Get the pixel color buffer according to the specified cube face and area.\n   * @param face - You can choose which cube face to read\n   * @param x - X coordinate of area start\n   * @param y - Y coordinate of area start\n   * @param width - Area width\n   * @param height - Area height\n   * @param out - Color buffer\n   */\n  getPixelBuffer(\n    face: TextureCubeFace,\n    x: number,\n    y: number,\n    width: number,\n    height: number,\n    out: ArrayBufferView\n  ): void {\n    if (this._formatDetail.isCompressed) {\n      throw new Error(\"Unable to read compressed texture\");\n    }\n    super._getPixelBuffer(face, x, y, width, height, out);\n  }\n}\n","import { Logger } from \"../base/Logger\";\nimport { Engine } from \"../Engine\";\nimport { RenderBufferDepthFormat } from \"./enums/RenderBufferDepthFormat\";\nimport { TextureFilterMode } from \"./enums/TextureFilterMode\";\nimport { TextureWrapMode } from \"./enums/TextureWrapMode\";\nimport { Texture } from \"./Texture\";\n\n/**\n * The texture is used for the output of depth information in off-screen rendering.\n */\nexport class RenderDepthTexture extends Texture {\n  /** @internal */\n  public _isCube: boolean = false;\n\n  private _format: RenderBufferDepthFormat;\n  private _autoMipmap: boolean = false;\n\n  /**\n   * Render depth texture format.\n   */\n  get format(): RenderBufferDepthFormat {\n    return this._format;\n  }\n\n  /**\n   * Whether to automatically generate multi-level textures.\n   */\n  get autoGenerateMipmaps(): boolean {\n    return this._autoMipmap;\n  }\n\n  set autoGenerateMipmaps(value: boolean) {\n    this._autoMipmap = value;\n  }\n\n  /**\n   * Create RenderDepthTexture.\n   * @param engine - Define the engine to use to render this depth texture\n   * @param width - Texture width\n   * @param height - Texture height\n   * @param format - Texture format. default RenderBufferDepthFormat.Depth, engine will automatically select the supported precision\n   * @param mipmap - Whether to use multi-level texture\n   * @param isCube - Whether it's cube texture\n   */\n  constructor(\n    engine: Engine,\n    width: number,\n    height: number,\n    format: RenderBufferDepthFormat = RenderBufferDepthFormat.Depth,\n    mipmap: boolean = false,\n    isCube: boolean = false\n  ) {\n    super(engine);\n    const rhi = engine._hardwareRenderer;\n    const gl: WebGLRenderingContext & WebGL2RenderingContext = rhi.gl;\n    const isWebGL2: boolean = rhi.isWebGL2;\n\n    if (!Texture._supportRenderBufferDepthFormat(format, rhi, true)) {\n      throw new Error(`RenderBufferDepthFormat is not supported:${RenderBufferDepthFormat[format]}`);\n    }\n\n    if (isCube && width !== height) {\n      throw new Error(\"The cube texture must have the same width and height\");\n    }\n    if (mipmap && !isWebGL2 && (!Texture._isPowerOf2(width) || !Texture._isPowerOf2(height))) {\n      Logger.warn(\n        \"non-power-2 texture is not supported for mipmap in WebGL1,and has automatically downgraded to non-mipmap\"\n      );\n      mipmap = false;\n    }\n\n    this._glTexture = gl.createTexture();\n    this._formatDetail = Texture._getRenderBufferDepthFormatDetail(format, gl, isWebGL2);\n    this._isCube = isCube;\n    this._rhi = rhi;\n    this._target = isCube ? gl.TEXTURE_CUBE_MAP : gl.TEXTURE_2D;\n    this._mipmap = mipmap;\n    this._width = width;\n    this._height = height;\n    this._format = format;\n    this._mipmapCount = this._getMipmapCount();\n\n    this._initMipmap(isCube);\n\n    this.filterMode = TextureFilterMode.Bilinear;\n    this.wrapModeU = this.wrapModeV = TextureWrapMode.Clamp;\n  }\n}\n","import { EngineObject } from \"../base\";\nimport { GLCapabilityType } from \"../base/Constant\";\nimport { Logger } from \"../base/Logger\";\nimport { Engine } from \"../Engine\";\nimport { RenderBufferDepthFormat } from \"./enums/RenderBufferDepthFormat\";\nimport { TextureCubeFace } from \"./enums/TextureCubeFace\";\nimport { RenderColorTexture } from \"./RenderColorTexture\";\nimport { RenderDepthTexture } from \"./RenderDepthTexture\";\nimport { Texture } from \"./Texture\";\n\n/**\n * The render target used for off-screen rendering.\n */\nexport class RenderTarget extends EngineObject {\n  public _frameBuffer: WebGLFramebuffer;\n  public _MSAAFrameBuffer: WebGLFramebuffer | null;\n\n  private _rhi;\n  private _width: number;\n  private _height: number;\n  private _antiAliasing: number;\n  private _colorTextures: RenderColorTexture[];\n  private _depthTexture: RenderDepthTexture | null;\n  private _depthRenderBuffer: WebGLRenderbuffer | null;\n  private _MSAAColorRenderBuffers: WebGLRenderbuffer[] = [];\n  private _MSAADepthRenderBuffer: WebGLRenderbuffer | null;\n  private _oriDrawBuffers: GLenum[];\n  private _blitDrawBuffers: GLenum[] | null;\n\n  /**\n   * Render target width.\n   * @readonly\n   */\n  get width(): number {\n    return this._width;\n  }\n\n  /**\n   * Render target height.\n   * @readonly\n   */\n  get height(): number {\n    return this._height;\n  }\n\n  /**\n   * Render color texture count.\n   * @readonly\n   */\n  get colorTextureCount(): number {\n    return this._colorTextures.length;\n  }\n\n  /**\n   * Depth texture.\n   * @readonly\n   */\n  get depthTexture(): RenderDepthTexture | null {\n    return this._depthTexture;\n  }\n\n  /**\n   * Anti-aliasing level.\n   * @remarks If the anti-aliasing level set is greater than the maximum level supported by the hardware, the maximum level of the hardware will be used.\n   * @readonly\n   */\n  get antiAliasing(): number {\n    return this._antiAliasing;\n  }\n\n  /**\n   * Create a render target through color texture and depth format.\n   * @param engine - Define the engine to use for this off-screen rendering\n   * @param width - Render target width\n   * @param height - Render target height\n   * @param colorTexture - Render color texture\n   * @param depthFormat - Depth format. default RenderBufferDepthFormat.Depth, engine will automatically select the supported precision\n   * @param antiAliasing - Anti-aliasing level, default is 1\n   */\n  constructor(\n    engine: Engine,\n    width: number,\n    height: number,\n    colorTexture: RenderColorTexture,\n    depthFormat?: RenderBufferDepthFormat | null,\n    antiAliasing?: number\n  );\n\n  /**\n   * Create a render target through color texture and depth format.\n   * @remarks If the color texture is not transmitted, only the depth texture is generated.\n   * @param engine - Define the engine to use for this off-screen rendering\n   * @param width - Render target width\n   * @param height - Render target height\n   * @param colorTexture - Render color texture\n   * @param depthTexture - Render depth texture\n   * @param antiAliasing - Anti-aliasing level, default is 1\n   */\n  constructor(\n    engine: Engine,\n    width: number,\n    height: number,\n    colorTexture: RenderColorTexture | null,\n    depthTexture: RenderDepthTexture,\n    antiAliasing?: number\n  );\n\n  /**\n   * Create a render target with color texture array and depth format.\n   * @param engine - Define the engine to use for this off-screen rendering\n   * @param width - Render target width\n   * @param height - Render target height\n   * @param colorTextures - Render color texture array\n   * @param depthFormat - Depth format. default RenderBufferDepthFormat.Depth,engine will automatically select the supported precision\n   * @param antiAliasing - Anti-aliasing level, default is 1\n   */\n  constructor(\n    engine: Engine,\n    width: number,\n    height: number,\n    colorTextures: RenderColorTexture[],\n    depthFormat?: RenderBufferDepthFormat | null,\n    antiAliasing?: number\n  );\n\n  /**\n   * Create a render target with color texture array and depth texture.\n   * @param engine - Define the engine to use for this off-screen rendering\n   * @param width - Render target width\n   * @param height - Render target height\n   * @param colorTextures - Render color texture array\n   * @param depthTexture - Depth texture\n   * @param antiAliasing - Anti-aliasing level, default is 1\n   */\n  constructor(\n    engine: Engine,\n    width: number,\n    height: number,\n    colorTextures: RenderColorTexture[],\n    depthTexture: RenderDepthTexture,\n    antiAliasing?: number\n  );\n\n  /**\n   * @internal\n   */\n  constructor(\n    engine: Engine,\n    width: number,\n    height: number,\n    renderTexture: RenderColorTexture | Array<RenderColorTexture> | null,\n    depth: RenderDepthTexture | RenderBufferDepthFormat | null = RenderBufferDepthFormat.Depth,\n    antiAliasing: number = 1\n  ) {\n    super(engine);\n    const rhi = engine._hardwareRenderer;\n\n    /** @TODO\n     * MRT + Cube + [,MSAA]\n     * MRT + MSAA\n     */\n    const gl: WebGLRenderingContext & WebGL2RenderingContext = rhi.gl;\n\n    if (!(depth instanceof RenderDepthTexture) && !Texture._supportRenderBufferDepthFormat(depth, rhi, false)) {\n      throw new Error(`RenderBufferDepthFormat is not supported:${RenderBufferDepthFormat[depth]}`);\n    }\n\n    if ((renderTexture as RenderColorTexture[])?.length > 1 && !rhi.canIUse(GLCapabilityType.drawBuffers)) {\n      throw new Error(\"MRT is not supported\");\n    }\n\n    // Handle this._colorTextures\n    if (renderTexture) {\n      this._colorTextures = renderTexture instanceof Array ? renderTexture.slice() : [renderTexture];\n    } else {\n      this._colorTextures = [];\n    }\n\n    if (this._colorTextures.some((v: RenderColorTexture) => v.width !== width || v.height !== height)) {\n      throw new Error(\"RenderColorTexture's size must as same as RenderTarget\");\n    }\n\n    if (depth instanceof RenderDepthTexture && (depth.width !== width || depth.height !== height)) {\n      throw new Error(\"RenderDepthTexture's size must as same as RenderTarget\");\n    }\n\n    // TODO: necessary to support MRT + Cube + [,MSAA] ?\n    if (this._colorTextures.length > 1 && this._colorTextures.some((v: RenderColorTexture) => v._isCube)) {\n      throw new Error(\"MRT+Cube+[,MSAA] is not supported\");\n    }\n\n    const maxAntiAliasing = rhi.capability.maxAntiAliasing;\n    if (antiAliasing > maxAntiAliasing) {\n      Logger.warn(`MSAA antiAliasing exceeds the limit and is automatically downgraded to:${maxAntiAliasing}`);\n      antiAliasing = maxAntiAliasing;\n    }\n\n    this._rhi = rhi;\n    this._width = width;\n    this._height = height;\n    this._frameBuffer = gl.createFramebuffer();\n    this._antiAliasing = antiAliasing;\n\n    if (depth instanceof RenderDepthTexture) {\n      this._depthTexture = depth;\n    }\n\n    // Bind main FBO\n    this._bindMainFBO(depth);\n\n    // Bind MSAA FBO\n    if (antiAliasing > 1) {\n      this._MSAAFrameBuffer = gl.createFramebuffer();\n      this._bindMSAAFBO(depth);\n    }\n  }\n\n  /**\n   * Get the render color texture by index.\n   * @param index\n   */\n  public getColorTexture(index: number = 0): RenderColorTexture | null {\n    return this._colorTextures[index];\n  }\n\n  /**\n   * Destroy render target.\n   */\n  public destroy(): void {\n    const gl: WebGLRenderingContext & WebGL2RenderingContext = this._rhi.gl;\n\n    gl.deleteFramebuffer(this._frameBuffer);\n    this._depthRenderBuffer && gl.deleteRenderbuffer(this._depthRenderBuffer);\n    this._MSAAFrameBuffer && gl.deleteFramebuffer(this._MSAAFrameBuffer);\n    this._MSAADepthRenderBuffer && gl.deleteRenderbuffer(this._MSAADepthRenderBuffer);\n\n    for (let i = 0; i < this._colorTextures.length; i++) {\n      this._colorTextures[i].destroy();\n    }\n\n    for (let i = 0; i < this._MSAAColorRenderBuffers.length; i++) {\n      gl.deleteRenderbuffer(this._MSAAColorRenderBuffers[i]);\n    }\n\n    this._depthTexture && this._depthTexture.destroy();\n\n    this._frameBuffer = null;\n    this._colorTextures.length = 0;\n    this._depthTexture = null;\n    this._depthRenderBuffer = null;\n    this._MSAAFrameBuffer = null;\n    this._MSAAColorRenderBuffers.length = 0;\n    this._MSAADepthRenderBuffer = null;\n  }\n\n  /**\n   * Activate this RenderTarget.\n   * @remarks\n   * If MSAA is turned on, MSAA FBO is activated, and then this._blitRenderTarget() is performed to exchange FBO.\n   * If MSAA is not turned on, activate the main FBO.\n   */\n  public _activeRenderTarget(): void {\n    const gl: WebGLRenderingContext & WebGL2RenderingContext = this._rhi.gl;\n\n    if (this._MSAAFrameBuffer) {\n      gl.bindFramebuffer(gl.FRAMEBUFFER, this._MSAAFrameBuffer);\n    } else {\n      gl.bindFramebuffer(gl.FRAMEBUFFER, this._frameBuffer);\n    }\n  }\n\n  /**\n   * Set which face of the cube texture to render to.\n   * @param faceIndex - Cube texture face\n   */\n  public _setRenderTargetFace(faceIndex: TextureCubeFace = TextureCubeFace.PositiveX): void {\n    const gl: WebGLRenderingContext & WebGL2RenderingContext = this._rhi.gl;\n    const colorTexture = this._colorTextures[0];\n    const depthTexture = this._depthTexture;\n\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this._frameBuffer);\n\n    // Bind render color texture\n    if (colorTexture?._isCube) {\n      gl.framebufferTexture2D(\n        gl.FRAMEBUFFER,\n        gl.COLOR_ATTACHMENT0,\n        gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex,\n        colorTexture._glTexture,\n        0\n      );\n    }\n\n    // Bind depth texture\n    if (depthTexture?._isCube) {\n      gl.framebufferTexture2D(\n        gl.FRAMEBUFFER,\n        depthTexture._formatDetail.attachment,\n        gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex,\n        depthTexture._glTexture,\n        0\n      );\n    }\n\n    // Revert current activated render target\n    this._activeRenderTarget();\n  }\n\n  /**\n   * Blit FBO.\n   */\n  public _blitRenderTarget(): void {\n    const gl: WebGLRenderingContext & WebGL2RenderingContext = this._rhi.gl;\n    const mask = gl.COLOR_BUFFER_BIT | (this._depthTexture ? gl.DEPTH_BUFFER_BIT : 0);\n    const colorTextureLength = this._colorTextures.length;\n\n    gl.bindFramebuffer(gl.READ_FRAMEBUFFER, this._MSAAFrameBuffer);\n    gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, this._frameBuffer);\n\n    for (let textureIndex = 0; textureIndex < colorTextureLength; textureIndex++) {\n      const attachment = gl.COLOR_ATTACHMENT0 + textureIndex;\n\n      this._blitDrawBuffers[textureIndex] = attachment;\n\n      gl.readBuffer(attachment);\n      gl.drawBuffers(this._blitDrawBuffers);\n      gl.blitFramebuffer(0, 0, this._width, this._height, 0, 0, this._width, this._height, mask, gl.NEAREST);\n\n      this._blitDrawBuffers[textureIndex] = gl.NONE;\n    }\n\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n  }\n\n  /**\n   * Bind main FBO.\n   */\n  private _bindMainFBO(renderDepth: RenderDepthTexture | RenderBufferDepthFormat | null): void {\n    const gl: WebGLRenderingContext & WebGL2RenderingContext = this._rhi.gl;\n    const isWebGL2: boolean = this._rhi.isWebGL2;\n    const colorTextureLength = this._colorTextures.length;\n    const drawBuffers = new Array(colorTextureLength);\n\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this._frameBuffer);\n\n    /** Color render buffer */\n    for (let i = 0; i < colorTextureLength; i++) {\n      const colorTexture = this._colorTextures[i];\n      const attachment = gl.COLOR_ATTACHMENT0 + i;\n\n      drawBuffers[i] = attachment;\n\n      // Cube texture please call _setRenderTargetFace()\n      if (!colorTexture._isCube) {\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, attachment, gl.TEXTURE_2D, colorTexture._glTexture, 0);\n      }\n    }\n\n    if (colorTextureLength > 1) {\n      gl.drawBuffers(drawBuffers);\n    }\n    this._oriDrawBuffers = drawBuffers;\n\n    /** Depth render buffer */\n    if (renderDepth !== null) {\n      if (renderDepth instanceof RenderDepthTexture) {\n        // Cube texture _setRenderTargetFace()\n        if (!renderDepth._isCube) {\n          gl.framebufferTexture2D(\n            gl.FRAMEBUFFER,\n            renderDepth._formatDetail.attachment,\n            gl.TEXTURE_2D,\n            renderDepth._glTexture,\n            0\n          );\n        }\n      } else if (this._antiAliasing <= 1) {\n        const { internalFormat, attachment } = Texture._getRenderBufferDepthFormatDetail(renderDepth, gl, isWebGL2);\n        const depthRenderBuffer = gl.createRenderbuffer();\n\n        this._depthRenderBuffer = depthRenderBuffer;\n\n        gl.bindRenderbuffer(gl.RENDERBUFFER, depthRenderBuffer);\n        gl.renderbufferStorage(gl.RENDERBUFFER, internalFormat, this._width, this._height);\n        gl.framebufferRenderbuffer(gl.FRAMEBUFFER, attachment, gl.RENDERBUFFER, depthRenderBuffer);\n      }\n    }\n\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    gl.bindRenderbuffer(gl.RENDERBUFFER, null);\n  }\n\n  /**\n   * Bind MSAA FBO.\n   */\n  private _bindMSAAFBO(renderDepth: RenderDepthTexture | RenderBufferDepthFormat | null): void {\n    const gl: WebGLRenderingContext & WebGL2RenderingContext = this._rhi.gl;\n    const isWebGL2: boolean = this._rhi.isWebGL2;\n    const MSAADepthRenderBuffer = gl.createRenderbuffer();\n    const colorTextureLength = this._colorTextures.length;\n\n    this._blitDrawBuffers = new Array(colorTextureLength);\n    this._MSAADepthRenderBuffer = MSAADepthRenderBuffer;\n\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this._MSAAFrameBuffer);\n\n    // Prepare MRT+MSAA color RBOs\n    for (let i = 0; i < colorTextureLength; i++) {\n      const MSAAColorRenderBuffer = gl.createRenderbuffer();\n\n      this._MSAAColorRenderBuffers[i] = MSAAColorRenderBuffer;\n      this._blitDrawBuffers[i] = gl.NONE;\n\n      gl.bindRenderbuffer(gl.RENDERBUFFER, MSAAColorRenderBuffer);\n      gl.renderbufferStorageMultisample(\n        gl.RENDERBUFFER,\n        this._antiAliasing,\n        this._colorTextures[i]._formatDetail.internalFormat,\n        this._width,\n        this._height\n      );\n      gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0 + i, gl.RENDERBUFFER, MSAAColorRenderBuffer);\n    }\n    gl.drawBuffers(this._oriDrawBuffers);\n\n    // Prepare MSAA depth RBO\n    if (renderDepth !== null) {\n      const { internalFormat, attachment } =\n        renderDepth instanceof RenderDepthTexture\n          ? renderDepth._formatDetail\n          : Texture._getRenderBufferDepthFormatDetail(renderDepth, gl, isWebGL2);\n\n      gl.bindRenderbuffer(gl.RENDERBUFFER, MSAADepthRenderBuffer);\n      gl.renderbufferStorageMultisample(gl.RENDERBUFFER, this._antiAliasing, internalFormat, this._width, this._height);\n      gl.framebufferRenderbuffer(gl.FRAMEBUFFER, attachment, gl.RENDERBUFFER, MSAADepthRenderBuffer);\n    }\n\n    this._checkFrameBuffer();\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    gl.bindRenderbuffer(gl.RENDERBUFFER, null);\n  }\n\n  /**\n   * Check FBO.\n   */\n  private _checkFrameBuffer(): void {\n    const gl: WebGLRenderingContext & WebGL2RenderingContext = this._rhi.gl;\n    const isWebGL2: boolean = this._rhi.isWebGL2;\n    const e = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n\n    switch (e) {\n      case gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:\n        throw new Error(\n          \"The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete\"\n        );\n      case gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:\n        throw new Error(\"There is no attachment\");\n      case gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:\n        throw new Error(\" Height and width of the attachment are not the same.\");\n      case gl.FRAMEBUFFER_UNSUPPORTED:\n        throw new Error(\n          \"The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer\"\n        );\n    }\n\n    if (isWebGL2 && e === gl.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE) {\n      throw new Error(\n        \"The values of gl.RENDERBUFFER_SAMPLES are different among attached renderbuffers, or are non-zero if the attached images are a mix of renderbuffers and textures.\"\n      );\n    }\n  }\n}\n","import { Logger } from \"../base/Logger\";\nimport { Engine } from \"../Engine\";\nimport { RenderBufferColorFormat } from \"./enums/RenderBufferColorFormat\";\nimport { TextureCubeFace } from \"./enums/TextureCubeFace\";\nimport { TextureFilterMode } from \"./enums/TextureFilterMode\";\nimport { TextureWrapMode } from \"./enums/TextureWrapMode\";\nimport { Texture } from \"./Texture\";\n\n/**\n * The texture is used for the output of color information in off-screen rendering.\n */\nexport class RenderColorTexture extends Texture {\n  /** @internal */\n  public _isCube: boolean = false;\n\n  private _format: RenderBufferColorFormat;\n  private _autoMipmap: boolean = false;\n\n  /**\n   * Render color texture format.\n   * @readonly\n   */\n  get format(): RenderBufferColorFormat {\n    return this._format;\n  }\n\n  /**\n   * Whether to automatically generate multi-level textures.\n   */\n  get autoGenerateMipmaps(): boolean {\n    return this._autoMipmap;\n  }\n\n  set autoGenerateMipmaps(value: boolean) {\n    this._autoMipmap = value;\n  }\n\n  /**\n   * Create RenderColorTexture.\n   * @param engine - Define the engine to use to render this color texture\n   * @param width - Texture width\n   * @param height - Texture height\n   * @param format - Texture format. default RenderBufferColorFormat.R8G8B8A8\n   * @param mipmap - Whether to use multi-level texture\n   * @param isCube - Whether it's cube texture\n   */\n  constructor(\n    engine: Engine,\n    width: number,\n    height: number,\n    format: RenderBufferColorFormat = RenderBufferColorFormat.R8G8B8A8,\n    mipmap: boolean = false,\n    isCube: boolean = false\n  ) {\n    super(engine);\n    const rhi = engine._hardwareRenderer;\n    const gl: WebGLRenderingContext & WebGL2RenderingContext = rhi.gl;\n    const isWebGL2: boolean = rhi.isWebGL2;\n\n    if (!Texture._supportRenderBufferColorFormat(format, rhi)) {\n      throw new Error(`RenderBufferColorFormat is not supported:${RenderBufferColorFormat[format]}`);\n    }\n\n    if (isCube && width !== height) {\n      throw new Error(\"The cube texture must have the same width and height\");\n    }\n    if (mipmap && !isWebGL2 && (!Texture._isPowerOf2(width) || !Texture._isPowerOf2(height))) {\n      Logger.warn(\n        \"non-power-2 texture is not supported for mipmap in WebGL1,and has automatically downgraded to non-mipmap\"\n      );\n      mipmap = false;\n    }\n\n    this._glTexture = gl.createTexture();\n    this._formatDetail = Texture._getRenderBufferColorFormatDetail(format, gl, isWebGL2);\n    this._isCube = isCube;\n    this._rhi = rhi;\n    this._target = isCube ? gl.TEXTURE_CUBE_MAP : gl.TEXTURE_2D;\n    this._mipmap = mipmap;\n    this._width = width;\n    this._height = height;\n    this._format = format;\n    this._mipmapCount = this._getMipmapCount();\n\n    this._initMipmap(isCube);\n\n    this.filterMode = TextureFilterMode.Bilinear;\n    this.wrapModeU = this.wrapModeV = TextureWrapMode.Clamp;\n  }\n\n  /**\n   * Get the pixel color buffer according to the specified cube face and area.\n   * @param face - You can choose which cube face to read if it's cube texture\n   * @param x - X coordinate of area start\n   * @param y - Y coordinate of area start\n   * @param width - Area width\n   * @param height - Area height\n   * @param out - Color buffer\n   */\n  public getPixelBuffer(\n    face: TextureCubeFace | null,\n    x: number,\n    y: number,\n    width: number,\n    height: number,\n    out: ArrayBufferView\n  ): void {\n    super._getPixelBuffer(face, x, y, width, height, out);\n  }\n}\n","/**\n * Buffer usage.\n */\nexport enum BufferUsage {\n  /** The buffer content are intended to be specified once, and used many times */\n  Static,\n  /** The buffer contents are intended to be respecified repeatedly, and used many times */\n  Dynamic,\n  /** The buffer contents are intended to be specified once, and used at most a few times */\n  Stream\n}\n","/**\n * Vertex element format.\n */\nexport enum VertexElementFormat {\n  /** 32-bit float */\n  Float,\n  /** Two-dimensional 32-bit float */\n  Vector2,\n  /** Three-dimensional 32-bit float */\n  Vector3,\n  /** Four-dimensional 32-bit float */\n  Vector4,\n  /** Four-dimensional 8-bit integer,range is [-128,127] */\n  Byte4,\n  /** Four-dimensional 8-bit Unsigned integer, range is [0,255] */\n  UByte4,\n  /** Four-dimensional 8-bit Normalized integer, range is [-1,1] */\n  NormalizedByte4,\n  /** Four-dimensional 8-bit Normalized unsigned integer, range is [0,1] */\n  NormalizedUByte4,\n  /** Two-dimensional 16-bit integer, range is[-32768, 32767] */\n  Short2,\n  /** Two-dimensional 16-bit Unsigned integer, range is [0, 65535] */\n  UShort2,\n  /** Two-dimensional 16-bit Unsigned integer, range is [-1, 1] */\n  NormalizedShort2,\n  /** Two-dimensional 16-bit Normalized unsigned integer, range is [0, 1] */\n  NormalizedUShort2,\n  /** Four-dimensional 16-bit integer, range is [-32768, 32767] */\n  Short4,\n  /** Four-dimensional 16-bit Unsigned integer, range is [0, 65535] */\n  UShort4,\n  /** Four-dimensional 16-bit Normalized integer, range is[-1, 1] */\n  NormalizedShort4,\n  /** Four-dimensional 16-bit Normalized unsigned integer, range is [0, 1] */\n  NormalizedUShort4\n}\n","/**\n * Index format.\n */\nexport enum IndexFormat {\n  /** 8 bit */\n  UInt8,\n  /** 16 bit */\n  UInt16,\n  /** 32 bit */\n  UInt32\n}\n","import { BufferUsage } from \"./enums/BufferUsage\";\nimport { VertexElementFormat } from \"./enums/VertexElementFormat\";\nimport { DataType } from \"../base/Constant\";\nimport { IndexFormat } from \"./enums/IndexFormat\";\n\nexport interface ElementInfo {\n  size: number;\n  type: DataType;\n}\n\nexport class BufferUtil {\n  /**\n   * @internal\n   */\n  static _getGLBufferUsage(gl: WebGLRenderingContext, bufferUsage: BufferUsage): number {\n    switch (bufferUsage) {\n      case BufferUsage.Static:\n        return gl.STATIC_DRAW;\n      case BufferUsage.Dynamic:\n        return gl.DYNAMIC_DRAW;\n      case BufferUsage.Stream:\n        return gl.STREAM_DRAW;\n    }\n  }\n\n  static _getGLIndexType(indexFormat: IndexFormat): DataType {\n    switch (indexFormat) {\n      case IndexFormat.UInt8:\n        return DataType.UNSIGNED_BYTE;\n      case IndexFormat.UInt16:\n        return DataType.UNSIGNED_SHORT;\n      case IndexFormat.UInt32:\n        return DataType.UNSIGNED_INT;\n    }\n  }\n\n  /**\n   * @internal\n   */\n  static _getElementInfo(format: VertexElementFormat): ElementInfo {\n    let size: number;\n    let type: DataType;\n    switch (format) {\n      case VertexElementFormat.Float:\n        size = 1;\n        type = DataType.FLOAT;\n        break;\n      case VertexElementFormat.Vector2:\n        size = 2;\n        type = DataType.FLOAT;\n        break;\n      case VertexElementFormat.Vector3:\n        size = 3;\n        type = DataType.FLOAT;\n        break;\n      case VertexElementFormat.Vector4:\n        size = 4;\n        type = DataType.FLOAT;\n        break;\n      case VertexElementFormat.Byte4:\n        size = 4;\n        type = DataType.UNSIGNED_BYTE;\n        break;\n      case VertexElementFormat.Short2:\n        size = 2;\n        type = DataType.SHORT;\n        break;\n      case VertexElementFormat.Short4:\n        size = 4;\n        type = DataType.SHORT;\n        break;\n      case VertexElementFormat.UShort2:\n        size = 2;\n        type = DataType.UNSIGNED_SHORT;\n        break;\n      case VertexElementFormat.UShort4:\n        size = 4;\n        type = DataType.UNSIGNED_SHORT;\n        break;\n      default:\n        break;\n    }\n    return { size, type };\n  }\n}\n","/**\n * Buffer binding flag.\n */\nexport enum BufferBindFlag {\n  /** Vertex buffer binding flag */\n  VertexBuffer,\n  /** Index buffer binding flag */\n  IndexBuffer\n}\n","/**\n * Define update strategy when call bufferData/bufferSubData func.\n */\nexport enum SetDataOptions {\n  /** Can overwrite part of used buffer data and ensure correct rendering */\n  None,\n  /** Discard old buffer and create a new buffer, and won't affect the previous rendering */\n  Discard\n  ///** Need to ensure that the buffer data will not be overwritten, and won't interrupting rendering if setData immediately */\n  //NoOverwrite\n}\n","import { RefObject } from \"../asset/RefObject\";\nimport { Engine } from \"../Engine\";\nimport { HardwareRenderer } from \"../HardwareRenderer\";\nimport { BufferUtil } from \"./BufferUtil\";\nimport { BufferBindFlag } from \"./enums/BufferBindFlag\";\nimport { BufferUsage } from \"./enums/BufferUsage\";\nimport { SetDataOptions } from \"./enums/SetDataOptions\";\n\n/**\n * Buffer.\n */\nexport class Buffer extends RefObject {\n  _glBindTarget: number;\n  _glBufferUsage: number;\n  _nativeBuffer: WebGLBuffer;\n\n  private _hardwareRenderer: HardwareRenderer;\n  private _type: BufferBindFlag;\n  private _byteLength: number;\n  private _bufferUsage: BufferUsage;\n\n  /**\n   * Engine.\n   */\n  get engine(): Engine {\n    return this._engine;\n  }\n\n  /**\n   * Buffer binding flag.\n   */\n  get type(): BufferBindFlag {\n    return this._type;\n  }\n\n  /**\n   * Byte length.\n   */\n  get byteLength(): number {\n    return this._byteLength;\n  }\n\n  /**\n   * Buffer usage.\n   */\n  get bufferUsage(): BufferUsage {\n    return this._bufferUsage;\n  }\n\n  /**\n   * Create Buffer.\n   * @param engine - Engine\n   * @param type - Buffer binding flag\n   * @param byteLength - Byte length\n   * @param bufferUsage - Buffer usage\n   */\n  constructor(engine: Engine, type: BufferBindFlag, byteLength: number, bufferUsage?: BufferUsage);\n\n  /**\n   * Create Buffer.\n   * @param engine - Engine\n   * @param type - Buffer binding flag\n   * @param byteLength - Byte length\n   * @param bufferUsage - Buffer usage\n   */\n  constructor(engine: Engine, type: BufferBindFlag, data: ArrayBuffer | ArrayBufferView, bufferUsage?: BufferUsage);\n\n  constructor(\n    engine: Engine,\n    type: BufferBindFlag,\n    byteLengthOrData: number | ArrayBuffer | ArrayBufferView,\n    bufferUsage: BufferUsage = BufferUsage.Static\n  ) {\n    super(engine);\n    this._engine = engine;\n    this._type = type;\n    this._bufferUsage = bufferUsage;\n\n    const hardwareRenderer = engine._hardwareRenderer;\n    const gl: WebGLRenderingContext & WebGL2RenderingContext = hardwareRenderer.gl;\n    const glBufferUsage = BufferUtil._getGLBufferUsage(gl, bufferUsage);\n    const glBindTarget = type === BufferBindFlag.VertexBuffer ? gl.ARRAY_BUFFER : gl.ELEMENT_ARRAY_BUFFER;\n\n    this._nativeBuffer = gl.createBuffer();\n    this._hardwareRenderer = hardwareRenderer;\n    this._glBufferUsage = glBufferUsage;\n    this._glBindTarget = glBindTarget;\n\n    this.bind();\n    if (typeof byteLengthOrData === \"number\") {\n      this._byteLength = byteLengthOrData;\n      gl.bufferData(glBindTarget, byteLengthOrData, glBufferUsage);\n    } else {\n      this._byteLength = byteLengthOrData.byteLength;\n      gl.bufferData(glBindTarget, byteLengthOrData, glBufferUsage);\n    }\n    gl.bindBuffer(glBindTarget, null);\n  }\n\n  /**\n   * Bind buffer.\n   */\n  bind(): void {\n    const gl: WebGLRenderingContext & WebGL2RenderingContext = this._hardwareRenderer.gl;\n    gl.bindBuffer(this._glBindTarget, this._nativeBuffer);\n  }\n\n  /**\n   * Set buffer data.\n   * @param data - Input buffer data\n   */\n  setData(data: ArrayBuffer | ArrayBufferView): void;\n\n  /**\n   * Set buffer data.\n   * @param data - Input buffer data\n   * @param bufferByteOffset - buffer byte offset\n   */\n  setData(data: ArrayBuffer | ArrayBufferView, bufferByteOffset: number): void;\n\n  /**\n   * Set buffer data.\n   * @param data - Input buffer data\n   * @param bufferByteOffset - Buffer byte offset\n   * @param dataOffset - Buffer byte offset\n   * @param dataLength - Data length\n   */\n  setData(data: ArrayBuffer | ArrayBufferView, bufferByteOffset: number, dataOffset: number, dataLength?: number): void;\n\n  /**\n   * Set buffer data.\n   * @param data - Input buffer data\n   * @param bufferByteOffset - Buffer byte offset\n   * @param dataOffset - Buffer byte offset\n   * @param dataLength - Data length\n   * @param options - Update strategy: None/Discard/NoOverwrite\n   */\n  setData(\n    data: ArrayBuffer | ArrayBufferView,\n    bufferByteOffset: number,\n    dataOffset: number,\n    dataLength: number,\n    options: SetDataOptions\n  ): void;\n\n  setData(\n    data: ArrayBuffer | ArrayBufferView,\n    bufferByteOffset: number = 0,\n    dataOffset: number = 0,\n    dataLength?: number,\n    options: SetDataOptions = SetDataOptions.None\n  ): void {\n    const gl: WebGLRenderingContext & WebGL2RenderingContext = this._hardwareRenderer.gl;\n    const isWebGL2: boolean = this._hardwareRenderer.isWebGL2;\n    const glBindTarget: number = this._glBindTarget;\n    this.bind();\n\n    if (options === SetDataOptions.Discard) {\n      gl.bufferData(glBindTarget, this._byteLength, this._glBufferUsage);\n    }\n\n    // TypeArray is BYTES_PER_ELEMENT, unTypeArray is 1\n    const byteSize = (<Uint8Array>data).BYTES_PER_ELEMENT || 1;\n    const dataByteLength = dataLength ? byteSize * dataLength : data.byteLength;\n\n    if (dataOffset !== 0 || dataByteLength < data.byteLength) {\n      const isArrayBufferView = (<ArrayBufferView>data).byteOffset !== undefined;\n      if (isWebGL2 && isArrayBufferView) {\n        gl.bufferSubData(glBindTarget, bufferByteOffset, <ArrayBufferView>data, dataOffset, dataByteLength / byteSize);\n      } else {\n        const subData = new Uint8Array(\n          isArrayBufferView ? (<ArrayBufferView>data).buffer : <ArrayBuffer>data,\n          dataOffset * byteSize,\n          dataByteLength\n        );\n        gl.bufferSubData(glBindTarget, bufferByteOffset, subData);\n      }\n    } else {\n      gl.bufferSubData(glBindTarget, bufferByteOffset, data);\n    }\n    gl.bindBuffer(glBindTarget, null);\n  }\n\n  /**\n   * Get buffer data.\n   * @param data - Output buffer data\n   */\n  getData(data: ArrayBufferView): void;\n\n  /**\n   * Get buffer data.\n   * @param data - Output buffer data\n   * @param bufferByteOffset - Buffer byte offset\n   */\n  getData(data: ArrayBufferView, bufferByteOffset: number): void;\n\n  /**\n   * Get buffer data.\n   * @param data - Output buffer data\n   * @param bufferByteOffset - Buffer byte offset\n   * @param dataOffset - Output data offset\n   * @param dataLength - Output data length\n   */\n  getData(data: ArrayBufferView, bufferByteOffset: number, dataOffset: number, dataLength: number): void;\n\n  getData(data: ArrayBufferView, bufferByteOffset: number = 0, dataOffset: number = 0, dataLength?: number): void {\n    const isWebGL2: boolean = this._hardwareRenderer.isWebGL2;\n\n    if (isWebGL2) {\n      const gl: WebGLRenderingContext & WebGL2RenderingContext = this._hardwareRenderer.gl;\n      this.bind();\n      gl.getBufferSubData(this._glBindTarget, bufferByteOffset, data, dataOffset, dataLength);\n    } else {\n      throw \"Buffer is write-only on WebGL1.0 platforms.\";\n    }\n  }\n\n  /**\n   * @override\n   * Destroy.\n   */\n  _onDestroy() {\n    const gl: WebGLRenderingContext & WebGL2RenderingContext = this._hardwareRenderer.gl;\n    gl.deleteBuffer(this._nativeBuffer);\n    this._nativeBuffer = null;\n    this._hardwareRenderer = null;\n  }\n\n  /**\n   * @deprecated\n   */\n  resize(dataLength: number) {\n    this.bind();\n    const gl: WebGLRenderingContext & WebGL2RenderingContext = this._hardwareRenderer.gl;\n    gl.bufferData(this._glBindTarget, dataLength, this._glBufferUsage);\n    this._byteLength = dataLength;\n  }\n}\n","/**\n * Primitive topology.\n */\nexport enum PrimitiveTopology {\n  /** Draws a single dot */\n  Points = 0,\n  /** Draws a line between a pair of vertices */\n  Lines = 1,\n  /** Draws a straight line to the next vertex, and connects the last vertex back to the first */\n  LineLoop = 2,\n  /** Draws a straight line to the next vertex. */\n  LineStrip = 3,\n  /** Draws a triangle for a group of three vertices */\n  Triangles = 4,\n  /** Draws a triangle strip */\n  TriangleStrip = 5,\n  /** Draws a triangle fan */\n  TriangleFan = 6\n}\n","import { IndexFormat } from \"./enums/IndexFormat\";\nimport { Buffer } from \"./Buffer\";\n\n/**\n * Index buffer binding.\n */\nexport class IndexBufferBinding {\n  /** @internal */\n  _buffer: Buffer;\n  /** @internal */\n  _format: IndexFormat;\n\n  /**\n   * Index buffer.\n   */\n  get buffer(): Buffer {\n    return this._buffer;\n  }\n\n  /**\n   * Index buffer format.\n   */\n  get format(): IndexFormat {\n    return this._format;\n  }\n\n  /**\n   * Create index buffer binding.\n   * @param buffer - Index buffer\n   * @param format - Index buffer format\n   */\n  constructor(buffer: Buffer, format: IndexFormat) {\n    this._buffer = buffer;\n    this._format = format;\n  }\n}\n","import { Buffer } from \"./Buffer\";\n\n/**\n * Vertex buffer binding.\n */\nexport class VertexBufferBinding {\n  /** @internal */\n  _buffer: Buffer;\n  /** @internal */\n  _stride: number;\n\n  /**\n   * Vertex buffer.\n   */\n  get buffer(): Buffer {\n    return this._buffer;\n  }\n\n  /**\n   * Vertex buffer stride.\n   */\n  get stride(): number {\n    return this._stride;\n  }\n\n  /**\n   * Create vertex buffer.\n   * @param buffer - Vertex buffer\n   * @param stride - Vertex buffer stride\n   */\n  constructor(buffer: Buffer, stride: number) {\n    this._buffer = buffer;\n    this._stride = stride;\n  }\n}\n","import { IPlatformPrimitive } from \"@oasis-engine/design\";\nimport { RefObject } from \"../asset/RefObject\";\nimport { Engine } from \"../Engine\";\nimport { Buffer } from \"../graphic/Buffer\";\nimport { Shader } from \"../shader/Shader\";\nimport { ShaderMacro } from \"../shader/ShaderMacro\";\nimport { ShaderMacroCollection } from \"../shader/ShaderMacroCollection\";\nimport { ShaderProgram } from \"../shader/ShaderProgram\";\nimport { BufferUtil } from \"./BufferUtil\";\nimport { IndexFormat } from \"./enums/IndexFormat\";\nimport { VertexElementFormat } from \"./enums/VertexElementFormat\";\nimport { IndexBufferBinding } from \"./IndexBufferBinding\";\nimport { SubPrimitive } from \"./SubPrimitive\";\nimport { VertexBufferBinding } from \"./VertexBufferBinding\";\nimport { VertexElement } from \"./VertexElement\";\n\n/**\n * @private\n */\nexport class Primitive extends RefObject {\n  private static _uvMacro: ShaderMacro = Shader.getMacroByName(\"O3_HAS_UV\");\n  private static _normalMacro: ShaderMacro = Shader.getMacroByName(\"O3_HAS_NORMAL\");\n  private static _tangentMacro: ShaderMacro = Shader.getMacroByName(\"O3_HAS_TANGENT\");\n  private static _vertexColorMacro: ShaderMacro = Shader.getMacroByName(\"O3_HAS_VERTEXCOLOR\");\n  private static _vertexAlphaMacro: ShaderMacro = Shader.getMacroByName(\"O3_HAS_VERTEXALPHA\");\n\n  /** Primitive name */\n  name: string;\n  /** Instanced count, disable instanced drawing when set zero */\n  instanceCount: number = 0;\n\n  /** @internal */\n  _macroCollection: ShaderMacroCollection = new ShaderMacroCollection(); // CM&SS:temp\n  _vertexElementMap: object = {};\n  _glIndexType: number;\n  _platformPrimitive: IPlatformPrimitive;\n\n  private _vertexBufferBindings: VertexBufferBinding[] = [];\n  private _indexBufferBinding: IndexBufferBinding = null;\n  private _vertexElements: VertexElement[] = [];\n\n  /**\n   *\n   */\n  get vertexBufferBindings(): Readonly<VertexBufferBinding[]> {\n    return this._vertexBufferBindings;\n  }\n\n  /**\n   * Vertex element collection.\n   */\n  get vertexElements(): Readonly<VertexElement[]> {\n    return this._vertexElements;\n  }\n\n  /**\n   * Index buffer binding.\n   */\n  get indexBufferBinding(): IndexBufferBinding {\n    return this._indexBufferBinding;\n  }\n\n  targets: any[] = [];\n\n  constructor(engine: Engine, name?: string) {\n    super(engine);\n    this.name = name;\n    this._platformPrimitive = this._engine._hardwareRenderer.createPlatformPrimitive(this);\n  }\n\n  /**\n   * Set vertex buffer binding.\n   * @param vertexBuffer - Vertex buffer\n   * @param stride - Vertex buffer stride\n   * @param firstIndex - Vertex buffer binding index, default is 0\n   */\n  setVertexBufferBinding(vertexBuffer: Buffer, stride: number, firstIndex?: number): void;\n\n  /**\n   * Set vertex buffer binding.\n   * @param vertexBufferBinding - Vertex buffer binding\n   * @param firstIndex - Vertex buffer binding index, default is 0\n   */\n  setVertexBufferBinding(vertexBufferBinding: VertexBufferBinding, firstIndex?: number): void;\n\n  setVertexBufferBinding(\n    bufferOrBinding: Buffer | VertexBufferBinding,\n    strideOrFirstIndex: number = 0,\n    firstIndex: number = 0\n  ): void {\n    let binding = <VertexBufferBinding>bufferOrBinding;\n    const isBinding = binding.buffer !== undefined;\n    isBinding || (binding = new VertexBufferBinding(<Buffer>bufferOrBinding, strideOrFirstIndex));\n\n    const bindings = this._vertexBufferBindings;\n    bindings.length <= firstIndex && (bindings.length = firstIndex + 1);\n    this._setVertexBufferBinding(isBinding ? strideOrFirstIndex : firstIndex, binding);\n  }\n\n  /**\n   * Set vertex buffer binding.\n   * @param bufferBindings - Vertex buffer binding collection\n   * @param firstIndex - First buffer binding index\n   */\n  setVertexBufferBindings(bufferBindings: VertexBufferBinding[], firstIndex: number = 0): void {\n    const bindings = this._vertexBufferBindings;\n    const count = bufferBindings.length;\n    const needLength = firstIndex + count;\n    bindings.length < needLength && (bindings.length = needLength);\n    for (let i = 0; i < count; i++) {\n      this._setVertexBufferBinding(firstIndex + i, bufferBindings[i]);\n    }\n  }\n\n  /**\n   * Set index buffer.\n   * @param buffer - Index buffer\n   * @param format - Index buffer format\n   */\n  setIndexBufferBinding(buffer: Buffer, format: IndexFormat): void;\n\n  /**\n   * Set index buffer.\n   * @param bufferBinding - Index buffer binding\n   */\n  setIndexBufferBinding(bufferBinding: IndexBufferBinding): void;\n\n  setIndexBufferBinding(bufferOrBinding: Buffer | IndexBufferBinding, format?: IndexFormat): void {\n    let binding = <IndexBufferBinding>bufferOrBinding;\n    const isBinding = binding.buffer !== undefined;\n    isBinding || (binding = new IndexBufferBinding(<Buffer>bufferOrBinding, format));\n    this._indexBufferBinding = binding;\n    this._glIndexType = BufferUtil._getGLIndexType(binding.format);\n  }\n\n  /**\n   * Set vertex elements.\n   * @param elements - Vertex element collection\n   */\n  setVertexElements(elements: VertexElement[]): void {\n    this._clearVertexElements();\n    for (let i = 0, n = elements.length; i < n; i++) {\n      this._addVertexElement(elements[i]);\n    }\n  }\n\n  /**\n   * @internal\n   */\n  _draw(shaderProgram: ShaderProgram, subPrimitive: SubPrimitive): void {\n    this._platformPrimitive.draw(shaderProgram, subPrimitive);\n  }\n\n  /**\n   * @override\n   */\n  _addRefCount(value: number): void {\n    super._addRefCount(value);\n    const vertexBufferBindings = this._vertexBufferBindings;\n    for (let i = 0, n = vertexBufferBindings.length; i < n; i++) {\n      vertexBufferBindings[i]._buffer._addRefCount(value);\n    }\n  }\n\n  /**\n   * @override\n   * Destroy.\n   */\n  _onDestroy() {\n    this._vertexBufferBindings = null;\n    this._indexBufferBinding = null;\n    this._vertexElements = null;\n    this._vertexElementMap = null;\n    this._platformPrimitive.destroy();\n  }\n\n  private _clearVertexElements(): void {\n    this._vertexElements.length = 0;\n    const vertexElementMap = this._vertexElementMap;\n    for (var k in vertexElementMap) {\n      delete vertexElementMap[k];\n    }\n\n    this._macroCollection.disable(Primitive._uvMacro);\n    this._macroCollection.disable(Primitive._normalMacro);\n    this._macroCollection.disable(Primitive._tangentMacro);\n    this._macroCollection.disable(Primitive._vertexColorMacro);\n    this._macroCollection.disable(Primitive._vertexAlphaMacro);\n  }\n\n  private _addVertexElement(element: VertexElement): void {\n    const { semantic, format } = element;\n    this._vertexElementMap[semantic] = element;\n    this._vertexElements.push(element);\n\n    // init primitive shaderData\n    switch (semantic) {\n      case \"TEXCOORD_0\":\n        this._macroCollection.enable(Primitive._uvMacro);\n        break;\n      case \"NORMAL\":\n        this._macroCollection.enable(Primitive._normalMacro);\n        break;\n      case \"TANGENT\":\n        this._macroCollection.enable(Primitive._tangentMacro);\n        break;\n      case \"COLOR_0\":\n        this._macroCollection.enable(Primitive._vertexColorMacro);\n        if (format === VertexElementFormat.Vector4) this._macroCollection.enable(Primitive._vertexAlphaMacro);\n        break;\n    }\n  }\n\n  private _setVertexBufferBinding(index: number, binding: VertexBufferBinding): void {\n    if (this._getRefCount() > 0) {\n      const lastBinding = this._vertexBufferBindings[index];\n      lastBinding && lastBinding._buffer._addRefCount(-1);\n      binding._buffer._addRefCount(1);\n    }\n    this._vertexBufferBindings[index] = binding;\n  }\n}\n","import { VertexElementFormat } from \"./enums/VertexElementFormat\";\nimport { ElementInfo, BufferUtil } from \"./BufferUtil\";\n\n/**\n * Vertex element.\n */\nexport class VertexElement {\n  public readonly normalized = false;\n\n  _glElementInfo: ElementInfo;\n\n  private _semantic: string;\n  private _offset: number;\n  private _format: VertexElementFormat;\n  private _bindingIndex: number;\n  private _instanceStepRate: number;\n\n  /**\n   * Vertex semantic.\n   */\n  get semantic(): string {\n    return this._semantic;\n  }\n\n  /**\n   * Vertex data byte offset.\n   */\n  get offset(): number {\n    return this._offset;\n  }\n\n  /**\n   * Vertex data format.\n   */\n  get format(): VertexElementFormat {\n    return this._format;\n  }\n\n  /**\n   * Vertex buffer binding index.\n   */\n  get bindingIndex(): number {\n    return this._bindingIndex;\n  }\n\n  /**\n   * Instance cadence, the number of instances drawn for each vertex in the buffer, non-instance elements must be 0.\n   */\n  get instanceStepRate(): number {\n    return this._instanceStepRate;\n  }\n\n  /**\n   * Create vertex element.\n   * @param semantic - Input vertex semantic\n   * @param offset - Vertex data byte offset\n   * @param format - Vertex data format\n   * @param bindingIndex - Vertex buffer binding index\n   * @param instanceStepRate - Instance cadence, the number of instances drawn for each vertex in the buffer, non-instance elements must be 0.\n   */\n  constructor(\n    semantic: string,\n    offset: number,\n    format: VertexElementFormat,\n    bindingIndex: number,\n    instanceStepRate: number = 0\n  ) {\n    this._semantic = semantic;\n    this._offset = offset;\n    this._format = format;\n    this._bindingIndex = bindingIndex;\n    this._glElementInfo = BufferUtil._getElementInfo(this.format);\n    this._instanceStepRate = Math.floor(instanceStepRate);\n  }\n\n  /**\n   * @deprecated\n   */\n  get elementInfo(): ElementInfo {\n    return this._glElementInfo;\n  }\n}\n","import { PrimitiveTopology } from \"./enums/PrimitiveTopology\";\n\n/**\n * Sub primitive.\n */\nexport class SubPrimitive {\n  /** Start drawing offset */\n  start: number;\n  /** Drawing count */\n  count: number;\n  /** Drawing topology */\n  topology: PrimitiveTopology;\n\n  /**\n   * Create sub primitive.\n   * @param start - Start drawing offset\n   * @param count - Drawing count\n   * @param topology - Drawing topology\n   */\n  constructor(start: number = 0, count: number = 0, topology: PrimitiveTopology = PrimitiveTopology.Triangles) {\n    this.start = start;\n    this.count = count;\n    this.topology = topology;\n  }\n}\n","import { Matrix, Quaternion, Vector3, Vector4 } from \"@oasis-engine/math\";\nimport { Logger } from \"../base/Logger\";\nimport { Camera } from \"../Camera\";\nimport { Entity } from \"../Entity\";\nimport { Renderer } from \"../Renderer\";\nimport { Texture2D } from \"../texture/Texture2D\";\n\ninterface IUvRect {\n  u: number;\n  v: number;\n  width: number;\n  height: number;\n}\n\ninterface IRect {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n}\n\ninterface IPositionQuad {\n  leftTop: Vector3;\n  leftBottom: Vector3;\n  rightTop: Vector3;\n  rightBottom: Vector3;\n}\n\n/**\n * Sprite renderer.\n * @class\n */\nexport class SpriteRenderer extends Renderer {\n  private static _tempVec40: Vector4 = new Vector4();\n  private static _tempVec41: Vector4 = new Vector4();\n  private static _tempVec42: Vector4 = new Vector4();\n  private static _tempVec43: Vector4 = new Vector4();\n\n  private _uvRect: IUvRect;\n  private _worldSize: number[] = [];\n  private _positionQuad: IPositionQuad;\n  private _rotationAngle: number = 0;\n  private _anchor: number[];\n  protected _texture: Texture2D;\n  protected _rect: IRect;\n  private _worldSizeFactor: number;\n\n  /**\n   * Render mode: 2D or 3D, default is 2D.\n   */\n  renderMode: string = \"2D\";\n  /**\n   * Rendering color for the Sprite graphic.\n   */\n  public tintColor: Vector4 = new Vector4(1, 1, 1, 1);\n  public transformMatrix: Matrix;\n\n  /**\n   * Constructor of SpriteRenderer.\n   * @param {Entity} entity\n   */\n  constructor(entity: Entity) {\n    super(entity);\n    this._worldSizeFactor = 100;\n\n    this.setTexture(undefined);\n    this.setRect(undefined);\n    this.setAnchor(undefined);\n    this.setUvRect();\n    this.setWorldSize();\n\n    this._positionQuad = {\n      leftTop: new Vector3(),\n      leftBottom: new Vector3(),\n      rightTop: new Vector3(),\n      rightBottom: new Vector3()\n    };\n  }\n\n  set texture(v) {\n    this.setTexture(v);\n    this.setRect();\n    this.setUvRect();\n    this.setWorldSize();\n  }\n\n  get texture() {\n    return this._texture;\n  }\n\n  set anchor(v) {\n    this._anchor = v || [0.5, 0.5];\n  }\n\n  get anchor() {\n    return this._anchor;\n  }\n\n  set rect(v) {\n    this.setRect(v);\n    this.setUvRect();\n    this.setWorldSize();\n  }\n\n  get rect() {\n    return this._rect;\n  }\n\n  protected setTexture(texture) {\n    // TODO: compatible resource\n    if (texture && texture.asset) {\n      texture = texture.asset;\n    }\n\n    this._texture = texture;\n  }\n\n  /**\n   * Angle of rotation.\n   * @member {Vector4}\n   */\n  get rotationAngle() {\n    return this._rotationAngle;\n  }\n\n  set rotationAngle(v) {\n    this._rotationAngle = v;\n  }\n\n  protected setRect(rect?) {\n    let rectObject;\n    try {\n      if (rect) {\n        rectObject = JSON.parse(rect);\n      }\n    } catch (error) {\n      Logger.warn(\"Rect is not valid JSON format\");\n    }\n\n    this._rect = rect || {\n      x: 0,\n      y: 0,\n      width: this._texture?.width ?? 0,\n      height: this._texture?.height ?? 0\n    };\n  }\n\n  protected setAnchor(anchor) {\n    this._anchor = anchor || [0.5, 0.5];\n  }\n\n  protected setWorldSize() {\n    const { _worldSizeFactor } = this;\n    this._worldSize = [this._rect.width / _worldSizeFactor, this._rect.height / _worldSizeFactor];\n  }\n\n  protected setUvRect() {\n    let w, h;\n\n    if (this._texture) {\n      w = this._texture.width;\n      h = this._texture.height;\n    } else {\n      w = this._rect.width;\n      h = this._rect.height;\n    }\n    this._uvRect = {\n      u: this._rect.x / w,\n      v: this._rect.y / h,\n      width: this._rect.width / w,\n      height: this._rect.height / h\n    };\n  }\n\n  /**\n   * Refresh render data and push to pipeline.\n   * @param {Camera} camera\n   */\n  render(camera: Camera) {\n    this._updatePositionQuad(camera);\n    this._transformByMatrix();\n    camera._renderPipeline.pushSprite(\n      this,\n      this._positionQuad,\n      this._uvRect,\n      this.tintColor,\n      this.texture,\n      this.renderMode,\n      camera\n    );\n  }\n\n  _transformByMatrix() {\n    if (!this.transformMatrix) return;\n    const matrix = this.transformMatrix;\n\n    let temp: Vector3 = this._positionQuad.leftTop;\n    const leftTop: Vector4 = SpriteRenderer._tempVec40;\n    leftTop.setValue(temp.x, temp.y, temp.z, 1);\n\n    temp = this._positionQuad.leftBottom;\n    const leftBottom: Vector4 = SpriteRenderer._tempVec41;\n    leftBottom.setValue(temp.x, temp.y, temp.z, 1);\n\n    temp = this._positionQuad.rightTop;\n    const rightTop: Vector4 = SpriteRenderer._tempVec42;\n    rightTop.setValue(temp.x, temp.y, temp.z, 1);\n\n    temp = this._positionQuad.rightBottom;\n    const rightBottom: Vector4 = SpriteRenderer._tempVec43;\n    rightBottom.setValue(temp.x, temp.y, temp.z, 1);\n\n    Vector4.transform(leftTop, matrix, leftTop);\n    Vector4.transform(leftBottom, matrix, leftBottom);\n    Vector4.transform(rightTop, matrix, rightTop);\n    Vector4.transform(rightBottom, matrix, rightBottom);\n\n    this._positionQuad.leftTop.setValue(leftTop.x, leftTop.y, leftTop.z);\n    this._positionQuad.leftBottom.setValue(leftBottom.x, leftBottom.y, leftBottom.z);\n    this._positionQuad.rightTop.setValue(rightTop.x, rightTop.y, rightTop.z);\n    this._positionQuad.rightBottom.setValue(rightBottom.x, rightBottom.y, rightBottom.z);\n  }\n\n  /**\n   * Update position.\n   * @param {Camera} camera\n   * @private\n   */\n  _updatePositionQuad(camera: Camera) {\n    if (this.renderMode === \"2D\") {\n      const m = camera.viewMatrix.elements;\n      const vx = new Vector3(m[0], m[4], m[8]);\n      const vy = new Vector3(m[1], m[5], m[9]);\n      //-- center pos\n      const c: Vector3 = this.entity.worldPosition.clone();\n      const s = this._worldSize;\n      const ns = this.entity.scale;\n\n      vx.scale(s[0] * ns.x);\n      vy.scale(s[1] * ns.y);\n\n      if (this._rotationAngle !== 0) {\n        const vz = new Vector3(m[2], m[6], m[10]);\n\n        const rotation: Quaternion = new Quaternion();\n        Quaternion.rotationAxisAngle(vz, this._rotationAngle, rotation);\n\n        Vector3.transformByQuat(vx, rotation, vx);\n        Vector3.transformByQuat(vy, rotation, vy);\n      }\n\n      const cx: Vector3 = new Vector3();\n      const cy: Vector3 = new Vector3();\n      Vector3.scale(vx, (this.anchor[0] - 0.5) * 2, cx);\n      Vector3.scale(vy, (this.anchor[1] - 0.5) * 2, cy);\n\n      c.subtract(cx).add(cy);\n\n      //-- quad pos\n      const leftTop: Vector3 = this._positionQuad.leftTop;\n      Vector3.subtract(c, vx, leftTop);\n      leftTop.add(vy);\n\n      const leftBottom: Vector3 = this._positionQuad.leftBottom;\n      Vector3.subtract(c, vx, leftBottom);\n      leftBottom.subtract(vy);\n\n      const rightBottom: Vector3 = this._positionQuad.rightBottom;\n      Vector3.add(c, vx, rightBottom);\n      rightBottom.subtract(vy);\n\n      const rightTop: Vector3 = this._positionQuad.rightTop;\n      Vector3.add(c, vx, rightTop);\n      rightTop.add(vy);\n    } else {\n      // TODO: 3D\n    }\n  }\n}\n","/**\n * Animation wrap mode.\n * @readonly\n */\nexport enum WrapMode {\n  /** Play once */\n  ONCE = 0,\n  /** Loop play */\n  LOOP = 1\n  // FOREVER: 2,\n  // PINGPONG: 3\n}\n\n/**\n * Animation event type.\n * @readonly\n */\nexport enum AnimationEventType {\n  /** Triggered when the animation over if the wrapMode === WrapMode.ONCE */\n  FINISHED = 0,\n  /** Triggered when the animation over if the wrapMode === WrapMode.LOOP */\n  LOOP_END = 1,\n  /** Triggered when the animation plays to the frame */\n  FRAME_EVENT = 2\n}\n\n/**\n * Animation interpolation method.\n * @readonly\n */\nexport enum InterpolationType {\n  /** Linear interpolation */\n  LINEAR = 0,\n  /** Cubic spline interpolation */\n  CUBICSPLINE = 1,\n  /** Stepped interpolation */\n  STEP = 2\n}\n","import { EngineObject } from \"../base/EngineObject\";\nimport { InterpolationType } from \"./AnimationConst\";\nimport { IChannel, ISample, List, Value } from \"./types\";\n\nexport enum TagetType {\n  position = 0,\n  rotation = 1,\n  scale = 2,\n  other = 3\n}\n\n/**\n * Data for an animation, set of Samples and Channels.\n * @extends AssetObject\n */\nexport class AnimationClip extends EngineObject {\n  private static _tagetTypeMap: Object = {\n    position: TagetType.position,\n    rotation: TagetType.rotation,\n    scale: TagetType.scale\n  };\n\n  public duration: number;\n\n  public durationIndex: number;\n\n  public samplers: ISample[];\n\n  public channels: IChannel[];\n  /**\n   * @constructor\n   * @param name - The AnimationClip's name.\n   */\n  constructor(public readonly name: string) {\n    super(null);\n\n    this.samplers = [];\n\n    this.channels = [];\n  }\n\n  /**\n   * Add sampler to samplers of the AnimationClip.\n   * @param _input - The index of an accessor containing keyframe input values.\n   * @param _output - The index of an accessor containing keyframe output values.\n   * @param _outputSize - The length of the output values.\n   * @param _interpolation - Interpolation algorithm.\t\n   */\n  public addSampler(\n    _input: List,\n    _output: List,\n    _outputSize: number,\n    _interpolation: InterpolationType = InterpolationType.LINEAR\n  ) {\n    // FIXME - adapt old error animation export file\n    if (_interpolation === InterpolationType.CUBICSPLINE) {\n      if (_outputSize <= 4) {\n        _interpolation = InterpolationType.LINEAR;\n      } else {\n        _outputSize /= 3;\n      }\n    }\n\n    // The sampler object, defines an curve\n    const sampler = {\n      input: _input,\n      output: _output,\n      outputSize: _outputSize,\n      interpolation: _interpolation\n    };\n    this.samplers.push(sampler);\n  }\n\n  /**\n   * Add channel to channels of the AnimationClip.\n   * @param samplerIndex - The sampler's index in channel's sampler property.\n   * @param targetID - Entity name.\n   * @param targetPath - Transform property name: position, rotation, scale.\n   */\n  public addChannel(samplerIndex: number, targetID: string, targetPath: string) {\n    const bindSampler = this.samplers[samplerIndex];\n\n    let tagetType: TagetType = AnimationClip._tagetTypeMap[targetPath];\n    // The channel object, bind a Sample to an Object property.\n    const channel = {\n      sampler: bindSampler,\n      target: {\n        id: targetID,\n        path: targetPath,\n        pathType: tagetType ?? TagetType.other\n      }\n    };\n\n    this.channels.push(channel);\n  }\n\n  /**\n   * Get length of the channel.\n   * @return {number} Number of channels.\n   */\n  public getChannelCount(): number {\n    return this.channels.length;\n  }\n\n  /**\n   * Get the object which the channel acting on.\n   * @return Channel objects.\n   * @param channelIndex - The channel's index in AnimationClip's channels property.\n   */\n  public getChannelObject(channelIndex: number) {\n    return this.channels[channelIndex];\n  }\n\n  /**\n   * Get frame count of the channel.\n   * @return Channel frame count.\n   * @param channelIndex - The channel's index in AnimationClip's channels property.\n   */\n  public getFrameCount(channelIndex: number): number {\n    const sampler = this.channels[channelIndex].sampler;\n    return sampler.input.length;\n  }\n\n  /**\n   * Get frame time of the channel by channelIndex and frameIndex.\n   * @return channel frame time\n   * @param channelIndex - The channel's index in AnimationClip's channels property.\n   * @param frameIndex - The keyframe's index in sampler.input.\n   */\n  public getFrameTime(channelIndex: number, frameIndex: number): number {\n    const sampler = this.channels[channelIndex].sampler;\n    return sampler.input[frameIndex];\n  }\n\n  /**\n   * Get length of the channel.\n   * @return channel time length\n   * @param channelIndex - The channel's index in AnimationClip's channels property.\n   */\n  public getChannelTimeLength(channelIndex: number): number {\n    const sampler = this.channels[channelIndex].sampler;\n    const frameCount = sampler.input.length;\n    return sampler.input[frameCount - 1];\n  }\n\n  /**\n   * Get the channel value.\n   * @return channel value\n   * @param channelIndex - The channel's index in AnimationClip's channels property.\n   */\n  public createChannelValue(channelIndex: number): number | Float32Array | number[] {\n    const sampler = this.channels[channelIndex].sampler;\n\n    return new Float32Array(sampler.outputSize);\n  }\n\n  /**\n   * @private\n   * @param outValue - The output value after interpolation.\n   * @param channelIndex - The channel's index in AnimationClip's channels property.\n   * @param frameIndex - The keyframe's index in sampler.input.\n   * @param nextFrameIndex - The next keyframe's index in sampler.input.\n   * @param alpha - The weight of the next keyframe in interpolation algorithm.\n   */\n  public evaluate(\n    outValue: Value,\n    channelIndex: number,\n    frameIndex: number,\n    nextFrameIndex: number,\n    alpha: number\n  ): Value {\n    const channel = this.channels[channelIndex];\n    const output = channel.sampler.output;\n    const outputSize = channel.sampler.outputSize;\n\n    switch (channel.sampler.interpolation) {\n      case InterpolationType.CUBICSPLINE:\n        this.evaluateCubicSpline(outValue, output, outputSize, frameIndex, nextFrameIndex, alpha);\n        break;\n      case InterpolationType.LINEAR:\n        this.evaluateLinear(outValue, output, outputSize, frameIndex, nextFrameIndex, alpha);\n        break;\n    }\n\n    return outValue;\n  }\n\n  public evaluateCubicSpline(\n    outValue: Value,\n    output: List,\n    outputSize: number,\n    frameIndex: number,\n    nextFrameIndex: number,\n    alpha: number\n  ) {\n    const squared = alpha * alpha;\n    const cubed = alpha * squared;\n    const part1 = 2.0 * cubed - 3.0 * squared + 1.0;\n    const part2 = -2.0 * cubed + 3.0 * squared;\n    const part3 = cubed - 2.0 * squared + alpha;\n    const part4 = cubed - squared;\n\n    for (let i = outputSize; i >= 0; i--) {\n      const t1 = output[frameIndex * outputSize * 3 + i];\n      const v1 = output[frameIndex * outputSize * 3 + outputSize + i];\n      const t2 = output[frameIndex * outputSize * 3 + outputSize * 2 + i];\n      const v2 = output[nextFrameIndex * outputSize * 3 + outputSize + i];\n\n      outValue[i] = v1 * part1 + v2 * part2 + t1 * part3 + t2 * part4;\n    }\n  }\n\n  public evaluateLinear(\n    outValue: Value,\n    output: List,\n    outputSize: number,\n    frameIndex: number,\n    nextFrameIndex: number,\n    alpha: number\n  ) {\n    switch (outputSize) {\n      case 1:\n        outValue[0] = output[frameIndex] * (1 - alpha) + output[nextFrameIndex] * alpha;\n        break;\n      case 4:\n        // const start = new Quaternion(\n        //   output[frameIndex * outputSize],\n        //   output[frameIndex * outputSize + 1],\n        //   output[frameIndex * outputSize + 2],\n        //   output[frameIndex * outputSize + 3]\n        // );\n        // const end = new Quaternion(\n        //   output[nextFrameIndex * outputSize],\n        //   output[nextFrameIndex * outputSize + 1],\n        //   output[nextFrameIndex * outputSize + 2],\n        //   output[nextFrameIndex * outputSize + 3]\n        // );\n        // Quaternion.slerp(start, end, alpha, <Quaternion>outValue);\n        this._quaSlerp(outValue, output, frameIndex * outputSize, output, nextFrameIndex * outputSize, alpha);\n        break;\n      default:\n        for (let i = outputSize; i >= 0; i--) {\n          outValue[i] =\n            output[frameIndex * outputSize + i] * (1 - alpha) + output[nextFrameIndex * outputSize + i] * alpha;\n        }\n        break;\n    } // End of switch\n  }\n\n  private _quaSlerp(out, a, aIndex, b, bIndex, t) {\n    // Benchmarks:\n    //    http://jsperf.com/quaternion-slerp-implementations\n    let ax = a[0 + aIndex],\n      ay = a[1 + aIndex],\n      az = a[2 + aIndex],\n      aw = a[3 + aIndex];\n    let bx = b[0 + bIndex],\n      by = b[1 + bIndex],\n      bz = b[2 + bIndex],\n      bw = b[3 + bIndex];\n\n    let omega, cosom, sinom, scale0, scale1;\n\n    // Calc cosine.\n    cosom = ax * bx + ay * by + az * bz + aw * bw;\n    // Adjust signs (if necessary).\n    if (cosom < 0.0) {\n      cosom = -cosom;\n      bx = -bx;\n      by = -by;\n      bz = -bz;\n      bw = -bw;\n    }\n    // Calculate coefficients.\n    if (1.0 - cosom > 0.000001) {\n      // Standard case (slerp)\n      omega = Math.acos(cosom);\n      sinom = Math.sin(omega);\n      scale0 = Math.sin((1.0 - t) * omega) / sinom;\n      scale1 = Math.sin(t * omega) / sinom;\n    } else {\n      // The \"from\" quaternions and the \"to\" quaternions are very close, so we can do a linear interpolation.\n      scale0 = 1.0 - t;\n      scale1 = t;\n    }\n    // Calculate final values.\n    out[0] = scale0 * ax + scale1 * bx;\n    out[1] = scale0 * ay + scale1 * by;\n    out[2] = scale0 * az + scale1 * bz;\n    out[3] = scale0 * aw + scale1 * bw;\n\n    return out;\n  }\n}\n","import { Event } from \"../base/Event\";\nimport { EventDispatcher } from \"../base/EventDispatcher\";\nimport { Logger } from \"../base/Logger\";\nimport { Component } from \"../Component\";\nimport { Entity } from \"../Entity\";\nimport { SkinnedMeshRenderer } from \"../mesh/SkinnedMeshRenderer\";\nimport { AnimationClip } from \"./AnimationClip\";\nimport { AnimationEventType, WrapMode } from \"./AnimationConst\";\nimport { AnimationOptions, IChannelState, IChannelTarget } from \"./types\";\n\n/**\n * AnimationClip playback.\n * @extends EventDispatcher\n * @see class AnimationClip\n * @private\n */\nexport class AnimationLayer extends EventDispatcher {\n  /**\n   * @return Whether the AnimationClip is playing.\n   */\n  get isPlaying(): boolean {\n    return this._animClip && this._isPlaying;\n  }\n\n  public layerWeight: number;\n\n  public mixTagetLayer: AnimationLayer;\n\n  public isFading: number;\n\n  public fadeDeltaTime: number;\n\n  public crossFadeDuration: number;\n\n  public fadeDuration: number;\n\n  public crossFadeDeltaTime: number;\n\n  public isMixLayer: boolean;\n\n  public hasMixLayer: boolean;\n\n  public mixEntity: Entity;\n\n  private _activedEvents: Event[];\n\n  private _animClip: AnimationClip;\n\n  private _isPlaying: boolean;\n\n  private _wrapMode: WrapMode;\n\n  private _channelStates: IChannelState[];\n\n  private _animClipLength: number;\n\n  private _frameEvents: any[];\n\n  /**\n   * @constructor\n   */\n  constructor() {\n    super(null);\n\n    this.layerWeight = 1.0;\n\n    this._activedEvents = [];\n  }\n\n  /**\n   * @param nextAnimClip - anim clip to playback next.\n   * @param rootEntity - The root entity of the skeleton animation.\n   * @return Whether can mix with current AnimationClip.\n   */\n  public canMix(nextAnimClip: AnimationClip, rootEntity: Entity): boolean {\n    if (!this._animClip || !this._isPlaying || this.isMixLayer || this.isFading) {\n      return false;\n    }\n\n    if (this._animClip.getChannelCount() !== nextAnimClip.getChannelCount()) {\n      return false;\n    }\n\n    const count = this._animClip.getChannelCount();\n    for (let i = count - 1; i >= 0; i--) {\n      const curChannel = this._animClip.getChannelObject(i);\n      const curTargetObject = this._findChannelTarget(rootEntity, curChannel.target);\n\n      const nextChannel = nextAnimClip.getChannelObject(i);\n      const nextTargetObject = this._findChannelTarget(rootEntity, nextChannel.target);\n\n      if (curTargetObject !== nextTargetObject) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Mix animClip with target animationLayer.\n   * @param animClip - AnimationClip to be mixed.\n   * @param targetLayer - Target animationLayer.\n   * @param rootEntity - The root entity of the skeleton animation.\n   * @param mixEntity - The entiity to be mixed.\n   * @param options - The play options when playing AnimationClip.\n   */\n  public mix(\n    animClip: AnimationClip,\n    targetLayer: AnimationLayer,\n    rootEntity: Entity,\n    mixEntity: Entity,\n    options: { wrapMode?: WrapMode } = {}\n  ) {\n    this._isPlaying = targetLayer.isPlaying;\n    this._animClip = animClip;\n    this._wrapMode = typeof options.wrapMode !== \"undefined\" ? options.wrapMode : targetLayer._wrapMode;\n\n    this._addEvents(options);\n\n    this._channelStates = [];\n    this._animClipLength = 0;\n\n    // -- Create new state object.\n    if (this._isPlaying) {\n      const targetChannelStates = targetLayer._channelStates;\n      const count = this._animClip.getChannelCount();\n      for (let i = count - 1; i >= 0; i--) {\n        const channel = this._animClip.getChannelObject(i);\n        const targetObject = this._findChannelTarget(mixEntity, channel.target);\n        this._channelStates[i] = {\n          frameTime: 0.0,\n          currentFrame: 0,\n          currentValue: this._animClip.createChannelValue(i),\n          mixWeight: targetObject ? 1 : 0\n        };\n\n        targetChannelStates[i].mixWeight =\n          targetChannelStates[i].mixWeight === undefined ? 1 : targetChannelStates[i].mixWeight;\n        if (targetChannelStates[i].mixWeight === 1) {\n          targetChannelStates[i].mixWeight = targetObject ? 0 : 1;\n        }\n\n        const channelTimeLength = this._animClip.getChannelTimeLength(i);\n        this._animClipLength = this._animClipLength > channelTimeLength ? this._animClipLength : channelTimeLength;\n      } // End of for.\n\n      return true;\n    }\n\n    return false;\n  }\n\n  public removeMixWeight() {\n    const count = this._channelStates.length;\n    for (let i = count - 1; i >= 0; i--) {\n      if (this._channelStates[i].mixWeight === 1) {\n        this.mixTagetLayer._channelStates[i].mixWeight = 1;\n      }\n    }\n  }\n\n  /**\n   * Play the specify AnimationClip.\n   * @param animClip - The AnimationClip to be played.\n   * @param rootEntity - The root entity of the skeleton animation.\n   * @param options - The play options when playing AnimationClip.\n   */\n  public play(\n    animClip: AnimationClip,\n    rootEntity: Entity,\n    options: AnimationOptions = { wrapMode: WrapMode.LOOP }\n  ): false | IChannelTarget[] {\n    this._isPlaying = !!animClip;\n    this._animClip = animClip;\n    this._wrapMode = typeof options.wrapMode !== \"undefined\" ? options.wrapMode : WrapMode.LOOP;\n\n    this._addEvents(options);\n\n    this._channelStates = [];\n    this._animClipLength = 0;\n\n    // Create new state object.\n    if (this._isPlaying) {\n      const count = this._animClip.getChannelCount();\n      const channelTargets: IChannelTarget[] = [];\n      for (let i = count - 1; i >= 0; i--) {\n        const channel = this._animClip.getChannelObject(i);\n        const targetObject = this._findChannelTarget(rootEntity, channel.target);\n        if (!targetObject) {\n          Logger.warn(\"Can not find channel target:\" + channel.target.id);\n        }\n        this._channelStates[i] = {\n          frameTime: 0.0,\n          currentFrame: 0,\n          currentValue: this._animClip.createChannelValue(i)\n        };\n\n        channelTargets[i] = {\n          targetObject,\n          path: channel.target.path,\n          pathType: channel.target.pathType,\n          outputSize: channel.sampler.outputSize\n        };\n\n        const channelTimeLength = this._animClip.getChannelTimeLength(i);\n        this._animClipLength = this._animClipLength > channelTimeLength ? this._animClipLength : channelTimeLength;\n      } // End of for.\n\n      return channelTargets;\n    }\n\n    return false;\n  }\n\n  /**\n   * Stop play AnimationClip.\n   * @param rightnow - Stop it immediately, or it will stop at the end of the clip.\n   */\n  public stop(rightnow: boolean) {\n    if (!this._animClip || !this._isPlaying) {\n      return;\n    }\n\n    if (rightnow) {\n      this._isPlaying = false;\n    } else {\n      this._wrapMode = WrapMode.ONCE;\n    }\n  }\n\n  /**\n   * Update animation states only.\n   * @param deltaTime - The deltaTime when the animation update.\n   */\n  public updateState(deltaTime: number) {\n    if (!this._animClip || !this._isPlaying) {\n      return;\n    }\n\n    // Update the weight of the Animation Layer.\n    if (this.isFading) {\n      this.fadeDeltaTime += deltaTime;\n      this.layerWeight = 1.0 - this.fadeDeltaTime / this.fadeDuration;\n      if (this.layerWeight <= 0) {\n        this._isPlaying = false;\n      }\n    } else if (this.crossFadeDuration) {\n      this.crossFadeDeltaTime += deltaTime;\n      this.layerWeight = this.crossFadeDeltaTime / this.crossFadeDuration;\n      if (this.layerWeight >= 1.0) {\n        this.layerWeight = 1.0;\n        delete this.crossFadeDuration;\n      }\n    }\n\n    deltaTime = deltaTime / 1000;\n    this._activeEvents(deltaTime);\n\n    // Update channelStates.\n    const count = this._animClip.getChannelCount();\n    let playingCount = 0;\n    for (let i = count - 1; i >= 0; i--) {\n      if (this._updateChannelState(deltaTime, i)) {\n        playingCount++;\n      }\n    }\n\n    if (playingCount === 0) {\n      this._isPlaying = false;\n\n      if (this.isMixLayer) {\n        this.removeMixWeight();\n      }\n    }\n  }\n\n  /**\n   * Get the weight of the Animation Layer.\n   * @return Channel layer weight.\n   * @param channelIndex - The channel's index in AnimationClip's channels property.\n   */\n  public getChannelLayerWeight(channelIndex: number): number {\n    if ((this.hasMixLayer || this.isMixLayer) && channelIndex < this._channelStates.length) {\n      const mixWeight = this._channelStates[channelIndex].mixWeight;\n      const layerWeight = this.isMixLayer ? this.mixTagetLayer.layerWeight : this.layerWeight;\n      return mixWeight * layerWeight;\n    }\n    return this.layerWeight;\n  }\n\n  /**\n   * @return Channel value.\n   * @param channelIndexchannelIndex - The channel's index in AnimationClip's channels property.\n   */\n  public getChannelValue(channelIndex: number) {\n    return this._channelStates[channelIndex].currentValue;\n  }\n\n  /**\n   * Trigger the animation events.\n   */\n  public triggerEvents() {\n    this._activedEvents &&\n      this._activedEvents.forEach((event) => {\n        this.trigger(event);\n      });\n\n    this._activedEvents.length = 0;\n  }\n\n  /**\n   * Jump to a frame of the AnimationClip, take effect immediately.\n   * @param frameTime - The time which the animation will jump to.\n   */\n  public jumpToFrame(frameTime: number) {\n    const count = this._animClip.getChannelCount();\n    for (let i = count - 1; i >= 0; i--) {\n      // 1. Clear pre frameTime.\n      const channelState = this._channelStates[i];\n      channelState.frameTime = 0;\n\n      // 2. Update new frameTime.\n      this._updateChannelState(frameTime, i);\n    }\n  }\n\n  /**\n   * Update state and value of channel.\n   * @param deltaTime - The deltaTime when the animation update.\n   * @param channelIndex - The channel's index in AnimationClip's channels property.\n   * @private\n   */\n  public _updateChannelState(deltaTime, channelIndex) {\n    const animClip = this._animClip;\n    const channelState = this._channelStates[channelIndex];\n    const animClipLength = animClip.getChannelTimeLength(channelIndex);\n\n    channelState.frameTime += deltaTime;\n    if (channelState.frameTime > animClipLength) {\n      switch (this._wrapMode) {\n        case WrapMode.ONCE:\n          channelState.frameTime = animClipLength;\n          break;\n        case WrapMode.LOOP:\n          channelState.frameTime = channelState.frameTime % this._animClipLength;\n          break;\n        default:\n          Logger.error(\"Unknown Anim wrap Mode: \" + this._wrapMode);\n      }\n    } // End of if.\n\n    if (channelState.mixWeight && channelState.mixWeight === 0) {\n      return true;\n    }\n\n    const frameTime = Math.min(channelState.frameTime, animClipLength);\n    const lerpState = this._getKeyAndAlpha(animClip.getChannelObject(channelIndex), frameTime);\n    channelState.currentValue = animClip.evaluate(\n      channelState.currentValue,\n      channelIndex,\n      lerpState.currentKey,\n      lerpState.nextKey,\n      lerpState.alpha\n    );\n\n    if (this._wrapMode === WrapMode.ONCE && channelState.frameTime >= animClipLength) {\n      return false;\n    }\n    return true;\n  }\n  // -- private ----------------------------------------------------------\n  /**\n   * @param options - The AnimationEvent's option.\n   * @private\n   */\n  private _addEvents(options: any) {\n    this.removeAllEventListeners();\n\n    this._frameEvents = [];\n    if (options.events) {\n      let frameEventIndex = 0;\n      for (let i = options.events.length - 1; i >= 0; i--) {\n        const event = options.events[i];\n        let eventType = event.type;\n        if (event.type === AnimationEventType.FRAME_EVENT) {\n          eventType = \"frameEvent\" + frameEventIndex;\n          frameEventIndex++;\n          this._frameEvents.push({\n            eventType,\n            triggerTime: event.triggerTime,\n            triggered: false\n          });\n        }\n        this.addEventListener(eventType, (e) => {\n          event.callback();\n        });\n      } // End of for.\n    } // End of if.\n  }\n\n  /**\n   * Activate the AnimationEvent.\n   * @param deltaTime - The deltaTime when the animation update.\n   * @private\n   */\n  private _activeEvents(deltaTime: number) {\n    // Trigger Frame Event.\n    const index = this._animClip.durationIndex;\n\n    if (this._frameEvents.length > 0 && this._channelStates.length > 0) {\n      const curFrameTime = this._channelStates[index].frameTime + deltaTime;\n      for (let i = this._frameEvents.length - 1; i >= 0; i--) {\n        const frameEvent = this._frameEvents[i];\n        if (!frameEvent.triggered && curFrameTime > frameEvent.triggerTime) {\n          this._activedEvents.push(new Event(frameEvent.eventType, this));\n          frameEvent.triggered = true;\n        }\n      }\n    }\n\n    if (this._channelStates.length > 0 && this._channelStates[index].frameTime + deltaTime >= this._animClip.duration) {\n      if (this._wrapMode === WrapMode.LOOP) {\n        // Reset Frame Event status.\n        if (this._frameEvents.length > 0) {\n          for (let i = this._frameEvents.length - 1; i >= 0; i--) {\n            this._frameEvents[i].triggered = false;\n          }\n        }\n        // Trigger Loop End Event.\n        // @ts-ignore\n        if (this.hasEvent(AnimationEventType.LOOP_END)) {\n          this._activedEvents.push(new Event(AnimationEventType.LOOP_END, this));\n        }\n        // @ts-ignore\n      } else if (this.hasEvent(AnimationEventType.FINISHED)) {\n        // Trigger Finish Event.\n        this._activedEvents.push(new Event(AnimationEventType.FINISHED, this));\n      }\n    }\n  }\n\n  /**\n   * Find the target the channel belongs to.\n   * @param rootNode - The root entity of the skeleton animation.\n   * @param target - The target to be finded.\n   * @private\n   */\n  private _findChannelTarget(rootNode: Entity, target: any): Entity | Component {\n    const targetID = target.id;\n    let targetSceneObject: Entity = null;\n    if (rootNode.name === targetID) {\n      targetSceneObject = rootNode;\n    } else {\n      targetSceneObject = rootNode.findByName(targetID);\n    }\n\n    if (target.path === \"weights\") {\n      return targetSceneObject.getComponent(SkinnedMeshRenderer);\n    } else {\n      return targetSceneObject;\n    }\n  }\n\n  /**\n   * @return Current and next key id, current alpha.\n   * @param channel - The channle which the key and alpha in.\n   * @param time - The frame time.\n   * @private\n   */\n  private _getKeyAndAlpha(channel, time: number) {\n    let keyTime = 0;\n    let currentKey = 0;\n    let nextKey = 0;\n\n    const timeKeys = channel.sampler.input;\n    const numKeys = timeKeys.length;\n    for (let i = numKeys - 1; i >= 0; i--) {\n      if (time > timeKeys[i]) {\n        keyTime = time - timeKeys[i];\n        currentKey = i;\n        break;\n      }\n    }\n\n    nextKey = currentKey + 1;\n    if (nextKey >= numKeys) {\n      switch (this._wrapMode) {\n        case WrapMode.ONCE:\n          nextKey = numKeys - 1;\n          break;\n        case WrapMode.LOOP:\n          nextKey = 0;\n          break;\n      }\n    }\n\n    const keyLength = timeKeys[nextKey] - timeKeys[currentKey];\n    const alpha = nextKey === currentKey || keyLength < 0.00001 ? 1 : keyTime / keyLength;\n\n    return {\n      currentKey,\n      nextKey,\n      alpha\n    };\n  }\n}\n","import { Quaternion, Vector3 } from \"@oasis-engine/math\";\nimport { Logger } from \"../base/Logger\";\nimport { ignoreClone, shallowClone } from \"../clone/CloneManager\";\nimport { Component } from \"../Component\";\nimport { Entity } from \"../Entity\";\nimport { SkinnedMeshRenderer } from \"../mesh/SkinnedMeshRenderer\";\nimport { AnimationClip, TagetType } from \"./AnimationClip\";\nimport { AnimationLayer } from \"./AnimationLayer\";\nimport { AnimationOptions, IChannelTarget } from \"./types\";\n/**\n * Animation Component, the AnimationClip player with crossFade and mix abilities.\n */\nexport class Animation extends Component {\n  /**\n   * The timeScale getter, timeScale which used for scale the animation time to speed up or slow down the animation.\n   */\n  get timeScale(): number {\n    return this._timeScale;\n  }\n\n  /**\n   * The timeScale setter, timeScale which used for scale the animation time to speed up or slow down the animation.\n   */\n  set timeScale(val: number) {\n    if (val > 0) {\n      this._timeScale = val;\n    }\n  }\n\n  /**\n   * Linearly interpolates between two values.\n   * @param outValue - The output value after interpolation.\n   * @param startValue - The start value before interpolation.\n   * @param endValue - The end value after interpolation.\n   * @param outputSize - The length of the output values.\n   * @param alpha - The weight of the endValue in interpolation algorithm.\n   * @private\n   */\n  public static lerp(\n    outValue: number | Float32Array,\n    startValue: number | Float32Array,\n    endValue: number | Float32Array,\n    alpha: number,\n    outputSize: number\n  ): number | Float32Array {\n    switch (outputSize) {\n      case 1:\n        outValue = <number>startValue * (1 - alpha) + <number>endValue * alpha;\n        break;\n      case 4:\n        const start = new Quaternion(...(startValue as Float32Array));\n        const end = new Quaternion(...(endValue as Float32Array));\n        const quat = new Quaternion();\n        Quaternion.slerp(start, end, alpha, quat);\n        outValue[0] = quat.x;\n        outValue[1] = quat.y;\n        outValue[2] = quat.z;\n        outValue[3] = quat.w;\n        break;\n      default:\n        for (let i = outputSize; i >= 0; i--) {\n          outValue[i] = startValue[i] * (1 - alpha) + endValue[i] * alpha;\n        }\n        break;\n    } // End of switch.\n\n    return outValue;\n  }\n\n  /** @internal */\n  @ignoreClone\n  _onUpdateIndex: number = -1;\n\n  @shallowClone\n  private _animSet = {};\n\n  @ignoreClone\n  private _animLayers: AnimationLayer[] = [new AnimationLayer()];\n  @ignoreClone\n  private _timeScale: number = 1.0;\n  @ignoreClone\n  private _channelTargets: IChannelTarget[] | false;\n\n  /**\n   * @param entity - The entitiy which the animation component belongs to.\n   */\n  constructor(entity: Entity) {\n    super(entity);\n  }\n\n  /**\n   * Evaluates the animation component based on deltaTime.\n   * @param deltaTime - The deltaTime when the animation update.\n   * @private\n   */\n  public update(deltaTime: number) {\n    if (!this.isPlaying()) {\n      return;\n    }\n\n    deltaTime = deltaTime * this._timeScale;\n\n    // Update state.\n    for (let i = this._animLayers.length - 1; i >= 0; i--) {\n      const animLayer = this._animLayers[i];\n      animLayer.updateState(deltaTime);\n    }\n\n    // Update value.\n    this._updateValues();\n\n    // Trigger events and destroy no use layer.\n    for (let i = this._animLayers.length - 1; i >= 0; i--) {\n      const animLayer = this._animLayers[i];\n      animLayer.triggerEvents();\n      if (!animLayer.isPlaying && (animLayer.isFading || animLayer.isMixLayer)) {\n        this._animLayers.splice(i, 1);\n        this._removeRefMixLayers(animLayer);\n      }\n    }\n  }\n\n  /**\n   * Add a AnimationClip to the animation with the name.\n   * @param animClip - The AnimationClip which you want to be added.\n   * @param name - The name of the AnimationClip.\n   */\n  public addAnimationClip(animClip: AnimationClip, name: string) {\n    this._animSet[name] = animClip;\n  }\n\n  /**\n   * Remove clip from the animation.\n   * @param name - The name of the AnimationClip.\n   */\n  public removeAnimationClip(name: string) {\n    const animClip = this._animSet[name];\n    if (animClip) {\n      delete this._animSet[name];\n    }\n  }\n\n  /**\n   * Get length of the AnimationClip By the name.\n   * @param name - The name of the AnimationClip.\n   * @return The AnimationClip length.\n   */\n  public getAnimationClipLength(name: string): number {\n    const animClip = this._animSet[name];\n    if (animClip) {\n      return animClip.getChannelTimeLength(0);\n    } else {\n      return 0.0;\n    }\n  }\n\n  /**\n   * Get the AnimationClip By name.\n   * @param name - The name of the AnimationClip.\n   * @return The AnimationClip which match the name.\n   */\n  public getAnimationClip(name: string): AnimationClip {\n    return this._animSet[name] || null;\n  }\n\n  /**\n   * Return whether is playing.\n   * @return {boolean}\n   */\n  public isPlaying(): boolean {\n    for (let i = this._animLayers.length - 1; i >= 0; i--) {\n      if (this._animLayers[i].isPlaying) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Play the AnimationClip by name.\n   * @param name - The AnimatioinClip's name.\n   * @param options - The play options when playing AnimationClip.\n   */\n  public playAnimationClip(name: string, options?: AnimationOptions) {\n    const animClip = this._animSet[name];\n    if (!animClip) {\n      Logger.error(\"can not find anim clip: \" + name);\n      return;\n    }\n\n    let animLayer: AnimationLayer = null;\n    for (let i = this._animLayers.length - 1; i >= 0; i--) {\n      if (!this._animLayers[i].isFading && !this._animLayers[i].isMixLayer) {\n        animLayer = this._animLayers[i];\n        break;\n      }\n    }\n\n    if (!animLayer) {\n      animLayer = new AnimationLayer();\n      this._animLayers.push(animLayer);\n    }\n    this._removeRefMixLayers(animLayer);\n    this._channelTargets = animLayer.play(animClip, this.entity, options);\n  }\n\n  /**\n   * CrossFade to the AnimationClip by name.\n   * @param name - The AnimatioinClip's name.\n   * @param crossFadeDuration - The milliseconds of the crossFade's duration.\n   * @param options - The play options when playing AnimationClip.\n   */\n  public CrossFade(name: string, crossFadeDuration: number, options: AnimationOptions) {\n    const animClip = this._animSet[name];\n    if (!animClip) {\n      Logger.error(\"can not find anim clip: \" + name);\n      return;\n    }\n\n    if (!crossFadeDuration || crossFadeDuration < 0) {\n      Logger.error(\"crossFadeDuration can not less than 0!\");\n      return;\n    }\n\n    // Look for targets that can be mixed.\n    let targetAnimLayer = null;\n    for (let i = this._animLayers.length - 1; i >= 0; i--) {\n      if (this._animLayers[i].canMix(animClip, this.entity)) {\n        targetAnimLayer = this._animLayers[i];\n        break;\n      }\n    }\n\n    if (targetAnimLayer) {\n      // Clear the unfinished crossFading action\n      for (let i = this._animLayers.length - 1; i >= 0; i--) {\n        if (this._animLayers[i].isFading) {\n          this._animLayers.splice(i, 1);\n        }\n      }\n\n      targetAnimLayer.isFading = true;\n      targetAnimLayer.fadeDuration = crossFadeDuration;\n      targetAnimLayer.fadeDeltaTime = 0;\n\n      const animLayer = new AnimationLayer();\n      animLayer.crossFadeDuration = crossFadeDuration;\n      animLayer.crossFadeDeltaTime = 0;\n      animLayer.play(animClip, this.entity, options);\n      this._animLayers.push(animLayer);\n    } else {\n      this.playAnimationClip(name, options);\n    }\n  }\n\n  /**\n   * Mix the AnimationClip by name.\n   * @param name - The AnimatioinClip's name.\n   * @param mixBoneName - Takes effect on the bone named mixBoneName and the child bones attached to it.\n   * @param options - The play options when playing AnimationClip.\n   */\n  public mix(name: string, mixBoneName: string, options: AnimationOptions) {\n    const animClip = this._animSet[name];\n    if (!animClip) {\n      Logger.error(\"can not find anim clip: \" + name);\n      return;\n    }\n\n    const mixNode = this.entity.findByName(mixBoneName);\n    if (!mixNode) {\n      Logger.error(\"can not find mix bone!\");\n      return;\n    }\n\n    // Look for targets that can be mixed.\n    let targetAnimLayer = null;\n    for (let i = this._animLayers.length - 1; i >= 0; i--) {\n      if (this._animLayers[i].canMix(animClip, this.entity)) {\n        targetAnimLayer = this._animLayers[i];\n        break;\n      }\n    }\n\n    if (targetAnimLayer) {\n      this._removeRefMixLayers(null, mixNode);\n\n      targetAnimLayer.hasMixLayer = true;\n\n      const animLayer = new AnimationLayer();\n      animLayer.isMixLayer = true;\n      animLayer.mixTagetLayer = targetAnimLayer;\n      animLayer.mixEntity = mixNode;\n      animLayer.mix(animClip, targetAnimLayer, this.entity, mixNode, options);\n      this._animLayers.push(animLayer);\n    }\n  }\n\n  /**\n   * Stop play\n   * @param rightnow - Stop it immediately, or it will stop at the end of the clip\n   */\n  public stop(rightnow: boolean) {\n    for (let i = this._animLayers.length - 1; i >= 0; i--) {\n      if (this._animLayers[i].isFading) {\n        this._animLayers.splice(i, 1);\n      } else {\n        this._animLayers[i].stop(rightnow);\n      }\n    }\n  }\n\n  /**\n   * Jump to a frame of the animation, take effect immediately.\n   * @param frameTime - The time which the animation will jump to.\n   */\n  public jumpToFrame(frameTime: number) {\n    frameTime = frameTime / 1000;\n    for (let i = this._animLayers.length - 1; i >= 0; i--) {\n      this._animLayers[i].jumpToFrame(frameTime);\n    }\n\n    this._updateValues();\n  }\n\n  // -- private ----------------------------------------------------------\n  /**\n   * Remove the mixed animation associated with targetLayer.\n   * @param targetLayer - The mixed AnimatioinLayer which will be removed.\n   * @private\n   */\n  public _removeRefMixLayers(targetLayer: AnimationLayer, mixNode?) {\n    if (targetLayer && targetLayer.hasMixLayer) {\n      for (let i = this._animLayers.length - 1; i >= 0; i--) {\n        const animLayer = this._animLayers[i];\n        if (animLayer.isMixLayer && animLayer.mixTagetLayer === targetLayer) {\n          animLayer.removeMixWeight();\n          this._animLayers.splice(i, 1);\n        }\n      }\n    }\n\n    if (mixNode) {\n      for (let i = this._animLayers.length - 1; i >= 0; i--) {\n        const animLayer = this._animLayers[i];\n        if (\n          animLayer.isMixLayer &&\n          (animLayer.mixEntity === mixNode ||\n            animLayer.mixEntity.findByName(mixNode) ||\n            mixNode.findByName(animLayer.mixEntity))\n        ) {\n          animLayer.removeMixWeight();\n          this._animLayers.splice(i, 1);\n        }\n      }\n    }\n  }\n\n  /**\n   * Update animation value.\n   * @private\n   */\n  public _updateValues() {\n    if (this._animLayers.length === 0 || !this._channelTargets) {\n      return;\n    }\n\n    for (let i = this._channelTargets.length - 1; i >= 0; i--) {\n      const channelTarget = this._channelTargets[i];\n      const val = this._getChannelValue(i, channelTarget.outputSize);\n      const targetObject = channelTarget.targetObject;\n      const path = channelTarget.path;\n\n      if (path === \"weights\") {\n        // SkinnedMeshRenderer.\n        (targetObject as SkinnedMeshRenderer).setWeights(val as any);\n      } else {\n        const v = val as Float32Array;\n        //CM: Temporary optimization val should be Vector3/Quaternion type to avoid conversion overhead\n        //CM: In the future, after Animation unifies all animation systems, it will use pathType as other and continue to use reflection.\n        //CM: Due to the relatively small number of pathTypes, pre-classification can be used to avoid switch overhead in the future, such as three types of skeletal animation\n        const transform = (<Entity>targetObject).transform;\n        switch (channelTarget.pathType) {\n          case TagetType.position:\n            const position: Vector3 = transform.position;\n            position.setValue(v[0], v[1], v[2]);\n            transform.position = position;\n            break;\n          case TagetType.rotation:\n            const rotation: Quaternion = transform.rotationQuaternion;\n            rotation.setValue(v[0], v[1], v[2], v[3]);\n            transform.rotationQuaternion = rotation;\n            break;\n          case TagetType.scale:\n            const scale: Vector3 = transform.scale;\n            scale.setValue(v[0], v[1], v[2]);\n            transform.scale = scale;\n            break;\n          default:\n            targetObject[path] = val;\n        }\n      }\n    } // End of for\n  }\n\n  /**\n   * @return Channel value.\n   * @param channelIndex - The channel's index in AnimationClip's channels property.\n   * @param outputSize - The length of the output values.\n   * @private\n   */\n  public _getChannelValue(channelIndex: number, outputSize: number): number | boolean | Float32Array {\n    const weights = [];\n    const values = [];\n    for (let i = this._animLayers.length - 1; i >= 0; i--) {\n      const weight = this._animLayers[i].getChannelLayerWeight(channelIndex);\n      if (weight > 0) {\n        weights.push(weight);\n        values.push(this._animLayers[i].getChannelValue(channelIndex));\n      }\n    }\n    /**\n     * When values.length === 1, return the value directly.\n     * When values.length === 2, return the lerp from value[0] and value[1].\n     **/\n    if (values.length === 1) {\n      return values[0];\n    } else if (values.length === 2) {\n      return Animation.lerp(values[0], values[0], values[1], weights[1], outputSize);\n    }\n\n    // Other case can't be handled.\n    Logger.error(\"Can not get channel value!\");\n    return false;\n  }\n\n  /**\n   * Be called when this instance be enabled.\n   * @override\n   * @internal\n   */\n  _onEnable(): void {\n    this.engine._componentsManager.addOnUpdateAnimations(this);\n  }\n\n  /**\n   * Be called when this instance be disabled or it's entity be inActiveInHierarchy or before this instance be destroyed.\n   * @override\n   * @internal\n   */\n  _onDisable(): void {\n    this.engine._componentsManager.removeOnUpdateAnimations(this);\n  }\n}\n","import { BoundingBox, Vector3 } from \"@oasis-engine/math\";\nimport { EngineObject } from \"../base\";\nimport { Engine } from \"../Engine\";\nimport { PrimitiveTopology, SubPrimitive } from \"../graphic\";\nimport { Buffer } from \"../graphic/Buffer\";\nimport { IndexFormat } from \"../graphic/enums/IndexFormat\";\nimport { IndexBufferBinding } from \"../graphic/IndexBufferBinding\";\nimport { Primitive } from \"../graphic/Primitive\";\nimport { VertexBufferBinding } from \"../graphic/VertexBufferBinding\";\nimport { VertexElement } from \"../graphic/VertexElement\";\n\n/**\n * BufferGeometry.\n */\nexport class BufferGeometry extends EngineObject {\n  /** Geometry name */\n  name: string;\n\n  /** @internal */\n  _primitive: Primitive;\n\n  readonly bounds: BoundingBox = new BoundingBox();\n  private _subGeometries: SubPrimitive[] = [];\n\n  /**\n   * Vertex buffer binding collection.\n   */\n  get vertexBufferBindings(): Readonly<VertexBufferBinding[]> {\n    return this._primitive.vertexBufferBindings;\n  }\n\n  /**\n   * Index buffer binding.\n   */\n  get indexBufferBinding(): IndexBufferBinding {\n    return this._primitive.indexBufferBinding;\n  }\n\n  /**\n   * Vertex element collection.\n   */\n  get vertexElements(): Readonly<VertexElement[]> {\n    return this._primitive.vertexElements;\n  }\n\n  /**\n   * First sub-geometry. Rendered using the first material. For more details, please refer to the subGeometrys property.\n   */\n  get subGeometry(): SubPrimitive | null {\n    return this._subGeometries[0] || null;\n  }\n\n  /**\n   * A collection of sub-geometry, each sub-geometry can be rendered with an independent material.\n   */\n  get subGeometries(): Readonly<SubPrimitive[]> {\n    return this._subGeometries;\n  }\n\n  /**\n   * Instanced count, 0 means disable.\n   */\n  get instanceCount(): number {\n    return this._primitive.instanceCount;\n  }\n\n  set instanceCount(count: number) {\n    this._primitive.instanceCount = count;\n  }\n\n  /**\n   * Create buffer geometry.\n   * @param engine - Engine\n   * @param name - Geometry name\n   */\n  constructor(engine: Engine, name?: string) {\n    super(engine);\n    this._primitive = new Primitive(engine);\n    this.name = name;\n  }\n\n  /**\n   * Set vertex buffer binding.\n   * @param vertexBufferBindings - Vertex buffer binding\n   * @param firstIndex - First vertex buffer index, the default value is 0\n   */\n  setVertexBufferBinding(vertexBufferBindings: VertexBufferBinding, firstIndex?: number): void;\n\n  /**\n   * Set vertex buffer binding.\n   * @param vertexBuffer - Vertex buffer\n   * @param stride - Vertex buffer data stride\n   * @param firstIndex - First vertex buffer index, the default value is 0\n   */\n  setVertexBufferBinding(vertexBuffer: Buffer, stride: number, firstIndex?: number): void;\n\n  setVertexBufferBinding(\n    bufferOrBinding: Buffer | VertexBufferBinding,\n    stride: number = 0,\n    firstIndex: number = 0\n  ): void {\n    this._primitive.setVertexBufferBinding(<Buffer>bufferOrBinding, stride, firstIndex);\n  }\n\n  /**\n   * Set vertex buffer binding.\n   * @param vertexBufferBindings - Vertex buffer binding\n   * @param firstIndex - First vertex buffer index, the default value is 0\n   */\n  setVertexBufferBindings(vertexBufferBindings: VertexBufferBinding[], firstIndex: number = 0): void {\n    this._primitive.setVertexBufferBindings(vertexBufferBindings, firstIndex);\n  }\n\n  /**\n   * Set index buffer binding.\n   * @param buffer - Index buffer\n   * @param format - Index buffer format\n   */\n  setIndexBufferBinding(buffer: Buffer, format: IndexFormat): void;\n\n  /**\n   * Set index buffer binding.\n   * @param bufferBinding - Index buffer binding\n   */\n  setIndexBufferBinding(bufferBinding: IndexBufferBinding): void;\n\n  setIndexBufferBinding(bufferOrBinding: Buffer | IndexBufferBinding, format?: IndexFormat): void {\n    this._primitive.setIndexBufferBinding(<Buffer>bufferOrBinding, format);\n  }\n\n  /**\n   * Set vertex elements.\n   * @param elements - Vertex element collection\n   */\n  setVertexElements(elements: VertexElement[]): void {\n    this._primitive.setVertexElements(elements);\n  }\n\n  /**\n   * Add sub-geometry, each sub-geometry can correspond to an independent material.\n   * @param start - Start drawing offset, if the index buffer is set, it means the offset in the index buffer, if not set, it means the offset in the vertex buffer\n   * @param count - Drawing count, if the index buffer is set, it means the count in the index buffer, if not set, it means the count in the vertex buffer\n   * @param topology - Drawing topology, default is PrimitiveTopology.Triangles\n   */\n  addSubGeometry(\n    start: number,\n    count: number,\n    topology: PrimitiveTopology = PrimitiveTopology.Triangles\n  ): SubPrimitive {\n    const subGeometry = new SubPrimitive(start, count, topology);\n    this._subGeometries.push(subGeometry);\n    return subGeometry;\n  }\n\n  /**\n   * Remove sub geometry.\n   * @param subGeometry - SubGeometry needs to be removed\n   */\n  removeSubGeometry(subGeometry: SubPrimitive): void {\n    const subGeometries = this._subGeometries;\n    const index = subGeometries.indexOf(subGeometry);\n    if (index !== -1) {\n      subGeometries.splice(index, 1);\n    }\n  }\n\n  /**\n   * Clear all sub geometries\n   */\n  clearSubGeometry(): void {\n    this._subGeometries.length = 0;\n  }\n\n  /**\n   * Destroy.\n   */\n  destroy(): void {\n    if (this._primitive) {\n      this._primitive.destroy();\n      this._primitive = null;\n    }\n  }\n}\n","import { BoundingBox } from \"@oasis-engine/math\";\nimport { Logger } from \"../base/Logger\";\nimport { Camera } from \"../Camera\";\nimport { Material } from \"../material/Material\";\nimport { Renderer } from \"../Renderer\";\nimport { RenderElement } from \"../RenderPipeline/RenderElement\";\nimport { BufferGeometry } from \"./BufferGeometry\";\n\n/**\n * Geometry renderer\n */\nexport class GeometryRenderer extends Renderer {\n  _material: Material;\n\n  /** Buffer geometry */\n  private _geometry: BufferGeometry;\n\n  /**\n   * Set buffer geometry\n   */\n  set geometry(value: BufferGeometry) {\n    if (this._geometry) {\n      this._geometry._primitive._addRefCount(-1);\n    }\n    value._primitive._addRefCount(1);\n    this._geometry = value;\n  }\n\n  get geometry(): BufferGeometry {\n    return this._geometry;\n  }\n\n  /**\n   * Material.\n   */\n  set material(value: Material) {\n    if (this._material) {\n      this._material._addRefCount(-1);\n    }\n    value._addRefCount(1);\n    this._material = value;\n  }\n\n  get material(): Material {\n    return this._material;\n  }\n\n  render(camera: Camera) {\n    const geometry = this.geometry;\n    if (geometry) {\n      const subGeometries = geometry.subGeometries;\n      const renderPipeline = camera._renderPipeline;\n      const material = this._material;\n      for (let i = 0, n = subGeometries.length; i < n; i++) {\n        if (material) {\n          const element = RenderElement.getFromPool();\n          element.setValue(this, geometry._primitive, subGeometries[i], material); // CM: need to support multi material\n          renderPipeline.pushPrimitive(element);\n        }\n      }\n    } else {\n      Logger.error(\"geometry is null.\");\n    }\n  }\n\n  /**\n   * @override\n   */\n  protected _updateBounds(worldBounds: BoundingBox): void {\n    const geometry = this._geometry;\n    if (geometry) {\n      const localBounds = geometry.bounds;\n      const worldMatrix = this._entity.transform.worldMatrix;\n      BoundingBox.transform(localBounds, worldMatrix, worldBounds);\n    } else {\n      worldBounds.min.setValue(0, 0, 0);\n      worldBounds.max.setValue(0, 0, 0);\n    }\n  }\n}\n","import { Vector3 } from \"@oasis-engine/math\";\nimport { Engine } from \"../Engine\";\nimport { BufferGeometry } from \"../geometry/BufferGeometry\";\nimport { Buffer } from \"../graphic/Buffer\";\nimport { BufferBindFlag } from \"../graphic/enums/BufferBindFlag\";\nimport { BufferUsage } from \"../graphic/enums/BufferUsage\";\nimport { IndexFormat } from \"../graphic/enums/IndexFormat\";\nimport { VertexElementFormat } from \"../graphic/enums/VertexElementFormat\";\nimport { VertexElement } from \"../graphic/VertexElement\";\n\n/**\n * Basic shape geometry.\n */\nexport class ShapeGeometry extends BufferGeometry {\n  /**\n   * @internal\n   */\n  _initialize(engine: Engine, vertices: Float32Array, indices: Uint16Array) {\n    const vertexStride = 32;\n    const vertexElements = [\n      new VertexElement(\"POSITION\", 0, VertexElementFormat.Vector3, 0),\n      new VertexElement(\"NORMAL\", 12, VertexElementFormat.Vector3, 0),\n      new VertexElement(\"TEXCOORD_0\", 24, VertexElementFormat.Vector2, 0)\n    ];\n\n    this._initBuffer(engine, vertices, indices, vertexStride, vertexElements);\n  }\n\n  _initBuffer(\n    engine: Engine,\n    vertices: Float32Array,\n    indices: Uint16Array,\n    vertexStride: number,\n    vertexElements: VertexElement[]\n  ) {\n    const positionElement = vertexElements[0];\n    const vertexBuffer = new Buffer(engine, BufferBindFlag.VertexBuffer, vertices, BufferUsage.Static);\n    const indexBuffer = new Buffer(engine, BufferBindFlag.IndexBuffer, indices, BufferUsage.Static);\n\n    this.setVertexBufferBinding(vertexBuffer, vertexStride);\n    this.setIndexBufferBinding(indexBuffer, IndexFormat.UInt16);\n    this.setVertexElements(vertexElements);\n    this.addSubGeometry(0, indices.length);\n\n    this._computeBounds(positionElement, vertices);\n  }\n\n  private _computeBounds(positionElement: VertexElement, vertices: ArrayBuffer | Float32Array): void {\n    const vertexElement = positionElement;\n    const bufferIndex = vertexElement.bindingIndex;\n    const vertexBufferBinding = this._primitive.vertexBufferBindings[bufferIndex];\n    const stride = vertexBufferBinding.stride;\n    const offset = vertexElement.offset;\n    const vertexCount = vertexBufferBinding.buffer.byteLength / stride;\n    let arrayBuffer: ArrayBuffer = vertices;\n    if (!(arrayBuffer instanceof ArrayBuffer)) {\n      arrayBuffer = (<Float32Array>arrayBuffer).buffer;\n    }\n    const dataView = new DataView(arrayBuffer, offset);\n\n    let min = new Vector3(Infinity, Infinity, Infinity);\n    let max = new Vector3(-Infinity, -Infinity, -Infinity);\n    for (let i = 0; i < vertexCount; i++) {\n      const base = offset + stride * i;\n      const position = new Vector3(\n        dataView.getFloat32(base, true),\n        dataView.getFloat32(base + 4, true),\n        dataView.getFloat32(base + 8, true)\n      );\n      Vector3.min(min, position, min);\n      Vector3.max(max, position, max);\n    }\n\n    const bounds = this.bounds;\n    min.cloneTo(bounds.min);\n    max.cloneTo(bounds.max);\n  }\n}\n","import { Engine } from \"../Engine\";\nimport { ShapeGeometry } from \"./ShapeGeometry\";\n\n/**\n * CuboidGeometry.\n */\nexport class CuboidGeometry extends ShapeGeometry {\n  /**\n   * Create a cuboid geometry.\n   * @param engine - Engine\n   * @param width - Cuboid width\n   * @param height - Cuboid height\n   * @param depth - Cuboid depth\n   */\n  constructor(engine: Engine, width: number = 1, height: number = 1, depth: number = 1) {\n    super(engine);\n\n    const halfWidth: number = width / 2;\n    const halfHeight: number = height / 2;\n    const halfDepth: number = depth / 2;\n\n    // prettier-ignore\n    const vertices: Float32Array = new Float32Array([\n    \t// up\n    \t-halfWidth, halfHeight, -halfDepth, 0, 1, 0, 0, 0, halfWidth, halfHeight, -halfDepth, 0, 1, 0, 1, 0, halfWidth, halfHeight, halfDepth, 0, 1, 0, 1, 1, -halfWidth, halfHeight, halfDepth, 0, 1, 0, 0, 1,\n    \t// down\n    \t-halfWidth, -halfHeight, -halfDepth, 0, -1, 0, 0, 1, halfWidth, -halfHeight, -halfDepth, 0, -1, 0, 1, 1, halfWidth, -halfHeight, halfDepth, 0, -1, 0, 1, 0, -halfWidth, -halfHeight, halfDepth, 0, -1, 0, 0, 0,\n    \t// left\n    \t-halfWidth, halfHeight, -halfDepth, -1, 0, 0, 0, 0, -halfWidth, halfHeight, halfDepth, -1, 0, 0, 1, 0, -halfWidth, -halfHeight, halfDepth, -1, 0, 0, 1, 1, -halfWidth, -halfHeight, -halfDepth, -1, 0, 0, 0, 1,\n    \t// right\n    \thalfWidth, halfHeight, -halfDepth, 1, 0, 0, 1, 0, halfWidth, halfHeight, halfDepth, 1, 0, 0, 0, 0, halfWidth, -halfHeight, halfDepth, 1, 0, 0, 0, 1, halfWidth, -halfHeight, -halfDepth, 1, 0, 0, 1, 1,\n    \t// fornt\n    \t-halfWidth, halfHeight, halfDepth, 0, 0, 1, 0, 0, halfWidth, halfHeight, halfDepth, 0, 0, 1, 1, 0, halfWidth, -halfHeight, halfDepth, 0, 0, 1, 1, 1, -halfWidth, -halfHeight, halfDepth, 0, 0, 1, 0, 1,\n    \t// back\n    \t-halfWidth, halfHeight, -halfDepth, 0, 0, -1, 1, 0, halfWidth, halfHeight, -halfDepth, 0, 0, -1, 0, 0, halfWidth, -halfHeight, -halfDepth, 0, 0, -1, 0, 1, -halfWidth, -halfHeight, -halfDepth, 0, 0, -1, 1, 1]);\n\n    // prettier-ignore\n    const indices: Uint16Array = new Uint16Array([\n    \t// up\n    \t0, 2, 1, 2, 0, 3,\n    \t// donw\n    \t4, 6, 7, 6, 4, 5,\n    \t// left\n    \t8, 10, 9, 10, 8, 11,\n    \t// right\n    \t12, 14, 15, 14, 12, 13,\n    \t// fornt\n    \t16, 18, 17, 18, 16, 19,\n    \t// back\n    \t20, 22, 23, 22, 20, 21]);\n    this._initialize(engine, vertices, indices);\n  }\n}\n","import { Engine } from \"../Engine\";\nimport { ShapeGeometry } from \"./ShapeGeometry\";\n\n/**\n * SphereGeometry.\n */\nexport class SphereGeometry extends ShapeGeometry {\n  private _parameters;\n  private _thetaEnd;\n\n  /**\n   * @param  radius - Sphere radius.\n   * @param  horizontalSegments - Number of horizontal segments\n   * @param  verticalSegments - Number of vertical segments\n   * @param  alphaStart - Specify horizontal starting angle\n   * @param  alphaRange - Specify horizontal sweep angle size\n   * @param  thetaStart - Specify vertical starting angle\n   * @param  thetaRange - Specify vertical sweep angle size\n   */\n  constructor(\n    engine: Engine,\n    radius: number = 1,\n    horizontalSegments: number = 8,\n    verticalSegments: number = 6,\n    alphaStart: number = 0,\n    alphaRange: number = Math.PI * 2,\n    thetaStart: number = 0,\n    thetaRange: number = Math.PI\n  ) {\n    super(engine);\n    this._parameters = {\n      radius: radius || 1,\n      horizontalSegments: Math.max(3, Math.floor(horizontalSegments)),\n      verticalSegments: Math.max(2, Math.floor(verticalSegments)),\n      alphaStart: alphaStart,\n      alphaRange: alphaRange,\n      thetaStart: thetaStart,\n      thetaRange: thetaRange\n    };\n    this._thetaEnd = this._parameters.thetaStart + this._parameters.thetaRange;\n    this.initialize(engine);\n  }\n\n  /**\n   * Generate sphere vertices data.\n   * @private\n   */\n  initialize(engine: Engine) {\n    const { verticalSegments, horizontalSegments } = this._parameters;\n    // Generate data of geometric vertices on the latitude and longitude lines\n    let index = 0;\n    const grid = [];\n    const vertices: Float32Array = new Float32Array((verticalSegments + 1) * (horizontalSegments + 1) * 8);\n    const indices = [];\n    // const positions = [];\n    for (let iy = 0; iy <= verticalSegments; iy++) {\n      const verticesRow = [];\n      const v = iy / verticalSegments;\n      for (let ix = 0; ix <= horizontalSegments; ix++) {\n        const u = ix / horizontalSegments;\n        let posX =\n          -this._parameters.radius *\n          Math.cos(this._parameters.alphaStart + u * this._parameters.alphaRange) *\n          Math.sin(this._parameters.thetaStart + v * this._parameters.thetaRange);\n        let posY = this._parameters.radius * Math.cos(this._parameters.thetaStart + v * this._parameters.thetaRange);\n        let posZ =\n          this._parameters.radius *\n          Math.sin(this._parameters.alphaStart + u * this._parameters.alphaRange) *\n          Math.sin(this._parameters.thetaStart + v * this._parameters.thetaRange);\n        posX = Math.abs(posX) < 1e-6 ? 0 : posX;\n        posY = Math.abs(posY) < 1e-6 ? 0 : posY;\n        posZ = Math.abs(posZ) < 1e-6 ? 0 : posZ;\n\n        const offset = index * 8;\n        // POSITION\n        vertices[offset] = posX;\n        vertices[offset + 1] = posY;\n        vertices[offset + 2] = posZ;\n        // NORMAL\n        vertices[offset + 3] = posX;\n        vertices[offset + 4] = posY;\n        vertices[offset + 5] = posZ;\n        // TEXCOORD_0\n        vertices[offset + 6] = u;\n        vertices[offset + 7] = 1 - v;\n\n        verticesRow.push(index++);\n      }\n      grid.push(verticesRow);\n    }\n\n    // Generate indices\n    for (let iy = 0; iy < verticalSegments; iy++) {\n      for (let ix = 0; ix < horizontalSegments; ix++) {\n        const a = grid[iy][ix + 1];\n        const b = grid[iy][ix];\n        const c = grid[iy + 1][ix];\n        const d = grid[iy + 1][ix + 1];\n\n        if (iy !== 0 || this._parameters.thetaStart > 0) indices.push(a, b, d);\n        if (iy !== verticalSegments - 1 || this._thetaEnd < Math.PI) indices.push(b, c, d);\n      }\n    }\n\n    this._initialize(engine, vertices, Uint16Array.from(indices));\n  }\n}\n","import { Engine } from \"../Engine\";\nimport { ShapeGeometry } from \"./ShapeGeometry\";\n\n/**\n * CubeGeometry.\n */\nexport class PlaneGeometry extends ShapeGeometry {\n  private _parameters;\n  private halfWidth;\n  private halfHeight;\n\n  /**\n   * @param engine - Engine\n   * @param width - Plane width\n   * @param height - Plane height\n   * @param horizontalSegments - Plane horizontal segments\n   * @param verticalSegments - Plane verticle segments\n   */\n  constructor(\n    engine: Engine,\n    width: number = 1,\n    height: number = 1,\n    horizontalSegments: number = 1,\n    verticalSegments: number = 1\n  ) {\n    super(engine);\n    this._parameters = {\n      width: width,\n      height: height,\n      horizontalSegments: Math.floor(horizontalSegments),\n      verticalSegments: Math.floor(verticalSegments)\n    };\n\n    this.halfWidth = this._parameters.width / 2;\n    this.halfHeight = this._parameters.height / 2;\n    this.initialize(engine);\n  }\n\n  initialize(engine: Engine) {\n    const { verticalSegments, horizontalSegments } = this._parameters;\n    // Generate data of geometric vertices on the latitude and longitude lines\n    let index = 0;\n    let offset = 0;\n    const grid = [];\n    const vertices: Float32Array = new Float32Array((verticalSegments + 1) * (horizontalSegments + 1) * 8);\n    const indices: Uint16Array = new Uint16Array(verticalSegments * horizontalSegments * 6);\n\n    for (let iy = 0; iy <= verticalSegments; iy++) {\n      const verticesRow = [];\n      const v = iy / verticalSegments;\n      for (let ix = 0; ix <= horizontalSegments; ix++) {\n        const u = ix / horizontalSegments;\n        const posX = u * this._parameters.width - this.halfWidth;\n        const posY = v * this._parameters.height - this.halfHeight;\n\n        // POSITION\n        vertices[offset++] = posX;\n        vertices[offset++] = posY;\n        vertices[offset++] = 0;\n        // NORMAL\n        vertices[offset++] = 0;\n        vertices[offset++] = 0;\n        vertices[offset++] = 1;\n        // TEXCOORD_0\n        vertices[offset++] = u;\n        vertices[offset++] = 1 - v;\n\n        verticesRow.push(index++);\n      }\n      grid.push(verticesRow);\n    }\n\n    // Generate indices\n    index = 0;\n    for (let iy = 0; iy < verticalSegments; iy++) {\n      for (let ix = 0; ix < horizontalSegments; ix++) {\n        const a = grid[iy][ix + 1];\n        const b = grid[iy][ix];\n        const c = grid[iy + 1][ix];\n        const d = grid[iy + 1][ix + 1];\n\n        indices[index++] = a;\n        indices[index++] = c;\n        indices[index++] = b;\n        indices[index++] = a;\n        indices[index++] = d;\n        indices[index++] = c;\n      }\n    }\n\n    this._initialize(engine, vertices, indices);\n  }\n}\n","import { Vector3 } from \"@oasis-engine/math\";\nimport { FrontFace } from \"../base/Constant\";\nimport { Engine } from \"../Engine\";\nimport { ShapeGeometry } from \"./ShapeGeometry\";\n\n/**\n * SphereGeometry.\n */\nexport class CylinderGeometry extends ShapeGeometry {\n  public FrontFace;\n  public index;\n  public indexArray;\n  public halfHeight;\n  private _parameters;\n  private _vertices;\n  private _indices;\n\n  /**\n   * @param  engine - Engine\n   * @param  radiusTop - Cylinder top radius, default is 1.\n   * @param  radiusBottom - Cylinder bottom radius, default is 1.\n   * @param  height - Cylinder height, default is 1.\n   * @param  radialSegments - Number of segmented faces around the circumference of the cylinder. Default is 8\n   * @param  heightSegments - Number of rows of faces along the height of the cylinder. Default is 1.\n   * @param  openEnded - A boolean indicating whether the ends of the cylinder are open or capped. Default is false, meaning capped.\n   * @param  thetaStart - Start angle for first segment, default = 0 (three o'clock position).\n   * @param  thetaLength - The central angle, often called theta, of the circular sector. The default is 2*Pi, which makes for a complete cylinder.\n   */\n  constructor(\n    engine: Engine,\n    radiusTop: number = 1,\n    radiusBottom: number = 1,\n    height: number = 1,\n    radialSegments: number = 8,\n    heightSegments: number = 1,\n    openEnded: boolean = false,\n    thetaStart: number = 0,\n    thetaLength: number = 2 * Math.PI,\n    frontFace: FrontFace = FrontFace.CCW\n  ) {\n    super(engine);\n    this.FrontFace = frontFace;\n    this._parameters = {\n      radiusTop: radiusTop,\n      radiusBottom: radiusBottom,\n      height: height,\n      radialSegments: radialSegments,\n      heightSegments: heightSegments,\n      openEnded: openEnded,\n      thetaStart: thetaStart,\n      thetaLength: thetaLength\n    };\n\n    this._vertices = [];\n    this._indices = [];\n\n    this.index = 0;\n    this.indexArray = [];\n    this.halfHeight = this._parameters.height / 2;\n\n    this.generateTorso();\n\n    if (this._parameters.openEnded === false) {\n      if (this._parameters.radiusTop > 0) this.generateCap(true);\n      if (this._parameters.radiusBottom > 0) this.generateCap(false);\n    }\n\n    this._initialize(engine, Float32Array.from(this._vertices), Uint16Array.from(this._indices));\n  }\n\n  generateTorso() {\n    const { radialSegments, heightSegments, radiusBottom, radiusTop, height } = this._parameters;\n    let x, y;\n    const normal: Vector3 = new Vector3();\n    const slope = (radiusBottom - radiusTop) / height;\n    for (y = 0; y <= heightSegments; y++) {\n      const indexRow = [];\n      const v = y / heightSegments;\n      const radius = v * (radiusBottom - radiusTop) + radiusTop;\n      for (x = 0; x <= radialSegments; x++) {\n        const u = x / radialSegments;\n        const theta = u * this._parameters.thetaLength + this._parameters.thetaStart;\n        const sinTheta = Math.sin(theta);\n        const cosTheta = Math.cos(theta);\n\n        // vertex\n        const vertX = radius * sinTheta;\n        const vertY = -v * height + this.halfHeight;\n        const vertZ = radius * cosTheta;\n        this._vertices.push(vertX, vertY, vertZ);\n\n        // normal\n        normal.setValue(sinTheta, slope, cosTheta);\n        normal.normalize();\n        this._vertices.push(normal.x, normal.y, normal.z);\n\n        // uv\n        if (this.FrontFace === FrontFace.CCW) {\n          this._vertices.push(u, v);\n        } else {\n          this._vertices.push(1 - u, v);\n        }\n\n        indexRow.push(this.index++);\n      }\n\n      this.indexArray.push(indexRow);\n    }\n\n    for (x = 0; x < radialSegments; x++) {\n      for (y = 0; y < heightSegments; y++) {\n        var a = this.indexArray[y][x];\n        var b = this.indexArray[y + 1][x];\n        var c = this.indexArray[y + 1][x + 1];\n        var d = this.indexArray[y][x + 1];\n\n        // faces\n        this._indices.push(a, b, d);\n        this._indices.push(b, c, d);\n      }\n    }\n  }\n\n  generateCap(isTop) {\n    const { radialSegments } = this._parameters;\n    let x;\n    const radius = isTop === true ? this._parameters.radiusTop : this._parameters.radiusBottom;\n    const sign = isTop === true ? 1 : -1;\n    const centerIndexStart = this.index;\n\n    for (x = 1; x <= radialSegments; x++) {\n      // vertex\n      this._vertices.push(0, this.halfHeight * sign, 0);\n\n      // normal\n      this._vertices.push(0, sign, 0);\n\n      // uv\n      this._vertices.push(0.5, 0.5);\n\n      // increase index\n      this.index++;\n    }\n    const centerIndexEnd = this.index;\n\n    for (x = 0; x <= radialSegments; x++) {\n      const u = x / radialSegments;\n      const theta = u * this._parameters.thetaLength + this._parameters.thetaStart;\n      const cosTheta = Math.cos(theta);\n      const sinTheta = Math.sin(theta);\n\n      // vertex\n      const vertexX = radius * sinTheta;\n      const vertexY = this.halfHeight * sign;\n      const vertexZ = radius * cosTheta;\n      this._vertices.push(vertexX, vertexY, vertexZ);\n\n      // normal\n      this._vertices.push(0, sign, 0);\n\n      // uv\n      const uvX = cosTheta * 0.5 + 0.5;\n      const uvY = sinTheta * 0.5 * sign + 0.5;\n      this._vertices.push(uvX, uvY);\n\n      // increase index\n      this.index++;\n    }\n\n    for (x = 0; x < radialSegments; x++) {\n      var c = centerIndexStart + x;\n      var i = centerIndexEnd + x;\n      if (isTop === true) {\n        // face top\n        this._indices.push(i, i + 1, c);\n      } else {\n        // face bottom\n        this._indices.push(i + 1, i, c);\n      }\n    }\n  }\n}\n","import { Engine } from \"../Engine\";\nimport { ShapeGeometry } from \"./ShapeGeometry\";\n\ninterface CircleGeometryOptions {\n  radius?: number;\n  segments?: number;\n  thetaStart?: number;\n  thetaLength?: number;\n}\n/**\n * CircleGeometry.\n */\nexport class CircleGeometry extends ShapeGeometry {\n  private radius: number = 1;\n  private segments: number = 16;\n  private thetaStart: number = 0;\n  private thetaLength: number = Math.PI * 2;\n\n  /**\n   * @param engine - Engine\n   * @param radius - Circle radius\n   */\n  constructor(engine: Engine, options: CircleGeometryOptions = {}) {\n    super(engine);\n\n    this.radius = options.radius || this.radius;\n    this.segments = options.segments || this.segments;\n    this.thetaStart = options.thetaStart || this.thetaStart;\n    this.thetaLength = options.thetaLength || this.thetaLength;\n    const { segments, radius } = this;\n\n    // init with center point\n    const vertices: Float32Array = new Float32Array((segments + 2) * 8);\n    // POSITION NORMAL TEXCOORD_0\n    vertices.set([0, 0, 0, 0, 0, 1, 0.5, 0.5]);\n\n    let index = 8;\n    for (let s = 0; s <= segments; s++) {\n      let segment = this.thetaStart + (s / segments) * this.thetaLength;\n      const x = radius * Math.cos(segment);\n      const y = radius * Math.sin(segment);\n\n      // POSITION\n      vertices[index++] = x;\n      vertices[index++] = y;\n      vertices[index++] = 0;\n      // NORMAL\n      vertices[index++] = 0;\n      vertices[index++] = 0;\n      vertices[index++] = 1;\n      // TEXCOORD_0\n      vertices[index++] = (x / radius + 1) * 0.5;\n      vertices[index++] = (y / radius + 1) * 0.5;\n    }\n\n    const indices: Uint16Array = new Uint16Array(segments * 3);\n    index = 0;\n    for (let i = 1; i <= segments; i++) {\n      indices[index++] = i;\n      indices[index++] = i + 1;\n      indices[index++] = 0;\n    }\n\n    this._initialize(engine, vertices, indices);\n  }\n}\n","import { Engine } from \"../Engine\";\nimport { PrimitiveTopology } from \"../graphic/enums/PrimitiveTopology\";\nimport { VertexElementFormat } from \"../graphic/enums/VertexElementFormat\";\nimport { VertexElement } from \"../graphic/VertexElement\";\nimport { ShapeGeometry } from \"./ShapeGeometry\";\n\n/**\n * A rectangle covering the entire screen.\n * @private\n */\nexport class ScreenQuadGeometry extends ShapeGeometry {\n  constructor(engine: Engine) {\n    super(engine);\n    const vertices: Float32Array = new Float32Array([-1, -1, 0, 0, 0, 1, -1, 0, 1, 0, 1, 1, 0, 1, 1, -1, 1, 0, 0, 1]);\n\n    const indices: Uint16Array = new Uint16Array([0, 1, 2, 3]);\n\n    this._initialize(engine, vertices, indices);\n    this.subGeometry.topology = PrimitiveTopology.TriangleFan;\n  }\n\n  _initialize(engine: Engine, vertices: Float32Array, indices: Uint16Array) {\n    const vertexStride = 20;\n    const vertexElements = [\n      new VertexElement(\"POSITION\", 0, VertexElementFormat.Vector3, 0),\n      new VertexElement(\"TEXCOORD_0\", 12, VertexElementFormat.Vector2, 0)\n    ];\n    this._initBuffer(engine, vertices, indices, vertexStride, vertexElements);\n  }\n}\n","import { Engine } from \"../Engine\";\nimport { VertexElementFormat } from \"../graphic/enums/VertexElementFormat\";\nimport { VertexElement } from \"../graphic/VertexElement\";\nimport { ShapeGeometry } from \"./ShapeGeometry\";\n\n/**\n * TorusGeometry.\n */\nexport class TorusGeometry extends ShapeGeometry {\n  constructor(\n    private parameters: {\n      radius?: number;\n      tube?: number;\n      radialSegments?: number;\n      tubularSegments?: number;\n      arc?: number;\n    } = {},\n    engine: Engine\n  ) {\n    super(engine);\n\n    const radius = this.parameters.radius || 1;\n    const tube = this.parameters.tube || 0.4;\n    const radialSegments = Math.floor(this.parameters.radialSegments) || 8;\n    const tubularSegments = Math.floor(this.parameters.tubularSegments) || 6;\n    const arc = this.parameters.arc || Math.PI * 2;\n\n    // buffers\n    const vertices: Float32Array = new Float32Array((radialSegments + 1) * (tubularSegments + 1) * 3);\n    const indices: Uint16Array = new Uint16Array(radialSegments * tubularSegments * 6);\n\n    // generate vertices, normals and uvs\n    let index = 0;\n    for (let j = 0; j <= radialSegments; j++) {\n      for (let i = 0; i <= tubularSegments; i++) {\n        const u = (i / tubularSegments) * arc;\n        const v = (j / radialSegments) * Math.PI * 2;\n\n        // POSITION\n        vertices[index++] = (radius + tube * Math.cos(v)) * Math.cos(u);\n        vertices[index++] = (radius + tube * Math.cos(v)) * Math.sin(u);\n        vertices[index++] = tube * Math.sin(v);\n      }\n    }\n\n    // generate indices\n    index = 0;\n    for (let j = 1; j <= radialSegments; j++) {\n      for (let i = 1; i <= tubularSegments; i++) {\n        // indices\n        const a = (tubularSegments + 1) * j + i - 1;\n        const b = (tubularSegments + 1) * (j - 1) + i - 1;\n        const c = (tubularSegments + 1) * (j - 1) + i;\n        const d = (tubularSegments + 1) * j + i;\n\n        // faces\n        indices[index++] = a;\n        indices[index++] = b;\n        indices[index++] = d;\n        indices[index++] = b;\n        indices[index++] = c;\n        indices[index++] = d;\n      }\n    }\n    this._initialize(engine, vertices, indices);\n  }\n\n  _initialize(engine: Engine, vertices: Float32Array, indices: Uint16Array) {\n    const vertexStride = 12;\n    const vertexElements = [new VertexElement(\"POSITION\", 0, VertexElementFormat.Vector3, 0)];\n\n    this._initBuffer(engine, vertices, indices, vertexStride, vertexElements);\n  }\n}\n","import { Entity } from \"../Entity\";\nimport { GeometryRenderer } from \"../geometry/GeometryRenderer\";\nimport { BlinnPhongMaterial } from \"../material/BlinnPhongMaterial\";\nimport { CuboidGeometry } from \"./CuboidGeometry\";\nimport { CylinderGeometry } from \"./CylinderGeometry\";\nimport { PlaneGeometry } from \"./PlaneGeometry\";\nimport { SphereGeometry } from \"./SphereGeometry\";\n\n// Only for editor\nexport class Model extends GeometryRenderer {\n  private _props: any;\n  private _geometryType: GeometryType;\n\n  set geometryType(value: GeometryType) {\n    switch (value) {\n      case \"Sphere\":\n        const {\n          sphereRadius,\n          sphereHorizontalSegments,\n          sphereVerticalSegments,\n          sphereAlphaStart,\n          sphereAlphaRange,\n          sphereThetaStart,\n          sphereThetaRange\n        } = this._props as any;\n        this.geometry = new SphereGeometry(\n          this.engine,\n          sphereRadius,\n          sphereHorizontalSegments,\n          sphereVerticalSegments,\n          sphereAlphaStart,\n          sphereAlphaRange,\n          sphereThetaStart,\n          sphereThetaRange\n        );\n        break;\n\n      case \"Cylinder\":\n        const {\n          cylinderRadiusTop,\n          cylinderRadiusBottom,\n          cylinderHeight,\n          cylinderRadialSegments,\n          cylinderHeightSegments,\n          cylinderOpenEnded\n        } = this._props as any;\n        this.geometry = new CylinderGeometry(\n          this.engine,\n          cylinderRadiusTop,\n          cylinderRadiusBottom,\n          cylinderHeight,\n          cylinderRadialSegments,\n          cylinderHeightSegments,\n          cylinderOpenEnded,\n          undefined,\n          undefined,\n          undefined\n        );\n        break;\n\n      case \"Plane\":\n        const { planeWidth, planeHeight, planeHorizontalSegments, planeVerticalSegments } = this._props as any;\n        this.geometry = new PlaneGeometry(\n          this.engine,\n          planeWidth,\n          planeHeight,\n          planeHorizontalSegments,\n          planeVerticalSegments\n        );\n        break;\n\n      case \"Box\":\n        var { boxWidth, boxHeight, boxDepth } = this._props as any;\n        this.geometry = new CuboidGeometry(this.engine, boxWidth, boxHeight, boxDepth);\n        break;\n    }\n\n    this._geometryType = value;\n  }\n\n  get geometryType() {\n    return this._geometryType;\n  }\n\n  constructor(entity: Entity) {\n    super(entity);\n  }\n\n  get material(): any {\n    return this._material;\n  }\n\n  set material(mtl: any) {\n    if (!mtl) {\n      this._material = new BlinnPhongMaterial(this.engine);\n    } else {\n      this._material = mtl;\n    }\n  }\n\n  init(props: any) {\n    this._props = props;\n\n    const { geometryType = GeometryType.Box } = props;\n    this.material = props.material;\n    this.geometryType = geometryType;\n  }\n\n  setProp(key: string, value: any) {\n    this._props[key] = value;\n\n    if (key === \"material\") {\n      this.material = value;\n    } else {\n      this.geometryType = this._props.geometryType;\n    }\n  }\n}\n\nenum GeometryType {\n  Box = \"Box\",\n  Cylinder = \"Cylinder\",\n  Plane = \"Plane\",\n  Sphere = \"Sphere\"\n}\n","import { Engine } from \"../Engine\";\nimport { Material } from \"../material/Material\";\nimport { CompareFunction } from \"../shader/enums/CompareFunction\";\nimport { CullMode } from \"../shader/enums/CullMode\";\nimport { Shader } from \"../shader/Shader\";\n\n/**\n * SkyboxMaterial\n */\nexport class SkyBoxMaterial extends Material {\n  constructor(engine: Engine) {\n    super(engine, Shader.find(\"skybox\"));\n\n    this.renderState.rasterState.cullMode = CullMode.Off;\n    this.renderState.depthState.compareFunction = CompareFunction.LessEqual;\n  }\n}\n","import { BoundingBox, Matrix } from \"@oasis-engine/math\";\nimport { Camera } from \"../Camera\";\nimport { Entity } from \"../Entity\";\nimport { CuboidGeometry } from \"../geometry-shape/CuboidGeometry\";\nimport { GeometryRenderer } from \"../geometry/GeometryRenderer\";\nimport { TextureCubeMap } from \"../texture/TextureCubeMap\";\nimport { SkyBoxMaterial } from \"./SkyBoxMaterial\";\n\n/**\n * Skybox Component\n */\nexport class SkyBox extends GeometryRenderer {\n  private _skyBoxMap: TextureCubeMap;\n  private _matrix: Matrix = new Matrix();\n  private _initBounds: boolean = false;\n\n  /**\n   * Contructor of skybox\n   * @param - Entity\n   */\n  constructor(entity: Entity) {\n    super(entity);\n    this.geometry = new CuboidGeometry(this.engine, 2, 2, 2);\n    this.material = new SkyBoxMaterial(this.engine);\n  }\n\n  /**\n   * @internal\n   * @param camera\n   */\n  render(camera: Camera) {\n    if (!this._skyBoxMap) return;\n\n    const modelMatrix = this.entity.transform.worldMatrix;\n    const view = camera.viewMatrix;\n    const proj = camera.projectionMatrix;\n    const matrix = this._matrix;\n\n    Matrix.multiply(view, modelMatrix, matrix);\n    const e = matrix.elements;\n    e[12] = e[13] = e[14] = 0;\n    Matrix.multiply(proj, matrix, matrix);\n    this.shaderData.setMatrix(\"u_mvpNoscale\", matrix);\n\n    super.render(camera);\n  }\n\n  /**\n   * CubeMap of current skybox.\n   */\n  get skyBoxMap(): TextureCubeMap {\n    return this._skyBoxMap;\n  }\n\n  set skyBoxMap(v: TextureCubeMap) {\n    this._skyBoxMap = v;\n    v && this.material.shaderData.setTexture(\"u_cube\", v);\n  }\n\n  /**\n   * @override\n   */\n  protected _updateBounds(worldBounds: BoundingBox): void {\n    if (!this._initBounds) {\n      worldBounds.min.setValue(Number.NEGATIVE_INFINITY, Number.NEGATIVE_INFINITY, Number.NEGATIVE_INFINITY);\n      worldBounds.max.setValue(Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY);\n      this._initBounds = true;\n    }\n  }\n}\n","import { MathUtil, Vector3, Color } from \"@oasis-engine/math\";\nimport { BufferGeometry, GeometryRenderer } from \"../geometry\";\nimport { Buffer } from \"../graphic/Buffer\";\nimport { BufferBindFlag } from \"../graphic/enums/BufferBindFlag\";\nimport { BufferUsage } from \"../graphic/enums/BufferUsage\";\nimport { IndexFormat } from \"../graphic/enums/IndexFormat\";\nimport { VertexElementFormat } from \"../graphic/enums/VertexElementFormat\";\nimport { VertexElement } from \"../graphic/VertexElement\";\nimport { Material } from \"../material/Material\";\nimport { BlendFactor } from \"../shader/enums/BlendFactor\";\nimport { RenderQueueType } from \"../material/enums/RenderQueueType\";\nimport { Shader, CullMode } from \"../shader\";\nimport { Texture } from \"../texture\";\n\nenum DirtyFlagType {\n  Position = 0x1,\n  Velocity = 0x2,\n  Acceleration = 0x4,\n  Color = 0x8,\n  Apha = 0x10,\n  Size = 0x20,\n  StartAngle = 0x40,\n  StartTime = 0x80,\n  LifeTime = 0x100,\n  RotateVelocity = 0x200,\n  Scale = 0x400,\n  Everything = 0xffffffff\n}\n\n/**\n * Blend mode enums of the particle renderer's material.\n */\nexport enum ParticleRendererBlendMode {\n  Transparent = 0,\n  Additive = 1\n}\n\n/**\n * Particle Renderer Component.\n */\nexport class ParticleRenderer extends GeometryRenderer {\n  private static _getRandom(): number {\n    return Math.random() - 0.5;\n  }\n\n  private _vertexStride: number;\n  private _vertices: Float32Array;\n  private _vertexBuffer: Buffer;\n  private _maxCount: number = 1000;\n  private _position: Vector3 = new Vector3();\n  private _positionRandomness: Vector3 = new Vector3();\n  private _positionArray: Vector3[];\n  private _velocity: Vector3 = new Vector3();\n  private _velocityRandomness: Vector3 = new Vector3();\n  private _acceleration: Vector3 = new Vector3();\n  private _accelerationRandomness: Vector3 = new Vector3();\n  private _color: Color = new Color(1, 1, 1, 1);\n  private _colorRandomness: number = 0;\n  private _size: number = 1;\n  private _sizeRandomness: number = 0;\n  private _alpha: number = 1;\n  private _alphaRandomness: number = 0;\n  private _startAngle: number = 0;\n  private _startAngleRandomness: number = 0;\n  private _rotateVelocity: number = 0;\n  private _rotateVelocityRandomness: number = 0;\n  private _lifetime: number = 5;\n  private _startTimeRandomness: number = 0;\n  private _scale: number = 1;\n  private _isOnce: boolean = false;\n  private _time: number = 0;\n  private _isInit: boolean = false;\n  private _isStart: boolean = false;\n  private _updateDirtyFlag: number = DirtyFlagType.Everything;\n  private _isRotateToVelocity: boolean = false;\n  private _isUseOriginColor: boolean = false;\n  private _isScaleByLifetime: boolean = false;\n  private _is2d: boolean = true;\n  private _isFadeIn: boolean = false;\n  private _isFadeOut: boolean = false;\n  private _playOnEnable: boolean = true;\n  private _blendMode: ParticleRendererBlendMode = ParticleRendererBlendMode.Transparent;\n\n  /**\n   * Sprite sheet of texture.\n   */\n  public spriteSheet: { x: number; y: number; w: number; h: number }[];\n\n  /**\n   * Texture of particle.\n   */\n  get texture(): Texture {\n    return this.material.shaderData.getTexture('u_texture');\n  }\n\n  set texture(texture: Texture) {\n    if (texture) {\n      this.shaderData.enableMacro('particleTexture');\n      this.material.shaderData.setTexture('u_texture', texture);\n    } else {\n      this.shaderData.disableMacro('particleTexture');\n    }\n  }\n\n  /**\n   * Position of particles.\n   */\n  get position(): Vector3 {\n    return this._position;\n  }\n\n  set position(value: Vector3) {\n    this._updateDirtyFlag |= DirtyFlagType.Position;\n    this._position = value;\n  }\n\n  /**\n   * Random range of positions.\n   */\n  get positionRandomness(): Vector3 {\n    return this._positionRandomness;\n  }\n\n  set positionRandomness(value: Vector3) {\n    this._updateDirtyFlag |= DirtyFlagType.Position;\n    this._positionRandomness = value;\n  }\n\n  /**\n   * Array of fixed positions.\n   */\n  get positionArray(): Vector3[] {\n    return this._positionArray;\n  }\n\n  set positionArray(value: Vector3[]) {\n    this._updateDirtyFlag |= DirtyFlagType.Position;\n    this._positionArray = value;\n  }\n\n  /**\n   * Velocity of particles.\n   */\n  get velocity(): Vector3 {\n    return this._velocity;\n  }\n\n  set velocity(value: Vector3) {\n    this._updateDirtyFlag |= DirtyFlagType.Velocity;\n    this._velocity = value;\n  }\n\n  /**\n   * Random range of velocity.\n   */\n  get velocityRandomness(): Vector3 {\n    return this._velocityRandomness;\n  }\n\n  set velocityRandomness(value: Vector3) {\n    this._updateDirtyFlag |= DirtyFlagType.Velocity;\n    this._velocityRandomness = value;\n  }\n\n  /**\n   * Acceleration of particles.\n   */\n  get acceleration(): Vector3 {\n    return this._acceleration;\n  }\n\n  set acceleration(value: Vector3) {\n    this._updateDirtyFlag |= DirtyFlagType.Acceleration;\n    this._acceleration = value;\n  }\n\n  /**\n   * Random range of acceleration.\n   */\n  get accelerationRandomness(): Vector3 {\n    return this._accelerationRandomness;\n  }\n\n  set accelerationRandomness(value: Vector3) {\n    this._updateDirtyFlag |= DirtyFlagType.Acceleration;\n    this._accelerationRandomness = value;\n  }\n\n  /**\n   * Color of particles.\n   */\n  get color(): Color {\n    return this._color;\n  }\n\n  set color(value: Color) {\n    this._updateDirtyFlag |= DirtyFlagType.Color;\n    this._color = value;\n  }\n\n  /**\n   * Random range of color.\n   */\n  get colorRandomness(): number {\n    return this._colorRandomness;\n  }\n\n  set colorRandomness(value: number) {\n    this._updateDirtyFlag |= DirtyFlagType.Color;\n    this._colorRandomness = value;\n  }\n\n  /**\n   * Size of particles.\n   */\n  get size(): number {\n    return this._size;\n  }\n\n  set size(value: number) {\n    this._updateDirtyFlag |= DirtyFlagType.Size;\n    this._size = value;\n  }\n\n  /**\n   * Random range of size.\n   */\n  get sizeRandomness(): number {\n    return this._sizeRandomness;\n  }\n\n  set sizeRandomness(value: number) {\n    this._updateDirtyFlag |= DirtyFlagType.Size;\n    this._sizeRandomness = value;\n  }\n\n  /**\n   * Alpha of particles.\n   */\n  get alpha(): number {\n    return this._alpha;\n  }\n\n  set alpha(value: number) {\n    this._updateDirtyFlag |= DirtyFlagType.Apha;\n    this._alpha = value;\n  }\n\n  /**\n   * Random range of alpha.\n   */\n  get alphaRandomness(): number {\n    return this._alphaRandomness;\n  }\n\n  set alphaRandomness(value: number) {\n    this._updateDirtyFlag |= DirtyFlagType.Apha;\n    this._alphaRandomness = value;\n  }\n\n  /**\n   * Angle of particles.\n   */\n  get angle(): number {\n    return this._startAngle;\n  }\n\n  set angle(value: number) {\n    this._updateDirtyFlag |= DirtyFlagType.StartAngle;\n    this._startAngle = value;\n  }\n\n  /**\n   * Random range of angle.\n   */\n  get angleRandomness(): number {\n    return this._startAngleRandomness;\n  }\n\n  set angleRandomness(value: number) {\n    this._updateDirtyFlag |= DirtyFlagType.StartAngle;\n    this._startAngleRandomness = value;\n  }\n\n  /**\n   * Rotate velocity of particles.\n   */\n  get rotateVelocity(): number {\n    return this._rotateVelocity;\n  }\n\n  set rotateVelocity(value: number) {\n    this._updateDirtyFlag |= DirtyFlagType.RotateVelocity;\n    this._rotateVelocity = value;\n  }\n\n  /**\n   * Random range of rotate velocity.\n   */\n  get rotateVelocityRandomness(): number {\n    return this._rotateVelocityRandomness;\n  }\n\n  set rotateVelocityRandomness(value: number) {\n    this._updateDirtyFlag |= DirtyFlagType.RotateVelocity;\n    this._rotateVelocityRandomness = value;\n  }\n\n  /**\n   * Lifetime of particles.\n   */\n  get lifetime(): number {\n    return this._lifetime;\n  }\n\n  set lifetime(value: number) {\n    this._updateDirtyFlag |= DirtyFlagType.LifeTime;\n    this._lifetime = value;\n  }\n\n  /**\n   * Random range of start time.\n   */\n  get startTimeRandomness(): number {\n    return this._startTimeRandomness;\n  }\n\n  set startTimeRandomness(value: number) {\n    this._updateDirtyFlag |= DirtyFlagType.StartTime;\n    this._startTimeRandomness = value;\n  }\n\n  /**\n   * Scale factor of particles.\n   */\n  get scale(): number {\n    return this._scale;\n  }\n\n  set scale(value: number) {\n    this._updateDirtyFlag |= DirtyFlagType.Scale;\n    this._scale = value;\n  }\n\n  /**\n   * Max count of particles.\n   */\n  get maxCount(): number {\n    return this._maxCount;\n  }\n\n  set maxCount(value: number) {\n    this._isStart = false;\n    this._isInit = false;\n    this._maxCount = value;\n    this._updateDirtyFlag = DirtyFlagType.Everything;\n    this.geometry = this._createGeometry();\n\n    this._updateBuffer();\n\n    this._isInit = true;\n\n  }\n\n  /**\n   * Whether play once.\n   */\n  get isOnce(): boolean {\n    return this._isOnce;\n  }\n\n  set isOnce(value: boolean) {\n    this._time = 0;\n    this.shaderData.setInt(\"u_once\", value ? 1 : 0);\n    this._isOnce = value;\n  }\n\n  /**\n   * Whether follow the direction of velocity.\n   */\n  get isRotateToVelocity(): boolean {\n    return this._isRotateToVelocity;\n  }\n\n  set isRotateToVelocity(value: boolean) {\n    if (value) {\n      this.shaderData.enableMacro(\"rotateToVelocity\");\n    } else {\n      this.shaderData.disableMacro(\"rotateToVelocity\");\n    }\n\n    this._isRotateToVelocity = value;\n  }\n\n  /**\n   * Whether use origin color.\n   */\n  get isUseOriginColor(): boolean {\n    return this._isUseOriginColor;\n  }\n\n  set isUseOriginColor(value: boolean) {\n    if (value) {\n      this.shaderData.enableMacro(\"useOriginColor\");\n    } else {\n      this.shaderData.disableMacro(\"useOriginColor\");\n    }\n\n    this._isUseOriginColor = value;\n  }\n\n  /**\n   * Whether scale by lifetime.\n   */\n  get isScaleByLifetime(): boolean {\n    return this._isScaleByLifetime;\n  }\n\n  set isScaleByLifetime(value: boolean) {\n    if (value) {\n      this.shaderData.enableMacro(\"isScaleByLifetime\");\n    } else {\n      this.shaderData.disableMacro(\"isScaleByLifetime\");\n    }\n\n    this._isScaleByLifetime = value;\n  }\n\n  /**\n   * Whether 2D rendering.\n   */\n  get is2d(): boolean {\n    return this._is2d;\n  }\n\n  set is2d(value: boolean) {\n    if (value) {\n      this.shaderData.enableMacro(\"is2d\");\n    } else {\n      this.shaderData.disableMacro(\"is2d\");\n      this.material.renderState.rasterState.cullMode = CullMode.Off;\n    }\n\n    this._is2d = value;\n  }\n\n  /**\n   * Whether fade in.\n   */\n  get isFadeIn(): boolean {\n    return this._isFadeIn;\n  }\n\n  set isFadeIn(value: boolean) {\n    if (value) {\n      this.shaderData.enableMacro(\"fadeIn\");\n    } else {\n      this.shaderData.disableMacro(\"fadeIn\");\n    }\n\n    this._isFadeIn = value;\n  }\n\n  /**\n   * Whether fade out.\n   */\n  get isFadeOut(): boolean {\n    return this._isFadeOut;\n  }\n\n  set isFadeOut(value: boolean) {\n    if (value) {\n      this.shaderData.enableMacro(\"fadeOut\");\n    } else {\n      this.shaderData.disableMacro(\"fadeOut\");\n    }\n\n    this._isFadeOut = value;\n  }\n\n  /**\n   * Whether play on enable.\n   */\n  get playOnEnable(): boolean {\n    return this._playOnEnable;\n  }\n\n  set playOnEnable(value: boolean) {\n    this._playOnEnable = value;\n\n    if (value) {\n      this.start();\n    }\n    else {\n      this.stop();\n    }\n  }\n\n  /**\n   * Blend mode of the particle renderer's material.\n   */\n  get blendMode(): ParticleRendererBlendMode {\n    return this._blendMode;\n  }\n\n  set blendMode(value: ParticleRendererBlendMode) {\n    const blendState = this.material.renderState.blendState;\n    const target = blendState.targetBlendState;\n\n    if (value === ParticleRendererBlendMode.Transparent) {\n      target.sourceColorBlendFactor = target.sourceAlphaBlendFactor = BlendFactor.SourceAlpha;\n      target.destinationColorBlendFactor = target.destinationAlphaBlendFactor = BlendFactor.OneMinusSourceAlpha;\n    }\n    else if (value === ParticleRendererBlendMode.Additive) {\n      target.sourceColorBlendFactor = target.sourceAlphaBlendFactor = BlendFactor.SourceAlpha;\n      target.destinationColorBlendFactor = target.destinationAlphaBlendFactor = BlendFactor.One;\n    }\n\n    this._blendMode = value;\n  }\n\n  constructor(props) {\n    super(props);\n\n    this._material = this._createMaterial();\n  }\n\n  /**\n   * @override\n   * @internal\n   */\n  update(deltaTime: number): void {\n    if (!this._isInit || !this._isStart) {\n      return;\n    }\n\n    if (this._updateDirtyFlag) {\n      this._updateBuffer();\n      this._updateDirtyFlag = 0;\n    }\n\n    this._time += deltaTime / 1000;\n    this.shaderData.setFloat(\"u_time\", this._time);\n  }\n\n  /**\n   * @override\n   * @internal\n   */\n  _onEnable(): void {\n    super._onEnable();\n\n    if (this._playOnEnable) {\n      this.start();\n    }\n  }\n\n  /**\n   * Start emitting.\n   */\n  start(): void {\n    this._isStart = true;\n    this._time = 0;\n    this.shaderData.setInt(\"u_active\", 1);\n  }\n\n  /**\n   * Stop emitting.\n   */\n  stop(): void {\n    this.shaderData.setInt(\"u_active\", 0);\n  }\n\n  private _createMaterial(): Material {\n    const material = new Material(this.engine, Shader.find(\"particle-shader\"));\n    const { renderState } = material;\n    const target = renderState.blendState.targetBlendState;\n\n    target.sourceColorBlendFactor = target.sourceAlphaBlendFactor = BlendFactor.SourceAlpha;\n    target.destinationColorBlendFactor = target.destinationAlphaBlendFactor = BlendFactor.OneMinusSourceAlpha;\n\n    renderState.depthState.writeEnabled = false;\n\n    material.renderQueueType = RenderQueueType.Transparent;\n\n    this.isUseOriginColor = true;\n    this.is2d = true;\n    this.isFadeOut = true;\n\n    return material;\n  }\n\n  private _createGeometry(): BufferGeometry {\n    const geometry = new BufferGeometry(this._entity.engine, \"particleGeometry\");\n    const vertexStride = 96;\n    const vertexFloatCount = this._maxCount * 4 * vertexStride;\n    const vertices = new Float32Array(vertexFloatCount);\n    const indices = new Uint16Array(6 * this._maxCount);\n\n    for (let i = 0, idx = 0; i < this._maxCount; ++i) {\n      let startIndex = i * 4;\n      indices[idx++] = startIndex + 0;\n      indices[idx++] = startIndex + 1;\n      indices[idx++] = startIndex + 2;\n      indices[idx++] = startIndex + 0;\n      indices[idx++] = startIndex + 2;\n      indices[idx++] = startIndex + 3;\n    }\n\n    const vertexElements = [\n      new VertexElement(\"a_position\", 0, VertexElementFormat.Vector3, 0),\n      new VertexElement(\"a_velocity\", 12, VertexElementFormat.Vector3, 0),\n      new VertexElement(\"a_acceleration\", 24, VertexElementFormat.Vector3, 0),\n      new VertexElement(\"a_color\", 36, VertexElementFormat.Vector4, 0),\n      new VertexElement(\"a_lifeAndSize\", 52, VertexElementFormat.Vector4, 0),\n      new VertexElement(\"a_rotation\", 68, VertexElementFormat.Vector2, 0),\n      new VertexElement(\"a_uv\", 76, VertexElementFormat.Vector3, 0),\n      new VertexElement(\"a_normalizedUv\", 88, VertexElementFormat.Vector2, 0)\n    ];\n\n    const vertexBuffer = new Buffer(\n      this.engine,\n      BufferBindFlag.VertexBuffer,\n      vertexFloatCount * 4,\n      BufferUsage.Dynamic\n    );\n\n    const indexBuffer = new Buffer(this.engine, BufferBindFlag.IndexBuffer, indices, BufferUsage.Dynamic);\n\n    geometry.setVertexBufferBinding(vertexBuffer, vertexStride);\n    geometry.setIndexBufferBinding(indexBuffer, IndexFormat.UInt16);\n    geometry.setVertexElements(vertexElements);\n    geometry.addSubGeometry(0, indices.length);\n\n    this._vertexBuffer = vertexBuffer;\n    this._vertexStride = vertexStride / 4;\n    this._vertices = vertices;\n    return geometry;\n  }\n\n  private _updateBuffer(): void {\n    for (let x = 0; x < this._maxCount; x++) {\n      this._updateSingleBuffer(x);\n    }\n\n    this._vertexBuffer.setData(this._vertices);\n  }\n\n  private _updateSingleBuffer(i: number): void {\n    const { _updateDirtyFlag, _vertices: vertices, _vertexStride: vertexStride } = this;\n    const { _getRandom: getRandom } = ParticleRenderer;\n    const offset = i * 4;\n\n    const k0 = offset * vertexStride;\n    const k1 = (offset + 1) * vertexStride;\n    const k2 = (offset + 2) * vertexStride;\n    const k3 = (offset + 3) * vertexStride;\n\n    if (_updateDirtyFlag & DirtyFlagType.Position) {\n      let { x, y, z } = this._position;\n      const { _positionArray, _positionRandomness } = this;\n\n      if (_positionArray) {\n        if (_positionArray.length !== this._maxCount) {\n          throw Error(\"The length of positionArray must be equal to maxCount.\");\n        }\n        const pos = _positionArray[i];\n\n        x += pos.x;\n        y += pos.y;\n        z += pos.z;\n      } else {\n        x += getRandom() * _positionRandomness.x;\n        y += getRandom() * _positionRandomness.y;\n        z += getRandom() * _positionRandomness.z;\n      }\n\n      vertices[k0] = vertices[k1] = vertices[k2] = vertices[k3] = x;\n      vertices[k0 + 1] = vertices[k1 + 1] = vertices[k2 + 1] = vertices[k3 + 1] = y;\n      vertices[k0 + 2] = vertices[k1 + 2] = vertices[k2 + 2] = vertices[k3 + 2] = z;\n    }\n\n    if (_updateDirtyFlag & DirtyFlagType.Velocity) {\n      const { _velocity, _velocityRandomness } = this;\n\n      vertices[k0 + 3] = vertices[k1 + 3] = vertices[k2 + 3] = vertices[k3 + 3] =\n        _velocity.x + getRandom() * _velocityRandomness.x;\n      vertices[k0 + 4] = vertices[k1 + 4] = vertices[k2 + 4] = vertices[k3 + 4] =\n        _velocity.y + getRandom() * _velocityRandomness.y;\n      vertices[k0 + 5] = vertices[k1 + 5] = vertices[k2 + 5] = vertices[k3 + 5] =\n        _velocity.z + getRandom() * _velocityRandomness.z;\n    }\n\n    if (_updateDirtyFlag & DirtyFlagType.Acceleration) {\n      const { _acceleration, _accelerationRandomness } = this;\n\n      vertices[k0 + 6] = vertices[k1 + 6] = vertices[k2 + 6] = vertices[k3 + 6] =\n        _acceleration.x + getRandom() * _accelerationRandomness.x;\n      vertices[k0 + 7] = vertices[k1 + 7] = vertices[k2 + 7] = vertices[k3 + 7] =\n        _acceleration.y + getRandom() * _accelerationRandomness.y;\n      vertices[k0 + 8] = vertices[k1 + 8] = vertices[k2 + 8] = vertices[k3 + 8] =\n        _acceleration.z + getRandom() * _accelerationRandomness.z;\n    }\n\n    if (_updateDirtyFlag & DirtyFlagType.Color) {\n      const { _color, _colorRandomness } = this;\n\n      vertices[k0 + 9] = vertices[k1 + 9] = vertices[k2 + 9] = vertices[k3 + 9] = MathUtil.clamp(\n        _color.r + getRandom() * _colorRandomness,\n        0,\n        1\n      );\n\n      vertices[k0 + 10] = vertices[k1 + 10] = vertices[k2 + 10] = vertices[k3 + 10] = MathUtil.clamp(\n        _color.g + getRandom() * _colorRandomness,\n        0,\n        1\n      );\n      vertices[k0 + 11] = vertices[k1 + 11] = vertices[k2 + 11] = vertices[k3 + 11] = MathUtil.clamp(\n        _color.b + getRandom() * _colorRandomness,\n        0,\n        1\n      );\n    }\n\n    if (_updateDirtyFlag & DirtyFlagType.Apha) {\n      vertices[k0 + 12] = vertices[k1 + 12] = vertices[k2 + 12] = vertices[k3 + 12] = MathUtil.clamp(\n        this._alpha + getRandom() * this._alphaRandomness,\n        0,\n        1\n      );\n    }\n\n    if (_updateDirtyFlag & DirtyFlagType.StartTime) {\n      vertices[k0 + 13] = vertices[k1 + 13] = vertices[k2 + 13] = vertices[k3 + 13] =\n        Math.random() * this._startTimeRandomness;\n    }\n\n    if (_updateDirtyFlag & DirtyFlagType.LifeTime) {\n      const { _lifetime } = this;\n\n      vertices[k0 + 14] = vertices[k1 + 14] = vertices[k2 + 14] = vertices[k3 + 14] =\n        _lifetime + getRandom() * _lifetime;\n    }\n\n    if (_updateDirtyFlag & DirtyFlagType.Size) {\n      const { _size } = this;\n\n      vertices[k0 + 15] = vertices[k1 + 15] = vertices[k2 + 15] = vertices[k3 + 15] = Math.max(\n        _size + getRandom() * this._sizeRandomness * _size * 2,\n        0\n      );\n    }\n\n    if (_updateDirtyFlag & DirtyFlagType.Scale) {\n      vertices[k0 + 16] = vertices[k1 + 16] = vertices[k2 + 16] = vertices[k3 + 16] = this._scale;\n    }\n\n    if (_updateDirtyFlag & DirtyFlagType.StartAngle) {\n      vertices[k0 + 17] = vertices[k1 + 17] = vertices[k2 + 17] = vertices[k3 + 17] =\n        this._startAngle + getRandom() * Math.PI * this._startAngleRandomness * 2;\n    }\n\n    if (_updateDirtyFlag & DirtyFlagType.RotateVelocity) {\n      vertices[k0 + 18] = vertices[k1 + 18] = vertices[k2 + 18] = vertices[k3 + 18] =\n        this._rotateVelocity + getRandom() * this._rotateVelocityRandomness;\n    }\n\n    this._updateSingleUv(i, k0, k1, k2, k3);\n  }\n\n  private _updateSingleUv(i: number, k0: number, k1: number, k2: number, k3: number): void {\n    const { spriteSheet } = this;\n    const texture = this._material.shaderData.getTexture(\"u_texture\");\n    const vertices = this._vertices;\n\n    if (texture) {\n      const width = texture.width;\n      const height = texture.height;\n\n      if (spriteSheet) {\n        const { x, y, w, h } = spriteSheet[i % spriteSheet.length];\n\n        const u = x / width;\n        const v = y / height;\n        const p = u + w / width;\n        const q = v + h / height;\n        const ratio = h / w;\n\n        // left bottom\n        vertices[k0 + 19] = u;\n        vertices[k0 + 20] = q;\n        vertices[k0 + 21] = ratio;\n\n        // right bottom\n        vertices[k1 + 19] = p;\n        vertices[k1 + 20] = q;\n        vertices[k1 + 21] = ratio;\n\n        // right top\n        vertices[k2 + 19] = p;\n        vertices[k2 + 20] = v;\n        vertices[k2 + 21] = ratio;\n\n        // left top\n        vertices[k3 + 19] = u;\n        vertices[k3 + 20] = v;\n        vertices[k3 + 21] = ratio;\n      } else {\n        const ratio = height / width;\n\n        // left bottom\n        vertices[k0 + 19] = 0;\n        vertices[k0 + 20] = 1;\n        vertices[k0 + 21] = ratio;\n\n        // right bottom\n        vertices[k1 + 19] = 1;\n        vertices[k1 + 20] = 1;\n        vertices[k1 + 21] = ratio;\n\n        // right top\n        vertices[k2 + 19] = 1;\n        vertices[k2 + 20] = 0;\n        vertices[k2 + 21] = ratio;\n\n        // left top\n        vertices[k3 + 19] = 0;\n        vertices[k3 + 20] = 0;\n        vertices[k3 + 21] = ratio;\n      }\n    } else {\n      // left bottom\n      vertices[k0 + 19] = 0;\n      vertices[k0 + 20] = 0;\n      vertices[k0 + 21] = 1;\n\n      // right bottom\n      vertices[k1 + 19] = 1;\n      vertices[k1 + 20] = 0;\n      vertices[k1 + 21] = 1;\n\n      // right top\n      vertices[k2 + 19] = 1;\n      vertices[k2 + 20] = 1;\n      vertices[k2 + 21] = 1;\n\n      // left top\n      vertices[k3 + 19] = 0;\n      vertices[k3 + 20] = 1;\n      vertices[k3 + 21] = 1;\n    }\n\n    vertices[k0 + 22] = -0.5;\n    vertices[k0 + 23] = -0.5;\n    vertices[k1 + 22] = 0.5;\n    vertices[k1 + 23] = -0.5;\n    vertices[k2 + 22] = 0.5;\n    vertices[k2 + 23] = 0.5;\n    vertices[k3 + 22] = -0.5;\n    vertices[k3 + 23] = 0.5;\n  }\n}\n","import { Engine } from \"../Engine\";\nimport { Material } from \"../material/Material\";\nimport { BlendFactor, Shader } from \"../shader\";\nimport FRAG_SHADER from \"./trail.fs.glsl\";\nimport VERT_SHADER from \"./trail.vs.glsl\";\n\nShader.create(\"trail\", VERT_SHADER, FRAG_SHADER);\n\nexport class TrailMaterial extends Material {\n  constructor(engine: Engine) {\n    super(engine, Shader.find(\"trail\"));\n\n    const target = this.renderState.blendState.targetBlendState;\n    target.sourceColorBlendFactor = target.sourceAlphaBlendFactor = BlendFactor.SourceAlpha;\n    target.destinationColorBlendFactor = target.destinationAlphaBlendFactor = BlendFactor.One;\n\n    this.renderState.depthState.writeEnabled = false;\n  }\n}\n","import { Matrix, Quaternion, Vector3 } from \"@oasis-engine/math\";\nimport { Camera } from \"../Camera\";\nimport { Entity } from \"../Entity\";\nimport { BufferGeometry, GeometryRenderer } from \"../geometry\";\nimport { Buffer } from \"../graphic/Buffer\";\nimport { BufferUsage } from \"../graphic/enums/BufferUsage\";\nimport { PrimitiveTopology } from \"../graphic/enums/PrimitiveTopology\";\nimport { VertexElementFormat } from \"../graphic/enums/VertexElementFormat\";\nimport { VertexElement } from \"../graphic/VertexElement\";\nimport { Texture2D } from \"../texture\";\nimport { TrailMaterial } from \"./TrailMaterial\";\n\nconst _tempVector3 = new Vector3();\n\n/**\n * @deprecated\n */\nexport class TrailRenderer extends GeometryRenderer {\n  private _vertexStride: number;\n  private _vertices: Float32Array;\n  private _vertexBuffer: Buffer;\n  private _stroke;\n  private _minSeg;\n  private _lifetime;\n  private _maxPointNum;\n  private _points: Array<Vector3>;\n  private _pointStates: Array<number>;\n  private _strapPoints: Array<Vector3>;\n  private _curPointNum;\n  private _prePointsNum;\n  /**\n   * @deprecated\n   */\n  constructor(entity: Entity, props: any) {\n    super(entity);\n\n    this._stroke = props.stroke || 0.2;\n    this._minSeg = props.minSeg || 0.02;\n    this._lifetime = props.lifetime || 1000;\n    this._maxPointNum = (this._lifetime / 1000.0) * entity.engine.targetFrameRate;\n\n    this._points = [];\n    this._pointStates = [];\n    this._strapPoints = [];\n    for (let i = 0; i < this._maxPointNum; i++) {\n      this._points.push(new Vector3());\n      this._pointStates.push(this._lifetime);\n\n      this._strapPoints.push(new Vector3());\n      this._strapPoints.push(new Vector3());\n    }\n    this._curPointNum = 0;\n\n    const mtl = props.material || new TrailMaterial(this.engine);\n    this.material = mtl;\n\n    this.setTexture(props.texture);\n    this._initGeometry();\n  }\n\n  /**\n   * @internal\n   */\n  update(deltaTime: number) {\n    let mov = 0,\n      newIdx = 0;\n    for (let i = 0; i < this._curPointNum; i++) {\n      this._pointStates[i] -= deltaTime;\n      if (this._pointStates[i] < 0) {\n        mov++;\n      } else if (mov > 0) {\n        newIdx = i - mov;\n\n        // Move data\n        this._pointStates[newIdx] = this._pointStates[i];\n\n        // Move point\n        this._points[i].cloneTo(this._points[newIdx]);\n      }\n    }\n    this._curPointNum -= mov;\n\n    let appendNewPoint = true;\n    if (this._curPointNum === this._maxPointNum) {\n      appendNewPoint = false;\n    } else if (this._curPointNum > 0) {\n      const lastPoint = this._points[this._points.length - 1];\n      if (Vector3.distance(this.entity.worldPosition, lastPoint) < this._minSeg) {\n        appendNewPoint = false;\n      } else {\n        // debugger\n      }\n    }\n\n    if (appendNewPoint) {\n      this._pointStates[this._curPointNum] = this._lifetime;\n      this.entity.worldPosition.cloneTo(this._points[this._curPointNum]);\n\n      this._curPointNum++;\n    }\n  }\n\n  /**\n   * @internal\n   */\n  render(camera: Camera) {\n    this._updateStrapVertices(camera, this._points);\n    this._updateStrapCoords();\n    this._vertexBuffer.setData(this._vertices);\n\n    super.render(camera);\n  }\n\n  /**\n   * @deprecated\n   * Set trail texture.\n   * @param texture\n   */\n  setTexture(texture: Texture2D) {\n    if (texture) {\n      this.material.shaderData.setTexture(\"u_texture\", texture);\n    }\n  }\n\n  private _initGeometry() {\n    const geometry = new BufferGeometry(this._entity.engine);\n\n    const vertexStride = 20;\n    const vertexCount = this._maxPointNum * 2;\n    const vertexFloatCount = vertexCount * vertexStride;\n    const vertices = new Float32Array(vertexFloatCount);\n    const vertexElements = [\n      new VertexElement(\"POSITION\", 0, VertexElementFormat.Vector3, 0),\n      new VertexElement(\"TEXCOORD_0\", 12, VertexElementFormat.Vector2, 0)\n    ];\n    const vertexBuffer = new Buffer(this.engine, vertexFloatCount * 4, BufferUsage.Dynamic);\n\n    geometry.setVertexBufferBinding(vertexBuffer, vertexStride);\n    geometry.setVertexElements(vertexElements);\n    geometry.addSubGeometry(0, vertexCount, PrimitiveTopology.TriangleStrip);\n\n    this._vertexBuffer = vertexBuffer;\n    this._vertexStride = vertexStride;\n    this._vertices = vertices;\n    this.geometry = geometry;\n  }\n\n  private _updateStrapVertices(camera, points: Array<Vector3>) {\n    const m: Matrix = camera.viewMatrix;\n    const e = m.elements;\n    const vx = new Vector3(e[0], e[4], e[8]);\n    const vy = new Vector3(e[1], e[5], e[9]);\n    const vz = new Vector3(e[2], e[6], e[10]);\n    const s = this._stroke;\n\n    vy.scale(s);\n\n    const up = new Vector3();\n    const down = new Vector3();\n\n    const rotation = new Quaternion();\n\n    Vector3.transformByQuat(vx, rotation, vx);\n    Vector3.transformByQuat(vy, rotation, vy);\n\n    const dy = new Vector3();\n    const cross = new Vector3();\n    const perpVector = new Vector3();\n\n    vx.normalize();\n\n    const vertieces = this._vertices;\n    //-- quad pos\n    for (let i = 0; i < this._maxPointNum; i++) {\n      //-- center pos\n      if (i < this._curPointNum) {\n        const p = points[i];\n\n        if (i === this._curPointNum - 1 && i !== 0) {\n          Vector3.subtract(p, points[i - 1], perpVector);\n        } else {\n          Vector3.subtract(points[i + 1], p, perpVector);\n        }\n\n        this._projectOnPlane(perpVector, vz, perpVector);\n        perpVector.normalize();\n\n        // Calculate angle between vectors\n        let angle = Math.acos(Vector3.dot(vx, perpVector));\n        Vector3.cross(vx, perpVector, cross);\n        if (Vector3.dot(cross, vz) <= 0) {\n          angle = Math.PI * 2 - angle;\n        }\n        Quaternion.rotationAxisAngle(vz, angle, rotation);\n        Vector3.transformByQuat(vy, rotation, dy);\n\n        Vector3.add(p, dy, up);\n        Vector3.subtract(p, dy, down);\n      }\n\n      const p0 = (i * 2 * this._vertexStride) / 4;\n      const p1 = ((i * 2 + 1) * this._vertexStride) / 4;\n      vertieces[p0] = up.x;\n      vertieces[p0 + 1] = up.y;\n      vertieces[p0 + 2] = up.z;\n\n      vertieces[p1] = down.x;\n      vertieces[p1 + 1] = down.y;\n      vertieces[p1 + 2] = down.z;\n    }\n  }\n\n  private _updateStrapCoords() {\n    if (this._prePointsNum === this._curPointNum) {\n      return;\n    }\n\n    this._prePointsNum = this._curPointNum;\n\n    const count = this._curPointNum;\n    const texDelta = 1.0 / count;\n    const vertieces = this._vertices;\n    for (let i = 0; i < count; i++) {\n      const d = 1.0 - i * texDelta;\n      const p0 = (i * 2 * this._vertexStride) / 4;\n      const p1 = ((i * 2 + 1) * this._vertexStride) / 4;\n\n      vertieces[p0] = 0;\n      vertieces[p0 + 1] = d;\n\n      vertieces[p1] = 1.0;\n      vertieces[p1 + 1] = d;\n    }\n  }\n\n  private _projectOnVector(a: Vector3, p: Vector3, out: Vector3): void {\n    const n_p = p.clone();\n    Vector3.normalize(n_p, n_p);\n    const cosine = Vector3.dot(a, n_p);\n    out.x = n_p.x * cosine;\n    out.y = n_p.y * cosine;\n    out.z = n_p.z * cosine;\n  }\n\n  private _projectOnPlane(a: Vector3, n: Vector3, out: Vector3) {\n    this._projectOnVector(a, n, _tempVector3);\n    Vector3.subtract(a, _tempVector3, out);\n  }\n}\n","import { Vector3 } from \"@oasis-engine/math\";\nimport { Entity } from \"../Entity\";\nimport { ABoxCollider } from \"./ABoxCollider\";\n\nexport class BoxCollider extends ABoxCollider {\n  private _center: Vector3 = new Vector3();\n  private _size: Vector3 = new Vector3();\n  private isShowCollider: boolean = true;\n\n  get center(): Vector3 {\n    return this._center;\n  }\n\n  set center(value: Vector3) {\n    this._center = value;\n    this.setBoxCenterSize(this._center, this._size);\n  }\n\n  get size(): Vector3 {\n    return this._size;\n  }\n\n  set size(value: Vector3) {\n    this._size = value;\n    this.setBoxCenterSize(this._center, this._size);\n  }\n\n  constructor(entity: Entity) {\n    super(entity);\n    this.center = this.center;\n    this.size = this.size;\n    this.isShowCollider = this.isShowCollider;\n  }\n}\n","import { Vector3 } from \"@oasis-engine/math\";\nimport { Entity } from \"../Entity\";\nimport { ASphereCollider } from \"./ASphereCollider\";\n\nexport class SphereCollider extends ASphereCollider {\n  private __center: Vector3 = new Vector3();\n  private __radius: number = 1.0;\n  private isShowCollider: boolean = true;\n\n  get _center(): Vector3 {\n    return this.__center;\n  }\n\n  set _center(value: Vector3) {\n    this.__center = value;\n    this.setSphere(this.__center, this.__radius);\n  }\n\n  get _radius() {\n    return this.__radius;\n  }\n\n  set _radius(value: number) {\n    this.__radius = value;\n    this.setSphere(this.__center, this.__radius);\n  }\n\n  constructor(entity: Entity) {\n    super(entity);\n\n    this._center = this._center;\n    this._radius = this._radius;\n    this.isShowCollider = this.isShowCollider;\n  }\n}\n","import { ColliderFeature } from \"./ColliderFeature\";\nimport { Scene } from \"../Scene\";\nScene.registerFeature(ColliderFeature);\n\n//-- colliders\nexport { ColliderFeature };\nexport { Collider as ACollider } from \"./Collider\";\nexport { ABoxCollider } from \"./ABoxCollider\";\nexport { PlaneCollider } from \"./PlaneCollider\";\nexport { ASphereCollider } from \"./ASphereCollider\";\nexport { BoxCollider } from \"./BoxCollider\";\nexport { SphereCollider } from \"./SphereCollider\";\n","import { Vector3 } from \"@oasis-engine/math\";\n\n/**\n * AABBox = {\n *  min: [-1,-1,-1],\n *  max: [1,1,1]\n * };\n *\n * Sphere = {\n *  center: [0,0,0],\n *  radius: 1\n * };\n */\n\n/**\n * Check whether the boxes intersect.\n * @param boxA - The first box to check\n * @param boxB - The second box to check\n * @returns True if the boxes intersect, false otherwise\n */\nexport function intersectBox2Box(boxA, boxB) {\n  return (\n    boxA.min.x <= boxB.max.x &&\n    boxA.max.x >= boxB.min.x &&\n    boxA.min.y <= boxB.max.y &&\n    boxA.max.y >= boxB.min.y &&\n    boxA.min.z <= boxB.max.z &&\n    boxA.max.z >= boxB.min.z\n  );\n}\n\n/**\n * Check whether the spheres intersect.\n * @param sphereA - The first sphere to check\n * @param sphereB - The second sphere to check\n * @returns True if the spheres intersect, false otherwise\n */\nexport function intersectSphere2Sphere(sphereA, sphereB) {\n  const distance = Vector3.distance(sphereA.center, sphereB.center);\n  return distance < sphereA.radius + sphereA.radius;\n}\n\n/**\n * Check whether the sphere and the box intersect.\n * @param sphere - The sphere to check\n * @param box - The box to check\n * @returns True if the sphere and the box intersect, false otherwise\n */\nexport function intersectSphere2Box(sphere, box) {\n  const center: Vector3 = sphere.center;\n\n  const closestPoint: Vector3 = new Vector3(\n    Math.max(box.min.x, Math.min(center.x, box.max.x)),\n    Math.max(box.min.y, Math.min(center.y, box.max.y)),\n    Math.max(box.min.z, Math.min(center.z, box.max.z))\n  );\n\n  const distance = Vector3.distance(center, closestPoint);\n  return distance < sphere.radius;\n}\n","import { BoundingBox, Vector3 } from \"@oasis-engine/math\";\nimport { Event } from \"../base/Event\";\nimport { EventDispatcher } from \"../base/EventDispatcher\";\nimport { ACollider } from \"../collider\";\nimport { ABoxCollider } from \"../collider/ABoxCollider\";\nimport { ASphereCollider } from \"../collider/ASphereCollider\";\nimport { ColliderFeature } from \"../collider/ColliderFeature\";\nimport { Script } from \"../Script\";\nimport { intersectBox2Box, intersectSphere2Box, intersectSphere2Sphere } from \"./intersect\";\n\n/**\n * Detect collisions between the Collider on the current entity and other Colliders in the scene.\n */\nexport class CollisionDetection extends Script {\n  private static _tempVec3: Vector3 = new Vector3();\n  private static _tempBox1: BoundingBox = new BoundingBox();\n  private static _tempBox2: BoundingBox = new BoundingBox();\n\n  private _colliderManager;\n  private _myCollider;\n  private _overlopCollider;\n  private _sphere;\n  private _box: BoundingBox = new BoundingBox();\n\n  /**\n   * Constructor of the colliseion detection.\n   * @param entity - Entity to which the colliseion detection belong\n   */\n  constructor(entity) {\n    super(entity);\n  }\n\n  /**\n   * The collider that intersects with the collider on the current Entity.\n   */\n  get overlopCollider() {\n    return this._overlopCollider;\n  }\n\n  /**\n   * When every frame is updated, calculate the collision with other collider.\n   */\n  onUpdate(deltaTime) {\n    super.onUpdate(deltaTime);\n\n    let overlopCollider = null;\n\n    if (this._colliderManager && this._myCollider) {\n      const colliders = this._colliderManager.colliders;\n\n      if (this._myCollider instanceof ABoxCollider) {\n        this._updateWorldBox(this._myCollider, this._box);\n        for (let i = 0, len = colliders.length; i < len; i++) {\n          const collider = colliders[i];\n          if (collider != this._myCollider && this._boxCollision(collider)) {\n            overlopCollider = collider;\n            this.dispatch(\"collision\", { collider });\n          }\n        } // end of for\n      } else if (this._myCollider instanceof ASphereCollider) {\n        this._sphere = this._getWorldSphere(this._myCollider);\n        for (let i = 0, len = colliders.length; i < len; i++) {\n          const collider = colliders[i];\n          if (collider != this._myCollider && this._sphereCollision(collider)) {\n            overlopCollider = collider;\n            this.dispatch(\"collision\", { collider });\n          }\n        } // end of for\n      }\n    } // end of if\n\n    //-- overlop events\n    if (overlopCollider != null && this._overlopCollider != overlopCollider) {\n      this.dispatch(\"begin_overlop\", { collider: overlopCollider });\n    }\n\n    if (this._overlopCollider != null && this._overlopCollider != overlopCollider) {\n      const e = this._overlopCollider;\n      this.dispatch(\"end_overlop\", { collider: e });\n    }\n\n    this._overlopCollider = overlopCollider;\n  }\n\n  /**\n   * Calculate the boundingbox in world space from boxCollider.\n   * @param boxCollider - The boxCollider to calculate\n   * @param out - The caclulated boundingBox\n   */\n  _updateWorldBox(boxCollider, out: BoundingBox): void {\n    const mat = boxCollider.entity.transform.worldMatrix;\n    const source = CollisionDetection._tempBox1;\n    boxCollider.boxMax.cloneTo(source.max);\n    boxCollider.boxMin.cloneTo(source.min);\n    BoundingBox.transform(source, mat, out);\n  }\n\n  /**\n   * Get the sphere info of the given sphere collider in world space.\n   * @param sphereCollider - The given sphere collider\n   */\n  _getWorldSphere(sphereCollider) {\n    const center: Vector3 = new Vector3();\n    Vector3.transformCoordinate(sphereCollider.center, sphereCollider.entity.transform.worldMatrix, center);\n    return {\n      radius: sphereCollider.radius,\n      center\n    };\n  }\n\n  /**\n   * Collider and another collider do collision detection.\n   * @param other - The another collider to collision detection\n   */\n  _boxCollision(other) {\n    if (other instanceof ABoxCollider) {\n      const box = CollisionDetection._tempBox2;\n      this._updateWorldBox(other, box);\n      return intersectBox2Box(box, this._box);\n    } else if (other instanceof ASphereCollider) {\n      const sphere = this._getWorldSphere(other);\n      return intersectSphere2Box(sphere, this._box);\n    }\n    return false;\n  }\n\n  /**\n   * Collider and another collider do collision detection.\n   * @param other - The another collider to collision detection\n   */\n  _sphereCollision(other) {\n    if (other instanceof ABoxCollider) {\n      const box = CollisionDetection._tempBox2;\n      this._updateWorldBox(other, box);\n      return intersectSphere2Box(this._sphere, box);\n    } else if (other instanceof ASphereCollider) {\n      const sphere = this._getWorldSphere(other);\n      return intersectSphere2Sphere(sphere, this._sphere);\n    }\n    return false;\n  }\n\n  onAwake() {\n    this._colliderManager = this.scene.findFeature(ColliderFeature);\n    this._myCollider = this.entity.getComponent(ACollider);\n  }\n\n  //----------- EventDispatcher Interface ---------------;\n\n  // _evts: object;\n  // _evtCount: number;\n\n  /**\n   * Determine whether there is event monitoring.\n   * @param event - The event name\n   * @returns True if there is event monitoring, false otherwise\n   */\n  hasEvent: (event: string) => boolean;\n  /**\n   * Return all registered event names.\n   * @returns all registered event names\n   */\n  eventNames: () => string[];\n\n  /**\n   * Returns the number of listener functions with the specified event name.\n   * @param event - The event name\n   * @returns the number of listener functions with the specified event name\n   */\n  listenerCount: (event: string) => number;\n\n  /**\n   * Dispatch the event with the specified event name.\n   * @param event - The event name\n   * @param data - The data to dispatch\n   * @returns True if the dispatch is success, false otherwise\n   */\n  dispatch: (event: string, data?: any) => boolean;\n\n  /**\n   * Add a listener function.\n   * @param event - The event name\n   * @param fn - The function to add\n   * @returns This\n   */\n  on: (event: string, fn: Function) => EventDispatcher;\n\n  /**\n   * Add a listener function that just call once.\n   * @param event - The event name\n   * @param fn - The function to add\n   * @returns This\n   */\n  once: (event: string, fn: Function) => EventDispatcher;\n\n  /**\n   * @deprecated Replace with on/once.\n   */\n  addEventListener: (event: string, fn: Function, once?: boolean) => EventDispatcher;\n\n  off: (event: string, fn?: Function) => EventDispatcher;\n\n  /**\n   * @deprecated Replace with off.\n   */\n  removeEventListener: (event: string, fn?: Function) => EventDispatcher;\n\n  /**\n   * Remove all event listeners.\n   * @param event - The event name, delete all events if not passed\n   */\n  removeAllEventListeners: (event?: string) => void;\n\n  /**\n   * @deprecated Replace with dispatch.\n   */\n  trigger: (e: Event) => void;\n\n  _clearEvent: (event: string) => void;\n}\napplyMixins(CollisionDetection, [EventDispatcher]);\nfunction applyMixins(derivedCtor: any, baseCtors: any[]) {\n  baseCtors.forEach((baseCtor) => {\n    Object.getOwnPropertyNames(baseCtor.prototype).forEach((name) => {\n      derivedCtor.prototype[name] = baseCtor.prototype[name];\n    });\n  });\n}\n","import { Color } from \"@oasis-engine/math\";\nimport { Component } from \"../Component\";\nimport { Entity } from \"../Entity\";\nimport { Shader } from \"../shader/Shader\";\n\n/**\n * Fog.\n */\nexport class Fog extends Component {\n  protected static _colorProperty = Shader.getPropertyByName(\"u_fogColor\");\n\n  /**\n   * Fog color.\n   */\n  get color(): Color {\n    return this._color;\n  }\n\n  set color(value: Color) {\n    this._color = value;\n    this.scene.shaderData.setColor(Fog._colorProperty, value);\n  }\n\n  private _color: Color = new Color(1, 0, 0, 1);\n\n  constructor(entity: Entity) {\n    super(entity);\n    this.color = this._color;\n  }\n\n  /**\n   * @internal\n   * @override\n   */\n  _onEnable() {\n    this.scene.shaderData.enableMacro(\"O3_HAS_FOG\");\n  }\n\n  /**\n   * @internal\n   * @override\n   */\n  _onDisable() {\n    this.scene.shaderData.disableMacro(\"O3_HAS_FOG\");\n  }\n}\n","import { Entity } from \"../Entity\";\nimport { Shader } from \"../shader\";\nimport { Fog } from \"./Fog\";\n\n/**\n * Exponential fog.\n */\nexport class EXP2Fog extends Fog {\n  private static _densityProperty = Shader.getPropertyByName(\"u_fogDensity\");\n\n  /**\n   * Density of fog.\n   */\n  get density(): number {\n    return this._density;\n  }\n\n  set density(value: number) {\n    this._density = value;\n    this.scene.shaderData.setFloat(EXP2Fog._densityProperty, value);\n  }\n\n  private _density: number = 0.0025;\n\n  constructor(entity: Entity) {\n    super(entity);\n    this.density = this._density;\n  }\n  /**\n   * @internal\n   * @override\n   */\n  _onEnable() {\n    this.scene.shaderData.enableMacro(\"O3_FOG_EXP2\");\n  }\n\n  /**\n   * @internal\n   * @override\n   */\n  _onDisable() {\n    this.scene.shaderData.disableMacro(\"O3_FOG_EXP2\");\n  }\n}\n","import { Entity } from \"../Entity\";\nimport { Shader } from \"../shader\";\nimport { Fog } from \"./Fog\";\n\n/**\n * Linear fog, according to the distance of the camera linear difference fog density.\n */\nexport class LinearFog extends Fog {\n  private static _nearProperty = Shader.getPropertyByName(\"u_fogNear\");\n  private static _farProperty = Shader.getPropertyByName(\"u_fogFar\");\n\n  /**\n   * Start of fog.\n   */\n  get near(): number {\n    return this._near;\n  }\n\n  set near(value: number) {\n    this._near = value;\n    this.scene.shaderData.setFloat(LinearFog._nearProperty, value);\n  }\n\n  /**\n   * End of fog.\n   */\n  get far(): number {\n    return this._far;\n  }\n\n  set far(value: number) {\n    this._far = value;\n    this.scene.shaderData.setFloat(LinearFog._farProperty, value);\n  }\n\n  private _near: number = 1;\n  private _far: number = 1000;\n\n  constructor(entity: Entity) {\n    super(entity);\n    this.near = this._near;\n    this.far = this._far;\n  }\n}\n","import { Camera } from \"../Camera\";\nimport { Layer } from \"../Layer\";\nimport { Script } from \"../Script\";\nimport { RenderBufferDepthFormat } from \"../texture/enums/RenderBufferDepthFormat\";\nimport { RenderColorTexture } from \"../texture/RenderColorTexture\";\nimport { RenderTarget } from \"../texture/RenderTarget\";\n\n/**\n * Environmental probes, providing necessary capabilities such as reflection and refraction.\n * @example\n * ```ts\n * const probe = cameraEntity.addComponent( CubeProbe )\n * probe.onTextureChange = cubeTexture => {\n *   envLight.specularTexture = cubeTexture;\n *   skybox.specularTexture = cubeTexture;\n * }\n * ```\n */\nexport abstract class Probe extends Script {\n  /**\n   * Probe's layer, render everything by default.\n   */\n  probeLayer: Layer = Layer.Everything;\n\n  /**\n   * The width of the probe rendering target.\n   */\n  width: number = 1024;\n\n  /**\n   * The height of the probe rendering target.\n   */\n  height: number = 1024;\n\n  /**\n   * When using WebGL2, you can turn on MSAA at the hardware layer.\n   */\n  antiAliasing: number = 1;\n\n  /**\n   * Whether the probe is rendered to the cube color texture.\n   */\n  protected readonly _isCube: boolean = false;\n\n  private _oriCameraRenderTarget: RenderTarget;\n  private _renderTarget: RenderTarget;\n  private _renderTargetSwap: RenderTarget;\n  private _activeRenderTarget: RenderTarget;\n  private _camera: Camera;\n  private _oriCameraCullingMask: Layer;\n\n  private get _texture(): RenderColorTexture {\n    return this._activeRenderTarget?.getColorTexture();\n  }\n\n  /**\n   * Provide hooks for users to exchange Texture.\n   * @remarks Prevent issue: Feedback Loops Between Textures and the Framebuffer.\n   */\n  onTextureChange(renderColorTexture: RenderColorTexture) {}\n\n  /**\n   * @override\n   */\n  onBeginRender(camera: Camera): void {\n    if (!this.enabled) return;\n    this._camera = camera;\n    this._oriCameraCullingMask = camera.cullingMask;\n    camera.cullingMask = this.probeLayer;\n    if (\n      !this._activeRenderTarget ||\n      this._activeRenderTarget.width !== this.width ||\n      this._activeRenderTarget.height !== this.height ||\n      this._activeRenderTarget.antiAliasing !== this.antiAliasing\n    ) {\n      this._renderTarget = new RenderTarget(\n        this.engine,\n        this.width,\n        this.height,\n        new RenderColorTexture(this.engine, this.width, this.height, undefined, undefined, this._isCube),\n        RenderBufferDepthFormat.Depth,\n        this.antiAliasing\n      );\n\n      this._renderTargetSwap = new RenderTarget(\n        this.engine,\n        this.width,\n        this.height,\n        new RenderColorTexture(this.engine, this.width, this.height, undefined, undefined, this._isCube),\n        RenderBufferDepthFormat.Depth,\n        this.antiAliasing\n      );\n\n      this._activeRenderTarget = this._renderTarget;\n    }\n\n    this._oriCameraRenderTarget = camera.renderTarget;\n    camera.renderTarget = this._activeRenderTarget;\n  }\n\n  /**\n   * @override\n   */\n  onEndRender(camera: Camera): void {\n    if (!this.enabled) return;\n\n    this.onTextureChange && this.onTextureChange(this._texture);\n\n    this._activeRenderTarget =\n      this._activeRenderTarget === this._renderTarget ? this._renderTargetSwap : this._renderTarget;\n  }\n\n  protected _reset(): void {\n    if (!this.enabled) return;\n    this._camera.renderTarget = this._oriCameraRenderTarget;\n    this._camera.cullingMask = this._oriCameraCullingMask;\n  }\n}\n","import { Matrix, Vector3 } from \"@oasis-engine/math\";\nimport { Camera } from \"../Camera\";\nimport { TextureCubeFace } from \"../texture\";\nimport { Probe } from \"./Probe\";\n\nconst cacheTarget: Vector3 = new Vector3();\nconst cacheUp: Vector3 = new Vector3();\nconst cacheDir: Vector3 = new Vector3();\n\n/**\n * Cube probe, generate cubeTexture, used for dynamic environment reflection and other effects.\n */\nexport class CubeProbe extends Probe {\n  /**\n   * The position of the probe can be set, the default is the origin [0,0,0].\n   */\n  position: Vector3 = new Vector3(0, 0, 0);\n\n  /**\n   * @override\n   */\n  protected readonly _isCube: boolean = true;\n\n  private oriViewMatrix = new Matrix();\n  private _oriFieldOfView: number;\n\n  /**\n   * @override\n   */\n  onBeginRender(camera: Camera): void {\n    if (!this.enabled) return;\n    super.onBeginRender(camera);\n    this._storeCamera(camera);\n\n    // Render 6 faces\n    for (let faceIndex = 0; faceIndex < 6; faceIndex++) {\n      // Change camera parameters\n      this._setCamera(faceIndex, camera);\n      camera.render(TextureCubeFace.PositiveX + faceIndex);\n    }\n\n    this._restoreCamera(camera);\n    super._reset();\n  }\n\n  /**\n   * Store original camera parameters.\n   */\n  private _storeCamera(camera: Camera) {\n    camera.viewMatrix.cloneTo(this.oriViewMatrix);\n    this._oriFieldOfView = camera.fieldOfView;\n  }\n\n  /**\n   * Restore camera parameters.\n   */\n  private _restoreCamera(camera: Camera) {\n    this.oriViewMatrix.cloneTo(camera.viewMatrix);\n    camera.fieldOfView = this._oriFieldOfView;\n  }\n\n  /**\n   * Set camera parameters according to the rendering surface.\n   */\n  private _setCamera(faceIndex: number, camera: Camera) {\n    switch (faceIndex) {\n      // positive_x\n      case 0:\n        cacheUp.setValue(0, -1, 0);\n        cacheDir.setValue(1, 0, 0);\n        break;\n      // negative_x\n      case 1:\n        cacheUp.setValue(0, -1, 0);\n        cacheDir.setValue(-1, 0, 0);\n        break;\n      // positive_y\n      case 2:\n        cacheUp.setValue(0, 0, 1);\n        cacheDir.setValue(0, 1, 0);\n        break;\n      // negative_y\n      case 3:\n        cacheUp.setValue(0, 0, -1);\n        cacheDir.setValue(0, -1, 0);\n        break;\n      // positive_z\n      case 4:\n        cacheUp.setValue(0, -1, 0);\n        cacheDir.setValue(0, 0, 1);\n        break;\n      // negative_z\n      case 5:\n        cacheUp.setValue(0, -1, 0);\n        cacheDir.setValue(0, 0, -1);\n        break;\n    }\n\n    Vector3.add(this.position, cacheDir, cacheTarget);\n    Matrix.lookAt(this.position, cacheTarget, cacheUp, camera.viewMatrix);\n    camera.fieldOfView = 90;\n  }\n}\n","import { MathUtil, Matrix, Vector2 } from \"@oasis-engine/math\";\nimport { DirectLight } from \"../lighting/DirectLight\";\nimport { Light } from \"../lighting/Light\";\nimport { PointLight } from \"../lighting/PointLight\";\nimport { SpotLight } from \"../lighting/SpotLight\";\nimport { Shader } from \"../shader/Shader\";\nimport { ShaderData } from \"../shader/ShaderData\";\nimport { RenderColorTexture } from \"../texture/RenderColorTexture\";\nimport { RenderTarget } from \"../texture/RenderTarget\";\n\n/**\n * Shadow manager.\n */\nexport class LightShadow {\n  private static _viewMatFromLightProperty = Shader.getPropertyByName(\"u_viewMatFromLight\");\n  private static _projMatFromLightProperty = Shader.getPropertyByName(\"u_projMatFromLight\");\n  private static _shadowBiasProperty = Shader.getPropertyByName(\"u_shadowBias\");\n  private static _shadowIntensityProperty = Shader.getPropertyByName(\"u_shadowIntensity\");\n  private static _shadowRadiusProperty = Shader.getPropertyByName(\"u_shadowRadius\");\n  private static _shadowMapSizeProperty = Shader.getPropertyByName(\"u_shadowMapSize\");\n  private static _shadowMapsProperty = Shader.getPropertyByName(\"u_shadowMaps\");\n\n  /**\n   * @internal\n   */\n  static _updateShaderData(shaderData: ShaderData) {\n    const data = LightShadow._combinedData;\n\n    shaderData.setFloatArray(LightShadow._viewMatFromLightProperty, data.viewMatrix);\n    shaderData.setFloatArray(LightShadow._projMatFromLightProperty, data.projectionMatrix);\n    shaderData.setFloatArray(LightShadow._shadowBiasProperty, data.bias);\n    shaderData.setFloatArray(LightShadow._shadowIntensityProperty, data.intensity);\n    shaderData.setFloatArray(LightShadow._shadowRadiusProperty, data.radius);\n    shaderData.setFloatArray(LightShadow._shadowMapSizeProperty, data.mapSize);\n    shaderData.setTextureArray(LightShadow._shadowMapsProperty, data.map);\n  }\n\n  /**\n   * Clear all shadow maps.\n   */\n  static clearMap() {\n    LightShadow._combinedData.map.length = 0;\n  }\n\n  private static _maxLight = 3;\n\n  private static _combinedData = {\n    viewMatrix: new Float32Array(16 * LightShadow._maxLight),\n    projectionMatrix: new Float32Array(16 * LightShadow._maxLight),\n    bias: new Float32Array(LightShadow._maxLight),\n    intensity: new Float32Array(LightShadow._maxLight),\n    radius: new Float32Array(LightShadow._maxLight),\n    mapSize: new Float32Array(2 * LightShadow._maxLight),\n    map: []\n  };\n\n  private _mapSize: Vector2;\n  private _renderTarget: RenderTarget;\n\n  /**\n   * Shadow's light.\n   */\n  readonly light: Light;\n\n  /**\n   * Shadow bias.\n   */\n  bias: number = 0.005;\n\n  /**\n   * Shadow intensity, the larger the value, the clearer and darker the shadow.\n   */\n  intensity: number = 0.2;\n\n  /**\n   * Pixel range used for shadow PCF interpolation.\n   */\n  radius: number = 1;\n\n  /**\n   * Generate the projection matrix used by the shadow map.\n   */\n  projectionMatrix: Matrix = new Matrix();\n\n  constructor(light: Light, props = { engine: null, width: 512, height: 512 }) {\n    this.light = light;\n    const { engine, width, height } = props;\n\n    this._mapSize = new Vector2(width, height);\n    this._renderTarget = new RenderTarget(engine, width, height, new RenderColorTexture(engine, width, height));\n  }\n\n  /**\n   * The RenderTarget corresponding to the shadow map.\n   * @readonly\n   */\n  get renderTarget(): RenderTarget {\n    return this._renderTarget;\n  }\n\n  /**\n   * Shadow map's color render texture.\n   * @readonly\n   */\n  get map(): RenderColorTexture {\n    return this._renderTarget.getColorTexture();\n  }\n\n  /**\n   * Shadow map size.\n   * @readonly\n   */\n  get mapSize(): Vector2 {\n    return this._mapSize;\n  }\n\n  /**\n   * Initialize the projection matrix for lighting.\n   * @param light - The light to generate shadow\n   */\n  initShadowProjectionMatrix(light: Light) {\n    /**\n     * Directional light projection matrix, the default coverage area is left: -5, right: 5, bottom: -5, up: 5, near: 0.5, far: 50.\n     */\n    if (light instanceof DirectLight) {\n      Matrix.ortho(-5, 5, -5, 5, 0.1, 50, this.projectionMatrix);\n    }\n\n    /**\n     * Point light projection matrix, default configuration: fov: 50, aspect: 1, near: 0.5, far: 50.\n     */\n    if (light instanceof PointLight) {\n      Matrix.perspective(MathUtil.degreeToRadian(50), 1, 0.5, 50, this.projectionMatrix);\n    }\n\n    /**\n     * Spotlight projection matrix, the default configuration: fov: this.angle * 2 * Math.sqrt(2), aspect: 1, near: 0.1, far: this.distance + 5\n     */\n    if (light instanceof SpotLight) {\n      const fov = Math.min(Math.PI / 2, light.angle * 2 * Math.sqrt(2));\n      Matrix.perspective(fov, 1, 0.1, light.distance + 5, this.projectionMatrix);\n    }\n  }\n\n  appendData(lightIndex: number): void {\n    const viewStart = lightIndex * 16;\n    const projectionStart = lightIndex * 16;\n    const biasStart = lightIndex;\n    const intensityStart = lightIndex;\n    const radiusStart = lightIndex;\n    const mapSizeStart = lightIndex * 2;\n    const mapStart = lightIndex;\n\n    const data = LightShadow._combinedData;\n\n    data.viewMatrix.set(this.light.viewMatrix.elements, viewStart);\n    data.projectionMatrix.set(this.projectionMatrix.elements, projectionStart);\n    data.bias[biasStart] = this.bias;\n    data.intensity[intensityStart] = this.intensity;\n    data.radius[radiusStart] = this.radius;\n    data.mapSize[mapSizeStart] = this.mapSize.x;\n    data.mapSize[mapSizeStart + 1] = this.mapSize.y;\n    data.map[mapStart] = this.map;\n  }\n}\n","import { Logger } from \"../base/Logger\";\nimport { AmbientLight } from \"../lighting/AmbientLight\";\nimport { Light } from \"../lighting/Light\";\nimport { LightShadow } from \"./LightShadow\";\nimport { Component } from \"../Component\";\n\n/**\n * Set whether the light to generate shadows.\n */\nObject.defineProperty(Light.prototype, \"enableShadow\", {\n  get: function () {\n    return this._enableShadow;\n  },\n  set: function (enabled) {\n    this._enableShadow = enabled;\n\n    if (this._enableShadow) {\n      if (this instanceof AmbientLight) {\n        this._enableShadow = false;\n        Logger.warn(\"Has no shadow!\");\n        return;\n      }\n\n      this.shadow = this.shadow || new LightShadow(this, { engine: this.engine, width: 512, height: 512 });\n      this.shadow.initShadowProjectionMatrix(this);\n    }\n  }\n});\n\n/**\n * Set whether the renderer to receive shadows.\n */\nObject.defineProperty(Component.prototype, \"recieveShadow\", {\n  get: function () {\n    return this._recieveShadow;\n  },\n  set: function (enabled) {\n    this._recieveShadow = enabled;\n  }\n});\n\n/**\n * Set whether the renderer to cast shadows.\n */\nObject.defineProperty(Component.prototype, \"castShadow\", {\n  get: function () {\n    return this._castShadow;\n  },\n  set: function (enabled) {\n    this._castShadow = enabled;\n  }\n});\n","import { Engine } from \"../Engine\";\nimport { Material } from \"../material/Material\";\nimport { Shader } from \"../shader/Shader\";\n\n/**\n * Shadow Map material.\n */\nexport class ShadowMapMaterial extends Material {\n  constructor(engine: Engine) {\n    super(engine, Shader.find(\"shadow-map\"));\n    this.shaderData.enableMacro(\"O3_GENERATE_SHADOW_MAP\");\n  }\n}\n","import { Vector4 } from \"@oasis-engine/math\";\nimport { Camera } from \"../Camera\";\nimport { Layer } from \"../Layer\";\nimport { Light } from \"../lighting/Light\";\nimport { Material } from \"../material/Material\";\nimport { RenderPass } from \"../RenderPipeline/RenderPass\";\nimport { RenderQueue } from \"../RenderPipeline/RenderQueue\";\nimport { Shader } from \"../shader/Shader\";\nimport { RenderTarget } from \"../texture/RenderTarget\";\n\n/**\n * RenderPass for rendering shadow map.\n */\nexport class ShadowMapPass extends RenderPass {\n  private static _viewMatFromLightProperty = Shader.getPropertyByName(\"u_viewMatFromLight\");\n  private static _projMatFromLightProperty = Shader.getPropertyByName(\"u_projMatFromLight\");\n\n  readonly light: Light;\n\n  /**\n   * Constructor.\n   * @param light  - The light that the shadow belongs to\n   */\n  constructor(\n    name: string,\n    priority: number,\n    renderTarget: RenderTarget,\n    replaceMaterial: Material,\n    mask: Layer,\n    light: Light\n  ) {\n    super(name, priority, renderTarget, replaceMaterial, mask, new Vector4(1, 1, 1, 1));\n    this.light = light;\n  }\n\n  /**\n   * @override\n   */\n  preRender(camera: Camera, queue: RenderQueue) {\n    // The viewProjection matrix from the light.\n    const shaderData = this.replaceMaterial.shaderData;\n    shaderData.setMatrix(ShadowMapPass._viewMatFromLightProperty, this.light.viewMatrix);\n    shaderData.setMatrix(ShadowMapPass._projMatFromLightProperty, (this.light as any).shadow.projectionMatrix);\n  }\n}\n","import { Engine } from \"../Engine\";\nimport { RenderQueueType } from \"../material\";\nimport { Material } from \"../material/Material\";\nimport { BlendFactor } from \"../shader/enums/BlendFactor\";\nimport { CompareFunction } from \"../shader/enums/CompareFunction\";\nimport { Shader } from \"../shader/Shader\";\n\n/**\n * Shadow material.\n */\nexport class ShadowMaterial extends Material {\n  constructor(engine: Engine) {\n    super(engine, Shader.find(\"shadow\"));\n\n    const targetBlendState = this.renderState.blendState.targetBlendState;\n\n    targetBlendState.sourceColorBlendFactor = targetBlendState.sourceAlphaBlendFactor = BlendFactor.DestinationColor;\n    targetBlendState.destinationColorBlendFactor = targetBlendState.destinationAlphaBlendFactor = BlendFactor.Zero;\n    this.renderState.depthState.compareFunction = CompareFunction.LessEqual;\n\n    this.renderQueueType = RenderQueueType.Transparent;\n  }\n}\n","import { ClearMode } from \"../base/Constant\";\nimport { Camera } from \"../Camera\";\nimport { LightFeature } from \"../lighting/LightFeature\";\nimport { RenderPass } from \"../RenderPipeline/RenderPass\";\nimport { RenderQueue } from \"../RenderPipeline/RenderQueue\";\nimport { LightShadow } from \"./LightShadow\";\n\n/**\n * RenderPass for rendering shadow.\n */\nexport class ShadowPass extends RenderPass {\n  constructor(...args) {\n    super(...args);\n    this.clearMode = ClearMode.DONT_CLEAR;\n  }\n\n  /**\n   * @override\n   */\n  preRender(camera: Camera, queue: RenderQueue) {\n    this.enabled = false;\n    const lightMgr = camera.scene.findFeature(LightFeature);\n    const lights = lightMgr.visibleLights;\n    const shaderData = this.replaceMaterial.shaderData;\n\n    // keep render based on default render pass\n    const pass = camera._renderPipeline.defaultRenderPass;\n    this.renderTarget = pass.renderTarget;\n\n    let shadowMapCount = 0;\n\n    LightShadow.clearMap();\n    for (let i = 0, len = lights.length; i < len; i++) {\n      const lgt: any = lights[i];\n      if (lgt.enableShadow) {\n        lgt.shadow.appendData(shadowMapCount++);\n      }\n    }\n\n    if (shadowMapCount) {\n      this.enabled = true;\n      LightShadow._updateShaderData(shaderData);\n      shaderData.enableMacro(\"O3_SHADOW_MAP_COUNT\", shadowMapCount.toString());\n    } else {\n      shaderData.disableMacro(\"O3_SHADOW_MAP_COUNT\");\n    }\n  }\n}\n","import { Camera } from \"../Camera\";\nimport { Component } from \"../Component\";\nimport { Layer } from \"../Layer\";\nimport { LightFeature } from \"../lighting/LightFeature\";\nimport { RenderQueue } from \"../RenderPipeline/RenderQueue\";\nimport { Scene } from \"../Scene\";\nimport { SceneFeature } from \"../SceneFeature\";\nimport { ShadowMapMaterial } from \"./ShadowMapMaterial\";\nimport { ShadowMapPass } from \"./ShadowMapPass\";\nimport { ShadowMaterial } from \"./ShadowMaterial\";\nimport { ShadowPass } from \"./ShadowPass\";\n\n/**\n * Shadow plug-in.\n */\nexport class ShadowFeature extends SceneFeature {\n  private _shadowPass: ShadowPass;\n  private _shadowMapMaterial: ShadowMapMaterial;\n\n  /**\n   * @override\n   */\n  preRender(scene: Scene, camera: Camera) {\n    const lights = scene.findFeature(LightFeature).visibleLights;\n\n    if (lights.length > 0) {\n      // Check RenderPass for rendering shadows.\n      if (!this._shadowPass) {\n        this.addShadowPass(camera);\n      }\n\n      // Check RenderPass for rendering shadow map.\n      const renderPipeline = camera._renderPipeline;\n\n      for (let i = 0, len = lights.length; i < len; i++) {\n        const lgt: any = lights[i];\n        if (lgt.enableShadow && !lgt.shadowMapPass) {\n          lgt.shadowMapPass = this.addShadowMapPass(camera, lgt);\n        } else if (!lgt.enableShadow && lgt.shadowMapPass) {\n          renderPipeline.removeRenderPass(lgt.shadowMapPass);\n          lgt.shadowMapPass = null;\n        }\n      }\n\n      this.updatePassRenderFlag(renderPipeline.queue);\n    }\n  }\n\n  /**\n   * Add RenderPass for rendering shadows.\n   * @param camera - The camera for rendering\n   */\n  addShadowPass(camera: Camera) {\n    const shadowMaterial = new ShadowMaterial(camera.engine);\n    this._shadowPass = new ShadowPass(\"ShadowPass\", 1, null, shadowMaterial, Layer.Layer30); // SHADOW\n    const renderer = camera._renderPipeline;\n    renderer.addRenderPass(this._shadowPass);\n  }\n\n  /**\n   * Add RenderPass for rendering shadow map.\n   * @param camera - The camera for rendering\n   * @param light - The light that the shadow belongs to\n   */\n  addShadowMapPass(camera: Camera, light) {\n    // Share shadow map material.\n    this._shadowMapMaterial = this._shadowMapMaterial || new ShadowMapMaterial(camera.engine);\n\n    const shadowMapPass = new ShadowMapPass(\n      \"ShadowMapPass\",\n      -1,\n      light.shadow.renderTarget,\n      this._shadowMapMaterial,\n      Layer.Layer31, // SHADOW_MAP\n      light\n    );\n    const renderer = camera._renderPipeline;\n    renderer.addRenderPass(shadowMapPass);\n\n    return shadowMapPass;\n  }\n\n  /**\n   * Update the renderPassFlag state of renderers in the scene.\n   * @param renderQueue - Render queue\n   */\n  updatePassRenderFlag(renderQueue: RenderQueue) {\n    const items = renderQueue.items;\n    for (let i = 0, len = items.length; i < len; i++) {\n      const item = items[i];\n      const ability: Component = item.component;\n\n      const recieveShadow = (ability as any).recieveShadow;\n      const castShadow = (ability as any).castShadow;\n      if (recieveShadow === true) {\n        ability.entity.layer |= Layer.Layer30; //SHADOW;\n      } else if (recieveShadow === false) {\n        ability.entity.layer &= ~Layer.Layer30; //SHADOW;\n      }\n\n      if (castShadow === true) {\n        ability.entity.layer |= Layer.Layer31; //SHADOW_MAP;\n      } else if (castShadow === false) {\n        ability.entity.layer &= ~Layer.Layer31; //SHADOW_MAP;\n      }\n    }\n  }\n}\n","import \"./Extension\";\nimport { ShadowFeature } from \"./ShadowFeature\";\nimport { Scene } from \"../Scene\";\n\nScene.registerFeature(ShadowFeature);\n","export { Engine } from \"./Engine\";\nexport { SystemInfo } from \"./SystemInfo\";\nexport type { HardwareRenderer } from \"./HardwareRenderer\";\nexport type { Canvas } from \"./Canvas\";\nexport { EngineFeature } from \"./EngineFeature\";\n\nexport { Scene } from \"./Scene\";\nexport { SceneFeature } from \"./SceneFeature\";\n\nexport { Entity } from \"./Entity\";\nexport { Component } from \"./Component\";\nexport { Script } from \"./Script\";\nexport { Renderer } from \"./Renderer\";\nexport { dependencies } from \"./ComponentsDependencies\";\n\nexport { Camera } from \"./Camera\";\nexport { Transform } from \"./Transform\";\nexport { UpdateFlag } from \"./UpdateFlag\";\nexport { request } from \"./asset/request\";\nexport { Loader } from \"./asset/Loader\";\nexport { ResourceManager, resourceLoader } from \"./asset/ResourceManager\";\nexport { AssetPromise, AssetPromiseStatus } from \"./asset/AssetPromise\";\nexport type { LoadItem } from \"./asset/LoadItem\";\nexport { AssetType } from \"./asset/AssetType\";\nexport { RefObject } from \"./asset/RefObject\";\n\nexport { BasicRenderPipeline } from \"./RenderPipeline/BasicRenderPipeline\";\nexport { RenderQueue } from \"./RenderPipeline/RenderQueue\";\nexport { RenderPass } from \"./RenderPipeline/RenderPass\";\nexport { RenderElement } from \"./RenderPipeline/RenderElement\";\nexport * from \"./base\";\n\n// Lighting\nimport { LightFeature, hasLight } from \"./lighting/LightFeature\";\nimport { Scene } from \"./Scene\";\nScene.registerFeature(LightFeature);\n(Scene.prototype as any).hasLight = hasLight;\n// Quote raycast\nimport \"./raycast\";\n\nexport { LightFeature };\nexport { AmbientLight } from \"./lighting/AmbientLight\";\nexport { DirectLight } from \"./lighting/DirectLight\";\nexport { PointLight } from \"./lighting/PointLight\";\nexport { SpotLight } from \"./lighting/SpotLight\";\nexport { EnvironmentMapLight } from \"./lighting/EnvironmentMapLight\";\nexport { Light } from \"./lighting/Light\";\n// Mesh\nexport { Mesh } from \"./mesh/Mesh\";\nexport { Skin } from \"./mesh/Skin\";\nexport { MeshRenderer } from \"./mesh/MeshRenderer\";\nexport { SkinnedMeshRenderer } from \"./mesh/SkinnedMeshRenderer\";\nexport { LODGroup } from \"./mesh/LODGroup\";\n\n// Material\nexport * from \"./material/index\";\nexport * from \"./texture/index\";\nexport * from \"./graphic/index\";\nexport * from \"./2d/index\";\nexport * from \"./shaderlib/index\";\nexport * from \"./animation/index\";\nexport * from \"./geometry/index\";\nexport * from \"./geometry-shape/index\";\nexport * from \"./skybox/index\";\nexport * from \"./particle/index\";\nexport * from \"./trail/index\";\nexport * from \"./collider/index\";\nexport * from \"./collision/index\";\nexport * from \"./fog/index\";\nexport * from \"./env-probe/index\";\nexport * from \"./shadow/index\";\nexport * from \"./shader/index\";\nexport * from \"./Layer\";\n"],"names":["AssetPromiseStatus","AssetPromise","all","promises","resolve","reject","setProgress","Array","isArray","completed","total","length","results","forEach","value","index","Promise","then","result","catch","err","onProgress","callback","_listeners","add","cancel","_status","Pending","_reject","executor","newReject","progress","_progress","listener","reason","Failed","Success","Set","Util","toString","call","isArrayLike","x","clone","obj","rst","slice","i","l","k","hasOwnProperty","downloadBlob","blob","fileName","navigator","msSaveBlob","url","window","URL","createObjectURL","a","document","createElement","body","appendChild","style","display","href","download","addEventListener","parentElement","removeChild","click","revokeObjectURL","removeFromArray","array","item","indexOf","last","end","ObjectValues","Object","keys","map","key","ResourceManager","_addLoader","type","loader","extnames","_loaders","len","_extTypeMapping","_getTypeByUrl","path","split","substring","lastIndexOf","engine","retryCount","retryInterval","timeout","_assetPool","create","_assetUrlPool","_refObjectPool","_loadingPromises","load","assetInfo","_loadSingleItem","cancelNotLoaded","promise","p","gc","objects","isGCIgnored","destroy","getAssetPath","instanceId","_addAsset","asset","_deleteAsset","id","_addRefObject","_deleteRefObject","_assignDefaultOptions","undefined","urls","join","info","res","useCache","resourceLoader","assetType","Target","Event","target","data","bubbles","_timeStamp","_target","_currentTarget","_bubbles","_propagationStopped","_type","Date","getTime","stopPropagation","t","CloneMode","ignoreClone","propertyKey","CloneManager","registerCloneMode","Ignore","assignmentClone","Assignment","shallowClone","Shallow","deepClone","Deep","mode","targetMap","_subCloneModeMap","get","constructor","set","getCloneMode","cloneModes","_cloneModeMap","obejctType","_obejctType","cloneModeMap","subCloneModes","getPrototypeOf","deepCloneObject","source","Uint8Array","Uint16Array","Uint32Array","Int8Array","Int16Array","Int32Array","Float32Array","Float64Array","n","_deepCloneObjectItem","customSource","cloneTo","sourceItem","itemType","sourceTypeArrayItem","targetTypeArrayItem","sourceArryItem","targetArrayItem","sourceCustomItem","targetCustomItem","targetItem","Map","EngineObject","_engine","_instanceIdCounter","EventDispatcher","_evtCount","hasEvent","event","_evts","eventNames","listenerCount","listeners","fn","dispatch","once","removeEventListener","on","events","push","off","_clearEvent","temp","removeAllEventListeners","trigger","e","noop","message","debug","console","log","bind","warn","error","Logger","isEnabled","enable","disable","Time","_clock","_timeScale","_deltaTime","_startTime","_lastTickTime","performance","now","reset","tick","nowTime","s","InternalAssetType","ClearMode","MaterialType","RenderState","FrontFace","CullFace","Side","CompFunc","DataType","UniformSemantic","BlendFunc","RefreshRate","GLCapabilityType","DisorderedArray","count","_elements","element","delete","deleteByIndex","elements","lastIndex","garbageCollection","ShaderMacroCollection","_mask","_length","unionCollection","left","right","out","outMask","minSize","maxSize","minMask","maxMask","macro","_index","size","mask","maskStart","_value","endIndex","newValue","macroCollection","addMask","addSize","maskSize","complementaryCollection","removeMask","Math","min","intersectionCollection","unionMask","isEnable","clear","ComponentsManager","_onStartScripts","_onUpdateScripts","_onLateUpdateScripts","_destoryComponents","_onUpdateAnimations","_renderers","_onUpdateRenderers","_componentsContainerPool","addRenderer","renderer","_rendererIndex","removeRenderer","replaced","addOnStartScript","script","_onStartIndex","removeOnStartScript","addOnUpdateScript","_onUpdateIndex","removeOnUpdateScript","addOnLateUpdateScript","_onLateUpdateIndex","removeOnLateUpdateScript","addOnUpdateAnimations","animation","removeOnUpdateAnimations","addOnUpdateRenderers","removeOnUpdateRenderers","addDestoryComponent","component","callScriptOnStart","onStartScripts","_started","onStart","callScriptOnUpdate","deltaTime","onUpdate","callScriptOnLateUpdate","onLateUpdate","callAnimationUpdate","update","callRendererOnUpdate","callRender","context","camera","_camera","cullingMask","_entity","layer","enableFrustumCulling","isCulled","_frustum","intersectsBox","bounds","_updateShaderData","_globalShaderMacro","shaderData","_macroCollection","_render","callComponentDestory","destoryComponents","onDestroy","callCameraOnBeginRender","camComps","entity","_components","camComp","onBeginRender","callCameraOnEndRender","onEndRender","getActiveChangedTempList","pop","putActiveChangedTempList","componentContainer","ComponentCloner","cloneComponent","cloneMode","sourcePropS","tarProp","sourcePropD","ComponentsDependencies","register","currentComponent","dependentComponent","_addDependency","_dependenciesMap","_invDependenciesMap","_addCheck","dependencies","getComponent","_removeCheck","invDenpendencies","components","abilityClass","ability","Layer","Component","_renderPriority","_destroyed","_removeComponent","isActiveInHierarchy","_enabled","_onDisable","_onInActive","_onDestroy","_onAwake","_onEnable","_onActive","_setActive","_awaked","_isActiveInHierarchy","scene","val","UpdateFlag","_flags","flag","flags","Transform","_dirtyFlag","_WM_WP_WE_WQ_WS_FLAGS","setPosition","y","z","_position","setValue","position","setRotation","_rotation","rotation","setRotationQuaternion","w","_rotationQuaternion","rotationQuaternion","setScale","_scale","scale","setWorldPosition","_worldPosition","worldPosition","setWorldRotation","_worldRotation","worldRotation","setWorldRotationQuaternion","_worldRotationQuaternion","worldRotationQuaternion","getWorldForward","forward","worldMatrix","normalize","getWorldRight","getWorldUp","up","translate","translationOrX","relativeToLocalOrY","relativeToLocal","_tempVec3","_translate","rotate","rotationOrX","_rotateXYZ","rotateByAxis","axis","angle","rad","MathUtil","degreeToRadFactor","Quaternion","rotationAxisAngle","_tempQuat0","_rotateByQuat","lookAt","worldUp","EPSILON","zeroTolerance","abs","rotMat","_tempMat43","Matrix","getRotation","invert","registerWorldChangeFlag","_changeFlags","_parentChange","_isParentDirty","_updateAllWorldFlag","_updateWorldPositionFlag","_isContainDirtyFlags","_WM_WP_FLAGS","_worldAssociatedChange","nodeChildren","_children","transform","_updateWorldRotationFlag","_WM_WE_WQ_FLAGS","_updateWorldPositionAndRotationFlag","_WM_WP_WE_WQ_FLAGS","_updateWorldScaleFlag","_WM_WS_FLAGS","_updateWorldPositionAndScaleFlag","_WM_WP_WS_FLAGS","_getParentTransform","_parentTransformCache","parentCache","parent","_getScaleMatrix","invRotation","invRotationMat","_tempMat30","worldRotScaMat","_tempMat31","scaMat","_tempMat32","setValueByMatrix","Matrix3x3","multiply","targetDirtyFlags","_isContainDirtyFlag","_setDirtyFlagTrue","_setDirtyFlagFalse","rotateQuat","translation","rotationMat","_tempMat40","Vector3","transformCoordinate","radFactor","rotQuat","rotationEuler","translateXYZ","rotateXYZ","_LOCAL_MATRIX_FLAG","_WORLD_POSITION_FLAG","getTranslation","_tempMat41","_LOCAL_EULER_FLAG","toEuler","radToDegreeFactor","_LOCAL_QUAT_FLAG","_WORLD_EULER_FLAG","degreeToRadian","_WORLD_QUAT_FLAG","_WORLD_SCALE_FLAG","scaleMat","_lossyWorldScale","affineTransformation","_localMatrix","decompose","_WORLD_MATRIX_FLAG","localMatrix","_worldMatrix","_tempMat42","Entity","findByName","name","entitys","_entitys","findByPath","findEntityByPath","_findChildByName","root","children","child","_traverseSetOwnerScene","_scene","childCount","Layer0","_isRoot","_isActive","_parent","_activeChangedComponents","_invModelMatrix","_inverseWorldMatFlag","addComponent","getComponents","getComponentsIncludeChildren","_getComponentsInChildren","addChild","getChild","grandson","splits","createChild","clearChildren","_processInActive","cloneEntity","sourceComp","targetComp","abilityArray","parentChildren","splice","_removeFromParent","oldParent","oldParentChildren","_processActive","_componentsManager","_setActiveInHierarchy","_setActiveComponents","_setInActiveInHierarchy","isActive","activeChangedComponents","_setTransformDirty","getInvModelMatrix","_isActiveInEngine","newParent","parentScene","FeatureManager","_features","_objects","registerFeature","IFeature","featureArray","objectArray","features","addObject","callFeatureMethod","method","args","feature","apply","findFeature","RenderElement","primitive","subPrimitive","material","getFromPool","_elementPoolIndex","pool","_elementPool","_restPool","SceneFeature","preUpdate","postUpdate","preRender","postRender","BlendFactor","BlendOperation","ColorWriteMask","CompareFunction","CullMode","StencilOperation","RenderQueueType","RenderQueue","items","pushPrimitive","sort","cameraPosition","b","aIsPrimitive","_isPrimitive","bIsPrimitive","aElement","bElement","aRenderQueue","renderQueueType","bRenderQueue","Transparent","aDistance","distanceSquared","bDistance","shader","localeCompare","pushSprite","positionQuad","uvRect","tintColor","texture","renderMode","render","replaceMaterial","spriteMaterial","_renderPipeline","_defaultSpriteMaterial","renderCount","_renderCount","rhi","_hardwareRenderer","sceneData","cameraData","renderPassFlag","flushSprite","compileMacros","rendererData","materialData","_preRender","program","_getShaderProgram","isValid","switchProgram","switchRenderCount","_uploadRenderCount","groupingOtherUniformBlock","uploadAll","sceneUniformBlock","cameraUniformBlock","rendererUniformBlock","materialUniformBlock","_uploadCamera","_uploadRenderer","_uploadMaterial","uploadUniforms","uploadTextures","renderState","_apply","drawPrimitive","spirteElement","drawSprite","pbr_common_frag_define","pbr_util_frag_define","pbr_envmap_light_frag_define","pbr_base_frag_define","pbr_texture_frag_define","pbr_runtime_frag_define","pbr_normal_frag_define","pbr_brdf_cook_torrance_frag_define","pbr_direct_irradiance_frag_define","pbr_ibl_specular_frag_define","pbr_ibl_diffuse_frag_define","pbr_begin_frag","pbr_direct_irradiance_frag","pbr_ibl_diffuse_frag","pbr_ibl_specular_frag","pbr_end_frag","ShaderLib","common","common_vert","common_frag","color_share","normal_share","uv_share","worldpos_share","shadow_share","fog_share","begin_normal_vert","begin_position_vert","morph_target_vert","position_vert","color_vert","normal_vert","skinning_vert","uv_vert","worldpos_vert","shadow_vert","morph_vert","fog_vert","ambient_light_frag","direct_light_frag","point_light_frag","spot_light_frag","mobile_material_frag","fog_frag","begin_mobile_frag","begin_normal_frag","begin_viewdir_frag","mobile_blinnphong_frag","mobile_lambert_frag","noise_common","noise_cellular_2D","noise_cellular_2x2","noise_cellular_2x2x2","noise_cellular_3D","noise_cellular","noise_perlin_2D","noise_perlin_3D","noise_perlin_4D","noise_perlin","noise_psrd_2D","noise_simplex_2D","noise_simplex_3D_grad","noise_simplex_3D","noise_simplex_4D","noise_simplex","perturbation_share","perturbation_frag","refraction_share","refraction_frag","clipPlane_vert_define","clipPlane_vert","clipPlane_frag_define","clipPlane_frag","gamma_frag","oit_frag","oit_frag_define","PBRShaderLib","InjectShaderSlices","ShaderFactory","parseVersion","version","parsePrecision","vertP","fragP","compileVert","downgrade","parseShaderName","parseAttributeMacros","macros","m","parseCustomMacros","parseShader","src","parseIncludes","regex","replace","match","trim","slices","parseExtension","extensions","convertTo300","isFrag","isMRT","test","replaceMRTShader","getMaxDrawBuffers","mrtIndexSet","compatible","fragmentShader","hasFragData","declaration","ShaderMacro","ShaderDataGroup","ShaderUniform","propertyId","location","textureIndex","applyFunc","cacheValue","_rhi","_gl","gl","upload1f","shaderUniform","uniform1f","upload1fv","uniform1fv","upload2f","cacheVaue","r","g","uniform2f","upload2fv","uniform2fv","upload3f","uniform3f","upload3fv","uniform3fv","upload4f","uniform4f","upload4fv","uniform4fv","upload1i","uniform1i","upload1iv","uniform1iv","upload2i","uniform2i","upload2iv","uniform2iv","upload3i","uniform3i","upload3iv","uniform3iv","upload4i","uniform4i","upload4iv","uniform4iv","uploadMat4","uniformMatrix4fv","uploadMat4v","uploadTexture","activeTexture","bindTexture","_glTexture","uploadTextureArray","textureIndices","ShaderUniformBlock","constUniforms","textureUniforms","ShaderProgram","_addLineNum","str","lines","limitLength","prefix","line","vertexSource","fragmentSource","otherUniformBlock","attributeLocation","_isValid","_vertexShader","_fragmentShader","_glProgram","_activeTextureUint","_createProgram","_recordLocation","_counter","uniformBlock","properties","_properties","uniform","_groupingSubOtherUniforms","_currentBind","useProgram","deleteShader","deleteProgram","unifroms","isTexture","group","Shader","_getShaderPropertyGroup","_groupingUniform","Scene","Camera","Renderer","Material","vertexShader","_createShader","VERTEX_SHADER","FRAGMENT_SHADER","createProgram","attachShader","linkProgram","validateProgram","isContextLost","getProgramParameter","LINK_STATUS","getProgramInfoLog","shaderType","shaderSource","createShader","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","uniformInfos","_getUniformInfos","attributeInfos","_getAttributeInfos","substr","getUniformLocation","getPropertyByName","_uniqueId","FLOAT","FLOAT_VEC2","Vector2","FLOAT_VEC3","FLOAT_VEC4","Vector4","BOOL","INT","BOOL_VEC2","INT_VEC2","BOOL_VEC3","INT_VEC3","BOOL_VEC4","INT_VEC4","FLOAT_MAT4","SAMPLER_2D","SAMPLER_CUBE","glTextureIndices","TEXTURE0","getAttribLocation","uniformCount","ACTIVE_UNIFORMS","getActiveUniform","attributeCount","ACTIVE_ATTRIBUTES","getActiveAttrib","ShaderProperty","_group","_propertyNameCounter","shaderMap","_shaderMap","find","getMacroByName","_macroMap","maskMap","_macroMaskMap","counter","_macroCounter","floor","bit","propertyNameMap","_propertyNameMap","property","propertyName","shaderProperty","_getNamesByMacros","subMaskMap","subMask","log2","j","_shaderId","_vertexSource","_fragmentSource","_shaderCounter","compileVariant","shaderProgramPool","_getShaderProgramPool","shaderProgram","isWebGL2","macroNameList","macroNameStr","shaderNameStr","versionStr","precisionStr","_shaderExtension","cache","Light","_viewMat","_inverseViewMat","LightFeature","attachRenderLight","detachRenderLight","viewMatrix","_maxLight","AmbientLight","_color","Color","_intensity","_lightColor","color","setColor","_colorProperty","lightColor","DirectLight","intensity","_forward","_reverseDirection","_combinedData","setFloatArray","_directionProperty","direction","_appendData","lightIndex","colorStart","directionStart","EnvironmentMapLight","light","transformMatrix","setMatrix","_transformMatrixProperty","_diffuseTexture","_specularTexture","_diffuseColor","_specularColor","_diffuseIntensity","_specularIntensity","diffuseColor","specularColor","diffuseIntensity","specularIntensity","setTexture","_diffuseTextureProperty","enableMacro","_diffuseMacro","disableMacro","_specularTextureProperty","setFloat","_mipLevelProperty","specularTexture","mipmapCount","_specularMacro","_diffuseColorProperty","_specularColorProperty","_diffuseIntensityProperty","_specularIntensityProperty","PointLight","distance","decay","_positionProperty","_distanceProperty","_decayProperty","positionStart","distanceStart","decayStart","lightPosition","SpotLight","penumbra","PI","_inverseDirection","_angleProperty","_penumbraProperty","_penumbraCosProperty","penumbraCos","_coneCosProperty","coneCos","angleStart","penumbraStart","penumbraCosStart","coneCosStart","cos","hasLight","visibleLights","ambientLightCount","envMapLightCount","directLightCount","pointLightCount","spotLightCount","lights","_ambientMacro","_envMacro","RefObject","_refCount","resourceManager","force","refCount","_getRefCount","_addRefCount","_addToResourceManager","GLCompressedTextureInternalFormat","RenderBufferColorFormat","RenderBufferDepthFormat","TextureFilterMode","TextureFormat","TextureWrapMode","Texture","_formatDetail","_width","_height","_mipmap","_mipmapCount","_wrapModeU","_wrapModeV","_filterMode","_anisoLevel","_isPowerOf2","v","_getFormatDetail","format","R8G8B8","internalFormat","RGB8","RGB","baseFormat","dataType","UNSIGNED_BYTE","isCompressed","R8G8B8A8","RGBA8","RGBA","R4G4B4A4","RGBA4","UNSIGNED_SHORT_4_4_4_4","R5G5B5A1","RGB5_A1","UNSIGNED_SHORT_5_5_5_1","R5G6B5","RGB565","UNSIGNED_SHORT_5_6_5","Alpha8","ALPHA","R32G32B32A32","RGBA32F","DXT1","RGB_S3TC_DXT1_EXT","DXT5","RGBA_S3TC_DXT5_EXT","ETC1_RGB","RGB_ETC1_WEBGL","ETC2_RGB","RGB8_ETC2","ETC2_RGBA5","RGB8_PUNCHTHROUGH_ALPHA1_ETC2","ETC2_RGBA8","RGBA8_ETC2_EAC","PVRTC_RGB2","RGB_PVRTC_2BPPV1_IMG","PVRTC_RGBA2","RGBA_PVRTC_2BPPV1_IMG","PVRTC_RGB4","RGB_PVRTC_4BPPV1_IMG","PVRTC_RGBA4","RGBA_PVRTC_4BPPV1_IMG","ASTC_4x4","RGBA_ASTC_4X4_KHR","ASTC_5x5","RGBA_ASTC_5X5_KHR","ASTC_6x6","RGBA_ASTC_6X6_KHR","ASTC_8x8","RGBA_ASTC_8X8_KHR","ASTC_10x10","RGBA_ASTC_10X10_KHR","ASTC_12x12","RGBA_ASTC_12X12_KHR","Error","_getRenderBufferColorFormatDetail","R16G16B16A16","RGBA16F","HALF_FLOAT","_getRenderBufferDepthFormatDetail","Depth","DEPTH_COMPONENT32F","DEPTH_COMPONENT16","DEPTH_COMPONENT","UNSIGNED_INT","attachment","DEPTH_ATTACHMENT","DepthStencil","DEPTH24_STENCIL8","DEPTH_STENCIL","UNSIGNED_INT_24_8","DEPTH_STENCIL_ATTACHMENT","Stencil","STENCIL_INDEX8","STENCIL_ATTACHMENT","Depth16","Depth24","DEPTH_COMPONENT24","Depth32","Depth24Stencil8","Depth32Stencil8","DEPTH32F_STENCIL8","FLOAT_32_UNSIGNED_INT_24_8_REV","_supportTextureFormat","isSupported","canIUse","textureFloat","_supportRenderBufferColorFormat","colorBufferFloat","colorBufferHalfFloat","textureHalfFloat","_supportRenderBufferDepthFormat","depthTexture","generateMipmaps","_bind","generateMipmap","_unbind","deleteTexture","_getPixelBuffer","face","width","height","_readFrameBuffer","createFramebuffer","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","TEXTURE_CUBE_MAP_POSITIVE_X","TEXTURE_2D","readPixels","_initMipmap","isCube","texStorage2D","max","texImage2D","faceIndex","_getMaxMiplevel","_getMipmapCount","_setWrapMode","pname","Clamp","texParameteri","CLAMP_TO_EDGE","Repeat","REPEAT","Mirror","MIRRORED_REPEAT","TEXTURE_WRAP_S","TEXTURE_WRAP_T","Point","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","NEAREST_MIPMAP_NEAREST","Bilinear","LINEAR","LINEAR_MIPMAP_NEAREST","Trilinear","LINEAR_MIPMAP_LINEAR","capability","maxAnisoLevel","texParameterf","TEXTURE_MAX_ANISOTROPY_EXT","ShaderData","_variableMacros","getFloat","_getData","_setData","getInt","setInt","getFloatArray","getIntArray","setIntArray","getVector2","setVector2","getVector3","setVector3","getVector4","setVector4","getMatrix","getColor","getTexture","lastValue","getTextureArray","setTextureArray","_enableVariableMacro","variableValue","_disableVariableMacro","targetProperties","variableMacro","oldMacro","clipPlanes","_activeCameras","_rootEntities","_resolution","sceneFeatureManager","shaderTextureLod","standardDerivatives","createRootEntity","addRootEntity","isRoot","oldScene","_removeEntity","removeRootEntity","getRootEntity","findEntityByName","filter","Boolean","rootEntitiesCount","findEntity","sceneManager","activeScene","attachRenderCamera","detachRenderCamera","active","rootEntities","lightMgr","canvas","resolution","_resolutionProperty","oldRootEntities","Feature","raycast","ray","outPos","tag","SceneManager","_activeScene","loadScene","destroyOldScene","scenePromise","mergeScenes","sourceScene","destScene","ShaderPool","init","blinnPhongVs","blinnPhongFs","pbrVs","pbrFs","unlitVs","unlitFs","shadowMapVs","shadowMapFs","shadowFs","skyboxVs","skyboxFs","particleVs","particleFs","ShaderProgramPool","_cacheHierarchy","_cacheMap","_lastQueryMap","_lastQueryKey","cacheMap","maskLength","_resizeCacheMapHierarchy","maxEndIndex","subCacheShaders","cacheKey","hierarchy","resizeLength","RenderTargetBlendState","colorBlendOperation","Add","alphaBlendOperation","sourceColorBlendFactor","One","sourceAlphaBlendFactor","destinationColorBlendFactor","Zero","destinationAlphaBlendFactor","colorWriteMask","All","_blendEnable","BlendState","targetBlendState","blendColor","alphaToCoverage","_getGLBlendFactor","blendFactor","WebGLRenderingContext","ZERO","ONE","SourceColor","SRC_COLOR","OneMinusSourceColor","ONE_MINUS_SRC_COLOR","DestinationColor","DST_COLOR","OneMinusDestinationColor","ONE_MINUS_DST_COLOR","SourceAlpha","SRC_ALPHA","OneMinusSourceAlpha","ONE_MINUS_SRC_ALPHA","DestinationAlpha","DST_ALPHA","OneMinusDestinationAlpha","ONE_MINUS_DST_ALPHA","SourceAlphaSaturate","SRC_ALPHA_SATURATE","BlendColor","CONSTANT_COLOR","OneMinusBlendColor","ONE_MINUS_CONSTANT_COLOR","_getGLBlendOperation","blendOperation","FUNC_ADD","Subtract","FUNC_SUBTRACT","ReverseSubtract","FUNC_REVERSE_SUBTRACT","Min","WebGL2RenderingContext","MIN","Max","MAX","hardwareRenderer","lastRenderState","_platformApply","blendState","lastState","lastTargetBlendState","blendEnable","BLEND","blendFuncSeparate","blendEquationSeparate","equals","colorMask","Red","Green","Blue","Alpha","SAMPLE_ALPHA_TO_COVERAGE","DepthState","enabled","writeEnabled","compareFunction","Less","_getGLCompareFunction","Never","NEVER","LESS","Equal","EQUAL","LessEqual","LEQUAL","Greater","GREATER","NotEqual","NOTEQUAL","GreaterEqual","GEQUAL","Always","ALWAYS","depthState","DEPTH_TEST","depthFunc","depthMask","RasterState","cullMode","Back","depthBias","slopeScaledDepthBias","_cullFaceEnable","rasterState","cullFaceEnable","Off","CULL_FACE","cullFace","BACK","FRONT","POLYGON_OFFSET_FILL","polygonOffset","StencilState","referenceValue","writeMask","compareFunctionFront","compareFunctionBack","passOperationFront","Keep","passOperationBack","failOperationFront","failOperationBack","zFailOperationFront","zFailOperationBack","_getGLStencilOperation","KEEP","Replace","REPLACE","IncrementSaturate","INCR","DecrementSaturate","DECR","Invert","INVERT","IncrementWrap","INCR_WRAP","DecrementWrap","DECR_WRAP","stencilState","STENCIL_TEST","referenceOrMaskChange","stencilFuncSeparate","stencilOpSeparate","stencilMask","_lastRenderState","engineFeatureManager","Engine","_shaderProgramPools","_canvas","_resourceManager","_sceneManager","_vSyncCount","_targetFrameRate","_time","_isPaused","_requestId","_timeoutId","_vSyncCounter","_targetFrameInterval","_animate","requestAnimationFrame","setTimeout","createEntity","pause","cancelAnimationFrame","clearTimeout","resume","time","componentsManager","run","shaderProgramPools","cameras","camera1","camera2","priority","cameraEntity","SystemInfo","devicePixelRatio","EngineFeature","preLoad","preTick","currentScene","postTick","shutdown","Script","onAwake","onEnable","onDisable","prototype","_overrideUpdate","_transformChangeFlag","mvMatrix","_mvMatrix","mvpMatrix","_mvpMatrix","mvInvMatrix","_mvInvMatrix","normalMatrix","_normalMatrix","_viewProjectMatrix","transpose","_localMatrixProperty","_worldMatrixProperty","_mvMatrixProperty","_mvpMatrixProperty","_mvInvMatrixProperty","_normalMatrixProperty","_updateBounds","worldBounds","changeFlag","_bounds","BoundingBox","AlphaMode","Opaque","dest","renderElement","BlinnPhongMaterial","_emissiveColor","_emissiveTexture","_shininess","_alphaMode","_doubleSided","emissiveColor","shininess","CutOff","Blend","PBRBaseMaterial","_baseColor","_normalScale","_occlusionStrength","_alphaCutoff","_envMapIntensity","_refractionRatio","_refractionDepth","_perturbationUOffset","_perturbationVOffset","_PTMMatrix","_baseColorTexture","_opacityTexture","_normalTexture","_occlusionTexture","_reflectionTexture","_refractionTexture","_perturbationTexture","_srgb","_srgbFast","_gamma","_getOpacityFromRGB","_envMapModeRefract","baseColor","normalScale","occlusionStrength","alphaCutoff","envMapIntensity","refractionRatio","refractionDepth","perturbationUOffset","perturbationVOffset","srgb","srgbFast","gamma","getOpacityFromRGB","envMapModeRefract","alphaMode","AlphaTest","PBRMaterial","_metallicFactor","_roughnessFactor","_metallicTexture","_roughnessTexture","_metallicRoughnessTexture","metallicFactor","roughnessFactor","PBRSpecularMaterial","_glossinessFactor","_specularGlossinessTexture","glossinessFactor","UnlitMaterial","passNum","RenderPass","renderTarget","clearParam","renderOverride","clearMode","_clearParam","Everything","SOLID_COLOR","queue","SeparateSpritePass","_spriteItems","DONT_CLEAR","isUsed","renderHardware","_sortByDistance","eyePos","item1","item2","renderPriority","pos1","node","pos2","dis","BasicRenderPipeline","_queue","_defaultPass","_renderPassArray","_canvasDepthPass","_separateSpritePass","addRenderPass","nameOrPass","renderPass","p1","p2","removeRenderPass","pass","getRenderPass","idx","cubeFace","_drawRenderPass","activeRenderTarget","setRenderTargetFace","clearRenderTarget","blitRenderTarget","separateDraw","RenderContext","_getRenderContext","_renderContext","projectionMatrix","MathTemp","tempMat4","tempVec4","tempVec3","ClearFlags","_isOrthographic","_isProjMatSetting","_clearMode","_nearClipPlane","_farClipPlane","_fieldOfView","_orthographicSize","_isProjectionDirty","_isInvProjMatDirty","_isFrustumProjectDirty","_customAspectRatio","_renderTarget","_transform","_isViewMatrixDirty","_isInvViewProjDirty","_frustumViewChangeFlag","setClearMode","resetProjectionMatrix","_projMatChange","resetAspectRatio","worldToViewportPoint","point","nx","ny","nz","viewportToWorldPoint","invViewProjMat","_innerViewportToWorldPoint","viewportPointToRay","clipPoint","origin","farPoint","_invViewProjMat","subtract","screenToViewportPoint","viewport","viewportToScreenPoint","worldToScreenPoint","screenToWorldPoint","calculateFromMatrix","depth","invW","_viewMatrixProperty","_projectionMatrixProperty","_vpMatrixProperty","_inverseViewMatrixProperty","inverseViewMatrix","_inverseProjectionMatrixProperty","inverseProjectionMatrix","_cameraPositionProperty","backgroundColor","_backgroundColor","defaultRenderPass","_viewport","_viewMatrix","_lastAspectSize","_projectionMatrix","aspectRatio","perspective","ortho","_inverseProjectionMatrix","_inverseViewMatrix","BoundingFrustum","mimeType","json","gltf","mtl","prefab","txt","bin","png","webp","jpg","defaultRetryCount","defaultTimeout","defaultInterval","request","config","getMimeTypeFromUrl","realRequest","requestImage","requestRes","lastError","MultiExecutor","stop","start","img","Image","onerror","onabort","timeoutId","onload","crossOrigin","xhr","XMLHttpRequest","status","response","responseText","ontimeout","onprogress","loaded","open","withCredentials","credentials","responseType","headers","setRequestHeader","send","extname","execFunc","totalCount","interval","_currentCount","done","exec","Loader","AssetType","ColliderFeature","colliders","attachCollider","collider","detachCollider","Collider","ABoxCollider","boxMin","boxMax","_corners","_cornerFlag","setBoxMinMax","setBoxCenterSize","center","halfSize","getCorners","minX","minY","minZ","h","d","ASphereCollider","radius","setSphere","PlaneCollider","planePoint","normal","setPlane","RaycastHit","Number","MAX_VALUE","_tempPlane","Plane","_tepmBox","_tempShpere","BoundingSphere","_outPos","cf","nearestHit","hit","localRay","_getLocalRay","intersect","intersectBox","_updateHitResult","radio","intersectSphere","dot","intersectPlane","outHit","hitPos","getPoint","worldToLocal","o","_transformDirection","Ray","Mesh","primitives","groups","weights","updatePrimitiveWeightsIndices","weightsIndices","Skin","inverseBindMatrices","joints","skeleton","addPrimitivesRefCount","mesh","MeshRenderer","_mesh","setSharedMaterial","primitiveIndex","_sharedMaterials","setMaterial","_instanceMaterials","getInstanceMaterial","getSharedMaterial","renderPipeline","localBounds","Texture2D","mipmap","_format","_compressedMipFilled","formatDetail","createTexture","filterMode","wrapModeU","wrapModeV","setPixelBuffer","colorBuffer","mipLevel","mipWidth","mipHeight","pixelStorei","UNPACK_FLIP_Y_WEBGL","UNPACK_PREMULTIPLY_ALPHA_WEBGL","mipBit","compressedTexSubImage2D","compressedTexImage2D","texSubImage2D","setImageSource","imageSource","flipY","premultiplyAlpha","getPixelBuffer","SkinnedMeshRenderer","_skin","_mat","_weights","_useJointTexture","matrixPalette","_jointMatrixProperty","setWeights","_initJoints","skin","jointNodes","findByNodeName","maxAttribUniformVec4","renderStates","getParameter","MAX_VERTEX_UNIFORM_VECTORS","maxJoints","jointCount","_jointCountProperty","canIUseMoreJoints","_jointSamplerProperty","jointTexture","_maxJoints","nodeName","_findParent","brother","_hasInitJoints","ibms","mat","identity","createJointTexture","LODGroup","_lods","addLod","rendererAbility","dist","lods","activeLevel","lod","TextureCubeFace","TextureCubeMap","_compressedFaceFilled","TEXTURE_CUBE_MAP","mipSize","RenderDepthTexture","_isCube","_autoMipmap","RenderTarget","renderTexture","antiAliasing","_frameBuffer","_MSAAFrameBuffer","_antiAliasing","_colorTextures","_depthTexture","_depthRenderBuffer","_MSAAColorRenderBuffers","_MSAADepthRenderBuffer","_oriDrawBuffers","_blitDrawBuffers","drawBuffers","some","maxAntiAliasing","_bindMainFBO","_bindMSAAFBO","getColorTexture","deleteFramebuffer","deleteRenderbuffer","_activeRenderTarget","_setRenderTargetFace","PositiveX","colorTexture","_blitRenderTarget","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","colorTextureLength","READ_FRAMEBUFFER","DRAW_FRAMEBUFFER","readBuffer","blitFramebuffer","NONE","renderDepth","depthRenderBuffer","createRenderbuffer","bindRenderbuffer","RENDERBUFFER","renderbufferStorage","framebufferRenderbuffer","MSAADepthRenderBuffer","MSAAColorRenderBuffer","renderbufferStorageMultisample","_checkFrameBuffer","checkFramebufferStatus","FRAMEBUFFER_INCOMPLETE_ATTACHMENT","FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT","FRAMEBUFFER_INCOMPLETE_DIMENSIONS","FRAMEBUFFER_UNSUPPORTED","FRAMEBUFFER_INCOMPLETE_MULTISAMPLE","RenderColorTexture","BufferUsage","VertexElementFormat","IndexFormat","BufferUtil","_getGLBufferUsage","bufferUsage","Static","STATIC_DRAW","Dynamic","DYNAMIC_DRAW","Stream","STREAM_DRAW","_getGLIndexType","indexFormat","UInt8","UInt16","UNSIGNED_SHORT","UInt32","_getElementInfo","Float","Byte4","Short2","SHORT","Short4","UShort2","UShort4","BufferBindFlag","SetDataOptions","Buffer","byteLengthOrData","_glBindTarget","_glBufferUsage","_nativeBuffer","_byteLength","_bufferUsage","glBufferUsage","glBindTarget","VertexBuffer","ARRAY_BUFFER","ELEMENT_ARRAY_BUFFER","createBuffer","bufferData","byteLength","bindBuffer","setData","bufferByteOffset","dataOffset","dataLength","options","None","Discard","byteSize","BYTES_PER_ELEMENT","dataByteLength","isArrayBufferView","byteOffset","bufferSubData","subData","buffer","getData","getBufferSubData","deleteBuffer","resize","PrimitiveTopology","IndexBufferBinding","_buffer","VertexBufferBinding","stride","_stride","Primitive","instanceCount","_vertexElementMap","_glIndexType","_platformPrimitive","_vertexBufferBindings","_indexBufferBinding","_vertexElements","targets","createPlatformPrimitive","setVertexBufferBinding","bufferOrBinding","strideOrFirstIndex","firstIndex","binding","isBinding","bindings","_setVertexBufferBinding","setVertexBufferBindings","bufferBindings","needLength","setIndexBufferBinding","setVertexElements","_clearVertexElements","_addVertexElement","_draw","draw","vertexBufferBindings","vertexElementMap","_uvMacro","_normalMacro","_tangentMacro","_vertexColorMacro","_vertexAlphaMacro","semantic","lastBinding","VertexElement","offset","bindingIndex","instanceStepRate","normalized","_glElementInfo","_semantic","_offset","_bindingIndex","_instanceStepRate","SubPrimitive","topology","Triangles","SpriteRenderer","_uvRect","_worldSize","_positionQuad","_rotationAngle","_anchor","_texture","_rect","_worldSizeFactor","setRect","setAnchor","setUvRect","setWorldSize","leftTop","leftBottom","rightTop","rightBottom","rect","rectObject","JSON","parse","anchor","u","_updatePositionQuad","_transformByMatrix","matrix","_tempVec40","_tempVec41","_tempVec42","_tempVec43","vx","vy","c","ns","vz","transformByQuat","cx","cy","WrapMode","AnimationEventType","InterpolationType","TagetType","AnimationClip","duration","durationIndex","samplers","channels","addSampler","_input","_output","_outputSize","_interpolation","CUBICSPLINE","sampler","input","output","outputSize","interpolation","addChannel","samplerIndex","targetID","targetPath","bindSampler","tagetType","_tagetTypeMap","channel","pathType","other","getChannelCount","getChannelObject","channelIndex","getFrameCount","getFrameTime","frameIndex","getChannelTimeLength","frameCount","createChannelValue","evaluate","outValue","nextFrameIndex","alpha","evaluateCubicSpline","evaluateLinear","squared","cubed","part1","part2","part3","part4","t1","v1","t2","v2","_quaSlerp","aIndex","bIndex","ax","ay","az","aw","bx","by","bz","bw","omega","cosom","sinom","scale0","scale1","acos","sin","AnimationLayer","layerWeight","mixTagetLayer","isFading","fadeDeltaTime","crossFadeDuration","fadeDuration","crossFadeDeltaTime","isMixLayer","hasMixLayer","mixEntity","_activedEvents","_animClip","_isPlaying","_wrapMode","_channelStates","_animClipLength","_frameEvents","canMix","nextAnimClip","rootEntity","curChannel","curTargetObject","_findChannelTarget","nextChannel","nextTargetObject","mix","animClip","targetLayer","isPlaying","wrapMode","_addEvents","targetChannelStates","targetObject","frameTime","currentFrame","currentValue","mixWeight","channelTimeLength","removeMixWeight","play","LOOP","channelTargets","rightnow","ONCE","updateState","_activeEvents","playingCount","_updateChannelState","getChannelLayerWeight","getChannelValue","triggerEvents","jumpToFrame","channelState","animClipLength","lerpState","_getKeyAndAlpha","currentKey","nextKey","frameEventIndex","eventType","FRAME_EVENT","triggerTime","triggered","curFrameTime","frameEvent","LOOP_END","FINISHED","rootNode","targetSceneObject","keyTime","timeKeys","numKeys","keyLength","Animation","lerp","startValue","endValue","quat","slerp","_animLayers","animLayer","_updateValues","_removeRefMixLayers","addAnimationClip","_animSet","removeAnimationClip","getAnimationClipLength","getAnimationClip","playAnimationClip","_channelTargets","CrossFade","targetAnimLayer","mixBoneName","mixNode","channelTarget","_getChannelValue","values","weight","BufferGeometry","_primitive","_subGeometries","addSubGeometry","subGeometry","removeSubGeometry","subGeometries","clearSubGeometry","indexBufferBinding","vertexElements","GeometryRenderer","_material","_geometry","geometry","ShapeGeometry","_initialize","vertices","indices","vertexStride","_initBuffer","positionElement","vertexBuffer","indexBuffer","IndexBuffer","_computeBounds","vertexElement","bufferIndex","vertexBufferBinding","vertexCount","arrayBuffer","ArrayBuffer","dataView","DataView","Infinity","base","getFloat32","CuboidGeometry","halfWidth","halfHeight","halfDepth","SphereGeometry","horizontalSegments","verticalSegments","alphaStart","alphaRange","thetaStart","thetaRange","_parameters","_thetaEnd","initialize","grid","iy","verticesRow","ix","posX","posY","posZ","from","PlaneGeometry","CylinderGeometry","radiusTop","radiusBottom","radialSegments","heightSegments","openEnded","thetaLength","frontFace","CCW","indexArray","_vertices","_indices","generateTorso","generateCap","slope","indexRow","theta","sinTheta","cosTheta","vertX","vertY","vertZ","isTop","sign","centerIndexStart","centerIndexEnd","vertexX","vertexY","vertexZ","uvX","uvY","CircleGeometry","segments","segment","ScreenQuadGeometry","TriangleFan","TorusGeometry","parameters","tube","tubularSegments","arc","Model","_props","_geometryType","props","geometryType","GeometryType","Box","setProp","sphereRadius","sphereHorizontalSegments","sphereVerticalSegments","sphereAlphaStart","sphereAlphaRange","sphereThetaStart","sphereThetaRange","cylinderRadiusTop","cylinderRadiusBottom","cylinderHeight","cylinderRadialSegments","cylinderHeightSegments","cylinderOpenEnded","planeWidth","planeHeight","planeHorizontalSegments","planeVerticalSegments","boxWidth","boxHeight","boxDepth","SkyBoxMaterial","SkyBox","_skyBoxMap","_matrix","_initBounds","modelMatrix","view","proj","NEGATIVE_INFINITY","POSITIVE_INFINITY","DirtyFlagType","ParticleRendererBlendMode","ParticleRenderer","_getRandom","random","_vertexStride","_vertexBuffer","_maxCount","_positionRandomness","_positionArray","_velocity","_velocityRandomness","_acceleration","_accelerationRandomness","_colorRandomness","_size","_sizeRandomness","_alpha","_alphaRandomness","_startAngle","_startAngleRandomness","_rotateVelocity","_rotateVelocityRandomness","_lifetime","_startTimeRandomness","_isOnce","_isInit","_isStart","_updateDirtyFlag","_isRotateToVelocity","_isUseOriginColor","_isScaleByLifetime","_is2d","_isFadeIn","_isFadeOut","_playOnEnable","_blendMode","spriteSheet","_createMaterial","_updateBuffer","isUseOriginColor","is2d","isFadeOut","_createGeometry","vertexFloatCount","startIndex","_updateSingleBuffer","getRandom","k0","k1","k2","k3","Position","pos","Velocity","Acceleration","clamp","Apha","StartTime","LifeTime","Size","Scale","StartAngle","RotateVelocity","_updateSingleUv","q","ratio","Additive","VERT_SHADER","FRAG_SHADER","TrailMaterial","_tempVector3","TrailRenderer","_stroke","_minSeg","_maxPointNum","_points","_pointStates","_strapPoints","_curPointNum","_prePointsNum","stroke","minSeg","lifetime","targetFrameRate","_initGeometry","mov","newIdx","appendNewPoint","lastPoint","_updateStrapVertices","_updateStrapCoords","TriangleStrip","points","down","dy","cross","perpVector","vertieces","_projectOnPlane","p0","texDelta","_projectOnVector","n_p","cosine","BoxCollider","_center","isShowCollider","SphereCollider","__center","__radius","_radius","intersectBox2Box","boxA","boxB","intersectSphere2Sphere","sphereA","sphereB","intersectSphere2Box","sphere","box","closestPoint","CollisionDetection","_colliderManager","_myCollider","_overlopCollider","_sphere","_box","overlopCollider","_updateWorldBox","_boxCollision","_getWorldSphere","_sphereCollision","boxCollider","_tempBox1","sphereCollider","_tempBox2","ACollider","applyMixins","derivedCtor","baseCtors","baseCtor","getOwnPropertyNames","Fog","EXP2Fog","_density","density","_densityProperty","LinearFog","_near","_far","near","far","_nearProperty","_farProperty","Probe","probeLayer","_oriCameraRenderTarget","_renderTargetSwap","_oriCameraCullingMask","onTextureChange","renderColorTexture","_reset","cacheTarget","cacheUp","cacheDir","CubeProbe","oriViewMatrix","_oriFieldOfView","_storeCamera","_setCamera","_restoreCamera","fieldOfView","LightShadow","_viewMatFromLightProperty","_projMatFromLightProperty","_shadowBiasProperty","bias","_shadowIntensityProperty","_shadowRadiusProperty","_shadowMapSizeProperty","mapSize","_shadowMapsProperty","clearMap","_mapSize","initShadowProjectionMatrix","fov","sqrt","appendData","viewStart","projectionStart","biasStart","intensityStart","radiusStart","mapSizeStart","mapStart","defineProperty","_enableShadow","shadow","_recieveShadow","_castShadow","ShadowMapMaterial","ShadowMapPass","ShadowMaterial","ShadowPass","shadowMapCount","lgt","enableShadow","ShadowFeature","_shadowPass","_shadowMapMaterial","addShadowPass","shadowMapPass","addShadowMapPass","updatePassRenderFlag","shadowMaterial","Layer30","Layer31","renderQueue","recieveShadow","castShadow"],"mappings":"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"}