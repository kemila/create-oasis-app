{"version":3,"file":"module.js","sources":["../src/WebCanvas.ts","../src/GLCapability.ts","../src/GLExtensions.ts","../src/GLPrimitive.ts","../src/GLRenderStates.ts","../src/GLSprite.ts","../src/GLSpriteMaterial.ts","../src/GLSpriteBatcher.ts","../src/WebGLRenderer.ts","../src/WebGLEngine.ts"],"sourcesContent":["import { Canvas } from \"@oasis-engine/core\";\nimport { Vector2 } from \"@oasis-engine/math\";\n\n/**\n * The canvas used on the web, which can support HTMLCanvasElement and OffscreenCanvas.\n */\nexport class WebCanvas implements Canvas {\n  _webCanvas: HTMLCanvasElement | OffscreenCanvas;\n\n  private _width: number;\n  private _height: number;\n  private _scale: Vector2 = new Vector2();\n\n  /**\n   * @inheritdoc\n   */\n  get width(): number {\n    return this._width;\n  }\n\n  set width(value: number) {\n    if (this._width !== value) {\n      this._webCanvas.width = value;\n      this._width = value;\n    }\n  }\n\n  /**\n   * @inheritdoc\n   */\n  get height(): number {\n    return this._height;\n  }\n\n  set height(value: number) {\n    if (this._height !== value) {\n      this._webCanvas.height = value;\n      this._height = value;\n    }\n  }\n\n  /**\n   * The scale of canvas, the value is visible width/height divide the render width/height.\n   * @remarks Need to re-assign after modification to ensure that the modification takes effect.\n   */\n  get scale(): Vector2 {\n    const webCanvas = this._webCanvas;\n    if (webCanvas instanceof HTMLCanvasElement) {\n      this._scale.setValue(\n        (webCanvas.clientWidth * devicePixelRatio) / webCanvas.width,\n        (webCanvas.clientHeight * devicePixelRatio) / webCanvas.height\n      );\n    }\n    return this._scale;\n  }\n\n  set scale(value: Vector2) {\n    const webCanvas = this._webCanvas;\n    if (webCanvas instanceof HTMLCanvasElement) {\n      webCanvas.style.transformOrigin = `left top`;\n      webCanvas.style.transform = `scale(${value.x}, ${value.y})`;\n    }\n  }\n\n  /**\n   * Resize the rendering size according to the clientWidth and clientHeight of the canvas.\n   * @param pixelRatio - Pixel ratio\n   */\n  resizeByClientSize(pixelRatio: number = window.devicePixelRatio): void {\n    const webCanvas = this._webCanvas;\n    if (webCanvas instanceof HTMLCanvasElement) {\n      const width = webCanvas.clientWidth;\n      const height = webCanvas.clientHeight;\n      this.width = width * pixelRatio;\n      this.height = height * pixelRatio;\n    }\n  }\n\n  /**\n   * Create a web canvas.\n   * @param webCanvas - Web native canvas\n   */\n  constructor(webCanvas: HTMLCanvasElement | OffscreenCanvas) {\n    const width = webCanvas.width;\n    const height = webCanvas.height;\n    this._webCanvas = webCanvas;\n    this._width = width;\n    this._height = height;\n  }\n\n  /**\n   * Set scale.\n   * @param x - Scale along the X axis\n   * @param y - Scale along the Y axis\n   */\n  setScale(x: number, y: number): void {\n    this._scale.setValue(x, y);\n    this.scale = this._scale;\n  }\n}\n","import { WebGLRenderer } from \"./WebGLRenderer\";\nimport { GLCapabilityType, GLCompressedTextureInternalFormat } from \"@oasis-engine/core\";\n\ntype extensionKey = string;\n\n/**\n * GL capability.\n */\nexport class GLCapability {\n  private _maxDrawBuffers: number;\n  private _maxAnisoLevel: number;\n  private _maxAntiAliasing: number;\n\n  _rhi: WebGLRenderer;\n  capabilityList: Map<GLCapabilityType, boolean>;\n\n  get maxDrawBuffers() {\n    if (!this._maxDrawBuffers) {\n      if (this.canIUse(GLCapabilityType.drawBuffers)) {\n        this._maxDrawBuffers = this._rhi.gl.getParameter(this._rhi.gl.MAX_DRAW_BUFFERS);\n      } else {\n        this._maxDrawBuffers = 1;\n      }\n    }\n    return this._maxDrawBuffers;\n  }\n\n  /**\n   * Max anisoLevel.\n   */\n  get maxAnisoLevel(): number {\n    if (!this._maxAnisoLevel) {\n      const ext = this._rhi.requireExtension(GLCapabilityType.textureFilterAnisotropic);\n      this._maxAnisoLevel = ext ? this._rhi.gl.getParameter(ext.MAX_TEXTURE_MAX_ANISOTROPY_EXT) : 1;\n    }\n    return this._maxAnisoLevel;\n  }\n\n  /**\n   * Max MSAA count.\n   */\n  get maxAntiAliasing(): number {\n    if (!this._maxAntiAliasing) {\n      const gl = this._rhi.gl;\n      const canMSAA = this.canIUse(GLCapabilityType.multipleSample);\n\n      this._maxAntiAliasing = canMSAA ? gl.getParameter(gl.MAX_SAMPLES) : 1;\n    }\n    return this._maxAntiAliasing;\n  }\n\n  get rhi() {\n    return this._rhi;\n  }\n\n  constructor(rhi: WebGLRenderer) {\n    this._rhi = rhi;\n    this.capabilityList = new Map();\n\n    this.init();\n    this.compatibleAllInterface();\n  }\n\n  /**\n   * Check device capabilities.\n   */\n  public canIUse(capabilityType: GLCapabilityType): boolean {\n    return this.capabilityList.get(capabilityType);\n  }\n\n  /**\n   * Check if can use some compressed texture format.\n   */\n  public canIUseCompressedTextureInternalFormat(internalType: GLCompressedTextureInternalFormat): boolean {\n    const {\n      // astc\n      RGBA_ASTC_4X4_KHR,\n      RGBA_ASTC_12X12_KHR,\n      SRGB8_ALPHA8_ASTC_4X4_KHR,\n      SRGB8_ALPHA8_ASTC_12X12_KHR,\n      // etc1\n      RGB_ETC1_WEBGL,\n      // etc\n      R11_EAC,\n      SRGB8_ALPHA8_ETC2_EAC,\n      // pvrtc\n      RGB_PVRTC_4BPPV1_IMG,\n      RGBA_PVRTC_2BPPV1_IMG,\n      // s3tc\n      RGB_S3TC_DXT1_EXT,\n      RGBA_S3TC_DXT5_EXT\n    } = GLCompressedTextureInternalFormat;\n    if (\n      (internalType >= RGBA_ASTC_4X4_KHR && RGBA_ASTC_12X12_KHR <= RGBA_ASTC_12X12_KHR) ||\n      (internalType >= SRGB8_ALPHA8_ASTC_4X4_KHR && internalType <= SRGB8_ALPHA8_ASTC_12X12_KHR)\n    ) {\n      return this.canIUse(GLCapabilityType.astc);\n    } else if (internalType === RGB_ETC1_WEBGL) {\n      return this.canIUse(GLCapabilityType.etc1);\n    } else if (internalType >= R11_EAC && internalType <= SRGB8_ALPHA8_ETC2_EAC) {\n      return this.canIUse(GLCapabilityType.etc);\n    } else if (internalType >= RGB_PVRTC_4BPPV1_IMG && internalType <= RGBA_PVRTC_2BPPV1_IMG) {\n      return this.canIUse(GLCapabilityType.pvrtc);\n    } else if (internalType >= RGB_S3TC_DXT1_EXT && internalType <= RGBA_S3TC_DXT5_EXT) {\n      return this.canIUse(GLCapabilityType.s3tc);\n    }\n    return false;\n  }\n\n  /**\n   * If can use more joints.\n   */\n  public get canIUseMoreJoints() {\n    return (\n      this.canIUse(GLCapabilityType.textureFloat) &&\n      this.rhi.renderStates.getParameter(this.rhi.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS) > 0\n    );\n  }\n\n  /**\n   *  Init capabilities.\n   */\n  private init() {\n    const cap = this.capabilityList;\n    const { isWebGL2 } = this.rhi;\n    const requireExtension = this.rhi.requireExtension.bind(this.rhi);\n\n    const {\n      standardDerivatives,\n      shaderTextureLod,\n      elementIndexUint,\n      depthTexture,\n      vertexArrayObject,\n      instancedArrays,\n      multipleSample,\n      drawBuffers,\n\n      astc,\n      astc_webkit,\n      etc,\n      etc_webkit,\n      etc1,\n      etc1_webkit,\n      pvrtc,\n      pvrtc_webkit,\n      s3tc,\n      s3tc_webkit,\n\n      textureFloat,\n      textureHalfFloat,\n      textureFloatLinear,\n      textureHalfFloatLinear,\n      WEBGL_colorBufferFloat,\n      colorBufferFloat,\n      colorBufferHalfFloat,\n      textureFilterAnisotropic\n    } = GLCapabilityType;\n    cap.set(standardDerivatives, isWebGL2 || !!requireExtension(standardDerivatives));\n    cap.set(shaderTextureLod, isWebGL2 || !!requireExtension(shaderTextureLod));\n    cap.set(elementIndexUint, isWebGL2 || !!requireExtension(elementIndexUint));\n    cap.set(depthTexture, isWebGL2 || !!requireExtension(depthTexture));\n    cap.set(vertexArrayObject, isWebGL2 || !!requireExtension(vertexArrayObject));\n    cap.set(instancedArrays, isWebGL2 || !!requireExtension(instancedArrays));\n    cap.set(multipleSample, isWebGL2);\n    cap.set(drawBuffers, isWebGL2 || !!requireExtension(drawBuffers));\n    cap.set(textureFloat, isWebGL2 || !!requireExtension(textureFloat));\n    cap.set(textureHalfFloat, isWebGL2 || !!requireExtension(textureHalfFloat));\n    cap.set(textureFloatLinear, !!requireExtension(textureFloatLinear));\n    cap.set(textureHalfFloatLinear, isWebGL2 || !!requireExtension(textureHalfFloatLinear));\n    cap.set(\n      colorBufferFloat,\n      (isWebGL2 && !!requireExtension(colorBufferFloat)) || !!requireExtension(WEBGL_colorBufferFloat)\n    );\n    cap.set(\n      colorBufferHalfFloat,\n      (isWebGL2 && !!requireExtension(colorBufferFloat)) || !!requireExtension(colorBufferHalfFloat)\n    );\n    cap.set(textureFilterAnisotropic, !!requireExtension(textureFilterAnisotropic));\n\n    cap.set(astc, !!(requireExtension(astc) || requireExtension(astc_webkit)));\n    cap.set(etc, !!(requireExtension(etc) || requireExtension(etc_webkit)));\n    cap.set(etc1, !!(requireExtension(etc1) || requireExtension(etc1_webkit)));\n    cap.set(pvrtc, !!(requireExtension(pvrtc) || requireExtension(pvrtc_webkit)));\n    cap.set(s3tc, !!(requireExtension(s3tc) || requireExtension(s3tc_webkit)));\n  }\n\n  /**\n   * If there are extensions that can supplement this ability, smooth out the difference.\n   * @example\n   * compatible(GLCapabilityType.depthTexture,{\n   *    UNSIGNED_INT_24_8: \"UNSIGNED_INT_24_8_WEBGL\"\n   * })\n   * gl.UNSIGNED_INT_24_8 = ext.UNSIGNED_INT_24_8_WEBGL\n   */\n  private compatibleInterface(capabilityType: GLCapabilityType, flatItem: { [glKey: string]: extensionKey }) {\n    const rhi = this.rhi;\n    const gl = rhi.gl;\n    let ext = null;\n\n    if ((ext = rhi.requireExtension(capabilityType))) {\n      for (let glKey in flatItem) {\n        const extensionKey = flatItem[glKey];\n        const extensionVal = ext[extensionKey];\n\n        // Mini game hack the native function,use “.bind” to smooth out if is “Funcion”.\n        if (extensionVal?.bind) {\n          gl[glKey] = extensionVal.bind(ext);\n        } else {\n          gl[glKey] = extensionVal;\n        }\n      }\n    }\n  }\n\n  private compatibleAllInterface() {\n    const {\n      depthTexture,\n      vertexArrayObject,\n      instancedArrays,\n      drawBuffers,\n      textureFilterAnisotropic,\n      textureHalfFloat,\n      colorBufferHalfFloat,\n      WEBGL_colorBufferFloat\n    } = GLCapabilityType;\n    const { isWebGL2 } = this.rhi;\n\n    if (!isWebGL2) {\n      this.compatibleInterface(depthTexture, {\n        UNSIGNED_INT_24_8: \"UNSIGNED_INT_24_8_WEBGL\"\n      });\n      this.compatibleInterface(vertexArrayObject, {\n        createVertexArray: \"createVertexArrayOES\",\n        deleteVertexArray: \"deleteVertexArrayOES\",\n        isVertexArray: \"isVertexArrayOES\",\n        bindVertexArray: \"bindVertexArrayOES\"\n      });\n      this.compatibleInterface(instancedArrays, {\n        drawArraysInstanced: \"drawArraysInstancedANGLE\",\n        drawElementsInstanced: \"drawElementsInstancedANGLE\",\n        vertexAttribDivisor: \"vertexAttribDivisorANGLE\"\n      });\n      this.compatibleInterface(drawBuffers, {\n        MAX_DRAW_BUFFERS: \"MAX_DRAW_BUFFERS_WEBGL\"\n      });\n      const items = {};\n      if (this.canIUse(GLCapabilityType.drawBuffers)) {\n        const maxDrawBuffers = this.maxDrawBuffers;\n        for (let i = 0; i < maxDrawBuffers; i++) {\n          i != 0 && (items[`COLOR_ATTACHMENT${i}`] = `COLOR_ATTACHMENT${i}_WEBGL`);\n          items[`DRAW_BUFFER${i}`] = `DRAW_BUFFER${i}_WEBGL`;\n        }\n        this.compatibleInterface(drawBuffers, {\n          drawBuffers: \"drawBuffersWEBGL\",\n          ...items\n        });\n      }\n      this.compatibleInterface(textureHalfFloat, {\n        HAFL_FLOAT: \"HALF_FLOAT_OES\"\n      });\n      this.compatibleInterface(colorBufferHalfFloat, {\n        RGBA16F: \"RBGA16F_EXT\"\n      });\n      this.compatibleInterface(WEBGL_colorBufferFloat, {\n        RGBA32F: \"RBGA32F_EXT\"\n      });\n    }\n\n    this.compatibleInterface(textureFilterAnisotropic, {\n      TEXTURE_MAX_ANISOTROPY_EXT: \"TEXTURE_MAX_ANISOTROPY_EXT\"\n    });\n  }\n}\n","import { WebGLRenderer } from \"./WebGLRenderer\";\nimport { GLCapabilityType } from \"@oasis-engine/core\";\n\n/**\n * GLContext extension.\n */\nexport class GLExtensions {\n  private rhi: WebGLRenderer;\n  private _requireResult;\n\n  constructor(rhi: WebGLRenderer) {\n    this.rhi = rhi;\n    this._requireResult = {};\n  }\n\n  /**\n   * Require an extension.\n   */\n  requireExtension(ext: GLCapabilityType) {\n    if (this._requireResult[ext] !== undefined) {\n      return this._requireResult[ext];\n    }\n\n    this._requireResult[ext] = this.rhi.gl.getExtension(ext);\n    return this._requireResult[ext];\n  }\n}\n","import { GLCapabilityType, Logger, Primitive } from \"@oasis-engine/core\";\nimport { SubPrimitive } from \"@oasis-engine/core/types/graphic/SubPrimitive\";\nimport { IPlatformPrimitive } from \"@oasis-engine/design\";\nimport { WebGLExtension } from \"./type\";\nimport { WebGLRenderer } from \"./WebGLRenderer\";\n\n/**\n * Improvement of VAO:\n * 1) WebGL2.0 must support VAO, almost all devices support vao extensions in webgl1.0, we can use PollyFill,only keep VAO mode.\n * 2) VAO implementation now has bugs, change IndexBuffer、VertexBuffer、VertexElements need to update VAO.\n */\n\n/**\n * GL platform primtive.\n */\nexport class GLPrimitive implements IPlatformPrimitive {\n  protected readonly _primitive: Primitive;\n  protected attribLocArray: number[];\n  protected readonly canUseInstancedArrays: boolean;\n\n  private gl: (WebGLRenderingContext & WebGLExtension) | WebGL2RenderingContext;\n  private vao: Map<number, WebGLVertexArrayObject> = new Map();\n  private readonly _useVao: boolean;\n\n  constructor(rhi: WebGLRenderer, primitive: Primitive) {\n    this._primitive = primitive;\n    this.canUseInstancedArrays = rhi.canIUse(GLCapabilityType.instancedArrays);\n    this._useVao = rhi.canIUse(GLCapabilityType.vertexArrayObject);\n    this.gl = rhi.gl;\n  }\n\n  /**\n   * Draw the primitive.\n   */\n  draw(shaderProgram: any, subPrimitive: SubPrimitive) {\n    const gl = this.gl;\n    const primitive = this._primitive;\n\n    if (this._useVao) {\n      if (!this.vao.has(shaderProgram.id)) {\n        this.registerVAO(shaderProgram);\n      }\n      const vao = this.vao.get(shaderProgram.id);\n      gl.bindVertexArray(vao);\n    } else {\n      this.bindBufferAndAttrib(shaderProgram);\n    }\n\n    const { indexBufferBinding, instanceCount, _glIndexType } = primitive;\n    const { topology, start, count } = subPrimitive;\n\n    if (!instanceCount) {\n      if (indexBufferBinding) {\n        if (this._useVao) {\n          gl.drawElements(topology, count, _glIndexType, start);\n        } else {\n          const { _nativeBuffer } = indexBufferBinding.buffer;\n          gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, _nativeBuffer);\n          gl.drawElements(topology, count, _glIndexType, start);\n          gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n        }\n      } else {\n        gl.drawArrays(topology, start, count);\n      }\n    } else {\n      if (this.canUseInstancedArrays) {\n        if (indexBufferBinding) {\n          if (this._useVao) {\n            gl.drawElementsInstanced(topology, count, _glIndexType, start, instanceCount);\n          } else {\n            const { _nativeBuffer } = indexBufferBinding.buffer;\n            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, _nativeBuffer);\n            gl.drawElementsInstanced(topology, count, _glIndexType, start, instanceCount);\n            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n          }\n        } else {\n          gl.drawArraysInstanced(topology, start, count, instanceCount);\n        }\n      } else {\n        Logger.error(\"ANGLE_instanced_arrays extension is not supported\");\n      }\n    }\n\n    // unbind\n    if (this._useVao) {\n      gl.bindVertexArray(null);\n    } else {\n      this.disableAttrib();\n    }\n  }\n\n  destroy() {\n    if (this._useVao) {\n      const gl = this.gl;\n      this.vao.forEach((vao) => {\n        gl.deleteVertexArray(vao);\n      });\n    }\n  }\n\n  /**\n   * Bind buffer and attribute.\n   */\n  protected bindBufferAndAttrib(shaderProgram: any) {\n    const gl = this.gl;\n    const primitive = this._primitive;\n    const vertexBufferBindings = primitive.vertexBufferBindings;\n\n    this.attribLocArray = [];\n    const attributeLocation = shaderProgram.attributeLocation;\n    const attributes = primitive._vertexElementMap;\n\n    let vbo: WebGLBuffer;\n    let lastBoundVbo: WebGLBuffer;\n\n    for (const name in attributeLocation) {\n      const loc = attributeLocation[name];\n      if (loc === -1) continue;\n\n      const element = attributes[name];\n      if (element) {\n        const { buffer, stride } = vertexBufferBindings[element.bindingIndex];\n        vbo = buffer._nativeBuffer;\n        // prevent binding the vbo which already bound at the last loop, e.g. a buffer with multiple attributes.\n        if (lastBoundVbo !== vbo) {\n          lastBoundVbo = vbo;\n          gl.bindBuffer(gl.ARRAY_BUFFER, vbo);\n        }\n\n        gl.enableVertexAttribArray(loc);\n        const { size, type } = element._glElementInfo;\n        gl.vertexAttribPointer(loc, size, type, element.normalized, stride, element.offset);\n        if (this.canUseInstancedArrays) {\n          gl.vertexAttribDivisor(loc, element.instanceDivisor);\n        }\n        this.attribLocArray.push(loc);\n      } else {\n        Logger.warn(\"vertex attribute not found: \" + name);\n      }\n    }\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, null);\n  }\n\n  protected disableAttrib() {\n    const gl = this.gl;\n    for (let i = 0, l = this.attribLocArray.length; i < l; i++) {\n      gl.disableVertexAttribArray(this.attribLocArray[i]);\n    }\n  }\n\n  private registerVAO(shaderProgram: any): void {\n    const gl = this.gl;\n    const vao = gl.createVertexArray();\n\n    /** register VAO */\n    gl.bindVertexArray(vao);\n\n    const { indexBufferBinding } = this._primitive;\n    if (indexBufferBinding) {\n      gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBufferBinding.buffer._nativeBuffer);\n    }\n    this.bindBufferAndAttrib(shaderProgram);\n\n    /** unbind */\n    gl.bindVertexArray(null);\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n    this.disableAttrib();\n\n    this.vao.set(shaderProgram.id, vao);\n  }\n}\n","/**\n * @private\n */\nexport class GLRenderStates {\n  private _gl: WebGLRenderingContext;\n  private _parameters = {};\n  /**\n   * @param {WebGLRenderingContext} gl\n   */\n  constructor(gl: WebGLRenderingContext) {\n    this._gl = gl;\n    this._parameters = {}; // current gl state parameters\n\n    /** cache */\n    this._parameters[gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS] = gl.getParameter(gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS);\n    this._parameters[gl.MAX_VERTEX_UNIFORM_VECTORS] = gl.getParameter(gl.MAX_VERTEX_UNIFORM_VECTORS);\n    this._parameters[gl.MAX_VERTEX_ATTRIBS] = gl.getParameter(gl.MAX_VERTEX_ATTRIBS);\n    this._parameters[gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS] = gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS);\n\n    // init blend state same as BlendState default value.\n    gl.blendFuncSeparate(gl.ONE, gl.ZERO, gl.ONE, gl.ZERO);\n    gl.blendEquationSeparate(gl.FUNC_ADD, gl.FUNC_ADD);\n    gl.colorMask(true, true, true, true);\n    gl.blendColor(0, 0, 0, 0);\n    gl.disable(gl.SAMPLE_ALPHA_TO_COVERAGE);\n\n    // init depth state same as DpethState default value.\n    gl.enable(gl.DEPTH_TEST);\n    gl.depthFunc(gl.LESS);\n    gl.depthMask(true);\n\n    // init stencil state same as StencilState default value.\n    gl.disable(gl.STENCIL_TEST);\n    gl.stencilFuncSeparate(gl.FRONT, gl.ALWAYS, 0, 0xff);\n    gl.stencilFuncSeparate(gl.BACK, gl.ALWAYS, 0, 0xff);\n    gl.stencilOpSeparate(gl.FRONT, gl.KEEP, gl.KEEP, gl.KEEP);\n    gl.stencilOpSeparate(gl.BACK, gl.KEEP, gl.KEEP, gl.KEEP);\n    gl.stencilMask(0xff);\n\n    // init raster state same as RasterState default value.\n    gl.enable(gl.CULL_FACE);\n    gl.cullFace(gl.BACK);\n    gl.disable(gl.POLYGON_OFFSET_FILL);\n    gl.polygonOffset(0, 0);\n  }\n\n  /**\n   * Get a parameter.\n   */\n  getParameter(pname) {\n    return this._parameters[pname];\n  }\n}\n","import { Logger } from \"@oasis-engine/core\";\nimport { Vector2, Vector3, Vector4 } from \"@oasis-engine/math\";\n\n/**\n * @private\n */\nexport class GLSprite {\n  private gl: WebGLRenderingContext;\n  private _vbo: WebGLBuffer;\n  private _maxBatchCount: number;\n  private _vertBuffer;\n  private _vertCursor: number;\n  private _drawSpriteCount: number;\n  private _vertAttributes;\n  constructor(gl) {\n    this.gl = gl;\n\n    //-- vertex attributes\n    this._initVertexAttributes(gl);\n\n    this._vbo = gl.createBuffer();\n    this._maxBatchCount = 0;\n    this._vertBuffer = null;\n    this._vertCursor = 0;\n    this._drawSpriteCount = 0;\n  }\n\n  setMaxBatchCount(count) {\n    const requireSize = count * 6 * 9;\n    if (this._vertBuffer && this._vertBuffer.length >= requireSize) {\n      return;\n    }\n\n    this._maxBatchCount = count;\n    this._vertBuffer = new Float32Array(requireSize);\n  }\n\n  beginDraw(count) {\n    this._vertCursor = 0;\n    this._drawSpriteCount = 0;\n\n    // Dynamic resize\n    if (count > this._maxBatchCount) {\n      this.setMaxBatchCount(count);\n    }\n  }\n\n  drawSprite(positionQuad, uvRect, tintColor) {\n    this._drawSpriteCount++;\n    if (this._drawSpriteCount > this._maxBatchCount) {\n      Logger.warn(\"Sprite: sprite count overflow\");\n      return;\n    }\n\n    const color = tintColor;\n\n    const u = uvRect.u;\n    const v = uvRect.v;\n    const p = uvRect.u + uvRect.width;\n    const q = uvRect.v + uvRect.height;\n\n    this._pushVertex(positionQuad.leftTop, new Vector2(u, v), color);\n    this._pushVertex(positionQuad.leftBottom, new Vector2(u, q), color);\n    this._pushVertex(positionQuad.rightBottom, new Vector2(p, q), color);\n\n    this._pushVertex(positionQuad.rightBottom, new Vector2(p, q), color);\n    this._pushVertex(positionQuad.rightTop, new Vector2(p, v), color);\n    this._pushVertex(positionQuad.leftTop, new Vector2(u, v), color);\n  }\n\n  endDraw(shaderProgram) {\n    const vertCount = this._vertCursor / 9;\n    if (vertCount <= 0) return;\n\n    var gl = this.gl;\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n    gl.bindBuffer(gl.ARRAY_BUFFER, this._vbo);\n    gl.bufferData(gl.ARRAY_BUFFER, this._vertBuffer, gl.DYNAMIC_DRAW);\n\n    const attributeLocation = shaderProgram.attributeLocation;\n    for (const k in attributeLocation) {\n      const location = attributeLocation[k];\n      const attrib = this._vertAttributes[k];\n      gl.vertexAttribPointer(location, attrib.size, attrib.type, attrib.normalized, attrib.stride, attrib.offset);\n      gl.enableVertexAttribArray(location);\n    }\n\n    gl.drawArrays(gl.TRIANGLES, 0, vertCount);\n\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n    gl.bindBuffer(gl.ARRAY_BUFFER, null);\n    // disable attributes\n    for (const k in attributeLocation) {\n      gl.disableVertexAttribArray(attributeLocation[k]);\n    }\n  }\n\n  _initVertexAttributes(gl) {\n    const vertexStride = (3 + 2 + 4) * 4;\n    const posAtt: any = {};\n    posAtt.name = \"a_pos\";\n    posAtt.size = 3;\n    posAtt.offset = 0;\n\n    const uvAtt: any = {};\n    uvAtt.name = \"a_uv\";\n    uvAtt.size = 2;\n    uvAtt.offset = 3 * 4;\n\n    const colorAtt: any = {};\n    colorAtt.name = \"a_color\";\n    colorAtt.size = 4;\n    colorAtt.offset = 5 * 4;\n\n    this._vertAttributes = { a_pos: posAtt, a_uv: uvAtt, a_color: colorAtt };\n    for (const k in this._vertAttributes) {\n      const att = this._vertAttributes[k];\n      att.type = gl.FLOAT;\n      att.normalized = false;\n      att.stride = vertexStride;\n    }\n  }\n\n  _pushVertex(pos: Vector3, uv: Vector2, color: Vector4) {\n    const vb = this._vertBuffer;\n    const id = this._vertCursor;\n\n    //-- pos\n    vb[id] = pos.x;\n    vb[id + 1] = pos.y;\n    vb[id + 2] = pos.z;\n\n    //-- uv\n    vb[id + 3] = uv.x;\n    vb[id + 4] = uv.y;\n\n    //-- color\n    vb[id + 5] = color.x;\n    vb[id + 6] = color.y;\n    vb[id + 7] = color.z;\n    vb[id + 8] = color.w;\n\n    //--\n    this._vertCursor += 9;\n  }\n\n  finalize() {\n    if (this._vbo) {\n      this.gl.deleteBuffer(this._vbo);\n      this._vbo = null;\n    }\n  }\n}\n","\"use strict\";\n\nimport { Shader } from \"@oasis-engine/core\";\n\nconst spriteVertShader = `\nprecision highp float;\n\nuniform mat4 matProjection;\nuniform mat4 matView;\n\nattribute vec3 a_pos;\nattribute vec2 a_uv;\nattribute vec4 a_color;\n\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nvoid main()\n{\n  gl_Position = matProjection * matView * vec4(a_pos,1.0);\n  v_uv = a_uv;\n  v_color = a_color;\n}\n`;\n\nconst spriteFragmentShader = `\nprecision mediump float;\nprecision mediump int;\n\nuniform sampler2D s_diffuse;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nvoid main()\n{\n  // Only use the Alpha of the texture as a mask, so that the tint color can still be controlled to fade out.\n  vec4 baseColor = texture2D(s_diffuse, v_uv);\n  gl_FragColor = baseColor * v_color;\n}\n`;\n\nShader.create(\"Sprite\", spriteVertShader, spriteFragmentShader);\n","import { Camera, Engine, Logger, Material, RenderQueue } from \"@oasis-engine/core\";\nimport { GLSprite } from \"./GLSprite\";\nimport \"./GLSpriteMaterial\";\n\n/**\n * @private\n */\nexport class GLSpriteBatcher {\n  private _gl: WebGLRenderingContext;\n  private _batchedQueue;\n  private _targetTexture;\n  private _glSprite: GLSprite;\n  private _camera;\n\n  constructor(rhi) {\n    this._gl = rhi.gl;\n\n    this._batchedQueue = [];\n    this._targetTexture = null;\n\n    this._glSprite = new GLSprite(rhi.gl);\n\n    this._camera = null;\n  }\n\n  flush(engine: Engine, material: Material) {\n    if (this._batchedQueue.length === 0) {\n      return;\n    }\n\n    if (!this._targetTexture) {\n      Logger.error(\"No texture!\");\n      return;\n    }\n\n    const materialData = material.shaderData;\n    materialData.setTexture(\"s_diffuse\", this._targetTexture);\n    materialData.setMatrix(\"matView\", this._camera.viewMatrix);\n    materialData.setMatrix(\"matProjection\", this._camera.projectionMatrix);\n\n    //@ts-ignore\n    const compileMacros = RenderQueue.compileMacros;\n    compileMacros.clear();\n\n    //@ts-ignore\n    const program = material.shader._getShaderProgram(engine, compileMacros);\n    if (!program.isValid) {\n      return;\n    }\n\n    program.bind();\n    program.groupingOtherUniformBlock();\n    program.uploadAll(program.materialUniformBlock, materialData);\n\n    //@ts-ignore\n    material.renderState._apply(engine);\n\n    this._glSprite.beginDraw(this._batchedQueue.length);\n    for (let i = 0, len = this._batchedQueue.length; i < len; i++) {\n      const positionQuad = this._batchedQueue[i].positionQuad;\n      const uvRect = this._batchedQueue[i].uvRect;\n      const tintColor = this._batchedQueue[i].tintColor;\n      this._glSprite.drawSprite(positionQuad, uvRect, tintColor);\n    }\n    this._glSprite.endDraw(program);\n\n    this._batchedQueue = [];\n    this._targetTexture = null;\n    this._camera = null;\n  }\n\n  canBatch(texture, renderMode, camera: Camera) {\n    if (this._targetTexture === null) {\n      return true;\n    }\n    return texture === this._targetTexture && camera === this._camera;\n  }\n\n  drawSprite(material: Material, positionQuad, uvRect, tintColor, texture, renderMode, camera: Camera) {\n    if (!this.canBatch(texture, renderMode, camera)) {\n      this.flush(camera.engine, material);\n    }\n\n    this._targetTexture = texture;\n    this._camera = camera;\n    this._batchedQueue.push({ positionQuad, uvRect, tintColor });\n  }\n\n  finalize() {\n    this._glSprite.finalize();\n  }\n}\n","import {\n  Camera,\n  Canvas,\n  ClearMode,\n  ColorWriteMask,\n  Engine,\n  GLCapabilityType,\n  HardwareRenderer,\n  Logger,\n  Material,\n  Primitive,\n  RenderTarget,\n  SubPrimitive,\n  TextureCubeFace\n} from \"@oasis-engine/core\";\nimport { IPlatformPrimitive } from \"@oasis-engine/design\";\nimport { Vector4 } from \"@oasis-engine/math\";\nimport { GLCapability } from \"./GLCapability\";\nimport { GLExtensions } from \"./GLExtensions\";\nimport { GLPrimitive } from \"./GLPrimitive\";\nimport { GLRenderStates } from \"./GLRenderStates\";\nimport { GLSpriteBatcher } from \"./GLSpriteBatcher\";\nimport { WebGLExtension } from \"./type\";\nimport { WebCanvas } from \"./WebCanvas\";\n\n/**\n * WebGL mode.\n */\nexport enum WebGLMode {\n  /** Auto, use WebGL2.0 if support, or will fallback to WebGL1.0. */\n  Auto = 0,\n  /** WebGL2.0. */\n  WebGL2 = 1,\n  /** WebGL1.0, */\n  WebGL1 = 2\n}\n\n/**\n * WebGL renderer options.\n */\nexport interface WebGLRendererOptions extends WebGLContextAttributes {\n  /** WebGL mode.*/\n  webGLMode?: WebGLMode;\n}\n\n/**\n * WebGL renderer, including WebGL1.0 and WebGL2.0.\n */\nexport class WebGLRenderer implements HardwareRenderer {\n  _currentBind: any;\n\n  private _options: WebGLRendererOptions;\n  private _gl: (WebGLRenderingContext & WebGLExtension) | WebGL2RenderingContext;\n  private _renderStates;\n  private _extensions;\n  private _spriteBatcher;\n  private _capability: GLCapability;\n  private _isWebGL2: boolean;\n\n  private _activedTextureID: number;\n  private _activeTextures: WebGLTexture[] = new Array(32);\n\n  get isWebGL2() {\n    return this._isWebGL2;\n  }\n\n  constructor(options: WebGLRendererOptions = {}) {\n    this._options = options;\n  }\n\n  init(canvas: Canvas) {\n    const option = this._options;\n    const webCanvas = (canvas as WebCanvas)._webCanvas;\n    const webGLMode = option.webGLMode || WebGLMode.Auto;\n    let gl: (WebGLRenderingContext & WebGLExtension) | WebGL2RenderingContext;\n\n    if (webGLMode == WebGLMode.Auto || webGLMode == WebGLMode.WebGL2) {\n      gl = webCanvas.getContext(\"webgl2\", option);\n      if (!gl && webCanvas instanceof HTMLCanvasElement) {\n        gl = <WebGL2RenderingContext>webCanvas.getContext(\"experimental-webgl2\", option);\n      }\n      this._isWebGL2 = true;\n    }\n\n    if (!gl) {\n      if (webGLMode == WebGLMode.Auto || webGLMode == WebGLMode.WebGL1) {\n        gl = <WebGLRenderingContext & WebGLExtension>webCanvas.getContext(\"webgl\", option);\n        if (!gl && webCanvas instanceof HTMLCanvasElement) {\n          gl = <WebGLRenderingContext & WebGLExtension>webCanvas.getContext(\"experimental-webgl\", option);\n        }\n        this._isWebGL2 = false;\n      }\n    }\n\n    if (!gl) {\n      throw new Error(\"Get GL Context FAILED.\");\n    }\n\n    this._gl = gl;\n    this._renderStates = new GLRenderStates(gl);\n    this._extensions = new GLExtensions(this);\n    this._capability = new GLCapability(this);\n\n    this._options = null;\n  }\n\n  createPlatformPrimitive(primitive: Primitive): IPlatformPrimitive {\n    return new GLPrimitive(this, primitive);\n  }\n\n  get gl() {\n    return this._gl;\n  }\n\n  get renderStates(): GLRenderStates {\n    return this._renderStates;\n  }\n\n  get capability(): GLCapability {\n    return this._capability;\n  }\n\n  requireExtension(ext) {\n    return this._extensions.requireExtension(ext);\n  }\n\n  canIUse(capabilityType: GLCapabilityType) {\n    return this.capability.canIUse(capabilityType);\n  }\n\n  canIUseCompressedTextureInternalFormat(type: number) {\n    return this.capability.canIUseCompressedTextureInternalFormat(type);\n  }\n\n  public get canIUseMoreJoints() {\n    return this.capability.canIUseMoreJoints;\n  }\n\n  viewport(x, y, width, height) {\n    // gl.enable(gl.SCISSOR_TEST);\n    // gl.scissor(x, transformY, width, height);\n    const gl = this._gl;\n    gl.viewport(x, gl.drawingBufferHeight - y - height, width, height);\n  }\n\n  colorMask(r, g, b, a) {\n    this._gl.colorMask(r, g, b, a);\n  }\n\n  clearRenderTarget(engine: Engine, clearMode: ClearMode, clearParam: Vector4) {\n    const gl = this._gl;\n    const lastRenderState = engine._lastRenderState;\n    const {\n      blendState: {\n        targetBlendState: { colorWriteMask }\n      },\n      depthState: { writeEnabled: depthWriteEnabled },\n      stencilState: { writeMask: stencilWriteMask }\n    } = lastRenderState;\n\n    let clearColor = false;\n    let clearDepth = false;\n    let clearStencil = false;\n\n    switch (clearMode) {\n      case ClearMode.SOLID_COLOR:\n        gl.clearColor(clearParam.x, clearParam.y, clearParam.z, clearParam.w);\n        clearColor = clearDepth = true;\n        break;\n      case ClearMode.DEPTH_ONLY:\n        clearDepth = true;\n        break;\n      case ClearMode.COLOR_ONLY:\n        gl.clearColor(clearParam.x, clearParam.y, clearParam.z, clearParam.w);\n        clearColor = true;\n        break;\n      case ClearMode.STENCIL_ONLY:\n        gl.clear(gl.STENCIL_BUFFER_BIT);\n        clearStencil = true;\n        break;\n      case ClearMode.ALL_CLEAR:\n        gl.clearColor(clearParam.x, clearParam.y, clearParam.z, clearParam.w);\n        clearColor = clearDepth = clearStencil = true;\n        break;\n    }\n\n    if (clearColor && colorWriteMask !== ColorWriteMask.All) {\n      gl.colorMask(true, true, true, true);\n      lastRenderState.blendState.targetBlendState.colorWriteMask = ColorWriteMask.All;\n    }\n\n    if (clearDepth && depthWriteEnabled !== true) {\n      gl.depthMask(true);\n      lastRenderState.depthState.writeEnabled = true;\n    }\n\n    if (clearStencil && stencilWriteMask !== 0xff) {\n      gl.stencilMask(0xff);\n      lastRenderState.stencilState.writeMask = 0xff;\n    }\n\n    gl.clear(\n      (clearColor ? gl.COLOR_BUFFER_BIT : 0) |\n        (clearDepth ? gl.DEPTH_BUFFER_BIT : 0) |\n        (clearStencil ? gl.STENCIL_BUFFER_BIT : 0)\n    );\n  }\n\n  drawPrimitive(primitive: Primitive, subPrimitive: SubPrimitive, shaderProgram: any) {\n    // todo: VAO not support morph animation\n    if (primitive) {\n      //@ts-ignore\n      primitive._draw(shaderProgram, subPrimitive);\n    } else {\n      Logger.error(\"draw primitive failed.\");\n    }\n  }\n\n  drawSprite(material, positionQuad, uvRect, tintColor, texture, renderMode, camera: Camera) {\n    if (!this._spriteBatcher) {\n      this._spriteBatcher = new GLSpriteBatcher(this);\n    }\n\n    this._spriteBatcher.drawSprite(material, positionQuad, uvRect, tintColor, texture, renderMode, camera);\n  }\n\n  flushSprite(engine: Engine, material: Material) {\n    if (this._spriteBatcher) {\n      this._spriteBatcher.flush(engine, material);\n    }\n  }\n\n  activeRenderTarget(renderTarget: RenderTarget, camera: Camera) {\n    const gl = this._gl;\n    if (renderTarget) {\n      renderTarget._activeRenderTarget();\n      const { width, height } = renderTarget;\n      gl.viewport(0.0, 0.0, width, height);\n    } else {\n      gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n      const viewport = camera.viewport;\n      const width = gl.drawingBufferWidth;\n      const height = gl.drawingBufferHeight;\n      this.viewport(viewport.x * width, viewport.y * height, viewport.z * width, viewport.w * height);\n    }\n  }\n\n  blitRenderTarget(renderTarget: RenderTarget) {\n    if (renderTarget) {\n      if (renderTarget._MSAAFrameBuffer) {\n        renderTarget._blitRenderTarget();\n        return;\n      }\n    }\n  }\n\n  setRenderTargetFace(renderTarget: RenderTarget, cubeFace: TextureCubeFace) {\n    if (renderTarget) {\n      renderTarget._setRenderTargetFace(cubeFace);\n    }\n  }\n\n  destroy() {}\n\n  activeTexture(textureID: number): void {\n    if (this._activedTextureID !== textureID) {\n      this._gl.activeTexture(textureID);\n      this._activedTextureID = textureID;\n    }\n  }\n\n  bindTexture(target: number, texture: WebGLTexture): void {\n    const gl = this._gl;\n    if (this._activeTextures[this._activedTextureID - gl.TEXTURE0] !== texture) {\n      gl.bindTexture(target, texture);\n      this._activeTextures[this._activedTextureID - gl.TEXTURE0] = texture;\n    }\n  }\n}\n","import { Engine } from \"@oasis-engine/core\";\nimport { WebCanvas } from \"./WebCanvas\";\nimport { WebGLRenderer, WebGLRendererOptions } from \"./WebGLRenderer\";\n\n/**\n * WebGL platform engine,support includes WebGL1.0 and WebGL2.0.\n */\nexport class WebGLEngine extends Engine {\n  /**\n   * Create an engine suitable for the WebGL platform.\n   * @param canvas - Native web canvas\n   * @param webGLRendererOptions - WebGL renderer options\n   */\n  constructor(canvas: string | HTMLCanvasElement | OffscreenCanvas, webGLRendererOptions?: WebGLRendererOptions) {\n    const webCanvas = new WebCanvas(\n      <HTMLCanvasElement | OffscreenCanvas>(typeof canvas === \"string\" ? document.getElementById(canvas) : canvas)\n    );\n    const hardwareRenderer = new WebGLRenderer(webGLRendererOptions);\n\n    super(webCanvas, hardwareRenderer);\n  }\n\n  /**\n   * Web canvas.\n   */\n  get canvas(): WebCanvas {\n    return this._canvas as WebCanvas;\n  }\n}\n"],"names":["WebCanvas","resizeByClientSize","pixelRatio","window","devicePixelRatio","webCanvas","_webCanvas","HTMLCanvasElement","width","clientWidth","height","clientHeight","_width","_height","_scale","Vector2","setScale","x","y","setValue","scale","value","style","transformOrigin","transform","GLCapability","rhi","_maxDrawBuffers","_maxAnisoLevel","_maxAntiAliasing","_rhi","capabilityList","Map","init","compatibleAllInterface","canIUse","capabilityType","get","canIUseCompressedTextureInternalFormat","internalType","RGBA_ASTC_4X4_KHR","GLCompressedTextureInternalFormat","RGBA_ASTC_12X12_KHR","SRGB8_ALPHA8_ASTC_4X4_KHR","SRGB8_ALPHA8_ASTC_12X12_KHR","RGB_ETC1_WEBGL","R11_EAC","SRGB8_ALPHA8_ETC2_EAC","RGB_PVRTC_4BPPV1_IMG","RGBA_PVRTC_2BPPV1_IMG","RGB_S3TC_DXT1_EXT","RGBA_S3TC_DXT5_EXT","GLCapabilityType","astc","etc1","etc","pvrtc","s3tc","cap","isWebGL2","requireExtension","bind","standardDerivatives","shaderTextureLod","elementIndexUint","depthTexture","vertexArrayObject","instancedArrays","multipleSample","drawBuffers","astc_webkit","etc_webkit","etc1_webkit","pvrtc_webkit","s3tc_webkit","textureFloat","textureHalfFloat","textureFloatLinear","textureHalfFloatLinear","WEBGL_colorBufferFloat","colorBufferFloat","colorBufferHalfFloat","textureFilterAnisotropic","set","compatibleInterface","flatItem","gl","ext","glKey","extensionKey","extensionVal","UNSIGNED_INT_24_8","createVertexArray","deleteVertexArray","isVertexArray","bindVertexArray","drawArraysInstanced","drawElementsInstanced","vertexAttribDivisor","MAX_DRAW_BUFFERS","items","maxDrawBuffers","i","HAFL_FLOAT","RGBA16F","RGBA32F","TEXTURE_MAX_ANISOTROPY_EXT","getParameter","MAX_TEXTURE_MAX_ANISOTROPY_EXT","canMSAA","MAX_SAMPLES","renderStates","MAX_VERTEX_TEXTURE_IMAGE_UNITS","GLExtensions","_requireResult","undefined","getExtension","GLPrimitive","primitive","_primitive","attribLocArray","canUseInstancedArrays","vao","_useVao","draw","shaderProgram","subPrimitive","has","id","registerVAO","bindBufferAndAttrib","indexBufferBinding","instanceCount","_glIndexType","topology","start","count","drawElements","_nativeBuffer","buffer","bindBuffer","ELEMENT_ARRAY_BUFFER","drawArrays","Logger","error","disableAttrib","destroy","forEach","vertexBufferBindings","attributeLocation","attributes","_vertexElementMap","vbo","lastBoundVbo","name","loc","element","bindingIndex","stride","ARRAY_BUFFER","enableVertexAttribArray","_glElementInfo","size","type","vertexAttribPointer","normalized","offset","instanceDivisor","push","warn","l","length","disableVertexAttribArray","GLRenderStates","_gl","_parameters","MAX_COMBINED_TEXTURE_IMAGE_UNITS","MAX_VERTEX_UNIFORM_VECTORS","MAX_VERTEX_ATTRIBS","blendFuncSeparate","ONE","ZERO","blendEquationSeparate","FUNC_ADD","colorMask","blendColor","disable","SAMPLE_ALPHA_TO_COVERAGE","enable","DEPTH_TEST","depthFunc","LESS","depthMask","STENCIL_TEST","stencilFuncSeparate","FRONT","ALWAYS","BACK","stencilOpSeparate","KEEP","stencilMask","CULL_FACE","cullFace","POLYGON_OFFSET_FILL","polygonOffset","pname","GLSprite","_vbo","_maxBatchCount","_vertBuffer","_vertCursor","_drawSpriteCount","_vertAttributes","_initVertexAttributes","createBuffer","setMaxBatchCount","requireSize","Float32Array","beginDraw","drawSprite","positionQuad","uvRect","tintColor","color","u","v","p","q","_pushVertex","leftTop","leftBottom","rightBottom","rightTop","endDraw","vertCount","bufferData","DYNAMIC_DRAW","k","location","attrib","TRIANGLES","vertexStride","posAtt","uvAtt","colorAtt","a_pos","a_uv","a_color","att","FLOAT","pos","uv","vb","z","w","finalize","deleteBuffer","spriteVertShader","spriteFragmentShader","Shader","create","GLSpriteBatcher","_batchedQueue","_targetTexture","_glSprite","_camera","flush","engine","material","materialData","shaderData","setTexture","setMatrix","viewMatrix","projectionMatrix","compileMacros","RenderQueue","clear","program","shader","_getShaderProgram","isValid","groupingOtherUniformBlock","uploadAll","materialUniformBlock","renderState","_apply","len","canBatch","texture","renderMode","camera","WebGLMode","WebGLRenderer","options","_currentBind","_options","_renderStates","_extensions","_spriteBatcher","_capability","_isWebGL2","_activedTextureID","_activeTextures","Array","canvas","option","webGLMode","Auto","WebGL2","getContext","WebGL1","Error","createPlatformPrimitive","capability","viewport","drawingBufferHeight","r","g","b","a","clearRenderTarget","clearMode","clearParam","lastRenderState","_lastRenderState","colorWriteMask","blendState","targetBlendState","depthWriteEnabled","depthState","writeEnabled","stencilWriteMask","stencilState","writeMask","clearColor","clearDepth","clearStencil","ClearMode","SOLID_COLOR","DEPTH_ONLY","COLOR_ONLY","STENCIL_ONLY","STENCIL_BUFFER_BIT","ALL_CLEAR","ColorWriteMask","All","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","drawPrimitive","_draw","flushSprite","activeRenderTarget","renderTarget","_activeRenderTarget","bindFramebuffer","FRAMEBUFFER","drawingBufferWidth","blitRenderTarget","_MSAAFrameBuffer","_blitRenderTarget","setRenderTargetFace","cubeFace","_setRenderTargetFace","activeTexture","textureID","bindTexture","target","TEXTURE0","canIUseMoreJoints","WebGLEngine","webGLRendererOptions","document","getElementById","hardwareRenderer","_canvas","Engine"],"mappings":"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"}